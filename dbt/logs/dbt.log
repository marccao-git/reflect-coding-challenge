[0m11:04:24.846090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a792100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b808df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b808340>]}


============================== 11:04:24.850046 | a1acbf5f-becc-4963-9a19-bd55f2b7e4e0 ==============================
[0m11:04:24.850046 [info ] [MainThread]: Running with dbt=1.10.17
[0m11:04:24.850305 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/marccao/repo/dbt', 'quiet': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'version_check': 'True', 'debug': 'False', 'warn_error': 'None', 'log_format': 'default', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'empty': 'None', 'introspect': 'True', 'partial_parse': 'True', 'use_colors': 'True', 'invocation_command': 'dbt debug', 'cache_selected_only': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'printer_width': '80', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m11:04:24.856318 [info ] [MainThread]: dbt version: 1.10.17
[0m11:04:24.856480 [info ] [MainThread]: python version: 3.9.6
[0m11:04:24.856659 [info ] [MainThread]: python path: /Users/marccao/repo/.venv/bin/python
[0m11:04:24.856805 [info ] [MainThread]: os info: macOS-26.1-arm64-arm-64bit
[0m11:04:24.904804 [info ] [MainThread]: Using profiles dir at /Users/marccao/repo/dbt
[0m11:04:24.905085 [info ] [MainThread]: Using profiles.yml file at /Users/marccao/repo/dbt/profiles.yml
[0m11:04:24.905236 [info ] [MainThread]: Using dbt_project.yml file at /Users/marccao/repo/dbt/dbt_project.yml
[0m11:04:24.905610 [info ] [MainThread]: adapter type: postgres
[0m11:04:24.905754 [info ] [MainThread]: adapter version: 1.9.1
[0m11:04:24.950275 [info ] [MainThread]: Configuration:
[0m11:04:24.950544 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:04:24.950681 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:04:24.950810 [info ] [MainThread]: Required dependencies:
[0m11:04:24.950990 [debug] [MainThread]: Executing "git --help"
[0m11:04:24.963502 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:04:24.963957 [debug] [MainThread]: STDERR: "b''"
[0m11:04:24.964120 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:04:24.964269 [info ] [MainThread]: Connection:
[0m11:04:24.964436 [info ] [MainThread]:   host: localhost
[0m11:04:24.964560 [info ] [MainThread]:   port: 5433
[0m11:04:24.964680 [info ] [MainThread]:   user: lucca_user
[0m11:04:24.964797 [info ] [MainThread]:   database: lucca_db
[0m11:04:24.964913 [info ] [MainThread]:   schema: public
[0m11:04:24.965029 [info ] [MainThread]:   connect_timeout: 10
[0m11:04:24.965145 [info ] [MainThread]:   role: None
[0m11:04:24.965262 [info ] [MainThread]:   search_path: None
[0m11:04:24.965381 [info ] [MainThread]:   keepalives_idle: 0
[0m11:04:24.965497 [info ] [MainThread]:   sslmode: None
[0m11:04:24.965614 [info ] [MainThread]:   sslcert: None
[0m11:04:24.965730 [info ] [MainThread]:   sslkey: None
[0m11:04:24.965846 [info ] [MainThread]:   sslrootcert: None
[0m11:04:24.965962 [info ] [MainThread]:   application_name: dbt
[0m11:04:24.966078 [info ] [MainThread]:   retries: 1
[0m11:04:24.966373 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:04:25.020789 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m11:04:25.043987 [debug] [MainThread]: Using postgres connection "debug"
[0m11:04:25.044177 [debug] [MainThread]: On debug: select 1 as id
[0m11:04:25.044299 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:04:25.162737 [debug] [MainThread]: SQL status: SELECT 1 in 0.118 seconds
[0m11:04:25.163481 [debug] [MainThread]: On debug: Close
[0m11:04:25.163726 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m11:04:25.163918 [info ] [MainThread]: [32mAll checks passed![0m
[0m11:04:25.172467 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.36422586, "process_in_blocks": "0", "process_kernel_time": 0.158111, "process_mem_max_rss": "124108800", "process_out_blocks": "0", "process_user_time": 0.75806}
[0m11:04:25.172814 [debug] [MainThread]: Command `dbt debug` succeeded at 11:04:25.172754 after 0.36 seconds
[0m11:04:25.173014 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:04:25.173203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a792100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd9c2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa2b2e0>]}
[0m11:04:25.173440 [debug] [MainThread]: Flushing usage events
[0m11:04:25.543791 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:22:12.988456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b79eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bf0f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bf0490>]}


============================== 12:22:12.990721 | 703de0b2-b702-40c5-b226-f41caaaeea47 ==============================
[0m12:22:12.990721 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:22:12.990984 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'no_print': 'None', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'introspect': 'True', 'version_check': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'partial_parse': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'debug': 'False', 'indirect_selection': 'eager', 'target_path': 'None'}
[0m12:22:13.084964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065217f0>]}
[0m12:22:13.111931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ee46d0>]}
[0m12:22:13.112673 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:22:13.165872 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:22:13.166297 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m12:22:13.166487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d8520>]}
[0m12:22:13.676891 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.lucca_dbt.marts
[0m12:22:13.681706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ea6130>]}
[0m12:22:13.718577 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:22:13.719884 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:22:13.731235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ee9a30>]}
[0m12:22:13.731462 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m12:22:13.731616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f0d3a0>]}
[0m12:22:13.732176 [info ] [MainThread]: 
[0m12:22:13.732329 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:22:13.732456 [info ] [MainThread]: 
[0m12:22:13.732670 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:22:13.733089 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:22:13.760797 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:22:13.761027 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:22:13.761159 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:22:13.887606 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.126 seconds
[0m12:22:13.888338 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:22:13.888889 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public)
[0m12:22:13.892218 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m12:22:13.892384 [debug] [ThreadPool]: On list_lucca_db_public: BEGIN
[0m12:22:13.892521 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:22:13.901841 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m12:22:13.902038 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m12:22:13.902205 [debug] [ThreadPool]: On list_lucca_db_public: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:22:13.908794 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m12:22:13.909464 [debug] [ThreadPool]: On list_lucca_db_public: ROLLBACK
[0m12:22:13.909906 [debug] [ThreadPool]: On list_lucca_db_public: Close
[0m12:22:13.912375 [debug] [MainThread]: Using postgres connection "master"
[0m12:22:13.912573 [debug] [MainThread]: On master: BEGIN
[0m12:22:13.912722 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:22:13.921080 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:22:13.921309 [debug] [MainThread]: Using postgres connection "master"
[0m12:22:13.921495 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:22:13.925616 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m12:22:13.926348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2fcac0>]}
[0m12:22:13.926618 [debug] [MainThread]: On master: ROLLBACK
[0m12:22:13.927148 [debug] [MainThread]: Using postgres connection "master"
[0m12:22:13.927579 [debug] [MainThread]: On master: BEGIN
[0m12:22:13.928330 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:22:13.928497 [debug] [MainThread]: On master: COMMIT
[0m12:22:13.928646 [debug] [MainThread]: Using postgres connection "master"
[0m12:22:13.928787 [debug] [MainThread]: On master: COMMIT
[0m12:22:13.929222 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:22:13.929376 [debug] [MainThread]: On master: Close
[0m12:22:13.931690 [debug] [Thread-1  ]: Began running node model.lucca_dbt.users_mart
[0m12:22:13.931995 [info ] [Thread-1  ]: 1 of 1 START sql view model public.users_mart .................................. [RUN]
[0m12:22:13.932240 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public, now model.lucca_dbt.users_mart)
[0m12:22:13.932422 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.users_mart
[0m12:22:13.937562 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.users_mart"
[0m12:22:13.938158 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.users_mart
[0m12:22:13.986648 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.users_mart"
[0m12:22:13.987398 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:22:13.987619 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: BEGIN
[0m12:22:13.987784 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:22:13.998623 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m12:22:13.998873 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:22:13.999026 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.users_mart"} */

  create view "lucca_db"."public"."users_mart__dbt_tmp"
    
    
  as (
    select
    id, 
    name
from "lucca_db"."public"."users"
  );
[0m12:22:14.002862 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m12:22:14.005832 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:22:14.005994 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.users_mart"} */
alter table "lucca_db"."public"."users_mart__dbt_tmp" rename to "users_mart"
[0m12:22:14.006822 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:22:14.013055 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: COMMIT
[0m12:22:14.013205 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:22:14.013336 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: COMMIT
[0m12:22:14.015375 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:22:14.017968 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public"."users_mart__dbt_backup"
[0m12:22:14.019791 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:22:14.019948 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.users_mart"} */
drop view if exists "lucca_db"."public"."users_mart__dbt_backup" cascade
[0m12:22:14.020840 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m12:22:14.021875 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: Close
[0m12:22:14.022893 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '703de0b2-b702-40c5-b226-f41caaaeea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065026d0>]}
[0m12:22:14.023184 [info ] [Thread-1  ]: 1 of 1 OK created sql view model public.users_mart ............................. [[32mCREATE VIEW[0m in 0.09s]
[0m12:22:14.023436 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.users_mart
[0m12:22:14.023905 [debug] [MainThread]: Using postgres connection "master"
[0m12:22:14.024066 [debug] [MainThread]: On master: BEGIN
[0m12:22:14.024194 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:22:14.033246 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m12:22:14.033458 [debug] [MainThread]: On master: COMMIT
[0m12:22:14.033590 [debug] [MainThread]: Using postgres connection "master"
[0m12:22:14.033703 [debug] [MainThread]: On master: COMMIT
[0m12:22:14.034140 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:22:14.034269 [debug] [MainThread]: On master: Close
[0m12:22:14.034450 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:22:14.034560 [debug] [MainThread]: Connection 'model.lucca_dbt.users_mart' was properly closed.
[0m12:22:14.034683 [info ] [MainThread]: 
[0m12:22:14.034823 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m12:22:14.035153 [debug] [MainThread]: Command end result
[0m12:22:14.045346 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:22:14.046251 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:22:14.049829 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:22:14.049988 [info ] [MainThread]: 
[0m12:22:14.050162 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:22:14.050294 [info ] [MainThread]: 
[0m12:22:14.050435 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:22:14.052157 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1022509, "process_in_blocks": "0", "process_kernel_time": 0.200623, "process_mem_max_rss": "133283840", "process_out_blocks": "0", "process_user_time": 1.382976}
[0m12:22:14.052318 [debug] [MainThread]: Command `dbt run` succeeded at 12:22:14.052286 after 1.10 seconds
[0m12:22:14.052477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b79eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107eba850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a28e80>]}
[0m12:22:14.052624 [debug] [MainThread]: Flushing usage events
[0m12:22:14.413692 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:26:30.023954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d55df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dcce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dcc400>]}


============================== 12:26:30.026170 | 69a074f5-3900-4557-8ad6-3b2cb7d88d65 ==============================
[0m12:26:30.026170 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:26:30.026437 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'cache_selected_only': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'introspect': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'version_check': 'True', 'write_json': 'True', 'debug': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'printer_width': '80'}
[0m12:26:30.115689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '69a074f5-3900-4557-8ad6-3b2cb7d88d65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c8bb0>]}
[0m12:26:30.141960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '69a074f5-3900-4557-8ad6-3b2cb7d88d65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091c2ee0>]}
[0m12:26:30.142677 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:26:30.197685 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:26:30.263343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:26:30.263666 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/marts/users_mart.sql
[0m12:26:30.369876 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.lucca_dbt.marts
[0m12:26:30.376668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '69a074f5-3900-4557-8ad6-3b2cb7d88d65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f6deb0>]}
[0m12:26:30.433656 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:26:30.434718 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:26:30.443136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '69a074f5-3900-4557-8ad6-3b2cb7d88d65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ded430>]}
[0m12:26:30.443348 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m12:26:30.443501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69a074f5-3900-4557-8ad6-3b2cb7d88d65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072b38e0>]}
[0m12:26:30.444047 [info ] [MainThread]: 
[0m12:26:30.444202 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:26:30.444327 [info ] [MainThread]: 
[0m12:26:30.444545 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:26:30.444892 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:26:30.472825 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:26:30.473029 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:26:30.473152 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:26:30.510910 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.038 seconds
[0m12:26:30.511538 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:26:30.512029 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public)
[0m12:26:30.514765 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m12:26:30.514910 [debug] [ThreadPool]: On list_lucca_db_public: BEGIN
[0m12:26:30.515026 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:26:30.523764 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m12:26:30.523887 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m12:26:30.524011 [debug] [ThreadPool]: On list_lucca_db_public: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:26:30.528785 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m12:26:30.529339 [debug] [ThreadPool]: On list_lucca_db_public: ROLLBACK
[0m12:26:30.529701 [debug] [ThreadPool]: On list_lucca_db_public: Close
[0m12:26:30.531852 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:30.532009 [debug] [MainThread]: On master: BEGIN
[0m12:26:30.532131 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:26:30.537446 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m12:26:30.537608 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:30.537767 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:26:30.540758 [debug] [MainThread]: SQL status: SELECT 1 in 0.003 seconds
[0m12:26:30.541395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69a074f5-3900-4557-8ad6-3b2cb7d88d65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092bd730>]}
[0m12:26:30.541596 [debug] [MainThread]: On master: ROLLBACK
[0m12:26:30.541917 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:30.542037 [debug] [MainThread]: On master: BEGIN
[0m12:26:30.542583 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:26:30.542716 [debug] [MainThread]: On master: COMMIT
[0m12:26:30.542849 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:30.542965 [debug] [MainThread]: On master: COMMIT
[0m12:26:30.543296 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:26:30.543442 [debug] [MainThread]: On master: Close
[0m12:26:30.544786 [debug] [Thread-1  ]: Began running node model.lucca_dbt.users_mart
[0m12:26:30.545018 [info ] [Thread-1  ]: 1 of 1 START sql table model public.users_mart ................................. [RUN]
[0m12:26:30.545227 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public, now model.lucca_dbt.users_mart)
[0m12:26:30.545370 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.users_mart
[0m12:26:30.549466 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.users_mart"
[0m12:26:30.549895 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.users_mart
[0m12:26:30.568955 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.users_mart"
[0m12:26:30.569405 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:26:30.569554 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: BEGIN
[0m12:26:30.569698 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:26:30.579999 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m12:26:30.580168 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:26:30.580323 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.users_mart"} */

  
    

  create  table "lucca_db"."public"."users_mart__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name
from "lucca_db"."public"."users"
  );
  
[0m12:26:30.586045 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m12:26:30.590679 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:26:30.590864 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.users_mart"} */
alter table "lucca_db"."public"."users_mart" rename to "users_mart__dbt_backup"
[0m12:26:30.591974 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:26:30.593291 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:26:30.593441 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.users_mart"} */
alter table "lucca_db"."public"."users_mart__dbt_tmp" rename to "users_mart"
[0m12:26:30.594065 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:26:30.601017 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: COMMIT
[0m12:26:30.601178 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:26:30.601323 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: COMMIT
[0m12:26:30.602465 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:26:30.605635 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public"."users_mart__dbt_backup"
[0m12:26:30.607485 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.users_mart"
[0m12:26:30.607646 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.users_mart"} */
drop view if exists "lucca_db"."public"."users_mart__dbt_backup" cascade
[0m12:26:30.609910 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.002 seconds
[0m12:26:30.610920 [debug] [Thread-1  ]: On model.lucca_dbt.users_mart: Close
[0m12:26:30.611924 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69a074f5-3900-4557-8ad6-3b2cb7d88d65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066de610>]}
[0m12:26:30.612213 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public.users_mart ............................ [[32mSELECT 115[0m in 0.07s]
[0m12:26:30.612455 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.users_mart
[0m12:26:30.612882 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:30.613001 [debug] [MainThread]: On master: BEGIN
[0m12:26:30.613121 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:26:30.622622 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m12:26:30.622780 [debug] [MainThread]: On master: COMMIT
[0m12:26:30.622908 [debug] [MainThread]: Using postgres connection "master"
[0m12:26:30.623016 [debug] [MainThread]: On master: COMMIT
[0m12:26:30.623354 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:26:30.623470 [debug] [MainThread]: On master: Close
[0m12:26:30.623675 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:26:30.623845 [debug] [MainThread]: Connection 'model.lucca_dbt.users_mart' was properly closed.
[0m12:26:30.624016 [info ] [MainThread]: 
[0m12:26:30.624192 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m12:26:30.624489 [debug] [MainThread]: Command end result
[0m12:26:30.633899 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:26:30.634651 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:26:30.637580 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:26:30.637712 [info ] [MainThread]: 
[0m12:26:30.637893 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:26:30.638030 [info ] [MainThread]: 
[0m12:26:30.638176 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:26:30.639697 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6540037, "process_in_blocks": "0", "process_kernel_time": 0.17966, "process_mem_max_rss": "129417216", "process_out_blocks": "0", "process_user_time": 1.013343}
[0m12:26:30.639892 [debug] [MainThread]: Command `dbt run` succeeded at 12:26:30.639852 after 0.65 seconds
[0m12:26:30.640077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d55df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072ee820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ded520>]}
[0m12:26:30.640380 [debug] [MainThread]: Flushing usage events
[0m12:26:30.999740 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:02:35.037865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fbae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109030f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090304c0>]}


============================== 13:02:35.040114 | a1b7c95c-f59d-4cdf-a75f-89c5556a204a ==============================
[0m13:02:35.040114 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:02:35.040377 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'no_print': 'None', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'introspect': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'write_json': 'True', 'partial_parse': 'True', 'empty': 'False', 'invocation_command': 'dbt run', 'use_colors': 'True', 'warn_error': 'None', 'static_parser': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'log_format': 'default'}
[0m13:02:35.131701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a1b7c95c-f59d-4cdf-a75f-89c5556a204a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ff5700>]}
[0m13:02:35.182044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a1b7c95c-f59d-4cdf-a75f-89c5556a204a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a57460>]}
[0m13:02:35.182779 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:02:35.238993 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:02:35.287282 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:02:35.287561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a1b7c95c-f59d-4cdf-a75f-89c5556a204a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088b63d0>]}
[0m13:02:35.694250 [error] [MainThread]: Encountered an error:
Compilation Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  expected token ',', got 'peux'
    line 3
      schema='base'  -- tu peux changer en analytics ou raw selon l'organisation
[0m13:02:35.695841 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.69527394, "process_in_blocks": "0", "process_kernel_time": 0.16927, "process_mem_max_rss": "112377856", "process_out_blocks": "0", "process_user_time": 1.152263}
[0m13:02:35.696047 [debug] [MainThread]: Command `dbt run` failed at 13:02:35.696003 after 0.70 seconds
[0m13:02:35.696225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fbae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a17fb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a17fa90>]}
[0m13:02:35.696407 [debug] [MainThread]: Flushing usage events
[0m13:02:36.062141 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:02.176069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a85dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108afbc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108afb1f0>]}


============================== 13:03:02.178362 | 87757899-41c2-4adf-b12f-c0849370af80 ==============================
[0m13:03:02.178362 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:03:02.178619 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_colors': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'version_check': 'True', 'empty': 'False', 'log_cache_events': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'quiet': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'target_path': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'static_parser': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'no_print': 'None'}
[0m13:03:02.269237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fc0700>]}
[0m13:03:02.295461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083848b0>]}
[0m13:03:02.295961 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:03:02.345971 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:03:02.390207 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:03:02.390468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083a2880>]}
[0m13:03:02.877838 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.raw
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m13:03:02.882750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d91100>]}
[0m13:03:02.918125 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:03:02.919308 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:03:02.928034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109be9fd0>]}
[0m13:03:02.928240 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:03:02.928386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109df9d60>]}
[0m13:03:02.929067 [info ] [MainThread]: 
[0m13:03:02.929214 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:03:02.929345 [info ] [MainThread]: 
[0m13:03:02.929559 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:03:02.929912 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:03:02.957453 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:03:02.957665 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:03:02.957785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:03.053229 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.095 seconds
[0m13:03:03.053984 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:03:03.054381 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_base)
[0m13:03:03.054650 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_base"
"
[0m13:03:03.057574 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:03:03.057733 [debug] [ThreadPool]: On create_lucca_db_public_base: BEGIN
[0m13:03:03.057870 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:03:03.067134 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:03:03.067289 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:03:03.067434 [debug] [ThreadPool]: On create_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_base"} */
create schema if not exists "public_base"
[0m13:03:03.068606 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:03:03.069019 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:03:03.069180 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:03:03.069316 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:03:03.070167 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:03:03.070314 [debug] [ThreadPool]: On create_lucca_db_public_base: Close
[0m13:03:03.070795 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_base, now list_lucca_db_public_base)
[0m13:03:03.073642 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:03:03.073798 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:03:03.073928 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:03:03.082903 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:03:03.083122 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:03:03.083291 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:03:03.087499 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:03:03.088078 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:03:03.088547 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:03:03.090672 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:03.090835 [debug] [MainThread]: On master: BEGIN
[0m13:03:03.090970 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:03:03.098794 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m13:03:03.099004 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:03.099183 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:03:03.103575 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:03:03.104156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d92850>]}
[0m13:03:03.104407 [debug] [MainThread]: On master: ROLLBACK
[0m13:03:03.105022 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:03.105164 [debug] [MainThread]: On master: BEGIN
[0m13:03:03.105913 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:03:03.106062 [debug] [MainThread]: On master: COMMIT
[0m13:03:03.106200 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:03.106333 [debug] [MainThread]: On master: COMMIT
[0m13:03:03.106878 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:03:03.107025 [debug] [MainThread]: On master: Close
[0m13:03:03.108644 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:03:03.108923 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:03:03.109154 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m13:03:03.109329 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:03:03.114412 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:03:03.114815 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:03:03.134757 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:03:03.135434 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:03:03.135610 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:03:03.135754 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:03:03.145826 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m13:03:03.145999 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:03:03.146186 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:03:03.147114 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "("
LINE 24:     (raw_payload->'manager'->>'id')::int as manager_id,
             ^

[0m13:03:03.147307 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: ROLLBACK
[0m13:03:03.148003 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:03:03.159774 [debug] [Thread-1  ]: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  syntax error at or near "("
  LINE 24:     (raw_payload->'manager'->>'id')::int as manager_id,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m13:03:03.160823 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87757899-41c2-4adf-b12f-c0849370af80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064fea30>]}
[0m13:03:03.161130 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_base.lucca_raw_data ............... [[31mERROR[0m in 0.05s]
[0m13:03:03.161393 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:03:03.161630 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.lucca_raw_data' to be skipped because of status 'error'.  Reason: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  syntax error at or near "("
  LINE 24:     (raw_payload->'manager'->>'id')::int as manager_id,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql.
[0m13:03:03.162095 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:03.162232 [debug] [MainThread]: On master: BEGIN
[0m13:03:03.162341 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:03:03.172477 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m13:03:03.172651 [debug] [MainThread]: On master: COMMIT
[0m13:03:03.172793 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:03.172921 [debug] [MainThread]: On master: COMMIT
[0m13:03:03.173300 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:03:03.173441 [debug] [MainThread]: On master: Close
[0m13:03:03.173634 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:03:03.173760 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:03:03.173892 [info ] [MainThread]: 
[0m13:03:03.174033 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m13:03:03.174328 [debug] [MainThread]: Command end result
[0m13:03:03.209197 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:03:03.209979 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:03:03.212861 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:03:03.212994 [info ] [MainThread]: 
[0m13:03:03.213167 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:03:03.213312 [info ] [MainThread]: 
[0m13:03:03.213477 [error] [MainThread]: [31mFailure in model lucca_raw_data (models/models/base/lucca_raw_data.sql)[0m
[0m13:03:03.213635 [error] [MainThread]:   Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  syntax error at or near "("
  LINE 24:     (raw_payload->'manager'->>'id')::int as manager_id,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m13:03:03.213761 [info ] [MainThread]: 
[0m13:03:03.213906 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m13:03:03.214028 [info ] [MainThread]: 
[0m13:03:03.214168 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:03:03.215465 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.073039, "process_in_blocks": "0", "process_kernel_time": 0.152156, "process_mem_max_rss": "132694016", "process_out_blocks": "0", "process_user_time": 1.372555}
[0m13:03:03.215647 [debug] [MainThread]: Command `dbt run` failed at 13:03:03.215609 after 1.07 seconds
[0m13:03:03.215808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a85dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d008e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d48ee0>]}
[0m13:03:03.215968 [debug] [MainThread]: Flushing usage events
[0m13:03:03.592960 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:49.814076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d72eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108de8f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108de8490>]}


============================== 13:03:49.816381 | d9bf45ba-e5ac-412c-a80c-f76af3e71cc9 ==============================
[0m13:03:49.816381 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:03:49.816647 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'use_experimental_parser': 'False', 'printer_width': '80', 'empty': 'False', 'target_path': 'None', 'introspect': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'version_check': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'no_print': 'None', 'warn_error': 'None', 'use_colors': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'quiet': 'False'}
[0m13:03:49.907962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9bf45ba-e5ac-412c-a80c-f76af3e71cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092b74f0>]}
[0m13:03:49.934463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9bf45ba-e5ac-412c-a80c-f76af3e71cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d4af40>]}
[0m13:03:49.934959 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:03:49.987484 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:03:50.057647 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:03:50.058003 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m13:03:50.166267 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.raw
[0m13:03:50.173300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9bf45ba-e5ac-412c-a80c-f76af3e71cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f71130>]}
[0m13:03:50.232791 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:03:50.234128 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:03:50.243310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9bf45ba-e5ac-412c-a80c-f76af3e71cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109eab9d0>]}
[0m13:03:50.243537 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:03:50.243691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9bf45ba-e5ac-412c-a80c-f76af3e71cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f85550>]}
[0m13:03:50.244265 [info ] [MainThread]: 
[0m13:03:50.244426 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:03:50.244556 [info ] [MainThread]: 
[0m13:03:50.244775 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:03:50.245143 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:03:50.274898 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:03:50.275108 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:03:50.275241 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:50.305854 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.031 seconds
[0m13:03:50.306540 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:03:50.307042 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m13:03:50.310063 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:03:50.310233 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:03:50.310364 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:03:50.317846 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:03:50.318010 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:03:50.318156 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:03:50.321296 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:03:50.321810 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:03:50.322210 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:03:50.324112 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:50.324261 [debug] [MainThread]: On master: BEGIN
[0m13:03:50.324382 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:03:50.331806 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:03:50.332021 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:50.332181 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:03:50.336056 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:03:50.336528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9bf45ba-e5ac-412c-a80c-f76af3e71cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095905b0>]}
[0m13:03:50.336735 [debug] [MainThread]: On master: ROLLBACK
[0m13:03:50.337171 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:50.337300 [debug] [MainThread]: On master: BEGIN
[0m13:03:50.338001 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:03:50.338131 [debug] [MainThread]: On master: COMMIT
[0m13:03:50.338252 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:50.338372 [debug] [MainThread]: On master: COMMIT
[0m13:03:50.338822 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:03:50.338951 [debug] [MainThread]: On master: Close
[0m13:03:50.340161 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:03:50.340391 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:03:50.340600 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m13:03:50.340801 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:03:50.345536 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:03:50.346078 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:03:50.367695 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:03:50.368230 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:03:50.368405 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:03:50.368553 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:03:50.376744 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:03:50.376953 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:03:50.377146 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:03:50.386358 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.009 seconds
[0m13:03:50.391860 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:03:50.392075 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:03:50.393046 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:03:50.399458 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:03:50.399661 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:03:50.399812 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:03:50.401439 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:03:50.404154 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:03:50.405957 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:03:50.406110 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:03:50.406765 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:03:50.407865 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:03:50.408912 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9bf45ba-e5ac-412c-a80c-f76af3e71cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a393940>]}
[0m13:03:50.409220 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m13:03:50.409475 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:03:50.409964 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:50.410109 [debug] [MainThread]: On master: BEGIN
[0m13:03:50.410237 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:03:50.418182 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m13:03:50.418579 [debug] [MainThread]: On master: COMMIT
[0m13:03:50.418762 [debug] [MainThread]: Using postgres connection "master"
[0m13:03:50.418904 [debug] [MainThread]: On master: COMMIT
[0m13:03:50.419492 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:03:50.419627 [debug] [MainThread]: On master: Close
[0m13:03:50.419812 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:03:50.419929 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:03:50.420059 [info ] [MainThread]: 
[0m13:03:50.420204 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m13:03:50.420494 [debug] [MainThread]: Command end result
[0m13:03:50.430687 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:03:50.431497 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:03:50.435103 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:03:50.435289 [info ] [MainThread]: 
[0m13:03:50.435474 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:03:50.435668 [info ] [MainThread]: 
[0m13:03:50.435833 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:03:50.437284 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.65978825, "process_in_blocks": "0", "process_kernel_time": 0.160724, "process_mem_max_rss": "129269760", "process_out_blocks": "0", "process_user_time": 1.040028}
[0m13:03:50.437477 [debug] [MainThread]: Command `dbt run` succeeded at 13:03:50.437437 after 0.66 seconds
[0m13:03:50.437651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d72eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108025a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092b74f0>]}
[0m13:03:50.437826 [debug] [MainThread]: Flushing usage events
[0m13:03:50.904852 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:04:42.872954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a482df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4f8e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4f8400>]}


============================== 13:04:42.875292 | 07818b75-dccc-4218-8294-4caad9df6770 ==============================
[0m13:04:42.875292 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:04:42.875555 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/marccao/repo/dbt/logs', 'introspect': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'no_print': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_cache_events': 'False', 'warn_error': 'None', 'write_json': 'True', 'printer_width': '80', 'static_parser': 'True', 'debug': 'False', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'log_format': 'default', 'quiet': 'False', 'version_check': 'True', 'indirect_selection': 'eager'}
[0m13:04:42.978601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4be070>]}
[0m13:04:43.007834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7c28b0>]}
[0m13:04:43.008502 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:04:43.063691 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:04:43.109187 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:04:43.109477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad7e5e0>]}
[0m13:04:43.597352 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m13:04:43.602041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c78f0d0>]}
[0m13:04:43.638048 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:04:43.639641 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:04:43.649155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7f39a0>]}
[0m13:04:43.649473 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:04:43.649640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5f51f0>]}
[0m13:04:43.650477 [info ] [MainThread]: 
[0m13:04:43.650646 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:04:43.650774 [info ] [MainThread]: 
[0m13:04:43.651001 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:04:43.651374 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:04:43.680642 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:04:43.680851 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:04:43.680988 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:04:43.705321 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.024 seconds
[0m13:04:43.705948 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:04:43.706270 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_base)
[0m13:04:43.706483 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_base"
"
[0m13:04:43.709091 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:04:43.709245 [debug] [ThreadPool]: On create_lucca_db_public_base: BEGIN
[0m13:04:43.709368 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:04:43.714081 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m13:04:43.714269 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:04:43.714408 [debug] [ThreadPool]: On create_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_base"} */
create schema if not exists "public_base"
[0m13:04:43.714841 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.000 seconds
[0m13:04:43.715231 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:04:43.715373 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:04:43.715483 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:04:43.715948 [debug] [ThreadPool]: SQL status: COMMIT in 0.000 seconds
[0m13:04:43.716067 [debug] [ThreadPool]: On create_lucca_db_public_base: Close
[0m13:04:43.716571 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_base, now list_lucca_db_public_base)
[0m13:04:43.719276 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:04:43.719424 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:04:43.719531 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:04:43.723709 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m13:04:43.723872 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:04:43.724014 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:04:43.726087 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m13:04:43.726586 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:04:43.726898 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:04:43.728703 [debug] [MainThread]: Using postgres connection "master"
[0m13:04:43.728831 [debug] [MainThread]: On master: BEGIN
[0m13:04:43.728942 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:04:43.733386 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:04:43.733522 [debug] [MainThread]: Using postgres connection "master"
[0m13:04:43.733681 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:04:43.735760 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m13:04:43.736207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc2b220>]}
[0m13:04:43.736407 [debug] [MainThread]: On master: ROLLBACK
[0m13:04:43.736713 [debug] [MainThread]: Using postgres connection "master"
[0m13:04:43.736843 [debug] [MainThread]: On master: BEGIN
[0m13:04:43.737314 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:04:43.737427 [debug] [MainThread]: On master: COMMIT
[0m13:04:43.737537 [debug] [MainThread]: Using postgres connection "master"
[0m13:04:43.737641 [debug] [MainThread]: On master: COMMIT
[0m13:04:43.737891 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:04:43.738005 [debug] [MainThread]: On master: Close
[0m13:04:43.739267 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:04:43.739484 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:04:43.739687 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m13:04:43.739833 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:04:43.744272 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:04:43.744585 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:04:43.763803 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:04:43.764387 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:04:43.764570 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:04:43.764720 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:04:43.769719 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m13:04:43.769905 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:04:43.770096 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:04:43.773153 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m13:04:43.777664 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:04:43.777835 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:04:43.778212 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:04:43.784518 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:04:43.784721 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:04:43.784869 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:04:43.785538 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:04:43.788289 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:04:43.790170 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:04:43.790328 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:04:43.790735 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:04:43.792033 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:04:43.793135 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07818b75-dccc-4218-8294-4caad9df6770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbf2790>]}
[0m13:04:43.793467 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.05s]
[0m13:04:43.793724 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:04:43.794194 [debug] [MainThread]: Using postgres connection "master"
[0m13:04:43.794350 [debug] [MainThread]: On master: BEGIN
[0m13:04:43.794484 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:04:43.798946 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:04:43.799140 [debug] [MainThread]: On master: COMMIT
[0m13:04:43.799291 [debug] [MainThread]: Using postgres connection "master"
[0m13:04:43.799421 [debug] [MainThread]: On master: COMMIT
[0m13:04:43.799674 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:04:43.799809 [debug] [MainThread]: On master: Close
[0m13:04:43.800000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:04:43.800123 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:04:43.800264 [info ] [MainThread]: 
[0m13:04:43.800412 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.15 seconds (0.15s).
[0m13:04:43.800719 [debug] [MainThread]: Command end result
[0m13:04:43.834974 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:04:43.835769 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:04:43.838693 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:04:43.838835 [info ] [MainThread]: 
[0m13:04:43.839026 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:04:43.839161 [info ] [MainThread]: 
[0m13:04:43.839309 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:04:43.840681 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0034429, "process_in_blocks": "0", "process_kernel_time": 0.159233, "process_mem_max_rss": "132349952", "process_out_blocks": "0", "process_user_time": 1.384494}
[0m13:04:43.840859 [debug] [MainThread]: Command `dbt run` succeeded at 13:04:43.840823 after 1.00 seconds
[0m13:04:43.841023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a482df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c64d850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c760310>]}
[0m13:04:43.841192 [debug] [MainThread]: Flushing usage events
[0m13:04:44.205074 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:06:04.873252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108219eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109290f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109290490>]}


============================== 13:06:04.875418 | f735df9b-783b-4a0b-8445-87aa153602b4 ==============================
[0m13:06:04.875418 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:06:04.875671 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/marccao/repo/dbt/logs', 'fail_fast': 'False', 'no_print': 'None', 'version_check': 'True', 'use_colors': 'True', 'target_path': 'None', 'empty': 'False', 'warn_error': 'None', 'static_parser': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'log_cache_events': 'False', 'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'introspect': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_experimental_parser': 'False'}
[0m13:06:04.964443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f735df9b-783b-4a0b-8445-87aa153602b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10975d5b0>]}
[0m13:06:04.991093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f735df9b-783b-4a0b-8445-87aa153602b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091f2f40>]}
[0m13:06:04.991718 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:06:05.044962 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:06:05.110009 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:06:05.110205 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:06:05.113003 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m13:06:05.128688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f735df9b-783b-4a0b-8445-87aa153602b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2b5130>]}
[0m13:06:05.166527 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:06:05.167603 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:06:05.176034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f735df9b-783b-4a0b-8445-87aa153602b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2a35e0>]}
[0m13:06:05.176262 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:06:05.176460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f735df9b-783b-4a0b-8445-87aa153602b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2b4b20>]}
[0m13:06:05.177139 [info ] [MainThread]: 
[0m13:06:05.177333 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:06:05.177510 [info ] [MainThread]: 
[0m13:06:05.177825 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:06:05.178335 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:06:05.227440 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:06:05.227646 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:06:05.227767 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:06:05.258825 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.031 seconds
[0m13:06:05.259457 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:06:05.259761 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_base)
[0m13:06:05.259979 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_base"
"
[0m13:06:05.262448 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:06:05.262592 [debug] [ThreadPool]: On create_lucca_db_public_base: BEGIN
[0m13:06:05.262715 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:06:05.273719 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m13:06:05.273856 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:06:05.273977 [debug] [ThreadPool]: On create_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_base"} */
create schema if not exists "public_base"
[0m13:06:05.274706 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:06:05.275150 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:06:05.275303 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:06:05.275433 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:06:05.276396 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:06:05.276979 [debug] [ThreadPool]: On create_lucca_db_public_base: Close
[0m13:06:05.278018 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_base, now list_lucca_db_public_base)
[0m13:06:05.281771 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:06:05.282009 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:06:05.282140 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:06:05.291638 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:06:05.291845 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:06:05.291987 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:06:05.295437 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:06:05.295998 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:06:05.296404 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:06:05.298551 [debug] [MainThread]: Using postgres connection "master"
[0m13:06:05.298720 [debug] [MainThread]: On master: BEGIN
[0m13:06:05.298853 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:06:05.306397 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m13:06:05.306546 [debug] [MainThread]: Using postgres connection "master"
[0m13:06:05.306714 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:06:05.310575 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:06:05.311137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f735df9b-783b-4a0b-8445-87aa153602b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2be8b0>]}
[0m13:06:05.311371 [debug] [MainThread]: On master: ROLLBACK
[0m13:06:05.311775 [debug] [MainThread]: Using postgres connection "master"
[0m13:06:05.311921 [debug] [MainThread]: On master: BEGIN
[0m13:06:05.312433 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:06:05.312564 [debug] [MainThread]: On master: COMMIT
[0m13:06:05.312692 [debug] [MainThread]: Using postgres connection "master"
[0m13:06:05.312811 [debug] [MainThread]: On master: COMMIT
[0m13:06:05.313128 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:06:05.313264 [debug] [MainThread]: On master: Close
[0m13:06:05.314633 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:06:05.314893 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:06:05.315110 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m13:06:05.315270 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:06:05.319901 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:06:05.320375 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:06:05.339585 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:06:05.340029 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:06:05.340195 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:06:05.340350 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:06:05.349484 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:06:05.349634 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:06:05.349801 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:06:05.357399 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m13:06:05.361811 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:06:05.361986 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:06:05.362432 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:06:05.368617 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:06:05.368769 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:06:05.368913 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:06:05.370713 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m13:06:05.373251 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:06:05.375043 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:06:05.375201 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:06:05.375766 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:06:05.376770 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:06:05.377816 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f735df9b-783b-4a0b-8445-87aa153602b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6eafd0>]}
[0m13:06:05.378111 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:06:05.378380 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:06:05.378841 [debug] [MainThread]: Using postgres connection "master"
[0m13:06:05.378963 [debug] [MainThread]: On master: BEGIN
[0m13:06:05.379072 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:06:05.386249 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:06:05.386423 [debug] [MainThread]: On master: COMMIT
[0m13:06:05.386560 [debug] [MainThread]: Using postgres connection "master"
[0m13:06:05.386673 [debug] [MainThread]: On master: COMMIT
[0m13:06:05.387066 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:06:05.387181 [debug] [MainThread]: On master: Close
[0m13:06:05.387340 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:06:05.387445 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:06:05.387564 [info ] [MainThread]: 
[0m13:06:05.387706 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m13:06:05.387992 [debug] [MainThread]: Command end result
[0m13:06:05.397870 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:06:05.398643 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:06:05.401762 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:06:05.401926 [info ] [MainThread]: 
[0m13:06:05.402107 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:06:05.402244 [info ] [MainThread]: 
[0m13:06:05.402394 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:06:05.403889 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5671041, "process_in_blocks": "0", "process_kernel_time": 0.170332, "process_mem_max_rss": "125353984", "process_out_blocks": "0", "process_user_time": 0.918832}
[0m13:06:05.404051 [debug] [MainThread]: Command `dbt run` succeeded at 13:06:05.404019 after 0.57 seconds
[0m13:06:05.404208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108219eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2a3c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069f6be0>]}
[0m13:06:05.404367 [debug] [MainThread]: Flushing usage events
[0m13:06:05.813222 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:09:44.977042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d36e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adacf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adac4c0>]}


============================== 13:09:44.979320 | 9b3f25b7-1c09-47d9-97a3-ed94113b01aa ==============================
[0m13:09:44.979320 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:09:44.979592 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'fail_fast': 'False', 'target_path': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'quiet': 'False', 'log_format': 'default', 'profiles_dir': '/Users/marccao/repo/dbt', 'printer_width': '80', 'warn_error': 'None', 'partial_parse': 'True', 'write_json': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'no_print': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'version_check': 'True'}
[0m13:09:45.074020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2aabb0>]}
[0m13:09:45.101558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab3db50>]}
[0m13:09:45.102233 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:09:45.153476 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:09:45.198677 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:09:45.198926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6323d0>]}
[0m13:09:45.693335 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m13:09:45.698218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c060070>]}
[0m13:09:45.733882 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:09:45.735226 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:09:45.743637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0c36d0>]}
[0m13:09:45.743839 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:09:45.743993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bed44c0>]}
[0m13:09:45.744684 [info ] [MainThread]: 
[0m13:09:45.744832 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:09:45.744956 [info ] [MainThread]: 
[0m13:09:45.745167 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:09:45.745525 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:09:45.773552 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:09:45.773764 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:09:45.773889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:09:45.818791 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.045 seconds
[0m13:09:45.819452 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:09:45.819785 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db__base)
[0m13:09:45.819993 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "_base"
"
[0m13:09:45.822618 [debug] [ThreadPool]: Using postgres connection "create_lucca_db__base"
[0m13:09:45.822755 [debug] [ThreadPool]: On create_lucca_db__base: BEGIN
[0m13:09:45.822868 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:09:45.832036 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:09:45.832192 [debug] [ThreadPool]: Using postgres connection "create_lucca_db__base"
[0m13:09:45.832318 [debug] [ThreadPool]: On create_lucca_db__base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db__base"} */
create schema if not exists "_base"
[0m13:09:45.833333 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:09:45.833725 [debug] [ThreadPool]: On create_lucca_db__base: COMMIT
[0m13:09:45.833894 [debug] [ThreadPool]: Using postgres connection "create_lucca_db__base"
[0m13:09:45.834031 [debug] [ThreadPool]: On create_lucca_db__base: COMMIT
[0m13:09:45.834877 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:09:45.835010 [debug] [ThreadPool]: On create_lucca_db__base: Close
[0m13:09:45.835465 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db__base, now list_lucca_db__base)
[0m13:09:45.837991 [debug] [ThreadPool]: Using postgres connection "list_lucca_db__base"
[0m13:09:45.838124 [debug] [ThreadPool]: On list_lucca_db__base: BEGIN
[0m13:09:45.838238 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:09:45.847038 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:09:45.847164 [debug] [ThreadPool]: Using postgres connection "list_lucca_db__base"
[0m13:09:45.847297 [debug] [ThreadPool]: On list_lucca_db__base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db__base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike '_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike '_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike '_base'
  
[0m13:09:45.852138 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m13:09:45.852607 [debug] [ThreadPool]: On list_lucca_db__base: ROLLBACK
[0m13:09:45.852981 [debug] [ThreadPool]: On list_lucca_db__base: Close
[0m13:09:45.854840 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:45.854977 [debug] [MainThread]: On master: BEGIN
[0m13:09:45.855096 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:09:45.861343 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:09:45.861496 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:45.861653 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:09:45.866122 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:09:45.866613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0c4d00>]}
[0m13:09:45.866826 [debug] [MainThread]: On master: ROLLBACK
[0m13:09:45.867150 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:45.867289 [debug] [MainThread]: On master: BEGIN
[0m13:09:45.867771 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:09:45.867911 [debug] [MainThread]: On master: COMMIT
[0m13:09:45.868042 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:45.868165 [debug] [MainThread]: On master: COMMIT
[0m13:09:45.868448 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:09:45.868585 [debug] [MainThread]: On master: Close
[0m13:09:45.869910 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:09:45.870146 [info ] [Thread-1  ]: 1 of 1 START sql table model _base.lucca_raw_data .............................. [RUN]
[0m13:09:45.870345 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db__base, now model.lucca_dbt.lucca_raw_data)
[0m13:09:45.870499 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:09:45.874952 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:09:45.875256 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:09:45.894134 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:09:45.894533 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:45.894677 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:09:45.894807 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:45.904023 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:09:45.904203 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:45.904397 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:09:45.914282 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.010 seconds
[0m13:09:45.919049 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:45.919245 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:09:45.919704 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:45.926011 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:09:45.926183 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:45.926329 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:09:45.926795 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m13:09:45.929457 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."_base"."lucca_raw_data__dbt_backup"
[0m13:09:45.931308 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:45.931470 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."_base"."lucca_raw_data__dbt_backup" cascade
[0m13:09:45.931884 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:09:45.932960 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:09:45.934053 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b3f25b7-1c09-47d9-97a3-ed94113b01aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c53cb50>]}
[0m13:09:45.934368 [info ] [Thread-1  ]: 1 of 1 OK created sql table model _base.lucca_raw_data ......................... [[32mSELECT 115[0m in 0.06s]
[0m13:09:45.934627 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:09:45.935088 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:45.935225 [debug] [MainThread]: On master: BEGIN
[0m13:09:45.935346 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:09:45.940739 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:09:45.940889 [debug] [MainThread]: On master: COMMIT
[0m13:09:45.941010 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:45.941123 [debug] [MainThread]: On master: COMMIT
[0m13:09:45.941398 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:09:45.941527 [debug] [MainThread]: On master: Close
[0m13:09:45.941709 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:09:45.941828 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:09:45.941963 [info ] [MainThread]: 
[0m13:09:45.942104 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m13:09:45.942485 [debug] [MainThread]: Command end result
[0m13:09:45.976804 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:09:45.977615 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:09:45.980377 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:09:45.980513 [info ] [MainThread]: 
[0m13:09:45.980693 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:09:45.980826 [info ] [MainThread]: 
[0m13:09:45.980969 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:09:45.982552 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0410271, "process_in_blocks": "0", "process_kernel_time": 0.186613, "process_mem_max_rss": "132268032", "process_out_blocks": "0", "process_user_time": 1.397175}
[0m13:09:45.982743 [debug] [MainThread]: Command `dbt run` succeeded at 13:09:45.982707 after 1.04 seconds
[0m13:09:45.982901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d36e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092c4dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108aee190>]}
[0m13:09:45.983047 [debug] [MainThread]: Flushing usage events
[0m13:09:46.354137 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:11:09.816126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba52e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cac8d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cac82b0>]}


============================== 13:11:09.818554 | c86c8f3d-e900-408d-bd67-013d7246b573 ==============================
[0m13:11:09.818554 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:11:09.818811 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'fail_fast': 'False', 'empty': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'quiet': 'False', 'log_format': 'default', 'partial_parse': 'True', 'printer_width': '80', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'invocation_command': 'dbt run', 'warn_error': 'None', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/marccao/repo/dbt', 'no_print': 'None', 'static_parser': 'True', 'cache_selected_only': 'False', 'introspect': 'True'}
[0m13:11:09.913498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3fa190>]}
[0m13:11:09.941536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10caa6490>]}
[0m13:11:09.942311 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:11:09.996391 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:11:10.041063 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:11:10.041306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c34e970>]}
[0m13:11:10.537018 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.base
- models.lucca_dbt.analytics
[0m13:11:10.541835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd7c130>]}
[0m13:11:10.577428 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:11:10.578525 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:11:10.587606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddc5d90>]}
[0m13:11:10.587802 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:11:10.587949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc05130>]}
[0m13:11:10.588637 [info ] [MainThread]: 
[0m13:11:10.588785 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:11:10.588909 [info ] [MainThread]: 
[0m13:11:10.589125 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:11:10.589487 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:11:10.617183 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:11:10.617374 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:11:10.617488 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:11:10.653864 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.036 seconds
[0m13:11:10.654473 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:11:10.654792 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_base_base)
[0m13:11:10.655044 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "base_base"
"
[0m13:11:10.657597 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_base_base"
[0m13:11:10.657746 [debug] [ThreadPool]: On create_lucca_db_base_base: BEGIN
[0m13:11:10.657869 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:11:10.668352 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m13:11:10.668479 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_base_base"
[0m13:11:10.668594 [debug] [ThreadPool]: On create_lucca_db_base_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_base_base"} */
create schema if not exists "base_base"
[0m13:11:10.669482 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:11:10.669855 [debug] [ThreadPool]: On create_lucca_db_base_base: COMMIT
[0m13:11:10.669977 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_base_base"
[0m13:11:10.670086 [debug] [ThreadPool]: On create_lucca_db_base_base: COMMIT
[0m13:11:10.670979 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:11:10.671105 [debug] [ThreadPool]: On create_lucca_db_base_base: Close
[0m13:11:10.671548 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_base_base, now list_lucca_db_base_base)
[0m13:11:10.674202 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base_base"
[0m13:11:10.674336 [debug] [ThreadPool]: On list_lucca_db_base_base: BEGIN
[0m13:11:10.674445 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:11:10.682180 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:11:10.682297 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base_base"
[0m13:11:10.682417 [debug] [ThreadPool]: On list_lucca_db_base_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_base_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'base_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'base_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'base_base'
  
[0m13:11:10.686107 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:11:10.686571 [debug] [ThreadPool]: On list_lucca_db_base_base: ROLLBACK
[0m13:11:10.686957 [debug] [ThreadPool]: On list_lucca_db_base_base: Close
[0m13:11:10.688955 [debug] [MainThread]: Using postgres connection "master"
[0m13:11:10.689126 [debug] [MainThread]: On master: BEGIN
[0m13:11:10.689249 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:11:10.697965 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m13:11:10.698119 [debug] [MainThread]: Using postgres connection "master"
[0m13:11:10.698271 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:11:10.701012 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m13:11:10.701488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1f01f0>]}
[0m13:11:10.701708 [debug] [MainThread]: On master: ROLLBACK
[0m13:11:10.702011 [debug] [MainThread]: Using postgres connection "master"
[0m13:11:10.702172 [debug] [MainThread]: On master: BEGIN
[0m13:11:10.702661 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:11:10.702818 [debug] [MainThread]: On master: COMMIT
[0m13:11:10.702948 [debug] [MainThread]: Using postgres connection "master"
[0m13:11:10.703068 [debug] [MainThread]: On master: COMMIT
[0m13:11:10.703351 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:11:10.703479 [debug] [MainThread]: On master: Close
[0m13:11:10.704875 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:11:10.705127 [info ] [Thread-1  ]: 1 of 1 START sql table model base_base.lucca_raw_data .......................... [RUN]
[0m13:11:10.705340 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_base_base, now model.lucca_dbt.lucca_raw_data)
[0m13:11:10.705497 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:11:10.709956 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:11:10.710437 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:11:10.729205 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:11:10.729765 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:11:10.729931 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:11:10.730069 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:11:10.738880 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:11:10.739048 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:11:10.739218 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."base_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:11:10.744600 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:11:10.748819 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:11:10.748982 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."base_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:11:10.749433 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:11:10.755523 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:11:10.755690 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:11:10.755836 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:11:10.757241 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:11:10.759772 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."base_base"."lucca_raw_data__dbt_backup"
[0m13:11:10.761585 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:11:10.761737 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."base_base"."lucca_raw_data__dbt_backup" cascade
[0m13:11:10.762312 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:11:10.763331 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:11:10.764350 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c86c8f3d-e900-408d-bd67-013d7246b573', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2399d0>]}
[0m13:11:10.764618 [info ] [Thread-1  ]: 1 of 1 OK created sql table model base_base.lucca_raw_data ..................... [[32mSELECT 115[0m in 0.06s]
[0m13:11:10.764869 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:11:10.765300 [debug] [MainThread]: Using postgres connection "master"
[0m13:11:10.765423 [debug] [MainThread]: On master: BEGIN
[0m13:11:10.765531 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:11:10.774288 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m13:11:10.774456 [debug] [MainThread]: On master: COMMIT
[0m13:11:10.774576 [debug] [MainThread]: Using postgres connection "master"
[0m13:11:10.774688 [debug] [MainThread]: On master: COMMIT
[0m13:11:10.775013 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:11:10.775132 [debug] [MainThread]: On master: Close
[0m13:11:10.775298 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:11:10.775405 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:11:10.775525 [info ] [MainThread]: 
[0m13:11:10.775671 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m13:11:10.775951 [debug] [MainThread]: Command end result
[0m13:11:10.809117 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:11:10.810000 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:11:10.812725 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:11:10.812855 [info ] [MainThread]: 
[0m13:11:10.813040 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:11:10.813181 [info ] [MainThread]: 
[0m13:11:10.813324 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:11:10.814826 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0356661, "process_in_blocks": "0", "process_kernel_time": 0.183687, "process_mem_max_rss": "132415488", "process_out_blocks": "0", "process_user_time": 1.397557}
[0m13:11:10.814993 [debug] [MainThread]: Command `dbt run` succeeded at 13:11:10.814959 after 1.04 seconds
[0m13:11:10.815145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba52e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddc5c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a80a160>]}
[0m13:11:10.815291 [debug] [MainThread]: Flushing usage events
[0m13:11:11.180383 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:13:19.936893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1fae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d270f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2704c0>]}


============================== 13:13:19.939067 | fa749f6d-d238-4d6b-affb-6612bc824f3e ==============================
[0m13:13:19.939067 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:13:19.939327 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/marccao/repo/dbt/logs', 'use_colors': 'True', 'log_format': 'default', 'printer_width': '80', 'write_json': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_cache_events': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'partial_parse': 'True', 'no_print': 'None', 'quiet': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'introspect': 'True'}
[0m13:13:20.030713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa749f6d-d238-4d6b-affb-6612bc824f3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d76ebb0>]}
[0m13:13:20.056731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa749f6d-d238-4d6b-affb-6612bc824f3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d001b50>]}
[0m13:13:20.057285 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:13:20.108657 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:13:20.152437 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:13:20.152696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fa749f6d-d238-4d6b-affb-6612bc824f3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10caf73d0>]}
[0m13:13:20.666422 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m13:13:20.671537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa749f6d-d238-4d6b-affb-6612bc824f3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e506100>]}
[0m13:13:20.710860 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:13:20.712002 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:13:20.721071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa749f6d-d238-4d6b-affb-6612bc824f3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e56d970>]}
[0m13:13:20.721314 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:13:20.721469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa749f6d-d238-4d6b-affb-6612bc824f3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3b0e80>]}
[0m13:13:20.722239 [info ] [MainThread]: 
[0m13:13:20.722396 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:13:20.722525 [info ] [MainThread]: 
[0m13:13:20.722754 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:13:20.723118 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:13:20.752674 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:13:20.752905 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:13:20.753043 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:13:20.792541 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.039 seconds
[0m13:13:20.793269 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:13:20.793620 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_)
[0m13:13:20.793827 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
"
[0m13:13:20.796571 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_"
[0m13:13:20.796745 [debug] [ThreadPool]: On create_lucca_db_: BEGIN
[0m13:13:20.796881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:13:20.806238 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:13:20.806394 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_"
[0m13:13:20.806528 [debug] [ThreadPool]: On create_lucca_db_: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_"} */
create schema if not exists ""
[0m13:13:20.807088 [debug] [ThreadPool]: Postgres adapter: Postgres error: zero-length delimited identifier at or near """"
LINE 2: create schema if not exists ""
                                    ^

[0m13:13:20.807267 [debug] [ThreadPool]: On create_lucca_db_: ROLLBACK
[0m13:13:20.807681 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro create_schema
[0m13:13:20.807839 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m13:13:20.808034 [debug] [ThreadPool]: On create_lucca_db_: Close
[0m13:13:20.808394 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:13:20.808524 [debug] [MainThread]: Connection 'create_lucca_db_' was properly closed.
[0m13:13:20.808660 [info ] [MainThread]: 
[0m13:13:20.808820 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.09 seconds (0.09s).
[0m13:13:20.809072 [error] [MainThread]: Encountered an error:
Database Error
  zero-length delimited identifier at or near """"
  LINE 2: create schema if not exists ""
                                      ^
[0m13:13:20.810803 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9084418, "process_in_blocks": "0", "process_kernel_time": 0.16819, "process_mem_max_rss": "131104768", "process_out_blocks": "0", "process_user_time": 1.294257}
[0m13:13:20.811019 [debug] [MainThread]: Command `dbt run` failed at 13:13:20.810972 after 0.91 seconds
[0m13:13:20.811193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1fae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e506790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e99a4f0>]}
[0m13:13:20.811415 [debug] [MainThread]: Flushing usage events
[0m13:13:21.249246 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:13:59.097585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ed5e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af4bd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af4b2b0>]}


============================== 13:13:59.100110 | c8d6a562-fb74-462f-b9d0-50e2a4095ff3 ==============================
[0m13:13:59.100110 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:13:59.100374 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'quiet': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'debug': 'False', 'use_colors': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'invocation_command': 'dbt run', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'partial_parse': 'True'}
[0m13:13:59.136931 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "lucca", target "dev" invalid: 'schema' is a required property
[0m13:13:59.138284 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.082751915, "process_in_blocks": "0", "process_kernel_time": 0.101487, "process_mem_max_rss": "100433920", "process_out_blocks": "0", "process_user_time": 0.591857}
[0m13:13:59.138499 [debug] [MainThread]: Command `dbt run` failed at 13:13:59.138452 after 0.08 seconds
[0m13:13:59.138671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ed5e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af1cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af1c2e0>]}
[0m13:13:59.138833 [debug] [MainThread]: Flushing usage events
[0m13:13:59.497377 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:14:24.610335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8d6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b93fd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b93f280>]}


============================== 13:14:24.612674 | 936bb03b-6392-4842-b029-db1d08cb65d0 ==============================
[0m13:14:24.612674 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:14:24.612951 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/marccao/repo/dbt/logs', 'use_experimental_parser': 'False', 'empty': 'False', 'invocation_command': 'dbt run', 'introspect': 'True', 'fail_fast': 'False', 'write_json': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'partial_parse': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'target_path': 'None', 'no_print': 'None', 'use_colors': 'True', 'log_format': 'default', 'version_check': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m13:14:24.707817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b991880>]}
[0m13:14:24.735901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093b16a0>]}
[0m13:14:24.736446 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:14:24.790653 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:14:24.835976 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:14:24.836226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1d25b0>]}
[0m13:14:25.349820 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m13:14:25.355618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbe1130>]}
[0m13:14:25.394042 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:14:25.395125 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:14:25.404364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc4a040>]}
[0m13:14:25.404624 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:14:25.404780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca72d30>]}
[0m13:14:25.405528 [info ] [MainThread]: 
[0m13:14:25.405694 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:14:25.405825 [info ] [MainThread]: 
[0m13:14:25.406049 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:14:25.406428 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:14:25.434851 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:14:25.435102 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:14:25.435247 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:14:25.467547 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.032 seconds
[0m13:14:25.468184 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:14:25.468705 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public)
[0m13:14:25.471595 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m13:14:25.471736 [debug] [ThreadPool]: On list_lucca_db_public: BEGIN
[0m13:14:25.471861 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:14:25.481571 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m13:14:25.481881 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m13:14:25.482079 [debug] [ThreadPool]: On list_lucca_db_public: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:14:25.485383 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m13:14:25.486109 [debug] [ThreadPool]: On list_lucca_db_public: ROLLBACK
[0m13:14:25.486498 [debug] [ThreadPool]: On list_lucca_db_public: Close
[0m13:14:25.488908 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:25.489087 [debug] [MainThread]: On master: BEGIN
[0m13:14:25.489217 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:14:25.495342 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:14:25.495608 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:25.495781 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:14:25.500211 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:14:25.500896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc442b0>]}
[0m13:14:25.501132 [debug] [MainThread]: On master: ROLLBACK
[0m13:14:25.501454 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:25.501585 [debug] [MainThread]: On master: BEGIN
[0m13:14:25.502067 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:14:25.502217 [debug] [MainThread]: On master: COMMIT
[0m13:14:25.502348 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:25.502471 [debug] [MainThread]: On master: COMMIT
[0m13:14:25.502736 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:14:25.502909 [debug] [MainThread]: On master: Close
[0m13:14:25.505790 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:14:25.506065 [info ] [Thread-1  ]: 1 of 1 START sql table model public.lucca_raw_data ............................. [RUN]
[0m13:14:25.506284 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public, now model.lucca_dbt.lucca_raw_data)
[0m13:14:25.506443 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:14:25.510666 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:14:25.511171 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:14:25.531691 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:14:25.532214 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:25.532389 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:14:25.532542 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:14:25.538721 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:14:25.538952 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:25.539130 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:14:25.543840 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:14:25.548857 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:25.549075 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:14:25.549621 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:14:25.556476 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:14:25.556694 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:25.556854 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:14:25.557759 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:14:25.560792 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public"."lucca_raw_data__dbt_backup"
[0m13:14:25.562778 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:25.562953 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public"."lucca_raw_data__dbt_backup" cascade
[0m13:14:25.563412 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:14:25.564599 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:14:25.565687 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bb03b-6392-4842-b029-db1d08cb65d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d050580>]}
[0m13:14:25.566011 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public.lucca_raw_data ........................ [[32mSELECT 115[0m in 0.06s]
[0m13:14:25.566266 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:14:25.566884 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:25.567052 [debug] [MainThread]: On master: BEGIN
[0m13:14:25.567190 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:14:25.572659 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:14:25.572979 [debug] [MainThread]: On master: COMMIT
[0m13:14:25.573132 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:25.573262 [debug] [MainThread]: On master: COMMIT
[0m13:14:25.573549 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:14:25.573685 [debug] [MainThread]: On master: Close
[0m13:14:25.573890 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:14:25.574037 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:14:25.574294 [info ] [MainThread]: 
[0m13:14:25.574720 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m13:14:25.575181 [debug] [MainThread]: Command end result
[0m13:14:25.615125 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:14:25.616447 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:14:25.620392 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:14:25.620572 [info ] [MainThread]: 
[0m13:14:25.620857 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:14:25.621112 [info ] [MainThread]: 
[0m13:14:25.621280 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:14:25.622894 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0485097, "process_in_blocks": "0", "process_kernel_time": 0.189484, "process_mem_max_rss": "132317184", "process_out_blocks": "0", "process_user_time": 1.471759}
[0m13:14:25.623125 [debug] [MainThread]: Command `dbt run` succeeded at 13:14:25.623083 after 1.05 seconds
[0m13:14:25.623327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8d6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb60d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10934e460>]}
[0m13:14:25.623514 [debug] [MainThread]: Flushing usage events
[0m13:14:25.980245 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:14:52.728536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c41de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d494130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d494580>]}


============================== 13:14:52.731197 | 0a7fca13-7ec9-466d-946f-9807efc0ec99 ==============================
[0m13:14:52.731197 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:14:52.731710 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'empty': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'no_print': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'warn_error': 'None', 'target_path': 'None', 'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'log_path': '/Users/marccao/repo/dbt/logs', 'debug': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run'}
[0m13:14:52.828108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a7fca13-7ec9-466d-946f-9807efc0ec99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adc5a60>]}
[0m13:14:52.855954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a7fca13-7ec9-466d-946f-9807efc0ec99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cdb32b0>]}
[0m13:14:52.856655 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:14:52.909818 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:14:52.972852 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:14:52.973155 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m13:14:53.081878 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.base
- models.lucca_dbt.transform
[0m13:14:53.088771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a7fca13-7ec9-466d-946f-9807efc0ec99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e61d130>]}
[0m13:14:53.147287 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:14:53.148331 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:14:53.156320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a7fca13-7ec9-466d-946f-9807efc0ec99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4c0d30>]}
[0m13:14:53.156560 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:14:53.156716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a7fca13-7ec9-466d-946f-9807efc0ec99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e37ee80>]}
[0m13:14:53.157267 [info ] [MainThread]: 
[0m13:14:53.157423 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:14:53.157549 [info ] [MainThread]: 
[0m13:14:53.157764 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:14:53.158123 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:14:53.185960 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:14:53.186168 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:14:53.186286 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:14:53.221861 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.035 seconds
[0m13:14:53.222507 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:14:53.222814 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_base)
[0m13:14:53.223012 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_base"
"
[0m13:14:53.225549 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:14:53.225698 [debug] [ThreadPool]: On create_lucca_db_public_base: BEGIN
[0m13:14:53.225819 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:14:53.234771 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:14:53.234894 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:14:53.235011 [debug] [ThreadPool]: On create_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_base"} */
create schema if not exists "public_base"
[0m13:14:53.235877 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:14:53.236224 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:14:53.236344 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:14:53.236453 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:14:53.237437 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:14:53.237559 [debug] [ThreadPool]: On create_lucca_db_public_base: Close
[0m13:14:53.237985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_base, now list_lucca_db_public_base)
[0m13:14:53.240519 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:14:53.240653 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:14:53.240769 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:14:53.251448 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m13:14:53.251586 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:14:53.251717 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:14:53.256047 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:14:53.256515 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:14:53.256928 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:14:53.259003 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:53.259140 [debug] [MainThread]: On master: BEGIN
[0m13:14:53.259255 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:14:53.266230 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:14:53.266357 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:53.266512 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:14:53.270357 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:14:53.270808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a7fca13-7ec9-466d-946f-9807efc0ec99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e926400>]}
[0m13:14:53.271008 [debug] [MainThread]: On master: ROLLBACK
[0m13:14:53.271371 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:53.271498 [debug] [MainThread]: On master: BEGIN
[0m13:14:53.272025 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:14:53.272190 [debug] [MainThread]: On master: COMMIT
[0m13:14:53.272325 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:53.272449 [debug] [MainThread]: On master: COMMIT
[0m13:14:53.272765 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:14:53.272948 [debug] [MainThread]: On master: Close
[0m13:14:53.274142 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:14:53.274369 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:14:53.274567 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m13:14:53.274725 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:14:53.278628 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:14:53.278918 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:14:53.297423 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:14:53.297854 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:53.298007 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:14:53.298148 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:14:53.307482 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:14:53.307654 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:53.307830 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:14:53.315292 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m13:14:53.319715 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:53.319897 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:14:53.320477 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:14:53.326775 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:14:53.326938 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:53.327079 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:14:53.328092 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:14:53.331112 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:14:53.332910 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:14:53.333054 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:14:53.333992 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:14:53.334995 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:14:53.335989 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a7fca13-7ec9-466d-946f-9807efc0ec99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ada66a0>]}
[0m13:14:53.336260 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:14:53.336508 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:14:53.336952 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:53.337075 [debug] [MainThread]: On master: BEGIN
[0m13:14:53.337185 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:14:53.346284 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m13:14:53.346532 [debug] [MainThread]: On master: COMMIT
[0m13:14:53.346671 [debug] [MainThread]: Using postgres connection "master"
[0m13:14:53.346784 [debug] [MainThread]: On master: COMMIT
[0m13:14:53.347167 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:14:53.347293 [debug] [MainThread]: On master: Close
[0m13:14:53.347468 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:14:53.347575 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:14:53.347698 [info ] [MainThread]: 
[0m13:14:53.347844 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m13:14:53.348138 [debug] [MainThread]: Command end result
[0m13:14:53.357727 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:14:53.358530 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:14:53.361450 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:14:53.361584 [info ] [MainThread]: 
[0m13:14:53.361764 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:14:53.361900 [info ] [MainThread]: 
[0m13:14:53.362044 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:14:53.363497 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.67247176, "process_in_blocks": "0", "process_kernel_time": 0.162266, "process_mem_max_rss": "129777664", "process_out_blocks": "0", "process_user_time": 1.072522}
[0m13:14:53.363683 [debug] [MainThread]: Command `dbt run` succeeded at 13:14:53.363646 after 0.67 seconds
[0m13:14:53.363844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c41de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2d8160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4c00a0>]}
[0m13:14:53.364000 [debug] [MainThread]: Flushing usage events
[0m13:14:53.724402 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:15:38.350051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf1cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf94160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf945b0>]}


============================== 13:15:38.352488 | f5958215-0376-4dfd-85ac-6568354d0948 ==============================
[0m13:15:38.352488 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:15:38.352746 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'static_parser': 'True', 'empty': 'False', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'log_format': 'default', 'use_colors': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'cache_selected_only': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'no_print': 'None', 'debug': 'False', 'partial_parse': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'use_experimental_parser': 'False', 'quiet': 'False', 'version_check': 'True', 'warn_error': 'None'}
[0m13:15:38.444780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5958215-0376-4dfd-85ac-6568354d0948', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4b4850>]}
[0m13:15:38.472043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5958215-0376-4dfd-85ac-6568354d0948', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf223a0>]}
[0m13:15:38.472747 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:15:38.525761 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:15:38.591844 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:15:38.592146 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m13:15:38.699966 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m13:15:38.706763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5958215-0376-4dfd-85ac-6568354d0948', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e13d130>]}
[0m13:15:38.765390 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:15:38.766495 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:15:38.774932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5958215-0376-4dfd-85ac-6568354d0948', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0d2d90>]}
[0m13:15:38.775148 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:15:38.775300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5958215-0376-4dfd-85ac-6568354d0948', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de9f850>]}
[0m13:15:38.775839 [info ] [MainThread]: 
[0m13:15:38.775992 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:15:38.776117 [info ] [MainThread]: 
[0m13:15:38.776333 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:15:38.776679 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:15:38.804493 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:15:38.804705 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:15:38.804830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:15:38.847396 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.042 seconds
[0m13:15:38.848075 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:15:38.848389 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_transform)
[0m13:15:38.848579 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_transform"
"
[0m13:15:38.851061 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m13:15:38.851209 [debug] [ThreadPool]: On create_lucca_db_public_transform: BEGIN
[0m13:15:38.851324 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:15:38.859947 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:15:38.860105 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m13:15:38.860228 [debug] [ThreadPool]: On create_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_transform"} */
create schema if not exists "public_transform"
[0m13:15:38.861155 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:15:38.861551 [debug] [ThreadPool]: On create_lucca_db_public_transform: COMMIT
[0m13:15:38.861692 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m13:15:38.861809 [debug] [ThreadPool]: On create_lucca_db_public_transform: COMMIT
[0m13:15:38.862770 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:15:38.862893 [debug] [ThreadPool]: On create_lucca_db_public_transform: Close
[0m13:15:38.863334 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_transform, now list_lucca_db_public_transform)
[0m13:15:38.865894 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:15:38.866029 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:15:38.866152 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:15:38.874246 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:15:38.874379 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:15:38.874510 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:15:38.879873 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m13:15:38.880462 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:15:38.880863 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:15:38.883387 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:38.883564 [debug] [MainThread]: On master: BEGIN
[0m13:15:38.883686 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:15:38.888894 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:15:38.889098 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:38.889266 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:15:38.891991 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m13:15:38.892543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5958215-0376-4dfd-85ac-6568354d0948', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e445460>]}
[0m13:15:38.892755 [debug] [MainThread]: On master: ROLLBACK
[0m13:15:38.893081 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:38.893204 [debug] [MainThread]: On master: BEGIN
[0m13:15:38.893689 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:15:38.893836 [debug] [MainThread]: On master: COMMIT
[0m13:15:38.893968 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:38.894101 [debug] [MainThread]: On master: COMMIT
[0m13:15:38.894390 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:15:38.894555 [debug] [MainThread]: On master: Close
[0m13:15:38.896052 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:15:38.896307 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.lucca_raw_data ................... [RUN]
[0m13:15:38.896512 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m13:15:38.896668 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:15:38.900674 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:15:38.900995 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:15:38.920734 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:15:38.921256 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:38.921410 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:15:38.921552 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:38.930760 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:15:38.930990 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:38.931162 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_transform"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:15:38.938885 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m13:15:38.943264 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:38.943419 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_transform"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:15:38.943915 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:15:38.950128 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:15:38.950298 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:38.950440 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:15:38.951211 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:38.954798 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."lucca_raw_data__dbt_backup"
[0m13:15:38.957119 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:38.957351 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_transform"."lucca_raw_data__dbt_backup" cascade
[0m13:15:38.957864 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:15:38.959009 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:15:38.960095 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5958215-0376-4dfd-85ac-6568354d0948', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8a6700>]}
[0m13:15:38.960403 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_transform.lucca_raw_data .............. [[32mSELECT 115[0m in 0.06s]
[0m13:15:38.960655 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:15:38.961115 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:38.961275 [debug] [MainThread]: On master: BEGIN
[0m13:15:38.961401 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:15:38.966973 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:15:38.967184 [debug] [MainThread]: On master: COMMIT
[0m13:15:38.967325 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:38.967450 [debug] [MainThread]: On master: COMMIT
[0m13:15:38.967708 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:15:38.967840 [debug] [MainThread]: On master: Close
[0m13:15:38.968037 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:15:38.968156 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:15:38.968296 [info ] [MainThread]: 
[0m13:15:38.968443 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m13:15:38.968759 [debug] [MainThread]: Command end result
[0m13:15:38.979075 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:15:38.980065 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:15:38.983799 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:15:38.984008 [info ] [MainThread]: 
[0m13:15:38.984199 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:15:38.984335 [info ] [MainThread]: 
[0m13:15:38.984485 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:15:38.986083 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.67625767, "process_in_blocks": "0", "process_kernel_time": 0.181811, "process_mem_max_rss": "129892352", "process_out_blocks": "0", "process_user_time": 1.035186}
[0m13:15:38.986264 [debug] [MainThread]: Command `dbt run` succeeded at 13:15:38.986229 after 0.68 seconds
[0m13:15:38.986424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf1cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8c5340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0d29d0>]}
[0m13:15:38.986597 [debug] [MainThread]: Flushing usage events
[0m13:15:39.336643 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:18:07.466929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10798ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a04f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a04520>]}


============================== 13:18:07.469256 | 5d534fa5-f025-4848-b8a7-f8233d38df16 ==============================
[0m13:18:07.469256 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:18:07.469518 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'printer_width': '80', 'no_print': 'None', 'log_format': 'default', 'empty': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'write_json': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'quiet': 'False', 'version_check': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'debug': 'False', 'warn_error': 'None', 'profiles_dir': '/Users/marccao/repo/dbt'}
[0m13:18:07.561465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089f2df0>]}
[0m13:18:07.589602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108444d30>]}
[0m13:18:07.590296 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:18:07.641953 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:18:07.687710 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:18:07.688006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082856d0>]}
[0m13:18:08.186280 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m13:18:08.191233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cda100>]}
[0m13:18:08.226899 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:18:08.228166 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:18:08.236723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d21c10>]}
[0m13:18:08.236955 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:18:08.237106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5f490>]}
[0m13:18:08.237797 [info ] [MainThread]: 
[0m13:18:08.237945 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:18:08.238068 [info ] [MainThread]: 
[0m13:18:08.238286 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:18:08.238658 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:18:08.266233 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:18:08.266465 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:18:08.266600 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:18:08.306357 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.040 seconds
[0m13:18:08.307095 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:18:08.307659 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_base)
[0m13:18:08.310486 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base"
[0m13:18:08.310628 [debug] [ThreadPool]: On list_lucca_db_base: BEGIN
[0m13:18:08.310747 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:18:08.321018 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m13:18:08.321178 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base"
[0m13:18:08.321310 [debug] [ThreadPool]: On list_lucca_db_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'base'
  
[0m13:18:08.325727 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:18:08.326259 [debug] [ThreadPool]: On list_lucca_db_base: ROLLBACK
[0m13:18:08.326761 [debug] [ThreadPool]: On list_lucca_db_base: Close
[0m13:18:08.328661 [debug] [MainThread]: Using postgres connection "master"
[0m13:18:08.328814 [debug] [MainThread]: On master: BEGIN
[0m13:18:08.328934 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:18:08.336883 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m13:18:08.337023 [debug] [MainThread]: Using postgres connection "master"
[0m13:18:08.337165 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:18:08.341094 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:18:08.341554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0e2be0>]}
[0m13:18:08.341783 [debug] [MainThread]: On master: ROLLBACK
[0m13:18:08.342200 [debug] [MainThread]: Using postgres connection "master"
[0m13:18:08.342328 [debug] [MainThread]: On master: BEGIN
[0m13:18:08.342837 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:18:08.342978 [debug] [MainThread]: On master: COMMIT
[0m13:18:08.343089 [debug] [MainThread]: Using postgres connection "master"
[0m13:18:08.343196 [debug] [MainThread]: On master: COMMIT
[0m13:18:08.343489 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:18:08.343637 [debug] [MainThread]: On master: Close
[0m13:18:08.345036 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:18:08.345286 [info ] [Thread-1  ]: 1 of 1 START sql table model base.lucca_raw_data ............................... [RUN]
[0m13:18:08.345512 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_base, now model.lucca_dbt.lucca_raw_data)
[0m13:18:08.345689 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:18:08.349689 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:18:08.350142 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:18:08.369864 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:18:08.370320 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:18:08.370464 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:18:08.370604 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:18:08.379709 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:18:08.379890 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:18:08.380063 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:18:08.389003 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.009 seconds
[0m13:18:08.393592 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:18:08.393777 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:18:08.394397 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:18:08.400712 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:18:08.400884 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:18:08.401024 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:18:08.403076 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m13:18:08.405745 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."base"."lucca_raw_data__dbt_backup"
[0m13:18:08.407619 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:18:08.407773 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."base"."lucca_raw_data__dbt_backup" cascade
[0m13:18:08.408725 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:18:08.409777 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:18:08.410819 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d534fa5-f025-4848-b8a7-f8233d38df16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a142400>]}
[0m13:18:08.411109 [info ] [Thread-1  ]: 1 of 1 OK created sql table model base.lucca_raw_data .......................... [[32mSELECT 115[0m in 0.06s]
[0m13:18:08.411368 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:18:08.411807 [debug] [MainThread]: Using postgres connection "master"
[0m13:18:08.411932 [debug] [MainThread]: On master: BEGIN
[0m13:18:08.412039 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:18:08.419165 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:18:08.419299 [debug] [MainThread]: On master: COMMIT
[0m13:18:08.419413 [debug] [MainThread]: Using postgres connection "master"
[0m13:18:08.419521 [debug] [MainThread]: On master: COMMIT
[0m13:18:08.419937 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:18:08.420053 [debug] [MainThread]: On master: Close
[0m13:18:08.420211 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:18:08.420316 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:18:08.420433 [info ] [MainThread]: 
[0m13:18:08.420575 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m13:18:08.420852 [debug] [MainThread]: Command end result
[0m13:18:08.455379 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:18:08.456205 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:18:08.459240 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:18:08.459400 [info ] [MainThread]: 
[0m13:18:08.459581 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:18:08.459717 [info ] [MainThread]: 
[0m13:18:08.459869 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:18:08.461383 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0311626, "process_in_blocks": "0", "process_kernel_time": 0.180802, "process_mem_max_rss": "132202496", "process_out_blocks": "0", "process_user_time": 1.384582}
[0m13:18:08.461558 [debug] [MainThread]: Command `dbt run` succeeded at 13:18:08.461522 after 1.03 seconds
[0m13:18:08.461724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10798ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c30700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a288250>]}
[0m13:18:08.461873 [debug] [MainThread]: Flushing usage events
[0m13:18:08.825251 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:20:17.554190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108736eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097acf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ac490>]}


============================== 13:20:17.556562 | 5efc62e1-3958-45eb-b194-a6dac0f377f6 ==============================
[0m13:20:17.556562 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:20:17.556842 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'printer_width': '80', 'no_print': 'None', 'use_experimental_parser': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'debug': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'version_check': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'partial_parse': 'True'}
[0m13:20:17.648675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10973a1c0>]}
[0m13:20:17.676144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108aa06d0>]}
[0m13:20:17.676846 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:20:17.730055 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:20:17.796401 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m13:20:17.796672 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/analytics/test.sql
[0m13:20:17.903689 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m13:20:17.910544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9b3130>]}
[0m13:20:17.971523 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:20:17.972901 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:20:17.981805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6c7b50>]}
[0m13:20:17.982022 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m13:20:17.982176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a790fa0>]}
[0m13:20:17.982754 [info ] [MainThread]: 
[0m13:20:17.982903 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:20:17.983031 [info ] [MainThread]: 
[0m13:20:17.983246 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:20:17.985208 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:20:18.013413 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:20:18.013612 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:20:18.013728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:20:18.049033 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.035 seconds
[0m13:20:18.049657 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:20:18.050200 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_base)
[0m13:20:18.052867 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base"
[0m13:20:18.053022 [debug] [ThreadPool]: On list_lucca_db_base: BEGIN
[0m13:20:18.053140 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:20:18.061972 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:20:18.062096 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base"
[0m13:20:18.062215 [debug] [ThreadPool]: On list_lucca_db_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'base'
  
[0m13:20:18.066331 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:20:18.066774 [debug] [ThreadPool]: On list_lucca_db_base: ROLLBACK
[0m13:20:18.067186 [debug] [ThreadPool]: On list_lucca_db_base: Close
[0m13:20:18.069040 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:18.069201 [debug] [MainThread]: On master: BEGIN
[0m13:20:18.069325 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:20:18.078300 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m13:20:18.078485 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:18.078640 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:20:18.082415 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:20:18.082842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f6e8b0>]}
[0m13:20:18.083038 [debug] [MainThread]: On master: ROLLBACK
[0m13:20:18.083434 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:18.083557 [debug] [MainThread]: On master: BEGIN
[0m13:20:18.084165 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:20:18.084283 [debug] [MainThread]: On master: COMMIT
[0m13:20:18.084399 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:18.084510 [debug] [MainThread]: On master: COMMIT
[0m13:20:18.084859 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:20:18.084983 [debug] [MainThread]: On master: Close
[0m13:20:18.086186 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:20:18.086407 [info ] [Thread-1  ]: 1 of 2 START sql table model base.lucca_raw_data ............................... [RUN]
[0m13:20:18.086602 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_base, now model.lucca_dbt.lucca_raw_data)
[0m13:20:18.086764 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:20:18.090893 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:20:18.091348 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:20:18.108224 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:20:18.108658 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:18.108808 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:20:18.108947 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:20:18.117947 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:20:18.118122 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:18.118301 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:20:18.127023 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.009 seconds
[0m13:20:18.131538 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:18.131714 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:20:18.132531 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:20:18.138673 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:20:18.138833 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:18.138976 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:20:18.140237 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:20:18.142749 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."base"."lucca_raw_data__dbt_backup"
[0m13:20:18.144440 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:18.144591 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."base"."lucca_raw_data__dbt_backup" cascade
[0m13:20:18.145123 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:20:18.146134 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:20:18.147089 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac59fd0>]}
[0m13:20:18.147345 [info ] [Thread-1  ]: 1 of 2 OK created sql table model base.lucca_raw_data .......................... [[32mSELECT 115[0m in 0.06s]
[0m13:20:18.147593 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:20:18.147746 [debug] [Thread-1  ]: Began running node model.lucca_dbt.test
[0m13:20:18.147958 [info ] [Thread-1  ]: 2 of 2 START sql table model base.test ......................................... [RUN]
[0m13:20:18.148148 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.test)
[0m13:20:18.148292 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.test
[0m13:20:18.150218 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.test"
[0m13:20:18.150577 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.test
[0m13:20:18.152194 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.test"
[0m13:20:18.152499 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:18.152648 [debug] [Thread-1  ]: On model.lucca_dbt.test: BEGIN
[0m13:20:18.152774 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:20:18.164465 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m13:20:18.164682 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:18.164850 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */

  
    

  create  table "lucca_db"."base"."test__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:20:18.173280 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m13:20:18.174852 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:18.175008 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
alter table "lucca_db"."base"."test__dbt_tmp" rename to "test"
[0m13:20:18.175520 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:20:18.176183 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:20:18.176333 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:18.176470 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:20:18.177735 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:20:18.178778 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."base"."test__dbt_backup"
[0m13:20:18.179099 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:18.179241 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
drop table if exists "lucca_db"."base"."test__dbt_backup" cascade
[0m13:20:18.179747 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:20:18.180292 [debug] [Thread-1  ]: On model.lucca_dbt.test: Close
[0m13:20:18.180551 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5efc62e1-3958-45eb-b194-a6dac0f377f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acdb430>]}
[0m13:20:18.180832 [info ] [Thread-1  ]: 2 of 2 OK created sql table model base.test .................................... [[32mSELECT 115[0m in 0.03s]
[0m13:20:18.181079 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.test
[0m13:20:18.181527 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:18.181654 [debug] [MainThread]: On master: BEGIN
[0m13:20:18.181770 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:20:18.188924 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:20:18.189092 [debug] [MainThread]: On master: COMMIT
[0m13:20:18.189224 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:18.189347 [debug] [MainThread]: On master: COMMIT
[0m13:20:18.189690 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:20:18.189912 [debug] [MainThread]: On master: Close
[0m13:20:18.190096 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:20:18.190224 [debug] [MainThread]: Connection 'model.lucca_dbt.test' was properly closed.
[0m13:20:18.190394 [info ] [MainThread]: 
[0m13:20:18.190552 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m13:20:18.190895 [debug] [MainThread]: Command end result
[0m13:20:18.200983 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:20:18.201768 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:20:18.205116 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:20:18.205273 [info ] [MainThread]: 
[0m13:20:18.205445 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:20:18.205582 [info ] [MainThread]: 
[0m13:20:18.205728 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m13:20:18.207257 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.688627, "process_in_blocks": "0", "process_kernel_time": 0.179894, "process_mem_max_rss": "129662976", "process_out_blocks": "0", "process_user_time": 1.030038}
[0m13:20:18.207430 [debug] [MainThread]: Command `dbt run` succeeded at 13:20:18.207391 after 0.69 seconds
[0m13:20:18.207603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108736eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108aa06d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9b8040>]}
[0m13:20:18.207780 [debug] [MainThread]: Flushing usage events
[0m13:20:18.560577 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:20:48.508131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10852ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095a4c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095a41f0>]}


============================== 13:20:48.510469 | 443fb655-c3f5-4332-99d3-30fa035d35cc ==============================
[0m13:20:48.510469 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:20:48.510727 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'no_print': 'None', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'empty': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'write_json': 'True', 'debug': 'False', 'use_colors': 'True', 'warn_error': 'None', 'static_parser': 'True', 'quiet': 'False', 'indirect_selection': 'eager'}
[0m13:20:48.603142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10957d9d0>]}
[0m13:20:48.629159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ca9730>]}
[0m13:20:48.629831 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:20:48.680840 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:20:48.744019 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:20:48.744338 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/analytics/test.sql
[0m13:20:48.854330 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m13:20:48.861064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7ad130>]}
[0m13:20:48.919849 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:20:48.920968 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:20:48.929608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a592730>]}
[0m13:20:48.929845 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m13:20:48.930005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5a9820>]}
[0m13:20:48.930617 [info ] [MainThread]: 
[0m13:20:48.930775 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:20:48.930906 [info ] [MainThread]: 
[0m13:20:48.931125 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:20:48.932980 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:20:48.960722 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:20:48.960920 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:20:48.961039 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:20:48.998076 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.037 seconds
[0m13:20:48.998721 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:20:49.000077 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:20:49.000235 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:20:49.000351 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:20:49.009510 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.009 seconds
[0m13:20:49.010025 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:20:49.010286 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_base_analytics)
[0m13:20:49.010470 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "base_analytics"
"
[0m13:20:49.012762 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_base_analytics"
[0m13:20:49.012892 [debug] [ThreadPool]: On create_lucca_db_base_analytics: BEGIN
[0m13:20:49.013002 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:20:49.021154 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:20:49.021306 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_base_analytics"
[0m13:20:49.021430 [debug] [ThreadPool]: On create_lucca_db_base_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_base_analytics"} */
create schema if not exists "base_analytics"
[0m13:20:49.022502 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:20:49.022908 [debug] [ThreadPool]: On create_lucca_db_base_analytics: COMMIT
[0m13:20:49.023070 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_base_analytics"
[0m13:20:49.023203 [debug] [ThreadPool]: On create_lucca_db_base_analytics: COMMIT
[0m13:20:49.024023 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:20:49.024167 [debug] [ThreadPool]: On create_lucca_db_base_analytics: Close
[0m13:20:49.024648 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_base_analytics, now list_lucca_db_base)
[0m13:20:49.027639 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base"
[0m13:20:49.027779 [debug] [ThreadPool]: On list_lucca_db_base: BEGIN
[0m13:20:49.027892 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:20:49.038068 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m13:20:49.038201 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base"
[0m13:20:49.038330 [debug] [ThreadPool]: On list_lucca_db_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'base'
  
[0m13:20:49.042324 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:20:49.042817 [debug] [ThreadPool]: On list_lucca_db_base: ROLLBACK
[0m13:20:49.043229 [debug] [ThreadPool]: On list_lucca_db_base: Close
[0m13:20:49.043500 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_base, now list_lucca_db_base_analytics)
[0m13:20:49.044488 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base_analytics"
[0m13:20:49.044630 [debug] [ThreadPool]: On list_lucca_db_base_analytics: BEGIN
[0m13:20:49.044748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:20:49.049759 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m13:20:49.049913 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_base_analytics"
[0m13:20:49.050054 [debug] [ThreadPool]: On list_lucca_db_base_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_base_analytics"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'base_analytics'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'base_analytics'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'base_analytics'
  
[0m13:20:49.051404 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.001 seconds
[0m13:20:49.051862 [debug] [ThreadPool]: On list_lucca_db_base_analytics: ROLLBACK
[0m13:20:49.052190 [debug] [ThreadPool]: On list_lucca_db_base_analytics: Close
[0m13:20:49.054282 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:49.054418 [debug] [MainThread]: On master: BEGIN
[0m13:20:49.054544 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:20:49.059267 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:20:49.059430 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:49.059582 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:20:49.062333 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m13:20:49.062890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa74c10>]}
[0m13:20:49.063118 [debug] [MainThread]: On master: ROLLBACK
[0m13:20:49.063574 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:49.063699 [debug] [MainThread]: On master: BEGIN
[0m13:20:49.064285 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:20:49.064421 [debug] [MainThread]: On master: COMMIT
[0m13:20:49.064560 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:49.064678 [debug] [MainThread]: On master: COMMIT
[0m13:20:49.065042 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:20:49.065180 [debug] [MainThread]: On master: Close
[0m13:20:49.066473 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:20:49.066702 [info ] [Thread-1  ]: 1 of 2 START sql table model base.lucca_raw_data ............................... [RUN]
[0m13:20:49.066917 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_base_analytics, now model.lucca_dbt.lucca_raw_data)
[0m13:20:49.067067 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:20:49.071157 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:20:49.071493 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:20:49.088934 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:20:49.089374 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:49.089542 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:20:49.089679 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:20:49.098728 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:20:49.098903 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:49.099073 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:20:49.106169 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m13:20:49.110950 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:49.111126 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:20:49.112509 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:20:49.118678 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:20:49.118847 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:49.118990 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:20:49.120679 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m13:20:49.123227 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."base"."lucca_raw_data__dbt_backup"
[0m13:20:49.125100 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:20:49.125248 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."base"."lucca_raw_data__dbt_backup" cascade
[0m13:20:49.125974 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:20:49.127092 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:20:49.128125 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa8a220>]}
[0m13:20:49.128401 [info ] [Thread-1  ]: 1 of 2 OK created sql table model base.lucca_raw_data .......................... [[32mSELECT 115[0m in 0.06s]
[0m13:20:49.128659 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:20:49.128815 [debug] [Thread-1  ]: Began running node model.lucca_dbt.test
[0m13:20:49.129040 [info ] [Thread-1  ]: 2 of 2 START sql table model base_analytics.test ............................... [RUN]
[0m13:20:49.129245 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.test)
[0m13:20:49.129389 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.test
[0m13:20:49.130831 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.test"
[0m13:20:49.131106 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.test
[0m13:20:49.132710 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.test"
[0m13:20:49.132961 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:49.133098 [debug] [Thread-1  ]: On model.lucca_dbt.test: BEGIN
[0m13:20:49.133221 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:20:49.142187 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:20:49.142425 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:49.142653 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */

  
    

  create  table "lucca_db"."base_analytics"."test__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:20:49.149364 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m13:20:49.151014 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:49.151207 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
alter table "lucca_db"."base_analytics"."test__dbt_tmp" rename to "test"
[0m13:20:49.151719 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:20:49.152320 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:20:49.152464 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:49.152593 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:20:49.153216 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m13:20:49.154286 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."base_analytics"."test__dbt_backup"
[0m13:20:49.154615 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:20:49.154748 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
drop table if exists "lucca_db"."base_analytics"."test__dbt_backup" cascade
[0m13:20:49.155164 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:20:49.155645 [debug] [Thread-1  ]: On model.lucca_dbt.test: Close
[0m13:20:49.155909 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '443fb655-c3f5-4332-99d3-30fa035d35cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa8a220>]}
[0m13:20:49.156196 [info ] [Thread-1  ]: 2 of 2 OK created sql table model base_analytics.test .......................... [[32mSELECT 115[0m in 0.03s]
[0m13:20:49.156440 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.test
[0m13:20:49.156895 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:49.157030 [debug] [MainThread]: On master: BEGIN
[0m13:20:49.157139 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:20:49.164474 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:20:49.164652 [debug] [MainThread]: On master: COMMIT
[0m13:20:49.164774 [debug] [MainThread]: Using postgres connection "master"
[0m13:20:49.164885 [debug] [MainThread]: On master: COMMIT
[0m13:20:49.165301 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:20:49.165423 [debug] [MainThread]: On master: Close
[0m13:20:49.165597 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:20:49.165703 [debug] [MainThread]: Connection 'model.lucca_dbt.test' was properly closed.
[0m13:20:49.165849 [info ] [MainThread]: 
[0m13:20:49.165997 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m13:20:49.166333 [debug] [MainThread]: Command end result
[0m13:20:49.176725 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:20:49.177736 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:20:49.180755 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:20:49.180887 [info ] [MainThread]: 
[0m13:20:49.181056 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:20:49.181193 [info ] [MainThread]: 
[0m13:20:49.181338 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m13:20:49.182692 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7083899, "process_in_blocks": "0", "process_kernel_time": 0.157086, "process_mem_max_rss": "129679360", "process_out_blocks": "0", "process_user_time": 1.053033}
[0m13:20:49.182857 [debug] [MainThread]: Command `dbt run` succeeded at 13:20:49.182825 after 0.71 seconds
[0m13:20:49.183018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10852ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e874f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7b6880>]}
[0m13:20:49.183176 [debug] [MainThread]: Flushing usage events
[0m13:20:49.531369 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:31:22.670729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6f5df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b76cf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b76c490>]}


============================== 13:31:22.673241 | 5d356685-23f2-4fde-9d5f-88c467c786a4 ==============================
[0m13:31:22.673241 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:31:22.673513 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'warn_error': 'None', 'log_format': 'default', 'empty': 'False', 'no_print': 'None', 'use_experimental_parser': 'False', 'printer_width': '80', 'write_json': 'True', 'debug': 'False', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'indirect_selection': 'eager', 'log_path': '/Users/marccao/repo/dbt/logs', 'version_check': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'fail_fast': 'False'}
[0m13:31:22.769694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10909d940>]}
[0m13:31:22.799911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b733a90>]}
[0m13:31:22.800642 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:31:22.879620 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:31:22.927600 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:31:22.927872 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:31:22.928039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aff25e0>]}
[0m13:31:23.433793 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.base
- models.lucca_dbt.analytics
[0m13:31:23.438602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cab89d0>]}
[0m13:31:23.474732 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:31:23.476144 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:31:23.485186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cabca00>]}
[0m13:31:23.485411 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m13:31:23.485567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c52580>]}
[0m13:31:23.486155 [info ] [MainThread]: 
[0m13:31:23.486311 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:31:23.486439 [info ] [MainThread]: 
[0m13:31:23.486665 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:31:23.488530 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:31:23.536974 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:31:23.537184 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:31:23.537309 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:31:23.584924 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.048 seconds
[0m13:31:23.585538 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:31:23.586857 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:31:23.587042 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:31:23.587204 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:31:23.594585 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.007 seconds
[0m13:31:23.595159 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:31:23.595473 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_analytics)
[0m13:31:23.595684 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_analytics"
"
[0m13:31:23.598197 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:31:23.598342 [debug] [ThreadPool]: On create_lucca_db_public_analytics: BEGIN
[0m13:31:23.598464 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:31:23.603344 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m13:31:23.603528 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:31:23.603678 [debug] [ThreadPool]: On create_lucca_db_public_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_analytics"} */
create schema if not exists "public_analytics"
[0m13:31:23.604197 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.000 seconds
[0m13:31:23.604626 [debug] [ThreadPool]: On create_lucca_db_public_analytics: COMMIT
[0m13:31:23.604784 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:31:23.604915 [debug] [ThreadPool]: On create_lucca_db_public_analytics: COMMIT
[0m13:31:23.605443 [debug] [ThreadPool]: SQL status: COMMIT in 0.000 seconds
[0m13:31:23.605587 [debug] [ThreadPool]: On create_lucca_db_public_analytics: Close
[0m13:31:23.606106 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_analytics, now list_lucca_db_public_analytics)
[0m13:31:23.608967 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_analytics"
[0m13:31:23.609137 [debug] [ThreadPool]: On list_lucca_db_public_analytics: BEGIN
[0m13:31:23.609266 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:31:23.615289 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m13:31:23.615432 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_analytics"
[0m13:31:23.615568 [debug] [ThreadPool]: On list_lucca_db_public_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_analytics"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_analytics'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_analytics'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_analytics'
  
[0m13:31:23.618047 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m13:31:23.618578 [debug] [ThreadPool]: On list_lucca_db_public_analytics: ROLLBACK
[0m13:31:23.618884 [debug] [ThreadPool]: On list_lucca_db_public_analytics: Close
[0m13:31:23.619131 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_analytics, now list_lucca_db_public)
[0m13:31:23.620734 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m13:31:23.620878 [debug] [ThreadPool]: On list_lucca_db_public: BEGIN
[0m13:31:23.621006 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:31:23.625813 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m13:31:23.625972 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public"
[0m13:31:23.626108 [debug] [ThreadPool]: On list_lucca_db_public: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:31:23.628089 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m13:31:23.628631 [debug] [ThreadPool]: On list_lucca_db_public: ROLLBACK
[0m13:31:23.628970 [debug] [ThreadPool]: On list_lucca_db_public: Close
[0m13:31:23.631141 [debug] [MainThread]: Using postgres connection "master"
[0m13:31:23.631290 [debug] [MainThread]: On master: BEGIN
[0m13:31:23.631415 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:31:23.637588 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:31:23.637726 [debug] [MainThread]: Using postgres connection "master"
[0m13:31:23.637881 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:31:23.639727 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m13:31:23.640229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb03430>]}
[0m13:31:23.640437 [debug] [MainThread]: On master: ROLLBACK
[0m13:31:23.640721 [debug] [MainThread]: Using postgres connection "master"
[0m13:31:23.640854 [debug] [MainThread]: On master: BEGIN
[0m13:31:23.641281 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:31:23.641422 [debug] [MainThread]: On master: COMMIT
[0m13:31:23.641553 [debug] [MainThread]: Using postgres connection "master"
[0m13:31:23.641677 [debug] [MainThread]: On master: COMMIT
[0m13:31:23.641929 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:31:23.642060 [debug] [MainThread]: On master: Close
[0m13:31:23.643356 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:31:23.643598 [info ] [Thread-1  ]: 1 of 2 START sql table model public.lucca_raw_data ............................. [RUN]
[0m13:31:23.643809 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public, now model.lucca_dbt.lucca_raw_data)
[0m13:31:23.643966 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:31:23.648061 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.648512 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:31:23.665843 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.666287 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.666443 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:31:23.666587 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:31:23.675657 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:31:23.675832 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.676004 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:31:23.683700 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m13:31:23.688010 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.688171 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:31:23.688633 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:31:23.690597 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.690748 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:31:23.691105 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:31:23.698115 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:31:23.698269 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.698406 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:31:23.699211 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:31:23.701979 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public"."lucca_raw_data__dbt_backup"
[0m13:31:23.703760 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:31:23.703909 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public"."lucca_raw_data__dbt_backup" cascade
[0m13:31:23.707084 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:31:23.708134 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:31:23.709174 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c945d00>]}
[0m13:31:23.709500 [info ] [Thread-1  ]: 1 of 2 OK created sql table model public.lucca_raw_data ........................ [[32mSELECT 115[0m in 0.06s]
[0m13:31:23.709761 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:31:23.709938 [debug] [Thread-1  ]: Began running node model.lucca_dbt.test
[0m13:31:23.710178 [info ] [Thread-1  ]: 2 of 2 START sql table model public_analytics.test ............................. [RUN]
[0m13:31:23.710375 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.test)
[0m13:31:23.710533 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.test
[0m13:31:23.711993 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.test"
[0m13:31:23.712265 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.test
[0m13:31:23.713872 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.test"
[0m13:31:23.714147 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:31:23.714282 [debug] [Thread-1  ]: On model.lucca_dbt.test: BEGIN
[0m13:31:23.714416 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:31:23.721880 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:31:23.722108 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:31:23.722302 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */

  
    

  create  table "lucca_db"."public_analytics"."test__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:31:23.728343 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m13:31:23.729945 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:31:23.730092 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
alter table "lucca_db"."public_analytics"."test__dbt_tmp" rename to "test"
[0m13:31:23.730480 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:31:23.731099 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:31:23.731259 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:31:23.731390 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:31:23.731933 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m13:31:23.733035 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_analytics"."test__dbt_backup"
[0m13:31:23.733360 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:31:23.733514 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
drop table if exists "lucca_db"."public_analytics"."test__dbt_backup" cascade
[0m13:31:23.733878 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:31:23.734395 [debug] [Thread-1  ]: On model.lucca_dbt.test: Close
[0m13:31:23.734666 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d356685-23f2-4fde-9d5f-88c467c786a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7fa700>]}
[0m13:31:23.734967 [info ] [Thread-1  ]: 2 of 2 OK created sql table model public_analytics.test ........................ [[32mSELECT 115[0m in 0.02s]
[0m13:31:23.735214 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.test
[0m13:31:23.735722 [debug] [MainThread]: Using postgres connection "master"
[0m13:31:23.735854 [debug] [MainThread]: On master: BEGIN
[0m13:31:23.735961 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:31:23.740542 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:31:23.740703 [debug] [MainThread]: On master: COMMIT
[0m13:31:23.740828 [debug] [MainThread]: Using postgres connection "master"
[0m13:31:23.740951 [debug] [MainThread]: On master: COMMIT
[0m13:31:23.741194 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:31:23.741338 [debug] [MainThread]: On master: Close
[0m13:31:23.741520 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:31:23.741662 [debug] [MainThread]: Connection 'model.lucca_dbt.test' was properly closed.
[0m13:31:23.741831 [info ] [MainThread]: 
[0m13:31:23.741985 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m13:31:23.742399 [debug] [MainThread]: Command end result
[0m13:31:23.752495 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:31:23.753500 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:31:23.756332 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:31:23.756466 [info ] [MainThread]: 
[0m13:31:23.756636 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:31:23.756770 [info ] [MainThread]: 
[0m13:31:23.756915 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m13:31:23.758452 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1263577, "process_in_blocks": "0", "process_kernel_time": 0.187455, "process_mem_max_rss": "131481600", "process_out_blocks": "0", "process_user_time": 1.452073}
[0m13:31:23.758631 [debug] [MainThread]: Command `dbt run` succeeded at 13:31:23.758594 after 1.13 seconds
[0m13:31:23.758788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6f5df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4fd700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cabcb50>]}
[0m13:31:23.758962 [debug] [MainThread]: Flushing usage events
[0m13:31:24.127507 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:32:32.559649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108742d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ace50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ac3a0>]}


============================== 13:32:32.562111 | 9244d016-3bcb-4160-80bb-191e3e57e6a1 ==============================
[0m13:32:32.562111 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:32:32.562410 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'empty': 'False', 'log_cache_events': 'False', 'partial_parse': 'True', 'target_path': 'None', 'write_json': 'True', 'introspect': 'True', 'version_check': 'True', 'quiet': 'False', 'debug': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'profiles_dir': '/Users/marccao/repo/dbt', 'static_parser': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'invocation_command': 'dbt run'}
[0m13:32:32.652754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ff880>]}
[0m13:32:32.678761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cc0c40>]}
[0m13:32:32.679380 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:32:32.732407 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:32:32.798715 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:32:32.799050 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m13:32:32.906724 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.base
- models.lucca_dbt.analytics
[0m13:32:32.913514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c0130>]}
[0m13:32:32.972186 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:32:32.973272 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:32:32.981954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7aa880>]}
[0m13:32:32.982177 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m13:32:32.982335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5fb160>]}
[0m13:32:32.982918 [info ] [MainThread]: 
[0m13:32:32.983072 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:32:32.983199 [info ] [MainThread]: 
[0m13:32:32.983428 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:32:32.985287 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:32:33.012883 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:32:33.013098 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:32:33.013221 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:32:33.047280 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.034 seconds
[0m13:32:33.047867 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:32:33.049094 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:32:33.049249 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:32:33.049362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:32:33.058131 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m13:32:33.058653 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:32:33.058944 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_base)
[0m13:32:33.059142 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_base"
"
[0m13:32:33.061569 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:32:33.061723 [debug] [ThreadPool]: On create_lucca_db_public_base: BEGIN
[0m13:32:33.061846 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:32:33.072203 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m13:32:33.072341 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:32:33.072465 [debug] [ThreadPool]: On create_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_base"} */
create schema if not exists "public_base"
[0m13:32:33.073297 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:32:33.073664 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:32:33.073794 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:32:33.073931 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:32:33.074939 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:32:33.075069 [debug] [ThreadPool]: On create_lucca_db_public_base: Close
[0m13:32:33.075309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_base, now create_lucca_db_public_analytics)
[0m13:32:33.075506 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_analytics"
"
[0m13:32:33.076860 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:32:33.077012 [debug] [ThreadPool]: On create_lucca_db_public_analytics: BEGIN
[0m13:32:33.077131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:32:33.085274 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:32:33.085416 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:32:33.085539 [debug] [ThreadPool]: On create_lucca_db_public_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_analytics"} */
create schema if not exists "public_analytics"
[0m13:32:33.086230 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:32:33.086580 [debug] [ThreadPool]: On create_lucca_db_public_analytics: COMMIT
[0m13:32:33.086711 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:32:33.086832 [debug] [ThreadPool]: On create_lucca_db_public_analytics: COMMIT
[0m13:32:33.087594 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:32:33.087726 [debug] [ThreadPool]: On create_lucca_db_public_analytics: Close
[0m13:32:33.088190 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_analytics, now list_lucca_db_public_base)
[0m13:32:33.090866 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:32:33.091003 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:32:33.091122 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:32:33.099849 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:32:33.099987 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:32:33.100118 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:32:33.103436 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:32:33.103928 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:32:33.104367 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:32:33.104585 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_analytics)
[0m13:32:33.105569 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_analytics"
[0m13:32:33.105698 [debug] [ThreadPool]: On list_lucca_db_public_analytics: BEGIN
[0m13:32:33.105815 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:32:33.111330 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m13:32:33.111495 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_analytics"
[0m13:32:33.111634 [debug] [ThreadPool]: On list_lucca_db_public_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_analytics"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_analytics'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_analytics'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_analytics'
  
[0m13:32:33.114420 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:32:33.114944 [debug] [ThreadPool]: On list_lucca_db_public_analytics: ROLLBACK
[0m13:32:33.115287 [debug] [ThreadPool]: On list_lucca_db_public_analytics: Close
[0m13:32:33.117410 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:33.117580 [debug] [MainThread]: On master: BEGIN
[0m13:32:33.117755 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:32:33.122471 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:32:33.122620 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:33.122782 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:32:33.124834 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m13:32:33.125322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10954cc40>]}
[0m13:32:33.125533 [debug] [MainThread]: On master: ROLLBACK
[0m13:32:33.125909 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:33.126038 [debug] [MainThread]: On master: BEGIN
[0m13:32:33.126492 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:32:33.126631 [debug] [MainThread]: On master: COMMIT
[0m13:32:33.126762 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:33.126885 [debug] [MainThread]: On master: COMMIT
[0m13:32:33.127153 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:32:33.127287 [debug] [MainThread]: On master: Close
[0m13:32:33.128587 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:32:33.128840 [info ] [Thread-1  ]: 1 of 2 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:32:33.129049 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_analytics, now model.lucca_dbt.lucca_raw_data)
[0m13:32:33.129206 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:32:33.133351 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:32:33.133828 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:32:33.151922 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:32:33.152382 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:32:33.152534 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:32:33.152663 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:32:33.161663 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:32:33.161830 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:32:33.162010 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:32:33.170976 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.009 seconds
[0m13:32:33.175516 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:32:33.175679 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:32:33.176132 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:32:33.182375 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:32:33.182537 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:32:33.182675 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:32:33.184917 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m13:32:33.187651 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:32:33.189495 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:32:33.189647 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:32:33.190453 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:32:33.191537 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:32:33.192579 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acfc8e0>]}
[0m13:32:33.192896 [info ] [Thread-1  ]: 1 of 2 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:32:33.193177 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:32:33.193364 [debug] [Thread-1  ]: Began running node model.lucca_dbt.test
[0m13:32:33.193603 [info ] [Thread-1  ]: 2 of 2 START sql table model public_analytics.test ............................. [RUN]
[0m13:32:33.193813 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.test)
[0m13:32:33.193968 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.test
[0m13:32:33.195448 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.test"
[0m13:32:33.195748 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.test
[0m13:32:33.197396 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.test"
[0m13:32:33.197647 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:32:33.197785 [debug] [Thread-1  ]: On model.lucca_dbt.test: BEGIN
[0m13:32:33.197911 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:32:33.204491 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:32:33.204711 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:32:33.204878 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */

  
    

  create  table "lucca_db"."public_analytics"."test__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:32:33.210744 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m13:32:33.212423 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:32:33.212585 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
alter table "lucca_db"."public_analytics"."test__dbt_tmp" rename to "test"
[0m13:32:33.212980 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:32:33.213599 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:32:33.213749 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:32:33.213885 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:32:33.214710 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:32:33.216506 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_analytics"."test__dbt_backup"
[0m13:32:33.216826 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:32:33.216979 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
drop table if exists "lucca_db"."public_analytics"."test__dbt_backup" cascade
[0m13:32:33.217363 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:32:33.217919 [debug] [Thread-1  ]: On model.lucca_dbt.test: Close
[0m13:32:33.218184 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9244d016-3bcb-4160-80bb-191e3e57e6a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089e0460>]}
[0m13:32:33.218477 [info ] [Thread-1  ]: 2 of 2 OK created sql table model public_analytics.test ........................ [[32mSELECT 115[0m in 0.02s]
[0m13:32:33.218723 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.test
[0m13:32:33.219265 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:33.219402 [debug] [MainThread]: On master: BEGIN
[0m13:32:33.219525 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:32:33.225985 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:32:33.226153 [debug] [MainThread]: On master: COMMIT
[0m13:32:33.226283 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:33.226405 [debug] [MainThread]: On master: COMMIT
[0m13:32:33.226748 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:32:33.226871 [debug] [MainThread]: On master: Close
[0m13:32:33.227032 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:32:33.227137 [debug] [MainThread]: Connection 'model.lucca_dbt.test' was properly closed.
[0m13:32:33.227283 [info ] [MainThread]: 
[0m13:32:33.227433 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m13:32:33.227767 [debug] [MainThread]: Command end result
[0m13:32:33.237421 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:32:33.238252 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:32:33.241127 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:32:33.241264 [info ] [MainThread]: 
[0m13:32:33.241431 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:32:33.241566 [info ] [MainThread]: 
[0m13:32:33.241712 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m13:32:33.243052 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7186177, "process_in_blocks": "0", "process_kernel_time": 0.15534, "process_mem_max_rss": "129581056", "process_out_blocks": "0", "process_user_time": 1.038377}
[0m13:32:33.243243 [debug] [MainThread]: Command `dbt run` succeeded at 13:32:33.243206 after 0.72 seconds
[0m13:32:33.243417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108742d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109791dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c5a30>]}
[0m13:32:33.243649 [debug] [MainThread]: Flushing usage events
[0m13:32:33.602284 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:33:13.023370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fb6e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902bd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902b2b0>]}


============================== 13:33:13.025620 | 7f20bf0b-56bb-4e90-87e9-1bd64f2d074a ==============================
[0m13:33:13.025620 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:33:13.025884 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'empty': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'quiet': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'write_json': 'True', 'debug': 'False', 'printer_width': '80', 'use_colors': 'True', 'no_print': 'None', 'static_parser': 'True', 'indirect_selection': 'eager'}
[0m13:33:13.115540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fe5b80>]}
[0m13:33:13.141985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902b160>]}
[0m13:33:13.142419 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:33:13.192708 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:33:13.258007 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m13:33:13.258289 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/base/Deuxiemeterzeazeazaze.sql
[0m13:33:13.365292 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m13:33:13.372030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a236130>]}
[0m13:33:13.429445 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:33:13.430582 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:33:13.439595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0bf190>]}
[0m13:33:13.439818 [info ] [MainThread]: Found 3 models, 1 source, 447 macros
[0m13:33:13.439969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a02d190>]}
[0m13:33:13.440569 [info ] [MainThread]: 
[0m13:33:13.440720 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:33:13.440844 [info ] [MainThread]: 
[0m13:33:13.441065 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:33:13.442881 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:33:13.470413 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:33:13.470613 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:33:13.470730 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:33:13.503786 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.033 seconds
[0m13:33:13.504371 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:33:13.505566 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:33:13.505729 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:33:13.505857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:33:13.514823 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m13:33:13.515300 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:33:13.515569 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_analytics)
[0m13:33:13.515763 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_analytics"
"
[0m13:33:13.518202 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:33:13.518347 [debug] [ThreadPool]: On create_lucca_db_public_analytics: BEGIN
[0m13:33:13.518465 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:33:13.526077 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:33:13.526232 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:33:13.526357 [debug] [ThreadPool]: On create_lucca_db_public_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_analytics"} */
create schema if not exists "public_analytics"
[0m13:33:13.527016 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:33:13.527380 [debug] [ThreadPool]: On create_lucca_db_public_analytics: COMMIT
[0m13:33:13.527512 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_analytics"
[0m13:33:13.527629 [debug] [ThreadPool]: On create_lucca_db_public_analytics: COMMIT
[0m13:33:13.528631 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:33:13.528759 [debug] [ThreadPool]: On create_lucca_db_public_analytics: Close
[0m13:33:13.529004 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_analytics, now create_lucca_db_public_base)
[0m13:33:13.529201 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_base"
"
[0m13:33:13.530500 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:33:13.530626 [debug] [ThreadPool]: On create_lucca_db_public_base: BEGIN
[0m13:33:13.530737 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:33:13.538324 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:33:13.538451 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:33:13.538567 [debug] [ThreadPool]: On create_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_base"} */
create schema if not exists "public_base"
[0m13:33:13.539327 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:33:13.539652 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:33:13.539780 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m13:33:13.539893 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m13:33:13.540912 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:33:13.541035 [debug] [ThreadPool]: On create_lucca_db_public_base: Close
[0m13:33:13.541507 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_base, now list_lucca_db_public_analytics)
[0m13:33:13.544119 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_analytics"
[0m13:33:13.544291 [debug] [ThreadPool]: On list_lucca_db_public_analytics: BEGIN
[0m13:33:13.544414 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:33:13.554421 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m13:33:13.554553 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_analytics"
[0m13:33:13.554685 [debug] [ThreadPool]: On list_lucca_db_public_analytics: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_analytics"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_analytics'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_analytics'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_analytics'
  
[0m13:33:13.558001 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:33:13.558476 [debug] [ThreadPool]: On list_lucca_db_public_analytics: ROLLBACK
[0m13:33:13.558824 [debug] [ThreadPool]: On list_lucca_db_public_analytics: Close
[0m13:33:13.559040 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_analytics, now list_lucca_db_public_base)
[0m13:33:13.560048 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:33:13.560180 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:33:13.560338 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:33:13.567578 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:33:13.567723 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:33:13.567864 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:33:13.570936 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:33:13.571443 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:33:13.571791 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:33:13.573880 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:13.574059 [debug] [MainThread]: On master: BEGIN
[0m13:33:13.574238 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:33:13.578869 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:33:13.579027 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:13.579193 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:33:13.581549 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m13:33:13.582071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a070790>]}
[0m13:33:13.582296 [debug] [MainThread]: On master: ROLLBACK
[0m13:33:13.582616 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:13.582759 [debug] [MainThread]: On master: BEGIN
[0m13:33:13.583227 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:33:13.583389 [debug] [MainThread]: On master: COMMIT
[0m13:33:13.583526 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:13.583655 [debug] [MainThread]: On master: COMMIT
[0m13:33:13.583924 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:33:13.584061 [debug] [MainThread]: On master: Close
[0m13:33:13.585328 [debug] [Thread-1  ]: Began running node model.lucca_dbt.Deuxiemeterzeazeazaze
[0m13:33:13.585587 [info ] [Thread-1  ]: 1 of 3 START sql table model public_base.Deuxiemeterzeazeazaze ................. [RUN]
[0m13:33:13.585793 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.Deuxiemeterzeazeazaze)
[0m13:33:13.585952 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.Deuxiemeterzeazeazaze
[0m13:33:13.590014 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.Deuxiemeterzeazeazaze"
[0m13:33:13.590342 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.Deuxiemeterzeazeazaze
[0m13:33:13.608203 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.Deuxiemeterzeazeazaze"
[0m13:33:13.608636 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.Deuxiemeterzeazeazaze"
[0m13:33:13.608787 [debug] [Thread-1  ]: On model.lucca_dbt.Deuxiemeterzeazeazaze: BEGIN
[0m13:33:13.608925 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:33:13.617924 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:33:13.618087 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.Deuxiemeterzeazeazaze"
[0m13:33:13.618266 [debug] [Thread-1  ]: On model.lucca_dbt.Deuxiemeterzeazeazaze: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.Deuxiemeterzeazeazaze"} */

  
    

  create  table "lucca_db"."public_base"."Deuxiemeterzeazeazaze__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:33:13.625094 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m13:33:13.629434 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.Deuxiemeterzeazeazaze"
[0m13:33:13.629600 [debug] [Thread-1  ]: On model.lucca_dbt.Deuxiemeterzeazeazaze: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.Deuxiemeterzeazeazaze"} */
alter table "lucca_db"."public_base"."Deuxiemeterzeazeazaze__dbt_tmp" rename to "Deuxiemeterzeazeazaze"
[0m13:33:13.630292 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:33:13.636426 [debug] [Thread-1  ]: On model.lucca_dbt.Deuxiemeterzeazeazaze: COMMIT
[0m13:33:13.636588 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.Deuxiemeterzeazeazaze"
[0m13:33:13.636729 [debug] [Thread-1  ]: On model.lucca_dbt.Deuxiemeterzeazeazaze: COMMIT
[0m13:33:13.638010 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:33:13.640567 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."Deuxiemeterzeazeazaze__dbt_backup"
[0m13:33:13.642359 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.Deuxiemeterzeazeazaze"
[0m13:33:13.642509 [debug] [Thread-1  ]: On model.lucca_dbt.Deuxiemeterzeazeazaze: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.Deuxiemeterzeazeazaze"} */
drop table if exists "lucca_db"."public_base"."Deuxiemeterzeazeazaze__dbt_backup" cascade
[0m13:33:13.642994 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:33:13.644044 [debug] [Thread-1  ]: On model.lucca_dbt.Deuxiemeterzeazeazaze: Close
[0m13:33:13.645071 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a50bc10>]}
[0m13:33:13.645368 [info ] [Thread-1  ]: 1 of 3 OK created sql table model public_base.Deuxiemeterzeazeazaze ............ [[32mSELECT 115[0m in 0.06s]
[0m13:33:13.645630 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.Deuxiemeterzeazeazaze
[0m13:33:13.645790 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:33:13.646015 [info ] [Thread-1  ]: 2 of 3 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:33:13.646235 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.Deuxiemeterzeazeazaze, now model.lucca_dbt.lucca_raw_data)
[0m13:33:13.646391 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:33:13.647806 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:33:13.648101 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:33:13.649692 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:33:13.649947 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:13.650090 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:33:13.650225 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:33:13.658059 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:33:13.658286 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:13.658493 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:33:13.664778 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m13:33:13.666335 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:13.666483 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:33:13.667116 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:33:13.667663 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:33:13.667801 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:13.667929 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:33:13.668898 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:33:13.670514 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:33:13.670803 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:13.670939 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:33:13.671394 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:33:13.671876 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:33:13.672124 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a538b0>]}
[0m13:33:13.672389 [info ] [Thread-1  ]: 2 of 3 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.03s]
[0m13:33:13.672643 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:33:13.672797 [debug] [Thread-1  ]: Began running node model.lucca_dbt.test
[0m13:33:13.673014 [info ] [Thread-1  ]: 3 of 3 START sql table model public_analytics.test ............................. [RUN]
[0m13:33:13.673221 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.test)
[0m13:33:13.673364 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.test
[0m13:33:13.674859 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.test"
[0m13:33:13.675156 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.test
[0m13:33:13.676668 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.test"
[0m13:33:13.676980 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:33:13.677149 [debug] [Thread-1  ]: On model.lucca_dbt.test: BEGIN
[0m13:33:13.677284 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:33:13.683592 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:33:13.683768 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:33:13.683945 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */

  
    

  create  table "lucca_db"."public_analytics"."test__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:33:13.688454 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:33:13.690090 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:33:13.690247 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
alter table "lucca_db"."public_analytics"."test__dbt_tmp" rename to "test"
[0m13:33:13.690740 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:33:13.691359 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:33:13.691504 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:33:13.691631 [debug] [Thread-1  ]: On model.lucca_dbt.test: COMMIT
[0m13:33:13.692506 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:33:13.693542 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_analytics"."test__dbt_backup"
[0m13:33:13.693909 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.test"
[0m13:33:13.694110 [debug] [Thread-1  ]: On model.lucca_dbt.test: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.test"} */
drop table if exists "lucca_db"."public_analytics"."test__dbt_backup" cascade
[0m13:33:13.694503 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:33:13.695052 [debug] [Thread-1  ]: On model.lucca_dbt.test: Close
[0m13:33:13.695330 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f20bf0b-56bb-4e90-87e9-1bd64f2d074a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6e0ac0>]}
[0m13:33:13.695617 [info ] [Thread-1  ]: 3 of 3 OK created sql table model public_analytics.test ........................ [[32mSELECT 115[0m in 0.02s]
[0m13:33:13.695867 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.test
[0m13:33:13.696349 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:13.696487 [debug] [MainThread]: On master: BEGIN
[0m13:33:13.696598 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:33:13.701739 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:33:13.701926 [debug] [MainThread]: On master: COMMIT
[0m13:33:13.702070 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:13.702204 [debug] [MainThread]: On master: COMMIT
[0m13:33:13.702477 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:33:13.702606 [debug] [MainThread]: On master: Close
[0m13:33:13.702792 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:33:13.702912 [debug] [MainThread]: Connection 'model.lucca_dbt.test' was properly closed.
[0m13:33:13.703088 [info ] [MainThread]: 
[0m13:33:13.703238 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m13:33:13.703729 [debug] [MainThread]: Command end result
[0m13:33:13.714004 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:33:13.714800 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:33:13.717750 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:33:13.717883 [info ] [MainThread]: 
[0m13:33:13.718051 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:33:13.718186 [info ] [MainThread]: 
[0m13:33:13.718331 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m13:33:13.719775 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7309468, "process_in_blocks": "0", "process_kernel_time": 0.155858, "process_mem_max_rss": "129810432", "process_out_blocks": "0", "process_user_time": 1.058597}
[0m13:33:13.719987 [debug] [MainThread]: Command `dbt run` succeeded at 13:33:13.719944 after 0.73 seconds
[0m13:33:13.720173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fb6e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a098cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107519730>]}
[0m13:33:13.720347 [debug] [MainThread]: Flushing usage events
[0m13:33:14.068913 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:33:46.862794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b92ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9a4ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9a4430>]}


============================== 13:33:46.865075 | bda789ba-e37a-4bb4-b16b-f5f35f8c8cee ==============================
[0m13:33:46.865075 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:33:46.865340 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'log_cache_events': 'False', 'empty': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'debug': 'False', 'printer_width': '80', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_format': 'default', 'introspect': 'True', 'quiet': 'False', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'write_json': 'True', 'no_print': 'None', 'use_colors': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'target_path': 'None'}
[0m13:33:46.954728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bda789ba-e37a-4bb4-b16b-f5f35f8c8cee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2d5e20>]}
[0m13:33:46.980817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bda789ba-e37a-4bb4-b16b-f5f35f8c8cee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3cb460>]}
[0m13:33:46.981474 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:33:47.031602 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:33:47.092752 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 0 files added, 0 files changed.
[0m13:33:47.092995 [debug] [MainThread]: Partial parsing: deleted file: lucca_dbt://models/models/base/Deuxiemeterzeazeazaze.sql
[0m13:33:47.093119 [debug] [MainThread]: Partial parsing: deleted file: lucca_dbt://models/models/analytics/test.sql
[0m13:33:47.127430 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.base
- models.lucca_dbt.analytics
[0m13:33:47.134425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bda789ba-e37a-4bb4-b16b-f5f35f8c8cee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9d9130>]}
[0m13:33:47.172649 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:33:47.173712 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:33:47.181783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bda789ba-e37a-4bb4-b16b-f5f35f8c8cee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7ec250>]}
[0m13:33:47.182005 [info ] [MainThread]: Found 1 model, 1 source, 447 macros
[0m13:33:47.182160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bda789ba-e37a-4bb4-b16b-f5f35f8c8cee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0a27c0>]}
[0m13:33:47.182714 [info ] [MainThread]: 
[0m13:33:47.182880 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:33:47.183006 [info ] [MainThread]: 
[0m13:33:47.183229 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:33:47.183621 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:33:47.233382 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:33:47.233586 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:33:47.233707 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:33:47.265067 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.031 seconds
[0m13:33:47.265704 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:33:47.266186 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m13:33:47.268911 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:33:47.269070 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:33:47.269201 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:33:47.276671 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:33:47.276811 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:33:47.276934 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:33:47.280446 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m13:33:47.280949 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:33:47.281411 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:33:47.283254 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:47.283403 [debug] [MainThread]: On master: BEGIN
[0m13:33:47.283517 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:33:47.290827 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:33:47.290951 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:47.291098 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:33:47.295081 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:33:47.295569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bda789ba-e37a-4bb4-b16b-f5f35f8c8cee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0af580>]}
[0m13:33:47.295766 [debug] [MainThread]: On master: ROLLBACK
[0m13:33:47.296123 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:47.296277 [debug] [MainThread]: On master: BEGIN
[0m13:33:47.296846 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:33:47.297015 [debug] [MainThread]: On master: COMMIT
[0m13:33:47.297159 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:47.297288 [debug] [MainThread]: On master: COMMIT
[0m13:33:47.297600 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:33:47.297738 [debug] [MainThread]: On master: Close
[0m13:33:47.299043 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:33:47.299281 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:33:47.299485 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m13:33:47.299645 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:33:47.303651 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.304187 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:33:47.322605 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.323151 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.323312 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:33:47.323445 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:33:47.332076 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:33:47.332250 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.332423 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:33:47.339042 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m13:33:47.343752 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.343920 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:33:47.344453 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:33:47.345749 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.345892 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:33:47.346720 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:33:47.353602 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:33:47.353764 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.353909 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:33:47.355346 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:33:47.357878 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:33:47.359668 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:33:47.359820 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:33:47.362097 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:33:47.363078 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:33:47.364065 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bda789ba-e37a-4bb4-b16b-f5f35f8c8cee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd7b2b0>]}
[0m13:33:47.364327 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:33:47.364575 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:33:47.365008 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:47.365126 [debug] [MainThread]: On master: BEGIN
[0m13:33:47.365233 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:33:47.372252 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:33:47.372425 [debug] [MainThread]: On master: COMMIT
[0m13:33:47.372546 [debug] [MainThread]: Using postgres connection "master"
[0m13:33:47.372673 [debug] [MainThread]: On master: COMMIT
[0m13:33:47.373100 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:33:47.373216 [debug] [MainThread]: On master: Close
[0m13:33:47.373414 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:33:47.373611 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m13:33:47.373755 [info ] [MainThread]: 
[0m13:33:47.373907 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m13:33:47.374211 [debug] [MainThread]: Command end result
[0m13:33:47.384220 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:33:47.384976 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:33:47.388163 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:33:47.388338 [info ] [MainThread]: 
[0m13:33:47.388518 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:33:47.388657 [info ] [MainThread]: 
[0m13:33:47.388804 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:33:47.390176 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.56072813, "process_in_blocks": "0", "process_kernel_time": 0.146274, "process_mem_max_rss": "126238720", "process_out_blocks": "0", "process_user_time": 0.944192}
[0m13:33:47.390352 [debug] [MainThread]: Command `dbt run` succeeded at 13:33:47.390313 after 0.56 seconds
[0m13:33:47.390527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b92ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2d5e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce725b0>]}
[0m13:33:47.390697 [debug] [MainThread]: Flushing usage events
[0m13:33:47.759275 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:52:14.216604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10835ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d5f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d5460>]}


============================== 13:52:14.219112 | 3591f8ed-81ee-4d2e-a0e7-586232723930 ==============================
[0m13:52:14.219112 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:52:14.219371 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'version_check': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'invocation_command': 'dbt run --select employee', 'fail_fast': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'empty': 'False', 'quiet': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_format': 'default'}
[0m13:52:14.312838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3591f8ed-81ee-4d2e-a0e7-586232723930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d05190>]}
[0m13:52:14.339793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3591f8ed-81ee-4d2e-a0e7-586232723930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10917b5b0>]}
[0m13:52:14.340477 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:52:14.391348 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:52:14.456309 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m13:52:14.456570 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/transform/employee.sql
[0m13:52:14.563458 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m13:52:14.570415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3591f8ed-81ee-4d2e-a0e7-586232723930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5df130>]}
[0m13:52:14.629868 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:52:14.631262 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:52:14.640549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3591f8ed-81ee-4d2e-a0e7-586232723930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3c4430>]}
[0m13:52:14.640781 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m13:52:14.640936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3591f8ed-81ee-4d2e-a0e7-586232723930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3ceaf0>]}
[0m13:52:14.641444 [info ] [MainThread]: 
[0m13:52:14.641596 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:52:14.641725 [info ] [MainThread]: 
[0m13:52:14.641942 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:52:14.642316 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:52:14.670867 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:52:14.671087 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:52:14.671232 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:52:14.712443 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.041 seconds
[0m13:52:14.713125 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:52:14.713432 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_transform)
[0m13:52:14.713623 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_transform"
"
[0m13:52:14.716173 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m13:52:14.716312 [debug] [ThreadPool]: On create_lucca_db_public_transform: BEGIN
[0m13:52:14.716438 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:14.725235 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:52:14.725408 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m13:52:14.725565 [debug] [ThreadPool]: On create_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_transform"} */
create schema if not exists "public_transform"
[0m13:52:14.727014 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m13:52:14.727397 [debug] [ThreadPool]: On create_lucca_db_public_transform: COMMIT
[0m13:52:14.727539 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m13:52:14.727661 [debug] [ThreadPool]: On create_lucca_db_public_transform: COMMIT
[0m13:52:14.728635 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m13:52:14.728766 [debug] [ThreadPool]: On create_lucca_db_public_transform: Close
[0m13:52:14.729246 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_transform, now list_lucca_db_public_transform)
[0m13:52:14.731949 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:52:14.732108 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:52:14.732228 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:14.740572 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:52:14.740704 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:52:14.740834 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:52:14.745267 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m13:52:14.745764 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:52:14.746169 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:52:14.746422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m13:52:14.747845 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:52:14.747990 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:52:14.748108 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:14.753777 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m13:52:14.753955 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:52:14.754087 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:52:14.756087 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m13:52:14.756693 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:52:14.757002 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:52:14.759132 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:14.759278 [debug] [MainThread]: On master: BEGIN
[0m13:52:14.759404 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:52:14.764170 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:52:14.764313 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:14.764468 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:52:14.767318 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m13:52:14.767847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3591f8ed-81ee-4d2e-a0e7-586232723930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5a39a0>]}
[0m13:52:14.768077 [debug] [MainThread]: On master: ROLLBACK
[0m13:52:14.768424 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:14.768584 [debug] [MainThread]: On master: BEGIN
[0m13:52:14.769044 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:52:14.769183 [debug] [MainThread]: On master: COMMIT
[0m13:52:14.769312 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:14.769434 [debug] [MainThread]: On master: COMMIT
[0m13:52:14.769698 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:52:14.769825 [debug] [MainThread]: On master: Close
[0m13:52:14.771202 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m13:52:14.771463 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.employee ......................... [RUN]
[0m13:52:14.771676 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.employee)
[0m13:52:14.771833 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m13:52:14.775787 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m13:52:14.776199 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m13:52:14.794979 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m13:52:14.795623 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:14.795788 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m13:52:14.795948 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:14.804504 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:52:14.804692 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:14.804839 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_transform"."employee__dbt_tmp"
  
  
    as
  
  (
    

select
    id,
    name,
    mail,
    employee_number,
    birth_date,
    contract_start_date,
    contract_end_date,
    manager_id,
    manager_name,
    culture_id,
    culture_name,
    calendar_id,
    calendar_name,
    legalEntity_id,
    legalEntity_name,
    rolePrincipal_id,
    rolePrincipal_name,
    habilitedRoles_names,
    habilitedRoles_ids
from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:14.810637 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m13:52:14.814749 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:14.814906 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_transform"."employee__dbt_tmp" rename to "employee"
[0m13:52:14.815325 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:14.821379 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:52:14.821541 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:14.821680 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:52:14.823902 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m13:52:14.827035 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee__dbt_backup"
[0m13:52:14.828862 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:14.829017 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_transform"."employee__dbt_backup" cascade
[0m13:52:14.829615 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:52:14.830657 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m13:52:14.831653 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3591f8ed-81ee-4d2e-a0e7-586232723930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9a4220>]}
[0m13:52:14.831934 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_transform.employee .................... [[32mSELECT 115[0m in 0.06s]
[0m13:52:14.832189 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m13:52:14.832628 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:14.832748 [debug] [MainThread]: On master: BEGIN
[0m13:52:14.832856 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:52:14.840119 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:52:14.840267 [debug] [MainThread]: On master: COMMIT
[0m13:52:14.840382 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:14.840492 [debug] [MainThread]: On master: COMMIT
[0m13:52:14.840845 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:52:14.840959 [debug] [MainThread]: On master: Close
[0m13:52:14.841113 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:52:14.841219 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m13:52:14.841340 [info ] [MainThread]: 
[0m13:52:14.841478 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m13:52:14.841751 [debug] [MainThread]: Command end result
[0m13:52:14.851760 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:52:14.852609 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:52:14.855908 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:52:14.856093 [info ] [MainThread]: 
[0m13:52:14.856271 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:52:14.856403 [info ] [MainThread]: 
[0m13:52:14.856545 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:52:14.858157 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6774591, "process_in_blocks": "0", "process_kernel_time": 0.175435, "process_mem_max_rss": "129368064", "process_out_blocks": "0", "process_user_time": 1.025502}
[0m13:52:14.858362 [debug] [MainThread]: Command `dbt run` succeeded at 13:52:14.858318 after 0.68 seconds
[0m13:52:14.858540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10835ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3c4370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085f4490>]}
[0m13:52:14.858698 [debug] [MainThread]: Flushing usage events
[0m13:52:15.218206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:05:18.904306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bcede80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd63d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd63250>]}


============================== 14:05:18.906641 | 56233b28-ac78-41af-92cb-993e66dd83be ==============================
[0m14:05:18.906641 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:05:18.906919 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'profiles_dir': '/Users/marccao/repo/dbt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'printer_width': '80', 'warn_error': 'None', 'debug': 'False', 'invocation_command': 'dbt run', 'version_check': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'fail_fast': 'False', 'write_json': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'empty': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:05:18.999742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56233b28-ac78-41af-92cb-993e66dd83be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a695a60>]}
[0m14:05:19.028281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56233b28-ac78-41af-92cb-993e66dd83be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c02e250>]}
[0m14:05:19.029026 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:05:19.081440 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:05:19.148992 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:05:19.149319 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m14:05:19.149503 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee.sql
[0m14:05:19.261138 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m14:05:19.268091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '56233b28-ac78-41af-92cb-993e66dd83be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df50130>]}
[0m14:05:19.326330 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:05:19.327494 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:05:19.336643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '56233b28-ac78-41af-92cb-993e66dd83be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd265e0>]}
[0m14:05:19.336896 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:05:19.337054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56233b28-ac78-41af-92cb-993e66dd83be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd4be80>]}
[0m14:05:19.337663 [info ] [MainThread]: 
[0m14:05:19.337827 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:05:19.337959 [info ] [MainThread]: 
[0m14:05:19.338179 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:05:19.340099 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:05:19.368165 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:05:19.368382 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:05:19.368517 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:05:19.405633 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.037 seconds
[0m14:05:19.406274 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:05:19.407554 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:05:19.407718 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:05:19.407840 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:19.416611 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m14:05:19.417218 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:05:19.417796 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:05:19.420749 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:05:19.420916 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:05:19.421044 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:19.427313 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:05:19.427503 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:05:19.427644 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:05:19.431403 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m14:05:19.432017 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:05:19.432405 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:05:19.432691 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:05:19.434345 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:05:19.434483 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:05:19.434600 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:19.439048 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m14:05:19.439217 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:05:19.439359 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:05:19.441115 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m14:05:19.441664 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:05:19.441947 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:05:19.444221 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:19.444391 [debug] [MainThread]: On master: BEGIN
[0m14:05:19.444527 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:05:19.449355 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:05:19.449496 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:19.449654 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:05:19.451273 [debug] [MainThread]: SQL status: SELECT 0 in 0.001 seconds
[0m14:05:19.451779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56233b28-ac78-41af-92cb-993e66dd83be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e20e100>]}
[0m14:05:19.452007 [debug] [MainThread]: On master: ROLLBACK
[0m14:05:19.452323 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:19.452463 [debug] [MainThread]: On master: BEGIN
[0m14:05:19.452939 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:05:19.453071 [debug] [MainThread]: On master: COMMIT
[0m14:05:19.453195 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:19.453318 [debug] [MainThread]: On master: COMMIT
[0m14:05:19.453587 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:05:19.453720 [debug] [MainThread]: On master: Close
[0m14:05:19.455047 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:05:19.455290 [info ] [Thread-1  ]: 1 of 2 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:05:19.455506 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:05:19.455658 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:05:19.459805 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:05:19.460257 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:05:19.478015 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:05:19.478567 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:05:19.478778 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:05:19.479076 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:05:19.484342 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:05:19.484536 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:05:19.484715 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:05:19.485248 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "last_name" does not exist
LINE 16:     last_name,
             ^

[0m14:05:19.485417 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: ROLLBACK
[0m14:05:19.485740 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:05:19.497545 [debug] [Thread-1  ]: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  column "last_name" does not exist
  LINE 16:     last_name,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:05:19.498594 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56233b28-ac78-41af-92cb-993e66dd83be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e270b20>]}
[0m14:05:19.498922 [error] [Thread-1  ]: 1 of 2 ERROR creating sql table model public_base.lucca_raw_data ............... [[31mERROR[0m in 0.04s]
[0m14:05:19.499204 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:05:19.499440 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.lucca_raw_data' to be skipped because of status 'error'.  Reason: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  column "last_name" does not exist
  LINE 16:     last_name,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql.
[0m14:05:19.499755 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:05:19.499956 [info ] [Thread-1  ]: 2 of 2 SKIP relation public_transform.employee ................................. [[33mSKIP[0m]
[0m14:05:19.500156 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:05:19.500551 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:19.500713 [debug] [MainThread]: On master: BEGIN
[0m14:05:19.500836 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:05:19.508311 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:05:19.508595 [debug] [MainThread]: On master: COMMIT
[0m14:05:19.508739 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:19.508873 [debug] [MainThread]: On master: COMMIT
[0m14:05:19.509254 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:05:19.509385 [debug] [MainThread]: On master: Close
[0m14:05:19.509577 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:05:19.509685 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m14:05:19.509849 [info ] [MainThread]: 
[0m14:05:19.509997 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m14:05:19.510313 [debug] [MainThread]: Command end result
[0m14:05:19.521001 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:05:19.521867 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:05:19.525475 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:05:19.525636 [info ] [MainThread]: 
[0m14:05:19.525803 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:05:19.525945 [info ] [MainThread]: 
[0m14:05:19.526113 [error] [MainThread]: [31mFailure in model lucca_raw_data (models/models/base/lucca_raw_data.sql)[0m
[0m14:05:19.526274 [error] [MainThread]:   Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  column "last_name" does not exist
  LINE 16:     last_name,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:05:19.526402 [info ] [MainThread]: 
[0m14:05:19.526552 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:05:19.526678 [info ] [MainThread]: 
[0m14:05:19.526822 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=2
[0m14:05:19.528692 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.66172993, "process_in_blocks": "0", "process_kernel_time": 0.178358, "process_mem_max_rss": "129712128", "process_out_blocks": "0", "process_user_time": 1.046336}
[0m14:05:19.528971 [debug] [MainThread]: Command `dbt run` failed at 14:05:19.528916 after 0.66 seconds
[0m14:05:19.529171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bcede80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de852e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a695a60>]}
[0m14:05:19.529346 [debug] [MainThread]: Flushing usage events
[0m14:05:19.966337 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:05:38.062664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a4ae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108abffa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108abf4c0>]}


============================== 14:05:38.064840 | ff82a2ce-2046-44da-ad14-221fcfd390f9 ==============================
[0m14:05:38.064840 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:05:38.065090 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/marccao/repo/dbt', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'quiet': 'False', 'introspect': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'debug': 'False', 'write_json': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'empty': 'False', 'static_parser': 'True', 'target_path': 'None', 'printer_width': '80', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False'}
[0m14:05:38.155285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ff82a2ce-2046-44da-ad14-221fcfd390f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108aabe80>]}
[0m14:05:38.182605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ff82a2ce-2046-44da-ad14-221fcfd390f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108851cd0>]}
[0m14:05:38.183275 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:05:38.233730 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:05:38.298150 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:05:38.298382 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:05:38.301344 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.base
- models.lucca_dbt.transform
[0m14:05:38.318071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ff82a2ce-2046-44da-ad14-221fcfd390f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109aec130>]}
[0m14:05:38.357004 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:05:38.358033 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:05:38.366349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ff82a2ce-2046-44da-ad14-221fcfd390f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109284760>]}
[0m14:05:38.366582 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:05:38.366740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff82a2ce-2046-44da-ad14-221fcfd390f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083416a0>]}
[0m14:05:38.367316 [info ] [MainThread]: 
[0m14:05:38.367482 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:05:38.367612 [info ] [MainThread]: 
[0m14:05:38.367837 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:05:38.369793 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:05:38.416675 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:05:38.416887 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:05:38.417008 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:05:38.451482 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.034 seconds
[0m14:05:38.452101 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:05:38.453290 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:05:38.453489 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:05:38.453644 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:38.462276 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m14:05:38.462771 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:05:38.463209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:05:38.465763 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:05:38.465910 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:05:38.466024 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:38.474083 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:05:38.474204 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:05:38.474329 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:05:38.478241 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m14:05:38.478741 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:05:38.479164 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:05:38.479385 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:05:38.480332 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:05:38.480557 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:05:38.480677 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:38.488499 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:05:38.488632 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:05:38.488764 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:05:38.492182 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m14:05:38.492702 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:05:38.493072 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:05:38.495403 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:38.495553 [debug] [MainThread]: On master: BEGIN
[0m14:05:38.495677 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:05:38.502928 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:05:38.503063 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:38.503223 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:05:38.506954 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m14:05:38.507418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff82a2ce-2046-44da-ad14-221fcfd390f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b13250>]}
[0m14:05:38.507617 [debug] [MainThread]: On master: ROLLBACK
[0m14:05:38.508032 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:38.508161 [debug] [MainThread]: On master: BEGIN
[0m14:05:38.508780 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:05:38.508912 [debug] [MainThread]: On master: COMMIT
[0m14:05:38.509036 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:38.509152 [debug] [MainThread]: On master: COMMIT
[0m14:05:38.509512 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:05:38.509641 [debug] [MainThread]: On master: Close
[0m14:05:38.511298 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:05:38.511536 [info ] [Thread-1  ]: 1 of 2 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:05:38.511738 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:05:38.511895 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:05:38.515911 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:05:38.516203 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:05:38.533824 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:05:38.534292 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:05:38.534460 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:05:38.534606 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:05:38.543331 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:05:38.543487 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:05:38.543660 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:05:38.545049 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "last_name" does not exist
LINE 16:     last_name,
             ^

[0m14:05:38.545220 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: ROLLBACK
[0m14:05:38.545705 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:05:38.556988 [debug] [Thread-1  ]: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  column "last_name" does not exist
  LINE 16:     last_name,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:05:38.557990 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff82a2ce-2046-44da-ad14-221fcfd390f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f29f70>]}
[0m14:05:38.558315 [error] [Thread-1  ]: 1 of 2 ERROR creating sql table model public_base.lucca_raw_data ............... [[31mERROR[0m in 0.05s]
[0m14:05:38.558579 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:05:38.558816 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.lucca_raw_data' to be skipped because of status 'error'.  Reason: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  column "last_name" does not exist
  LINE 16:     last_name,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql.
[0m14:05:38.559147 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:05:38.559341 [info ] [Thread-1  ]: 2 of 2 SKIP relation public_transform.employee ................................. [[33mSKIP[0m]
[0m14:05:38.559572 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:05:38.560241 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:38.560382 [debug] [MainThread]: On master: BEGIN
[0m14:05:38.560506 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:05:38.569173 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m14:05:38.569384 [debug] [MainThread]: On master: COMMIT
[0m14:05:38.569505 [debug] [MainThread]: Using postgres connection "master"
[0m14:05:38.569619 [debug] [MainThread]: On master: COMMIT
[0m14:05:38.570001 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:05:38.570142 [debug] [MainThread]: On master: Close
[0m14:05:38.570342 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:05:38.570524 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m14:05:38.570714 [info ] [MainThread]: 
[0m14:05:38.570863 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m14:05:38.571175 [debug] [MainThread]: Command end result
[0m14:05:38.581313 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:05:38.582109 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:05:38.585162 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:05:38.585308 [info ] [MainThread]: 
[0m14:05:38.585473 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:05:38.585612 [info ] [MainThread]: 
[0m14:05:38.585778 [error] [MainThread]: [31mFailure in model lucca_raw_data (models/models/base/lucca_raw_data.sql)[0m
[0m14:05:38.585935 [error] [MainThread]:   Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  column "last_name" does not exist
  LINE 16:     last_name,
               ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:05:38.586061 [info ] [MainThread]: 
[0m14:05:38.586209 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:05:38.586333 [info ] [MainThread]: 
[0m14:05:38.586473 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=2
[0m14:05:38.587912 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.55860883, "process_in_blocks": "0", "process_kernel_time": 0.150298, "process_mem_max_rss": "125779968", "process_out_blocks": "0", "process_user_time": 0.934426}
[0m14:05:38.588090 [debug] [MainThread]: Command `dbt run` failed at 14:05:38.588054 after 0.56 seconds
[0m14:05:38.588254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a4ae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a87f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d206d0>]}
[0m14:05:38.588409 [debug] [MainThread]: Flushing usage events
[0m14:05:38.978789 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:08:37.658862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba4ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cac5e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cac53a0>]}


============================== 14:08:37.661405 | cd4d8a48-0077-4fba-9be1-d0f98b182ef9 ==============================
[0m14:08:37.661405 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:08:37.661658 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/marccao/repo/dbt', 'introspect': 'True', 'target_path': 'None', 'version_check': 'True', 'invocation_command': 'dbt run --select base.lucca_raw_data', 'log_format': 'default', 'cache_selected_only': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'indirect_selection': 'eager', 'warn_error': 'None', 'quiet': 'False', 'debug': 'False', 'static_parser': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'fail_fast': 'False', 'write_json': 'True'}
[0m14:08:37.752350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd4d8a48-0077-4fba-9be1-d0f98b182ef9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cfadbe0>]}
[0m14:08:37.778825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd4d8a48-0077-4fba-9be1-d0f98b182ef9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4eb460>]}
[0m14:08:37.779512 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:08:37.832646 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:08:37.897950 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:08:37.898153 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:08:37.900884 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m14:08:37.917117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd4d8a48-0077-4fba-9be1-d0f98b182ef9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dad1130>]}
[0m14:08:37.956116 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:08:37.957373 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:08:37.966236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd4d8a48-0077-4fba-9be1-d0f98b182ef9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d90fbe0>]}
[0m14:08:37.966457 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:08:37.966616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd4d8a48-0077-4fba-9be1-d0f98b182ef9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d27d160>]}
[0m14:08:37.966858 [warn ] [MainThread]: The selection criterion 'base.lucca_raw_data' does not match any enabled nodes
[0m14:08:37.967214 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m14:08:37.968072 [debug] [MainThread]: Command end result
[0m14:08:37.977639 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:08:37.978420 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:08:37.980531 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:08:37.981982 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.3602058, "process_in_blocks": "0", "process_kernel_time": 0.131008, "process_mem_max_rss": "110952448", "process_out_blocks": "0", "process_user_time": 0.804962}
[0m14:08:37.982162 [debug] [MainThread]: Command `dbt run` succeeded at 14:08:37.982126 after 0.36 seconds
[0m14:08:37.982332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba4ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3f5e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d90f250>]}
[0m14:08:37.982488 [debug] [MainThread]: Flushing usage events
[0m14:08:38.509862 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:08:48.894561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bb2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c29f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c29490>]}


============================== 14:08:48.896692 | 9cf0bb5d-d921-48e3-bea9-60569598074b ==============================
[0m14:08:48.896692 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:08:48.896949 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'version_check': 'True', 'warn_error': 'None', 'printer_width': '80', 'fail_fast': 'False', 'target_path': 'None', 'invocation_command': 'dbt run --select lucca_raw_data', 'log_path': '/Users/marccao/repo/dbt/logs', 'indirect_selection': 'eager', 'write_json': 'True'}
[0m14:08:48.986214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9cf0bb5d-d921-48e3-bea9-60569598074b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065597f0>]}
[0m14:08:49.012298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9cf0bb5d-d921-48e3-bea9-60569598074b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108be32e0>]}
[0m14:08:49.012957 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:08:49.067033 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:08:49.132917 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:08:49.133169 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:08:49.136108 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m14:08:49.152780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9cf0bb5d-d921-48e3-bea9-60569598074b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c55130>]}
[0m14:08:49.192615 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:08:49.193629 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:08:49.201358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9cf0bb5d-d921-48e3-bea9-60569598074b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a9e580>]}
[0m14:08:49.201607 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:08:49.201772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9cf0bb5d-d921-48e3-bea9-60569598074b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c72df0>]}
[0m14:08:49.202274 [info ] [MainThread]: 
[0m14:08:49.202441 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:08:49.202575 [info ] [MainThread]: 
[0m14:08:49.202801 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:08:49.203200 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:08:49.249833 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:08:49.250053 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:08:49.250181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:08:49.287567 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.037 seconds
[0m14:08:49.288135 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:08:49.288449 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_base)
[0m14:08:49.288680 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_base"
"
[0m14:08:49.291120 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m14:08:49.291258 [debug] [ThreadPool]: On create_lucca_db_public_base: BEGIN
[0m14:08:49.291370 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:49.299306 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:08:49.299432 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m14:08:49.299544 [debug] [ThreadPool]: On create_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_base"} */
create schema if not exists "public_base"
[0m14:08:49.300572 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m14:08:49.300911 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m14:08:49.301029 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_base"
[0m14:08:49.301136 [debug] [ThreadPool]: On create_lucca_db_public_base: COMMIT
[0m14:08:49.301941 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m14:08:49.302059 [debug] [ThreadPool]: On create_lucca_db_public_base: Close
[0m14:08:49.302485 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_base, now list_lucca_db_public_base)
[0m14:08:49.305003 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:08:49.305120 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:08:49.305226 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:49.314438 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m14:08:49.314576 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:08:49.314704 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:08:49.318525 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m14:08:49.318997 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:08:49.319432 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:08:49.319651 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m14:08:49.320620 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:08:49.320763 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:08:49.320883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:49.328650 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:08:49.328777 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:08:49.328905 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:08:49.332243 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m14:08:49.332689 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:08:49.333125 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:08:49.335348 [debug] [MainThread]: Using postgres connection "master"
[0m14:08:49.335485 [debug] [MainThread]: On master: BEGIN
[0m14:08:49.335607 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:08:49.342926 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:08:49.343065 [debug] [MainThread]: Using postgres connection "master"
[0m14:08:49.343223 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:08:49.346790 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m14:08:49.347269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9cf0bb5d-d921-48e3-bea9-60569598074b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c72df0>]}
[0m14:08:49.347477 [debug] [MainThread]: On master: ROLLBACK
[0m14:08:49.347859 [debug] [MainThread]: Using postgres connection "master"
[0m14:08:49.347990 [debug] [MainThread]: On master: BEGIN
[0m14:08:49.348556 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:08:49.348716 [debug] [MainThread]: On master: COMMIT
[0m14:08:49.348843 [debug] [MainThread]: Using postgres connection "master"
[0m14:08:49.348962 [debug] [MainThread]: On master: COMMIT
[0m14:08:49.349269 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:08:49.349400 [debug] [MainThread]: On master: Close
[0m14:08:49.350688 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:08:49.350956 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:08:49.351192 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m14:08:49.351364 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:08:49.355390 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:08:49.355835 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:08:49.374654 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:08:49.375209 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:08:49.375368 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:08:49.375501 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:08:49.385233 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m14:08:49.385397 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:08:49.385565 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart' as contract_start_date,
    raw_payload->>'dtContractEnd' as contract_end_date,
    raw_payload->>'birthDate' AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:08:49.393812 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m14:08:49.398117 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:08:49.398286 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:08:49.399126 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:08:49.405257 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:08:49.405419 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:08:49.405561 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:08:49.407152 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:08:49.409677 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:08:49.412032 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:08:49.412189 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:08:49.412730 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m14:08:49.413741 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:08:49.414713 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cf0bb5d-d921-48e3-bea9-60569598074b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c72df0>]}
[0m14:08:49.414977 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m14:08:49.415230 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:08:49.415671 [debug] [MainThread]: Using postgres connection "master"
[0m14:08:49.415796 [debug] [MainThread]: On master: BEGIN
[0m14:08:49.415903 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:08:49.424535 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m14:08:49.424706 [debug] [MainThread]: On master: COMMIT
[0m14:08:49.424827 [debug] [MainThread]: Using postgres connection "master"
[0m14:08:49.424938 [debug] [MainThread]: On master: COMMIT
[0m14:08:49.425337 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:08:49.425456 [debug] [MainThread]: On master: Close
[0m14:08:49.425622 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:08:49.425728 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m14:08:49.425850 [info ] [MainThread]: 
[0m14:08:49.425991 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m14:08:49.426261 [debug] [MainThread]: Command end result
[0m14:08:49.435651 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:08:49.436442 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:08:49.439364 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:08:49.439527 [info ] [MainThread]: 
[0m14:08:49.439942 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:08:49.440113 [info ] [MainThread]: 
[0m14:08:49.440269 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m14:08:49.441603 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5797643, "process_in_blocks": "0", "process_kernel_time": 0.137065, "process_mem_max_rss": "126189568", "process_out_blocks": "0", "process_user_time": 0.933945}
[0m14:08:49.441762 [debug] [MainThread]: Command `dbt run` succeeded at 14:08:49.441728 after 0.58 seconds
[0m14:08:49.441920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bb2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c542e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c541f0>]}
[0m14:08:49.442092 [debug] [MainThread]: Flushing usage events
[0m14:08:50.196498 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:36:06.685702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4aaeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d521f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d521490>]}


============================== 14:36:06.688047 | 47c5188e-cfdd-44fc-a9ef-5f3d498792a1 ==============================
[0m14:36:06.688047 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:36:06.688317 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'printer_width': '80', 'fail_fast': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select transform/employee', 'log_path': '/Users/marccao/repo/dbt/logs', 'no_print': 'None', 'version_check': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'warn_error': 'None', 'target_path': 'None', 'debug': 'False', 'log_format': 'default', 'profiles_dir': '/Users/marccao/repo/dbt', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:36:06.776500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47c5188e-cfdd-44fc-a9ef-5f3d498792a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae517f0>]}
[0m14:36:06.803817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47c5188e-cfdd-44fc-a9ef-5f3d498792a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d50ce20>]}
[0m14:36:06.804502 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:36:06.855977 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:36:06.920673 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:36:06.920954 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee.sql
[0m14:36:07.027323 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m14:36:07.034085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47c5188e-cfdd-44fc-a9ef-5f3d498792a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e72b130>]}
[0m14:36:07.091353 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:36:07.092365 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:36:07.101418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47c5188e-cfdd-44fc-a9ef-5f3d498792a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e611c40>]}
[0m14:36:07.101668 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:36:07.101832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47c5188e-cfdd-44fc-a9ef-5f3d498792a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5319a0>]}
[0m14:36:07.102129 [warn ] [MainThread]: The selection criterion 'transform/employee' does not match any enabled nodes
[0m14:36:07.102501 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m14:36:07.102731 [debug] [MainThread]: Command end result
[0m14:36:07.111918 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:36:07.112713 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:36:07.114358 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:36:07.116047 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.4667971, "process_in_blocks": "0", "process_kernel_time": 0.155167, "process_mem_max_rss": "114425856", "process_out_blocks": "0", "process_user_time": 0.910911}
[0m14:36:07.116227 [debug] [MainThread]: Command `dbt run` succeeded at 14:36:07.116191 after 0.47 seconds
[0m14:36:07.116385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4aaeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c75da90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4bdc70>]}
[0m14:36:07.116536 [debug] [MainThread]: Flushing usage events
[0m14:36:07.483125 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:36:13.657596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c81aeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d891f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d891490>]}


============================== 14:36:13.659275 | 9c93774a-fe11-49af-8cfd-249f04cc87cf ==============================
[0m14:36:13.659275 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:36:13.659546 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'partial_parse': 'True', 'write_json': 'True', 'static_parser': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'fail_fast': 'False', 'printer_width': '80', 'log_path': '/Users/marccao/repo/dbt/logs', 'empty': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select transform/employee.sql', 'version_check': 'True', 'log_format': 'default', 'no_print': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'introspect': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None'}
[0m14:36:13.733391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c93774a-fe11-49af-8cfd-249f04cc87cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1c17f0>]}
[0m14:36:13.758892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c93774a-fe11-49af-8cfd-249f04cc87cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8482e0>]}
[0m14:36:13.759274 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:36:13.806743 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:36:13.862539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:36:13.862753 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:36:13.865550 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.base
- models.lucca_dbt.transform
[0m14:36:13.881779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c93774a-fe11-49af-8cfd-249f04cc87cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8bd130>]}
[0m14:36:13.919135 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:36:13.919962 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:36:13.924815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c93774a-fe11-49af-8cfd-249f04cc87cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e706580>]}
[0m14:36:13.925041 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:36:13.925194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c93774a-fe11-49af-8cfd-249f04cc87cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8dadf0>]}
[0m14:36:13.925499 [warn ] [MainThread]: The selection criterion 'transform/employee.sql' does not match any enabled nodes
[0m14:36:13.925844 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m14:36:13.926711 [debug] [MainThread]: Command end result
[0m14:36:13.936156 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:36:13.936926 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:36:13.938433 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:36:13.939527 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.31375033, "process_in_blocks": "0", "process_kernel_time": 0.09293, "process_mem_max_rss": "110837760", "process_out_blocks": "0", "process_user_time": 0.796482}
[0m14:36:13.939701 [debug] [MainThread]: Command `dbt run` succeeded at 14:36:13.939666 after 0.31 seconds
[0m14:36:13.939861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c81aeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd79820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8bd910>]}
[0m14:36:13.940009 [debug] [MainThread]: Flushing usage events
[0m14:36:14.351540 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:36:21.936908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb92e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc09f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc09460>]}


============================== 14:36:21.938903 | bbe2e4aa-6ca2-495e-984b-4c7891648046 ==============================
[0m14:36:21.938903 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:36:21.939186 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'version_check': 'True', 'no_print': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'cache_selected_only': 'False', 'printer_width': '80', 'write_json': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'introspect': 'True', 'invocation_command': 'dbt run --select employee.sql', 'use_experimental_parser': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'target_path': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'quiet': 'False'}
[0m14:36:22.019074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbe2e4aa-6ca2-495e-984b-4c7891648046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a539190>]}
[0m14:36:22.047242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bbe2e4aa-6ca2-495e-984b-4c7891648046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9af5b0>]}
[0m14:36:22.047858 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:36:22.125620 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:36:22.182709 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:36:22.182939 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:36:22.185966 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m14:36:22.203480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bbe2e4aa-6ca2-495e-984b-4c7891648046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc35130>]}
[0m14:36:22.243395 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:36:22.244377 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:36:22.249746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bbe2e4aa-6ca2-495e-984b-4c7891648046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc5c280>]}
[0m14:36:22.249988 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:36:22.250167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbe2e4aa-6ca2-495e-984b-4c7891648046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc211c0>]}
[0m14:36:22.250763 [info ] [MainThread]: 
[0m14:36:22.250935 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:36:22.251066 [info ] [MainThread]: 
[0m14:36:22.251291 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:36:22.251709 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:36:22.301836 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:36:22.302070 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:36:22.302209 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:36:22.399246 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.097 seconds
[0m14:36:22.399951 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:36:22.400282 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now create_lucca_db_public_transform)
[0m14:36:22.400498 [debug] [ThreadPool]: Creating schema "database: "lucca_db"
schema: "public_transform"
"
[0m14:36:22.403225 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m14:36:22.403387 [debug] [ThreadPool]: On create_lucca_db_public_transform: BEGIN
[0m14:36:22.403509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:36:22.410347 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:36:22.410490 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m14:36:22.410617 [debug] [ThreadPool]: On create_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "create_lucca_db_public_transform"} */
create schema if not exists "public_transform"
[0m14:36:22.411481 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m14:36:22.411872 [debug] [ThreadPool]: On create_lucca_db_public_transform: COMMIT
[0m14:36:22.412012 [debug] [ThreadPool]: Using postgres connection "create_lucca_db_public_transform"
[0m14:36:22.412133 [debug] [ThreadPool]: On create_lucca_db_public_transform: COMMIT
[0m14:36:22.413203 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m14:36:22.413336 [debug] [ThreadPool]: On create_lucca_db_public_transform: Close
[0m14:36:22.413839 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_lucca_db_public_transform, now list_lucca_db_public_transform)
[0m14:36:22.416646 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:36:22.416884 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:36:22.417053 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:36:22.423043 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:36:22.423219 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:36:22.423410 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:36:22.426707 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m14:36:22.427274 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:36:22.427748 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:36:22.428005 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:36:22.429257 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:36:22.429425 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:36:22.429670 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:36:22.438488 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m14:36:22.438787 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:36:22.438965 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:36:22.442325 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m14:36:22.443240 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:36:22.443819 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:36:22.447454 [debug] [MainThread]: Using postgres connection "master"
[0m14:36:22.447671 [debug] [MainThread]: On master: BEGIN
[0m14:36:22.447866 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:36:22.456364 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:36:22.456612 [debug] [MainThread]: Using postgres connection "master"
[0m14:36:22.456820 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:36:22.461910 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m14:36:22.462687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbe2e4aa-6ca2-495e-984b-4c7891648046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da7e3d0>]}
[0m14:36:22.462974 [debug] [MainThread]: On master: ROLLBACK
[0m14:36:22.463534 [debug] [MainThread]: Using postgres connection "master"
[0m14:36:22.463696 [debug] [MainThread]: On master: BEGIN
[0m14:36:22.464329 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:36:22.464461 [debug] [MainThread]: On master: COMMIT
[0m14:36:22.464589 [debug] [MainThread]: Using postgres connection "master"
[0m14:36:22.464713 [debug] [MainThread]: On master: COMMIT
[0m14:36:22.465110 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:36:22.465243 [debug] [MainThread]: On master: Close
[0m14:36:22.466947 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:36:22.467224 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.employee ......................... [RUN]
[0m14:36:22.467448 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.employee)
[0m14:36:22.467612 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:36:22.472003 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:36:22.472629 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:36:22.493561 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:36:22.494306 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:36:22.494488 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:36:22.494642 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:36:22.502168 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:36:22.502367 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:36:22.502524 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_transform"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:36:22.507812 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:36:22.514636 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:36:22.514880 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_transform"."employee__dbt_tmp" rename to "employee"
[0m14:36:22.516044 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:36:22.522774 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:36:22.523023 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:36:22.523199 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:36:22.525017 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m14:36:22.528410 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee__dbt_backup"
[0m14:36:22.531424 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:36:22.531622 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_transform"."employee__dbt_backup" cascade
[0m14:36:22.532620 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:36:22.533850 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:36:22.534948 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bbe2e4aa-6ca2-495e-984b-4c7891648046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a51a640>]}
[0m14:36:22.535264 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_transform.employee .................... [[32mSELECT 115[0m in 0.07s]
[0m14:36:22.535520 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:36:22.535973 [debug] [MainThread]: Using postgres connection "master"
[0m14:36:22.536108 [debug] [MainThread]: On master: BEGIN
[0m14:36:22.536228 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:36:22.543187 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:36:22.543372 [debug] [MainThread]: On master: COMMIT
[0m14:36:22.543505 [debug] [MainThread]: Using postgres connection "master"
[0m14:36:22.543625 [debug] [MainThread]: On master: COMMIT
[0m14:36:22.544166 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:36:22.544299 [debug] [MainThread]: On master: Close
[0m14:36:22.544494 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:36:22.544612 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m14:36:22.544746 [info ] [MainThread]: 
[0m14:36:22.544888 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m14:36:22.545182 [debug] [MainThread]: Command end result
[0m14:36:22.556181 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:36:22.557176 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:36:22.560515 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:36:22.560680 [info ] [MainThread]: 
[0m14:36:22.560962 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:36:22.561110 [info ] [MainThread]: 
[0m14:36:22.561258 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m14:36:22.563388 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6624496, "process_in_blocks": "0", "process_kernel_time": 0.130049, "process_mem_max_rss": "125976576", "process_out_blocks": "0", "process_user_time": 0.975366}
[0m14:36:22.563787 [debug] [MainThread]: Command `dbt run` succeeded at 14:36:22.563702 after 0.66 seconds
[0m14:36:22.564002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb92e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9af5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc5c310>]}
[0m14:36:22.564197 [debug] [MainThread]: Flushing usage events
[0m14:36:22.923617 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:38:23.589010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c18aeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d200190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d200520>]}


============================== 14:38:23.591257 | 73bef653-77f4-4b20-a67c-31d121097f99 ==============================
[0m14:38:23.591257 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:38:23.591515 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'printer_width': '80', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'log_path': '/Users/marccao/repo/dbt/logs', 'introspect': 'True', 'static_parser': 'True', 'quiet': 'False', 'use_colors': 'True', 'target_path': 'None', 'no_print': 'None', 'use_experimental_parser': 'False', 'version_check': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'log_cache_events': 'False'}
[0m14:38:23.686107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73bef653-77f4-4b20-a67c-31d121097f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab317f0>]}
[0m14:38:23.713995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73bef653-77f4-4b20-a67c-31d121097f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca6e5b0>]}
[0m14:38:23.714685 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:38:23.766281 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:38:23.833142 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:38:23.833431 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m14:38:23.942747 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m14:38:23.949807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73bef653-77f4-4b20-a67c-31d121097f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3ec130>]}
[0m14:38:24.008222 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:38:24.009492 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:38:24.018373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73bef653-77f4-4b20-a67c-31d121097f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1d0e20>]}
[0m14:38:24.018618 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:38:24.018796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73bef653-77f4-4b20-a67c-31d121097f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1e2be0>]}
[0m14:38:24.019364 [info ] [MainThread]: 
[0m14:38:24.019518 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:38:24.019648 [info ] [MainThread]: 
[0m14:38:24.019868 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:38:24.021674 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:38:24.049329 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:38:24.049534 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:38:24.049655 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:24.090021 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.040 seconds
[0m14:38:24.090610 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:38:24.091770 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:38:24.091957 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:38:24.092125 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:24.100465 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m14:38:24.100916 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:38:24.101341 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:38:24.103911 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:38:24.104048 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:38:24.104153 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:24.112233 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:38:24.112390 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:38:24.112528 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:38:24.116791 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m14:38:24.117299 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:38:24.117693 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:38:24.117917 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:38:24.119270 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:38:24.119402 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:38:24.119512 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:24.127379 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:38:24.127503 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:38:24.127628 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:38:24.130886 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m14:38:24.131336 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:38:24.131811 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:38:24.133676 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:24.133808 [debug] [MainThread]: On master: BEGIN
[0m14:38:24.133920 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:38:24.140475 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:38:24.140615 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:24.140767 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:38:24.144272 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m14:38:24.144785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73bef653-77f4-4b20-a67c-31d121097f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d91e400>]}
[0m14:38:24.145008 [debug] [MainThread]: On master: ROLLBACK
[0m14:38:24.145374 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:24.145519 [debug] [MainThread]: On master: BEGIN
[0m14:38:24.145986 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:38:24.146128 [debug] [MainThread]: On master: COMMIT
[0m14:38:24.146255 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:24.146374 [debug] [MainThread]: On master: COMMIT
[0m14:38:24.146642 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:38:24.146787 [debug] [MainThread]: On master: Close
[0m14:38:24.148035 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:38:24.148266 [info ] [Thread-1  ]: 1 of 2 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:38:24.148464 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:38:24.148616 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:38:24.152594 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:38:24.153018 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:38:24.170905 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:38:24.171349 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:24.171500 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:38:24.171643 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:38:24.180734 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:38:24.180925 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:24.181105 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    raw_payload->>'dtContractStart'::date as contract_start_date,
    raw_payload->>'dtContractEnd'::date as contract_end_date,
    raw_payload->>'birthDate'::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:38:24.182705 [debug] [Thread-1  ]: Postgres adapter: Postgres error: invalid input syntax for type date: "dtContractStart"
LINE 22:     raw_payload->>'dtContractStart'::date as contract_start_...
                           ^

[0m14:38:24.182866 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: ROLLBACK
[0m14:38:24.183309 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:38:24.193885 [debug] [Thread-1  ]: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  invalid input syntax for type date: "dtContractStart"
  LINE 22:     raw_payload->>'dtContractStart'::date as contract_start_...
                             ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:38:24.194885 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73bef653-77f4-4b20-a67c-31d121097f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e70db50>]}
[0m14:38:24.195196 [error] [Thread-1  ]: 1 of 2 ERROR creating sql table model public_base.lucca_raw_data ............... [[31mERROR[0m in 0.05s]
[0m14:38:24.195451 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:38:24.195688 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.lucca_raw_data' to be skipped because of status 'error'.  Reason: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  invalid input syntax for type date: "dtContractStart"
  LINE 22:     raw_payload->>'dtContractStart'::date as contract_start_...
                             ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql.
[0m14:38:24.195978 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:38:24.196169 [info ] [Thread-1  ]: 2 of 2 SKIP relation public_transform.employee ................................. [[33mSKIP[0m]
[0m14:38:24.196361 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:38:24.196760 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:24.196905 [debug] [MainThread]: On master: BEGIN
[0m14:38:24.197015 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:38:24.205075 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:38:24.205270 [debug] [MainThread]: On master: COMMIT
[0m14:38:24.205390 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:24.205498 [debug] [MainThread]: On master: COMMIT
[0m14:38:24.205940 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:38:24.206066 [debug] [MainThread]: On master: Close
[0m14:38:24.206245 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:38:24.206351 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m14:38:24.206501 [info ] [MainThread]: 
[0m14:38:24.206644 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m14:38:24.206952 [debug] [MainThread]: Command end result
[0m14:38:24.217294 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:38:24.218095 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:38:24.221648 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:38:24.221826 [info ] [MainThread]: 
[0m14:38:24.221986 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:38:24.222126 [info ] [MainThread]: 
[0m14:38:24.222291 [error] [MainThread]: [31mFailure in model lucca_raw_data (models/models/base/lucca_raw_data.sql)[0m
[0m14:38:24.222448 [error] [MainThread]:   Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  invalid input syntax for type date: "dtContractStart"
  LINE 22:     raw_payload->>'dtContractStart'::date as contract_start_...
                             ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:38:24.222577 [info ] [MainThread]: 
[0m14:38:24.222722 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:38:24.222847 [info ] [MainThread]: 
[0m14:38:24.222987 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=2
[0m14:38:24.224611 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6727155, "process_in_blocks": "0", "process_kernel_time": 0.178978, "process_mem_max_rss": "129859584", "process_out_blocks": "0", "process_user_time": 1.048172}
[0m14:38:24.224781 [debug] [MainThread]: Command `dbt run` failed at 14:38:24.224746 after 0.67 seconds
[0m14:38:24.224951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c18aeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d91a3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8e6820>]}
[0m14:38:24.225113 [debug] [MainThread]: Flushing usage events
[0m14:38:24.603933 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:38:40.092471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b98ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca04ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca04430>]}


============================== 14:38:40.094713 | 506b0acd-55ea-4c91-87a8-2ac62d22e94b ==============================
[0m14:38:40.094713 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:38:40.094987 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'quiet': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'fail_fast': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'printer_width': '80', 'no_print': 'None', 'version_check': 'True', 'write_json': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'warn_error': 'None', 'partial_parse': 'True', 'introspect': 'True'}
[0m14:38:40.182481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '506b0acd-55ea-4c91-87a8-2ac62d22e94b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a335e20>]}
[0m14:38:40.208426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '506b0acd-55ea-4c91-87a8-2ac62d22e94b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b42b460>]}
[0m14:38:40.209076 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:38:40.259453 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:38:40.318995 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:38:40.319296 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m14:38:40.425849 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m14:38:40.432722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '506b0acd-55ea-4c91-87a8-2ac62d22e94b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dbf1130>]}
[0m14:38:40.489370 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:38:40.490392 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:38:40.498533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '506b0acd-55ea-4c91-87a8-2ac62d22e94b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da0b2b0>]}
[0m14:38:40.498762 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:38:40.498919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '506b0acd-55ea-4c91-87a8-2ac62d22e94b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9f5910>]}
[0m14:38:40.499507 [info ] [MainThread]: 
[0m14:38:40.499664 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:38:40.499794 [info ] [MainThread]: 
[0m14:38:40.500014 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:38:40.501847 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:38:40.525725 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:38:40.525929 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:38:40.526054 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:40.560294 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.034 seconds
[0m14:38:40.560956 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:38:40.562184 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:38:40.562338 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:38:40.562453 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:40.570728 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m14:38:40.571220 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:38:40.571665 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:38:40.574234 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:38:40.574369 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:38:40.574523 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:40.581986 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:38:40.582112 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:38:40.582233 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:38:40.585971 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m14:38:40.586446 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:38:40.586850 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:38:40.587070 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:38:40.588434 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:38:40.588564 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:38:40.588679 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:40.596185 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:38:40.596340 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:38:40.596477 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:38:40.599559 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m14:38:40.600044 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:38:40.600416 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:38:40.602322 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:40.602459 [debug] [MainThread]: On master: BEGIN
[0m14:38:40.602577 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:38:40.609842 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:38:40.609975 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:40.610129 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:38:40.613331 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m14:38:40.613800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '506b0acd-55ea-4c91-87a8-2ac62d22e94b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10def25e0>]}
[0m14:38:40.614002 [debug] [MainThread]: On master: ROLLBACK
[0m14:38:40.614374 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:40.614503 [debug] [MainThread]: On master: BEGIN
[0m14:38:40.615063 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:38:40.615193 [debug] [MainThread]: On master: COMMIT
[0m14:38:40.615317 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:40.615440 [debug] [MainThread]: On master: COMMIT
[0m14:38:40.615785 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:38:40.615917 [debug] [MainThread]: On master: Close
[0m14:38:40.617535 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:38:40.617769 [info ] [Thread-1  ]: 1 of 2 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:38:40.617965 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:38:40.618122 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:38:40.622146 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:38:40.622450 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:38:40.639533 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:38:40.639944 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:40.640097 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:38:40.640231 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:38:40.649377 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:38:40.649529 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:40.649692 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart'::)date as contract_start_date,
    (raw_payload->>'dtContractEnd'::)date as contract_end_date,
    (raw_payload->>'birthDate'::)date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:38:40.650386 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ")"
LINE 22:     (raw_payload->>'dtContractStart'::)date as contract_star...
                                               ^

[0m14:38:40.650534 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: ROLLBACK
[0m14:38:40.650974 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:38:40.661864 [debug] [Thread-1  ]: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  syntax error at or near ")"
  LINE 22:     (raw_payload->>'dtContractStart'::)date as contract_star...
                                                 ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:38:40.662767 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '506b0acd-55ea-4c91-87a8-2ac62d22e94b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df11af0>]}
[0m14:38:40.663053 [error] [Thread-1  ]: 1 of 2 ERROR creating sql table model public_base.lucca_raw_data ............... [[31mERROR[0m in 0.04s]
[0m14:38:40.663304 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:38:40.663525 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.lucca_raw_data' to be skipped because of status 'error'.  Reason: Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  syntax error at or near ")"
  LINE 22:     (raw_payload->>'dtContractStart'::)date as contract_star...
                                                 ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql.
[0m14:38:40.663821 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:38:40.664036 [info ] [Thread-1  ]: 2 of 2 SKIP relation public_transform.employee ................................. [[33mSKIP[0m]
[0m14:38:40.664234 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:38:40.664633 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:40.664769 [debug] [MainThread]: On master: BEGIN
[0m14:38:40.664878 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:38:40.672497 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:38:40.672677 [debug] [MainThread]: On master: COMMIT
[0m14:38:40.672794 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:40.672903 [debug] [MainThread]: On master: COMMIT
[0m14:38:40.673256 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:38:40.673387 [debug] [MainThread]: On master: Close
[0m14:38:40.673550 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:38:40.673656 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m14:38:40.673797 [info ] [MainThread]: 
[0m14:38:40.673938 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m14:38:40.674240 [debug] [MainThread]: Command end result
[0m14:38:40.684013 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:38:40.684744 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:38:40.687824 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:38:40.688104 [info ] [MainThread]: 
[0m14:38:40.688285 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:38:40.688431 [info ] [MainThread]: 
[0m14:38:40.688609 [error] [MainThread]: [31mFailure in model lucca_raw_data (models/models/base/lucca_raw_data.sql)[0m
[0m14:38:40.688772 [error] [MainThread]:   Database Error in model lucca_raw_data (models/models/base/lucca_raw_data.sql)
  syntax error at or near ")"
  LINE 22:     (raw_payload->>'dtContractStart'::)date as contract_star...
                                                 ^
  compiled code at target/run/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:38:40.688905 [info ] [MainThread]: 
[0m14:38:40.689054 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/base/lucca_raw_data.sql
[0m14:38:40.689181 [info ] [MainThread]: 
[0m14:38:40.689324 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=2
[0m14:38:40.690641 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6313722, "process_in_blocks": "0", "process_kernel_time": 0.131142, "process_mem_max_rss": "129761280", "process_out_blocks": "0", "process_user_time": 1.008378}
[0m14:38:40.690820 [debug] [MainThread]: Command `dbt run` failed at 14:38:40.690785 after 0.63 seconds
[0m14:38:40.690982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b98ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da0b7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc48cd0>]}
[0m14:38:40.691136 [debug] [MainThread]: Flushing usage events
[0m14:38:41.039927 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:38:50.434678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf22e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf97fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf974c0>]}


============================== 14:38:50.436537 | 8727477a-4584-40ba-a77f-0a9d05ea297f ==============================
[0m14:38:50.436537 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:38:50.436795 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'use_colors': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'empty': 'False', 'version_check': 'True', 'quiet': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'partial_parse': 'True', 'printer_width': '80', 'introspect': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'fail_fast': 'False', 'log_path': '/Users/marccao/repo/dbt/logs'}
[0m14:38:50.514263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf83e80>]}
[0m14:38:50.541527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd29cd0>]}
[0m14:38:50.541954 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:38:50.591011 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:38:50.648584 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:38:50.648889 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m14:38:50.760801 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m14:38:50.768068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1a4130>]}
[0m14:38:50.833031 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:38:50.834106 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:38:50.842313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6e37c0>]}
[0m14:38:50.842551 [info ] [MainThread]: Found 2 models, 1 source, 447 macros
[0m14:38:50.842707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df9cf70>]}
[0m14:38:50.843302 [info ] [MainThread]: 
[0m14:38:50.843460 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:38:50.843590 [info ] [MainThread]: 
[0m14:38:50.843865 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:38:50.845812 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:38:50.871163 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:38:50.871388 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:38:50.871527 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:50.889859 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.018 seconds
[0m14:38:50.890515 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:38:50.891801 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:38:50.891969 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:38:50.892097 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:50.899322 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.007 seconds
[0m14:38:50.899789 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:38:50.900278 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:38:50.903167 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:38:50.903333 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:38:50.903463 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:50.909973 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:38:50.910114 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:38:50.910252 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:38:50.913077 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m14:38:50.913624 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:38:50.914046 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:38:50.914283 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:38:50.915718 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:38:50.915852 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:38:50.915970 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:50.922750 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:38:50.922885 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:38:50.923018 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:38:50.925798 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m14:38:50.926253 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:38:50.926654 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:38:50.928709 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:50.928853 [debug] [MainThread]: On master: BEGIN
[0m14:38:50.928974 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:38:50.935202 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:38:50.935355 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:50.935510 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:38:50.938572 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m14:38:50.938986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8b72b0>]}
[0m14:38:50.939193 [debug] [MainThread]: On master: ROLLBACK
[0m14:38:50.939602 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:50.939719 [debug] [MainThread]: On master: BEGIN
[0m14:38:50.940317 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:38:50.940447 [debug] [MainThread]: On master: COMMIT
[0m14:38:50.940564 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:50.940675 [debug] [MainThread]: On master: COMMIT
[0m14:38:50.941039 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:38:50.941173 [debug] [MainThread]: On master: Close
[0m14:38:50.942762 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:38:50.943010 [info ] [Thread-1  ]: 1 of 2 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:38:50.943231 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:38:50.943387 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:38:50.947390 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:38:50.947710 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:38:50.965580 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:38:50.966001 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:50.966162 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:38:50.966310 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:38:50.975312 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:38:50.975472 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:50.975652 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:38:50.984753 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.009 seconds
[0m14:38:50.989403 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:50.989576 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:38:50.990263 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:38:50.992194 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:50.992350 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:38:50.992879 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:38:51.000022 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:38:51.000202 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:51.000352 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:38:51.001748 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:38:51.004517 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:38:51.006374 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:38:51.006530 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:38:51.011676 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m14:38:51.012761 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:38:51.013730 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e497280>]}
[0m14:38:51.014024 [info ] [Thread-1  ]: 1 of 2 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m14:38:51.014278 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:38:51.014600 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:38:51.014832 [info ] [Thread-1  ]: 2 of 2 START sql table model public_transform.employee ......................... [RUN]
[0m14:38:51.015029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.employee)
[0m14:38:51.015183 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:38:51.016592 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:38:51.016887 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:38:51.018570 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:38:51.018991 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:38:51.019143 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:38:51.019284 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:38:51.028218 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:38:51.028475 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:38:51.028677 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_transform"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:38:51.034024 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:38:51.035744 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:38:51.035902 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_transform"."employee" rename to "employee__dbt_backup"
[0m14:38:51.036801 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:38:51.038154 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:38:51.038308 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_transform"."employee__dbt_tmp" rename to "employee"
[0m14:38:51.039133 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:38:51.039784 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:38:51.039936 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:38:51.040076 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:38:51.041289 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:38:51.042972 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee__dbt_backup"
[0m14:38:51.043327 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:38:51.043476 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_transform"."employee__dbt_backup" cascade
[0m14:38:51.046143 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:38:51.046652 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:38:51.046920 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8727477a-4584-40ba-a77f-0a9d05ea297f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9bfbb0>]}
[0m14:38:51.047202 [info ] [Thread-1  ]: 2 of 2 OK created sql table model public_transform.employee .................... [[32mSELECT 115[0m in 0.03s]
[0m14:38:51.047449 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:38:51.047924 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:51.048070 [debug] [MainThread]: On master: BEGIN
[0m14:38:51.048191 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:38:51.055260 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:38:51.055445 [debug] [MainThread]: On master: COMMIT
[0m14:38:51.055581 [debug] [MainThread]: Using postgres connection "master"
[0m14:38:51.055706 [debug] [MainThread]: On master: COMMIT
[0m14:38:51.056138 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:38:51.056270 [debug] [MainThread]: On master: Close
[0m14:38:51.056608 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:38:51.056817 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m14:38:51.056996 [info ] [MainThread]: 
[0m14:38:51.057152 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m14:38:51.057517 [debug] [MainThread]: Command end result
[0m14:38:51.067598 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:38:51.068433 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:38:51.072176 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:38:51.072356 [info ] [MainThread]: 
[0m14:38:51.072530 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:38:51.072665 [info ] [MainThread]: 
[0m14:38:51.072810 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m14:38:51.074266 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6723188, "process_in_blocks": "0", "process_kernel_time": 0.120298, "process_mem_max_rss": "130203648", "process_out_blocks": "0", "process_user_time": 1.06832}
[0m14:38:51.074453 [debug] [MainThread]: Command `dbt run` succeeded at 14:38:51.074416 after 0.67 seconds
[0m14:38:51.074631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf22e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cddea30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6e3040>]}
[0m14:38:51.074807 [debug] [MainThread]: Flushing usage events
[0m14:38:51.429448 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:01:56.352843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a209e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b27fee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b27f430>]}


============================== 15:01:56.355164 | 9c4c197e-31ec-407b-8b54-5b5a6660fe70 ==============================
[0m15:01:56.355164 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:01:56.355449 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'quiet': 'False', 'fail_fast': 'False', 'introspect': 'True', 'use_colors': 'True', 'version_check': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'partial_parse': 'True', 'debug': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'static_parser': 'True', 'printer_width': '80', 'log_format': 'default', 'target_path': 'None', 'use_experimental_parser': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None'}
[0m15:01:56.446272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bb1e20>]}
[0m15:01:56.472479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ca7460>]}
[0m15:01:56.473361 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:01:56.526739 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:01:56.593528 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 3 files added, 0 files changed.
[0m15:01:56.593814 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/base/contract.sql
[0m15:01:56.593987 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/base/employee.sql
[0m15:01:56.594124 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/transform/contract_extended.sql
[0m15:01:56.594242 [debug] [MainThread]: Partial parsing: deleted file: lucca_dbt://models/models/transform/employee.sql
[0m15:01:56.705321 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.base
- models.lucca_dbt.analytics
[0m15:01:56.712138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c46a130>]}
[0m15:01:56.768859 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:01:56.769944 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:01:56.778860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4be400>]}
[0m15:01:56.779071 [info ] [MainThread]: Found 4 models, 1 source, 447 macros
[0m15:01:56.779226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a565b80>]}
[0m15:01:56.779823 [info ] [MainThread]: 
[0m15:01:56.779977 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:01:56.780105 [info ] [MainThread]: 
[0m15:01:56.780321 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:01:56.782135 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:01:56.809802 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:01:56.809998 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:01:56.810115 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:01:56.851736 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.042 seconds
[0m15:01:56.852357 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:01:56.853572 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:01:56.853728 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:01:56.853847 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:56.863706 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m15:01:56.864192 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:01:56.864733 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m15:01:56.867676 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:01:56.867829 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:01:56.867949 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:56.875470 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:01:56.875612 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:01:56.875749 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:01:56.880206 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m15:01:56.880726 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:01:56.881194 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:01:56.881421 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m15:01:56.882463 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:01:56.882601 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:01:56.882718 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:56.889644 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:01:56.889776 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:01:56.889907 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:01:56.893446 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m15:01:56.893909 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:01:56.894304 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:01:56.896333 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:56.896477 [debug] [MainThread]: On master: BEGIN
[0m15:01:56.896594 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:01:56.903939 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:01:56.904072 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:56.904233 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:01:56.908348 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m15:01:56.908801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba38b50>]}
[0m15:01:56.909006 [debug] [MainThread]: On master: ROLLBACK
[0m15:01:56.909429 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:56.909557 [debug] [MainThread]: On master: BEGIN
[0m15:01:56.910135 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:01:56.910268 [debug] [MainThread]: On master: COMMIT
[0m15:01:56.910394 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:56.910513 [debug] [MainThread]: On master: COMMIT
[0m15:01:56.910863 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:01:56.910993 [debug] [MainThread]: On master: Close
[0m15:01:56.912166 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m15:01:56.912397 [info ] [Thread-1  ]: 1 of 4 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m15:01:56.912607 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m15:01:56.912770 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m15:01:56.916853 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.917381 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m15:01:56.934375 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.934761 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.934906 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m15:01:56.935035 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:01:56.944127 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:01:56.944277 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.944460 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m15:01:56.954451 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.010 seconds
[0m15:01:56.959255 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.959428 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m15:01:56.960467 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:01:56.961779 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.961929 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m15:01:56.962503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:01:56.969346 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:01:56.969506 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.969644 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:01:56.971024 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:01:56.973607 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m15:01:56.975414 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:01:56.975567 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m15:01:56.980782 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m15:01:56.981836 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m15:01:56.982923 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c742550>]}
[0m15:01:56.983214 [info ] [Thread-1  ]: 1 of 4 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m15:01:56.983469 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m15:01:56.983830 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m15:01:56.984051 [info ] [Thread-1  ]: 2 of 4 START sql table model public_base.contract .............................. [RUN]
[0m15:01:56.984247 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m15:01:56.984402 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m15:01:56.985800 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m15:01:56.986240 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m15:01:56.987921 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m15:01:56.988189 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:01:56.988382 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m15:01:56.988528 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:01:56.993693 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m15:01:56.993918 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:01:56.994072 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,
modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:01:56.998368 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m15:01:57.000074 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:01:57.000226 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m15:01:57.000633 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:01:57.001241 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:01:57.001381 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:01:57.001507 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:01:57.001972 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m15:01:57.003590 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m15:01:57.003876 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:01:57.004006 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m15:01:57.004361 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m15:01:57.004906 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m15:01:57.005181 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c885df0>]}
[0m15:01:57.005534 [info ] [Thread-1  ]: 2 of 4 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.02s]
[0m15:01:57.005787 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m15:01:57.005963 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m15:01:57.006199 [info ] [Thread-1  ]: 3 of 4 START sql table model public_transform.contract_extended ................ [RUN]
[0m15:01:57.006393 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m15:01:57.006549 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m15:01:57.008073 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m15:01:57.008526 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m15:01:57.010068 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m15:01:57.010320 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:01:57.010454 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m15:01:57.010580 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:01:57.016244 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m15:01:57.016452 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:01:57.016624 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,
CASE
    WHEN contract_start_date > CURRENT_DATE THEN TRUE
    ELSE FALSE
END AS will_start
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,
CASE
    WHEN contract_start_date IS NOT NULL THEN
        COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
    ELSE NULL
END AS days_worked,
CASE
    WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
        contract_end_date - CURRENT_DATE
    ELSE NULL
END AS remaining_days,



modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:01:57.017074 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "CASE"
LINE 29:     CASE
             ^

[0m15:01:57.017280 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: ROLLBACK
[0m15:01:57.017629 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m15:01:57.028653 [debug] [Thread-1  ]: Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  syntax error at or near "CASE"
  LINE 29:     CASE
               ^
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql
[0m15:01:57.028920 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9358e0>]}
[0m15:01:57.029208 [error] [Thread-1  ]: 3 of 4 ERROR creating sql table model public_transform.contract_extended ....... [[31mERROR[0m in 0.02s]
[0m15:01:57.029456 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m15:01:57.029628 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m15:01:57.029829 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.contract_extended' to be skipped because of status 'error'.  Reason: Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  syntax error at or near "CASE"
  LINE 29:     CASE
               ^
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql.
[0m15:01:57.030015 [info ] [Thread-1  ]: 4 of 4 START sql table model public_base.employee .............................. [RUN]
[0m15:01:57.030299 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.employee)
[0m15:01:57.030476 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m15:01:57.031958 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m15:01:57.032249 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m15:01:57.033853 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m15:01:57.034121 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:01:57.034257 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m15:01:57.034380 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:01:57.041648 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:01:57.041851 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:01:57.041987 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:01:57.046273 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m15:01:57.047803 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:01:57.047946 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m15:01:57.048747 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:01:57.049281 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:01:57.049412 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:01:57.049534 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:01:57.050625 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:01:57.051620 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m15:01:57.051908 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:01:57.052039 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m15:01:57.052465 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m15:01:57.052934 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m15:01:57.053177 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c4c197e-31ec-407b-8b54-5b5a6660fe70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ca78b0>]}
[0m15:01:57.053433 [info ] [Thread-1  ]: 4 of 4 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.02s]
[0m15:01:57.053674 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m15:01:57.054129 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:57.054264 [debug] [MainThread]: On master: BEGIN
[0m15:01:57.054379 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:01:57.061405 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:01:57.061540 [debug] [MainThread]: On master: COMMIT
[0m15:01:57.061654 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:57.061762 [debug] [MainThread]: On master: COMMIT
[0m15:01:57.062087 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:01:57.062199 [debug] [MainThread]: On master: Close
[0m15:01:57.062350 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:01:57.062452 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m15:01:57.062595 [info ] [MainThread]: 
[0m15:01:57.062733 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m15:01:57.063145 [debug] [MainThread]: Command end result
[0m15:01:57.073455 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:01:57.074494 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:01:57.077770 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:01:57.077939 [info ] [MainThread]: 
[0m15:01:57.078107 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:01:57.078250 [info ] [MainThread]: 
[0m15:01:57.078413 [error] [MainThread]: [31mFailure in model contract_extended (models/models/transform/contract_extended.sql)[0m
[0m15:01:57.078569 [error] [MainThread]:   Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  syntax error at or near "CASE"
  LINE 29:     CASE
               ^
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql
[0m15:01:57.078692 [info ] [MainThread]: 
[0m15:01:57.078834 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/contract_extended.sql
[0m15:01:57.078958 [info ] [MainThread]: 
[0m15:01:57.079093 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m15:01:57.080720 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.7656423, "process_in_blocks": "0", "process_kernel_time": 0.179981, "process_mem_max_rss": "130809856", "process_out_blocks": "0", "process_user_time": 1.071108}
[0m15:01:57.080955 [debug] [MainThread]: Command `dbt run` failed at 15:01:57.080911 after 0.77 seconds
[0m15:01:57.081134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a209e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bb1e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b74e5b0>]}
[0m15:01:57.081301 [debug] [MainThread]: Flushing usage events
[0m15:01:57.437115 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:11.440917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a37edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3f4dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3f4310>]}


============================== 15:02:11.443184 | 53bc9426-041e-4479-9fcf-7c1a34bb0fed ==============================
[0m15:02:11.443184 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:02:11.443437 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'log_format': 'default', 'introspect': 'True', 'partial_parse': 'True', 'write_json': 'True', 'no_print': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'indirect_selection': 'eager', 'target_path': 'None', 'quiet': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'printer_width': '80', 'use_colors': 'True'}
[0m15:02:11.530436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8f3d30>]}
[0m15:02:11.556422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8ca790>]}
[0m15:02:11.556889 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:02:11.608356 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:02:11.670195 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:02:11.670441 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:02:11.673549 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m15:02:11.689850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c427130>]}
[0m15:02:11.746167 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:02:11.747703 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:02:11.755750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c440850>]}
[0m15:02:11.755991 [info ] [MainThread]: Found 4 models, 1 source, 447 macros
[0m15:02:11.756146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb6d190>]}
[0m15:02:11.756756 [info ] [MainThread]: 
[0m15:02:11.756918 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:02:11.757042 [info ] [MainThread]: 
[0m15:02:11.757266 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:02:11.759252 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:02:11.802863 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:02:11.803074 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:02:11.803197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:11.837709 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.034 seconds
[0m15:02:11.838321 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:02:11.839575 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:02:11.839729 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:02:11.839842 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:11.848678 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m15:02:11.849116 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:02:11.849592 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m15:02:11.852165 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:02:11.852300 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:02:11.852416 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:11.860895 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:02:11.861062 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:02:11.861200 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:02:11.865156 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m15:02:11.865687 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:02:11.866143 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:02:11.866369 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m15:02:11.867298 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:02:11.867432 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:02:11.867645 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:11.876090 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:02:11.876238 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:02:11.876375 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:02:11.878325 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m15:02:11.879283 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:02:11.879683 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:02:11.881980 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:11.882143 [debug] [MainThread]: On master: BEGIN
[0m15:02:11.882268 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:11.888519 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m15:02:11.888655 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:11.888809 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:02:11.890565 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m15:02:11.891106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c456790>]}
[0m15:02:11.891336 [debug] [MainThread]: On master: ROLLBACK
[0m15:02:11.891704 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:11.891844 [debug] [MainThread]: On master: BEGIN
[0m15:02:11.892329 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:02:11.892461 [debug] [MainThread]: On master: COMMIT
[0m15:02:11.892586 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:11.892703 [debug] [MainThread]: On master: COMMIT
[0m15:02:11.892960 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:02:11.893093 [debug] [MainThread]: On master: Close
[0m15:02:11.894876 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m15:02:11.895103 [info ] [Thread-1  ]: 1 of 4 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m15:02:11.895307 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m15:02:11.895459 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m15:02:11.899504 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.899821 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m15:02:11.916953 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.917356 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.917509 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m15:02:11.917654 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:11.926684 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:02:11.926839 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.927005 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m15:02:11.933687 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m15:02:11.937959 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.938114 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m15:02:11.938711 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:02:11.939984 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.940126 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m15:02:11.940926 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:11.948458 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:02:11.948631 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.948771 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:02:11.950565 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:02:11.953133 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m15:02:11.954928 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:11.955079 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m15:02:11.957274 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:11.958283 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m15:02:11.959188 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c81f400>]}
[0m15:02:11.959451 [info ] [Thread-1  ]: 1 of 4 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m15:02:11.959698 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m15:02:11.960023 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m15:02:11.960239 [info ] [Thread-1  ]: 2 of 4 START sql table model public_base.contract .............................. [RUN]
[0m15:02:11.960462 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m15:02:11.960608 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m15:02:11.961946 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m15:02:11.962227 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m15:02:11.963867 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m15:02:11.964129 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:11.964264 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m15:02:11.964392 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:11.971291 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:02:11.971498 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:11.971635 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,
modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:02:11.975310 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m15:02:11.976895 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:11.977042 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m15:02:11.977686 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:11.978917 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:11.979051 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m15:02:11.979933 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:11.980568 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:02:11.980701 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:11.980828 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:02:11.981949 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:02:11.983443 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m15:02:11.983754 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:11.983892 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m15:02:11.985917 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:11.986374 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m15:02:11.986612 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9bec10>]}
[0m15:02:11.986861 [info ] [Thread-1  ]: 2 of 4 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m15:02:11.987103 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m15:02:11.987250 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m15:02:11.987475 [info ] [Thread-1  ]: 3 of 4 START sql table model public_transform.contract_extended ................ [RUN]
[0m15:02:11.987674 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m15:02:11.987819 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m15:02:11.989203 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m15:02:11.989486 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m15:02:11.991039 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m15:02:11.991288 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:02:11.991429 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m15:02:11.991554 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:11.998384 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:02:11.998537 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:02:11.998683 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,
CASE
    WHEN contract_start_date > CURRENT_DATE THEN TRUE
    ELSE FALSE
END AS will_start
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,
CASE
    WHEN contract_start_date IS NOT NULL THEN
        COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
    ELSE NULL
END AS days_worked,
CASE
    WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
        contract_end_date - CURRENT_DATE
    ELSE NULL
END AS remaining_days,



modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:02:11.999147 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "CASE"
LINE 29:     CASE
             ^

[0m15:02:11.999283 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: ROLLBACK
[0m15:02:11.999820 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m15:02:12.010884 [debug] [Thread-1  ]: Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  syntax error at or near "CASE"
  LINE 29:     CASE
               ^
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql
[0m15:02:12.011136 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9c8b50>]}
[0m15:02:12.011436 [error] [Thread-1  ]: 3 of 4 ERROR creating sql table model public_transform.contract_extended ....... [[31mERROR[0m in 0.02s]
[0m15:02:12.011688 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m15:02:12.011862 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m15:02:12.012073 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.contract_extended' to be skipped because of status 'error'.  Reason: Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  syntax error at or near "CASE"
  LINE 29:     CASE
               ^
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql.
[0m15:02:12.012270 [info ] [Thread-1  ]: 4 of 4 START sql table model public_base.employee .............................. [RUN]
[0m15:02:12.012518 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.employee)
[0m15:02:12.012672 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m15:02:12.014238 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m15:02:12.014506 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m15:02:12.016067 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m15:02:12.016298 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:12.016438 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m15:02:12.016565 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:12.024154 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:02:12.024361 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:12.024506 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:02:12.029487 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m15:02:12.031136 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:12.031288 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m15:02:12.032261 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:12.033527 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:12.033667 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m15:02:12.034229 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:02:12.035537 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:02:12.035674 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:12.035802 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:02:12.037129 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:02:12.038137 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m15:02:12.038461 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:12.038596 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m15:02:12.040770 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:12.041258 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m15:02:12.041498 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53bc9426-041e-4479-9fcf-7c1a34bb0fed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9bec10>]}
[0m15:02:12.041755 [info ] [Thread-1  ]: 4 of 4 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m15:02:12.041997 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m15:02:12.042440 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:12.042563 [debug] [MainThread]: On master: BEGIN
[0m15:02:12.042670 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:02:12.050788 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:02:12.050974 [debug] [MainThread]: On master: COMMIT
[0m15:02:12.051096 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:12.051207 [debug] [MainThread]: On master: COMMIT
[0m15:02:12.051568 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:02:12.051689 [debug] [MainThread]: On master: Close
[0m15:02:12.051861 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:02:12.051970 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m15:02:12.052123 [info ] [MainThread]: 
[0m15:02:12.052269 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m15:02:12.052685 [debug] [MainThread]: Command end result
[0m15:02:12.062427 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:02:12.063246 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:02:12.066579 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:02:12.066749 [info ] [MainThread]: 
[0m15:02:12.066914 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:02:12.067059 [info ] [MainThread]: 
[0m15:02:12.067225 [error] [MainThread]: [31mFailure in model contract_extended (models/models/transform/contract_extended.sql)[0m
[0m15:02:12.067386 [error] [MainThread]:   Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  syntax error at or near "CASE"
  LINE 29:     CASE
               ^
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql
[0m15:02:12.067514 [info ] [MainThread]: 
[0m15:02:12.067667 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/contract_extended.sql
[0m15:02:12.067793 [info ] [MainThread]: 
[0m15:02:12.067935 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m15:02:12.069289 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.66136694, "process_in_blocks": "0", "process_kernel_time": 0.140878, "process_mem_max_rss": "127303680", "process_out_blocks": "0", "process_user_time": 0.993259}
[0m15:02:12.069466 [debug] [MainThread]: Command `dbt run` failed at 15:02:12.069432 after 0.66 seconds
[0m15:02:12.069638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a37edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8f3d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c440850>]}
[0m15:02:12.069795 [debug] [MainThread]: Flushing usage events
[0m15:02:12.424390 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:20.592570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4c9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d540fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5404c0>]}


============================== 15:02:20.594322 | 44341681-db7d-4efe-b6f1-2f0f7bcbbc53 ==============================
[0m15:02:20.594322 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:02:20.594599 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'use_experimental_parser': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'warn_error': 'None', 'cache_selected_only': 'False', 'use_colors': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'log_format': 'default', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'indirect_selection': 'eager', 'quiet': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'empty': 'False', 'no_print': 'None', 'target_path': 'None'}
[0m15:02:20.667284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d52be80>]}
[0m15:02:20.693610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2d1cd0>]}
[0m15:02:20.694061 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:02:20.758806 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:02:20.814461 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:02:20.814733 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/contract_extended.sql
[0m15:02:20.921818 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.base
- models.lucca_dbt.transform
[0m15:02:20.928945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e72d130>]}
[0m15:02:20.986565 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:02:20.987394 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:02:20.992597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4f4bb0>]}
[0m15:02:20.992820 [info ] [MainThread]: Found 4 models, 1 source, 447 macros
[0m15:02:20.992979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e53ca00>]}
[0m15:02:20.993611 [info ] [MainThread]: 
[0m15:02:20.993771 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:02:20.993906 [info ] [MainThread]: 
[0m15:02:20.994129 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:02:20.996124 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:02:21.017324 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:02:21.017525 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:02:21.017647 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:21.035714 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.018 seconds
[0m15:02:21.036414 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:02:21.037685 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:02:21.037848 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:02:21.037976 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:21.042850 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.005 seconds
[0m15:02:21.043369 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:02:21.043947 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m15:02:21.046967 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:02:21.047160 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:02:21.047308 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:21.053611 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m15:02:21.053766 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:02:21.053923 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:02:21.055620 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m15:02:21.056155 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:02:21.056464 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:02:21.056697 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m15:02:21.057790 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:02:21.057921 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:02:21.058052 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:21.063217 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m15:02:21.063355 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:02:21.063478 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:02:21.065042 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.001 seconds
[0m15:02:21.065570 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:02:21.065876 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:02:21.068095 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:21.068235 [debug] [MainThread]: On master: BEGIN
[0m15:02:21.068360 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:21.074578 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m15:02:21.074720 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:21.074882 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:02:21.077245 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m15:02:21.077739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7a06d0>]}
[0m15:02:21.077952 [debug] [MainThread]: On master: ROLLBACK
[0m15:02:21.078301 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:21.078427 [debug] [MainThread]: On master: BEGIN
[0m15:02:21.078891 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:02:21.079014 [debug] [MainThread]: On master: COMMIT
[0m15:02:21.079132 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:21.079244 [debug] [MainThread]: On master: COMMIT
[0m15:02:21.079516 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:02:21.079667 [debug] [MainThread]: On master: Close
[0m15:02:21.080648 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m15:02:21.080902 [info ] [Thread-1  ]: 1 of 4 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m15:02:21.081134 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m15:02:21.081292 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m15:02:21.085263 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.085597 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m15:02:21.102400 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.102849 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.103004 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m15:02:21.103148 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:21.111882 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:02:21.112050 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.112219 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m15:02:21.119192 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m15:02:21.124014 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.124175 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m15:02:21.124715 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:02:21.126064 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.126212 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m15:02:21.126613 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:02:21.133617 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:02:21.133803 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.133959 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:02:21.135236 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:02:21.137873 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m15:02:21.139791 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:02:21.139940 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m15:02:21.142376 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:21.143418 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m15:02:21.144191 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea00820>]}
[0m15:02:21.144460 [info ] [Thread-1  ]: 1 of 4 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m15:02:21.144716 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m15:02:21.145043 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m15:02:21.145241 [info ] [Thread-1  ]: 2 of 4 START sql table model public_base.contract .............................. [RUN]
[0m15:02:21.145441 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m15:02:21.145602 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m15:02:21.146878 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m15:02:21.147210 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m15:02:21.148893 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m15:02:21.149148 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:21.149286 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m15:02:21.149411 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:21.156236 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:02:21.156406 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:21.156561 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,
modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:02:21.160066 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m15:02:21.161737 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:21.161878 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m15:02:21.162772 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:21.164724 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:21.164873 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m15:02:21.165459 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:02:21.166107 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:02:21.166246 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:21.166372 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:02:21.167474 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:02:21.168493 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m15:02:21.168783 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:02:21.168916 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m15:02:21.171533 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:21.172025 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m15:02:21.172344 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebcffd0>]}
[0m15:02:21.172613 [info ] [Thread-1  ]: 2 of 4 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m15:02:21.172864 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m15:02:21.173018 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m15:02:21.173229 [info ] [Thread-1  ]: 3 of 4 START sql table model public_transform.contract_extended ................ [RUN]
[0m15:02:21.173424 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m15:02:21.173566 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m15:02:21.174967 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m15:02:21.175257 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m15:02:21.176858 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m15:02:21.177117 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:02:21.177256 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m15:02:21.177382 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:21.184442 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:02:21.184629 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:02:21.184779 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

CASE
    WHEN contract_start_date > CURRENT_DATE THEN TRUE
    ELSE FALSE
END AS will_start,

    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

CASE
    WHEN contract_start_date IS NOT NULL THEN
        COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
    ELSE NULL
END AS days_worked,

CASE
    WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
        contract_end_date - CURRENT_DATE
    ELSE NULL
END AS remaining_days,



modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:02:21.189236 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m15:02:21.190722 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:02:21.190863 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m15:02:21.191528 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:21.192081 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m15:02:21.192218 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:02:21.192349 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m15:02:21.193580 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:02:21.194596 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m15:02:21.194893 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:02:21.195029 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m15:02:21.196046 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m15:02:21.196509 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m15:02:21.196746 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebbfc70>]}
[0m15:02:21.197007 [info ] [Thread-1  ]: 3 of 4 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.02s]
[0m15:02:21.197292 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m15:02:21.197443 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m15:02:21.197683 [info ] [Thread-1  ]: 4 of 4 START sql table model public_base.employee .............................. [RUN]
[0m15:02:21.197884 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.employee)
[0m15:02:21.198026 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m15:02:21.199401 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m15:02:21.199704 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m15:02:21.201843 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m15:02:21.202077 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:21.202204 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m15:02:21.202328 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:21.209523 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:02:21.209711 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:21.209850 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:02:21.214078 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m15:02:21.215706 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:21.215855 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m15:02:21.216654 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:02:21.217830 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:21.217981 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m15:02:21.218514 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:02:21.219129 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:02:21.219269 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:21.219405 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:02:21.220731 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:02:21.221751 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m15:02:21.222069 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:02:21.222299 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m15:02:21.224514 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:02:21.225074 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m15:02:21.225341 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44341681-db7d-4efe-b6f1-2f0f7bcbbc53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebb23a0>]}
[0m15:02:21.225619 [info ] [Thread-1  ]: 4 of 4 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m15:02:21.225872 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m15:02:21.226311 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:21.226439 [debug] [MainThread]: On master: BEGIN
[0m15:02:21.226557 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:02:21.233269 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:02:21.233433 [debug] [MainThread]: On master: COMMIT
[0m15:02:21.233571 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:21.233691 [debug] [MainThread]: On master: COMMIT
[0m15:02:21.234021 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:02:21.234162 [debug] [MainThread]: On master: Close
[0m15:02:21.234345 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:02:21.234466 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m15:02:21.234709 [info ] [MainThread]: 
[0m15:02:21.234957 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m15:02:21.235467 [debug] [MainThread]: Command end result
[0m15:02:21.245619 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:02:21.246375 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:02:21.249720 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:02:21.249897 [info ] [MainThread]: 
[0m15:02:21.250068 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:02:21.250202 [info ] [MainThread]: 
[0m15:02:21.250346 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:02:21.251635 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6901773, "process_in_blocks": "0", "process_kernel_time": 0.124408, "process_mem_max_rss": "130514944", "process_out_blocks": "0", "process_user_time": 1.062758}
[0m15:02:21.251818 [debug] [MainThread]: Command `dbt run` succeeded at 15:02:21.251780 after 0.69 seconds
[0m15:02:21.251987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4c9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da04910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2d1cd0>]}
[0m15:02:21.252163 [debug] [MainThread]: Flushing usage events
[0m15:02:21.605020 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:21:20.284598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10811ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109194dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109194310>]}


============================== 15:21:20.287034 | 9927e7f6-aa4b-48c0-bb6e-a654d0231504 ==============================
[0m15:21:20.287034 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:21:20.287299 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select employee_extended.sql', 'write_json': 'True', 'empty': 'False', 'debug': 'False', 'no_print': 'None', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'partial_parse': 'True', 'introspect': 'True', 'use_colors': 'True', 'version_check': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'static_parser': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error': 'None', 'cache_selected_only': 'False'}
[0m15:21:20.385505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9927e7f6-aa4b-48c0-bb6e-a654d0231504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ac5190>]}
[0m15:21:20.413276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9927e7f6-aa4b-48c0-bb6e-a654d0231504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f25c10>]}
[0m15:21:20.413848 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:21:20.467130 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:21:20.536365 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 2 files changed.
[0m15:21:20.536650 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/transform/employee_extended.sql
[0m15:21:20.536847 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/employee.sql
[0m15:21:20.537015 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/contract_extended.sql
[0m15:21:20.651809 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.base
- models.lucca_dbt.analytics
[0m15:21:20.659477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9927e7f6-aa4b-48c0-bb6e-a654d0231504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3810a0>]}
[0m15:21:20.719684 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:21:20.720819 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:21:20.730176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9927e7f6-aa4b-48c0-bb6e-a654d0231504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a17b4f0>]}
[0m15:21:20.730425 [info ] [MainThread]: Found 5 models, 1 source, 447 macros
[0m15:21:20.730580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9927e7f6-aa4b-48c0-bb6e-a654d0231504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10989aa60>]}
[0m15:21:20.731178 [info ] [MainThread]: 
[0m15:21:20.731332 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:21:20.731457 [info ] [MainThread]: 
[0m15:21:20.731670 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:21:20.732046 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:21:20.761524 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:21:20.761751 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:21:20.761887 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:21:20.848453 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.087 seconds
[0m15:21:20.849125 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:21:20.851531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m15:21:20.854412 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:21:20.854560 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:21:20.854682 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:20.861993 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:21:20.862126 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:21:20.862260 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:21:20.865973 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m15:21:20.866656 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:21:20.867062 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:21:20.867344 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m15:21:20.868840 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:21:20.868985 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:21:20.869109 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:20.877485 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:21:20.877639 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:21:20.877776 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:21:20.881163 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m15:21:20.881708 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:21:20.882204 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:21:20.884535 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:20.884678 [debug] [MainThread]: On master: BEGIN
[0m15:21:20.884798 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:21:20.891130 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m15:21:20.891258 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:20.891415 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:21:20.894500 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m15:21:20.894954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9927e7f6-aa4b-48c0-bb6e-a654d0231504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1a7880>]}
[0m15:21:20.895155 [debug] [MainThread]: On master: ROLLBACK
[0m15:21:20.895529 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:20.895655 [debug] [MainThread]: On master: BEGIN
[0m15:21:20.896196 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:21:20.896322 [debug] [MainThread]: On master: COMMIT
[0m15:21:20.896443 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:20.896560 [debug] [MainThread]: On master: COMMIT
[0m15:21:20.896874 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:21:20.896999 [debug] [MainThread]: On master: Close
[0m15:21:20.898256 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m15:21:20.898495 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.employee_extended ..................... [RUN]
[0m15:21:20.898694 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.employee_extended)
[0m15:21:20.898848 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m15:21:20.902794 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m15:21:20.903232 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m15:21:20.920961 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m15:21:20.921388 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:21:20.921549 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m15:21:20.921693 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:20.928253 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:21:20.928416 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:21:20.928567 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_base"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_db"."public_base"."lucca_raw_data") 
        THEN TRUE 
        ELSE FALSE 
    END AS is_manager,
    
from "lucca_db"."public_base"."employee"
  );
  
[0m15:21:20.929087 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "from"
LINE 22: from "lucca_db"."public_base"."employee"
         ^

[0m15:21:20.929240 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: ROLLBACK
[0m15:21:20.929632 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m15:21:20.943744 [debug] [Thread-1  ]: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  syntax error at or near "from"
  LINE 22: from "lucca_db"."public_base"."employee"
           ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:20.945118 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9927e7f6-aa4b-48c0-bb6e-a654d0231504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bbbbb0>]}
[0m15:21:20.945634 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_base.employee_extended ............ [[31mERROR[0m in 0.05s]
[0m15:21:20.946015 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m15:21:20.946277 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.employee_extended' to be skipped because of status 'error'.  Reason: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  syntax error at or near "from"
  LINE 22: from "lucca_db"."public_base"."employee"
           ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql.
[0m15:21:20.947075 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:20.947313 [debug] [MainThread]: On master: BEGIN
[0m15:21:20.947509 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:21:20.954817 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:21:20.955355 [debug] [MainThread]: On master: COMMIT
[0m15:21:20.955747 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:20.956075 [debug] [MainThread]: On master: COMMIT
[0m15:21:20.956844 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m15:21:20.957006 [debug] [MainThread]: On master: Close
[0m15:21:20.957223 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:21:20.957346 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m15:21:20.957489 [info ] [MainThread]: 
[0m15:21:20.957664 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m15:21:20.959846 [debug] [MainThread]: Command end result
[0m15:21:20.973245 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:21:20.974161 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:21:20.978012 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:21:20.978199 [info ] [MainThread]: 
[0m15:21:20.978407 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:21:20.978569 [info ] [MainThread]: 
[0m15:21:20.978742 [error] [MainThread]: [31mFailure in model employee_extended (models/models/transform/employee_extended.sql)[0m
[0m15:21:20.978958 [error] [MainThread]:   Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  syntax error at or near "from"
  LINE 22: from "lucca_db"."public_base"."employee"
           ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:20.979118 [info ] [MainThread]: 
[0m15:21:20.979273 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:20.979402 [info ] [MainThread]: 
[0m15:21:20.979559 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:21:20.981180 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.73556274, "process_in_blocks": "0", "process_kernel_time": 0.182311, "process_mem_max_rss": "129744896", "process_out_blocks": "0", "process_user_time": 1.071996}
[0m15:21:20.981365 [debug] [MainThread]: Command `dbt run` failed at 15:21:20.981326 after 0.74 seconds
[0m15:21:20.981543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10811ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ac5190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083b4490>]}
[0m15:21:20.981716 [debug] [MainThread]: Flushing usage events
[0m15:21:21.343731 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:21:33.265783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f41eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fb8fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fb84c0>]}


============================== 15:21:33.267817 | 8b16dba6-1819-487d-b55d-97c70624c483 ==============================
[0m15:21:33.267817 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:21:33.268076 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'write_json': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'empty': 'False', 'fail_fast': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'log_format': 'default', 'version_check': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'invocation_command': 'dbt run --select employee_extended.sql', 'introspect': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'use_colors': 'True', 'printer_width': '80'}
[0m15:21:33.343970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8b16dba6-1819-487d-b55d-97c70624c483', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fa4280>]}
[0m15:21:33.369576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8b16dba6-1819-487d-b55d-97c70624c483', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082ac6d0>]}
[0m15:21:33.370200 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:21:33.421248 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:21:33.481883 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:21:33.482216 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m15:21:33.588504 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m15:21:33.595310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8b16dba6-1819-487d-b55d-97c70624c483', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1c3130>]}
[0m15:21:33.653502 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:21:33.654481 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:21:33.662442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8b16dba6-1819-487d-b55d-97c70624c483', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cfa1f0>]}
[0m15:21:33.662648 [info ] [MainThread]: Found 5 models, 1 source, 447 macros
[0m15:21:33.662794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b16dba6-1819-487d-b55d-97c70624c483', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a4efa0>]}
[0m15:21:33.663373 [info ] [MainThread]: 
[0m15:21:33.663522 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:21:33.663644 [info ] [MainThread]: 
[0m15:21:33.663858 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:21:33.664218 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:21:33.687933 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:21:33.688127 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:21:33.688245 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:21:33.710329 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.022 seconds
[0m15:21:33.710974 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:21:33.713125 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m15:21:33.715879 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:21:33.716026 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:21:33.716152 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:33.724172 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:21:33.724308 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:21:33.724435 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:21:33.728226 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m15:21:33.728758 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:21:33.729206 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:21:33.729434 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m15:21:33.730656 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:21:33.730796 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:21:33.731036 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:33.738445 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:21:33.738590 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:21:33.738726 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:21:33.741686 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m15:21:33.742178 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:21:33.742551 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:21:33.744643 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:33.744787 [debug] [MainThread]: On master: BEGIN
[0m15:21:33.744904 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:21:33.752385 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:21:33.752520 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:33.752674 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:21:33.757000 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m15:21:33.757502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b16dba6-1819-487d-b55d-97c70624c483', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f665e0>]}
[0m15:21:33.757715 [debug] [MainThread]: On master: ROLLBACK
[0m15:21:33.758086 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:33.758213 [debug] [MainThread]: On master: BEGIN
[0m15:21:33.758744 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:21:33.758892 [debug] [MainThread]: On master: COMMIT
[0m15:21:33.759022 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:33.759148 [debug] [MainThread]: On master: COMMIT
[0m15:21:33.759432 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:21:33.759564 [debug] [MainThread]: On master: Close
[0m15:21:33.761350 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m15:21:33.761598 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.employee_extended ................ [RUN]
[0m15:21:33.761806 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.employee_extended)
[0m15:21:33.761969 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m15:21:33.765898 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m15:21:33.766205 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m15:21:33.801131 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m15:21:33.801572 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:21:33.801719 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m15:21:33.801848 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:33.813308 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m15:21:33.813498 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:21:33.813644 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_db"."public_base"."lucca_raw_data") 
        THEN TRUE 
        ELSE FALSE 
    END AS is_manager
    
from "lucca_db"."public_base"."employee"
  );
  
[0m15:21:33.814999 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "id" does not exist
LINE 17:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                      ^

[0m15:21:33.815149 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: ROLLBACK
[0m15:21:33.815608 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m15:21:33.826453 [debug] [Thread-1  ]: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  column "id" does not exist
  LINE 17:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                        ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:33.827439 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b16dba6-1819-487d-b55d-97c70624c483', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5cdd60>]}
[0m15:21:33.827762 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_transform.employee_extended ....... [[31mERROR[0m in 0.06s]
[0m15:21:33.828031 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m15:21:33.828269 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.employee_extended' to be skipped because of status 'error'.  Reason: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  column "id" does not exist
  LINE 17:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                        ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql.
[0m15:21:33.828787 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:33.828956 [debug] [MainThread]: On master: BEGIN
[0m15:21:33.829081 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:21:33.837077 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:21:33.837269 [debug] [MainThread]: On master: COMMIT
[0m15:21:33.837407 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:33.837530 [debug] [MainThread]: On master: COMMIT
[0m15:21:33.837906 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:21:33.838031 [debug] [MainThread]: On master: Close
[0m15:21:33.838206 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:21:33.838314 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m15:21:33.838435 [info ] [MainThread]: 
[0m15:21:33.838571 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m15:21:33.838863 [debug] [MainThread]: Command end result
[0m15:21:33.849004 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:21:33.849792 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:21:33.853075 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:21:33.853254 [info ] [MainThread]: 
[0m15:21:33.853445 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:21:33.853599 [info ] [MainThread]: 
[0m15:21:33.853772 [error] [MainThread]: [31mFailure in model employee_extended (models/models/transform/employee_extended.sql)[0m
[0m15:21:33.853934 [error] [MainThread]:   Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  column "id" does not exist
  LINE 17:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                        ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:33.854064 [info ] [MainThread]: 
[0m15:21:33.854213 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:33.854338 [info ] [MainThread]: 
[0m15:21:33.854482 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:21:33.855855 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.62347287, "process_in_blocks": "0", "process_kernel_time": 0.117632, "process_mem_max_rss": "129646592", "process_out_blocks": "0", "process_user_time": 1.006638}
[0m15:21:33.856031 [debug] [MainThread]: Command `dbt run` failed at 15:21:33.855998 after 0.62 seconds
[0m15:21:33.856195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f41eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066515e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10889b640>]}
[0m15:21:33.856350 [debug] [MainThread]: Flushing usage events
[0m15:21:34.262775 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:21:58.545800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5d9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b651dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b651310>]}


============================== 15:21:58.547912 | ac9ac6df-a494-43ad-97f1-b341c8217609 ==============================
[0m15:21:58.547912 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:21:58.548200 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'quiet': 'False', 'printer_width': '80', 'target_path': 'None', 'invocation_command': 'dbt run --select employee_extended.sql', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'partial_parse': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'fail_fast': 'False', 'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_cache_events': 'False'}
[0m15:21:58.636312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac9ac6df-a494-43ad-97f1-b341c8217609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f81190>]}
[0m15:21:58.661923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac9ac6df-a494-43ad-97f1-b341c8217609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3e1c10>]}
[0m15:21:58.662542 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:21:58.711913 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:21:58.772364 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:21:58.772698 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m15:21:58.880388 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m15:21:58.887392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac9ac6df-a494-43ad-97f1-b341c8217609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c85a130>]}
[0m15:21:58.944503 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:21:58.945520 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:21:58.953597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac9ac6df-a494-43ad-97f1-b341c8217609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b651dc0>]}
[0m15:21:58.953811 [info ] [MainThread]: Found 5 models, 1 source, 447 macros
[0m15:21:58.953965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac9ac6df-a494-43ad-97f1-b341c8217609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090b33a0>]}
[0m15:21:58.954542 [info ] [MainThread]: 
[0m15:21:58.954691 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:21:58.954814 [info ] [MainThread]: 
[0m15:21:58.955025 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:21:58.955380 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:21:58.978679 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:21:58.978865 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:21:58.978981 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:21:59.013624 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.035 seconds
[0m15:21:59.014246 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:21:59.016423 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m15:21:59.019068 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:21:59.019207 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:21:59.019320 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:59.026802 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:21:59.026926 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:21:59.027046 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:21:59.030514 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m15:21:59.031004 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:21:59.031417 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:21:59.031615 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m15:21:59.032984 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:21:59.033100 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:21:59.033202 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:59.041421 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:21:59.041544 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:21:59.041667 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:21:59.045232 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m15:21:59.045719 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:21:59.046303 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:21:59.048345 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:59.048489 [debug] [MainThread]: On master: BEGIN
[0m15:21:59.048610 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:21:59.056129 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:21:59.056255 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:59.056401 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:21:59.061045 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m15:21:59.061480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac9ac6df-a494-43ad-97f1-b341c8217609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090ac2e0>]}
[0m15:21:59.061673 [debug] [MainThread]: On master: ROLLBACK
[0m15:21:59.062025 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:59.062151 [debug] [MainThread]: On master: BEGIN
[0m15:21:59.062720 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:21:59.062849 [debug] [MainThread]: On master: COMMIT
[0m15:21:59.062968 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:59.063082 [debug] [MainThread]: On master: COMMIT
[0m15:21:59.063415 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:21:59.063556 [debug] [MainThread]: On master: Close
[0m15:21:59.066172 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m15:21:59.066432 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.employee_extended ................ [RUN]
[0m15:21:59.066652 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.employee_extended)
[0m15:21:59.066806 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m15:21:59.070712 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m15:21:59.071023 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m15:21:59.087907 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m15:21:59.088326 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:21:59.088473 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m15:21:59.088604 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:59.097351 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:21:59.097500 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:21:59.097636 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN employee_id IN (SELECT DISTINCT manager_id FROM "lucca_db"."public_base"."employee") 
        THEN TRUE 
        ELSE FALSE 
    END AS is_manager
    
from "lucca_db"."public_base"."employee"
  );
  
[0m15:21:59.098995 [debug] [Thread-1  ]: Postgres adapter: Postgres error: operator does not exist: character varying = integer
LINE 17:         WHEN employee_id IN (SELECT DISTINCT manager_id FROM...
                                  ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[0m15:21:59.099189 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: ROLLBACK
[0m15:21:59.099675 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m15:21:59.110027 [debug] [Thread-1  ]: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  operator does not exist: character varying = integer
  LINE 17:         WHEN employee_id IN (SELECT DISTINCT manager_id FROM...
                                    ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:59.110917 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac9ac6df-a494-43ad-97f1-b341c8217609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc67ac0>]}
[0m15:21:59.111213 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_transform.employee_extended ....... [[31mERROR[0m in 0.04s]
[0m15:21:59.111470 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m15:21:59.111687 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.employee_extended' to be skipped because of status 'error'.  Reason: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  operator does not exist: character varying = integer
  LINE 17:         WHEN employee_id IN (SELECT DISTINCT manager_id FROM...
                                    ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql.
[0m15:21:59.112115 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:59.112250 [debug] [MainThread]: On master: BEGIN
[0m15:21:59.112354 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:21:59.119580 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:21:59.119725 [debug] [MainThread]: On master: COMMIT
[0m15:21:59.119851 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:59.119981 [debug] [MainThread]: On master: COMMIT
[0m15:21:59.120386 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:21:59.120519 [debug] [MainThread]: On master: Close
[0m15:21:59.120699 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:21:59.120816 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m15:21:59.120936 [info ] [MainThread]: 
[0m15:21:59.121074 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m15:21:59.121368 [debug] [MainThread]: Command end result
[0m15:21:59.131321 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:21:59.132092 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:21:59.135361 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:21:59.135515 [info ] [MainThread]: 
[0m15:21:59.135686 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:21:59.135830 [info ] [MainThread]: 
[0m15:21:59.135997 [error] [MainThread]: [31mFailure in model employee_extended (models/models/transform/employee_extended.sql)[0m
[0m15:21:59.136162 [error] [MainThread]:   Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  operator does not exist: character varying = integer
  LINE 17:         WHEN employee_id IN (SELECT DISTINCT manager_id FROM...
                                    ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:59.136296 [info ] [MainThread]: 
[0m15:21:59.136446 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:21:59.136572 [info ] [MainThread]: 
[0m15:21:59.136714 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:21:59.138057 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.62376505, "process_in_blocks": "0", "process_kernel_time": 0.128815, "process_mem_max_rss": "129875968", "process_out_blocks": "0", "process_user_time": 0.996642}
[0m15:21:59.138219 [debug] [MainThread]: Command `dbt run` failed at 15:21:59.138184 after 0.62 seconds
[0m15:21:59.138376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5d9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c788670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c788160>]}
[0m15:21:59.138532 [debug] [MainThread]: Flushing usage events
[0m15:21:59.516780 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:24:53.282143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c9ae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d11dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d11310>]}


============================== 15:24:53.284522 | 3919f034-e84b-45ee-9c97-814c4100d904 ==============================
[0m15:24:53.284522 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:24:53.284802 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'partial_parse': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'log_path': '/Users/marccao/repo/dbt/logs', 'debug': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run --select employee_extended.sql', 'write_json': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'use_colors': 'True', 'target_path': 'None', 'warn_error': 'None', 'empty': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'introspect': 'True'}
[0m15:24:53.378005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3919f034-e84b-45ee-9c97-814c4100d904', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106641190>]}
[0m15:24:53.405119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3919f034-e84b-45ee-9c97-814c4100d904', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108aa1c10>]}
[0m15:24:53.405758 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:24:53.457376 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:24:53.526323 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:24:53.526672 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m15:24:53.636526 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.base
- models.lucca_dbt.transform
[0m15:24:53.643610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3919f034-e84b-45ee-9c97-814c4100d904', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f1b130>]}
[0m15:24:53.702061 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:24:53.703220 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:24:53.712288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3919f034-e84b-45ee-9c97-814c4100d904', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d11dc0>]}
[0m15:24:53.712529 [info ] [MainThread]: Found 5 models, 1 source, 447 macros
[0m15:24:53.712690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3919f034-e84b-45ee-9c97-814c4100d904', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067733a0>]}
[0m15:24:53.713275 [info ] [MainThread]: 
[0m15:24:53.713427 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:24:53.713554 [info ] [MainThread]: 
[0m15:24:53.713781 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:24:53.714149 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:24:53.742004 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:24:53.742239 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:24:53.742362 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:24:53.779248 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.037 seconds
[0m15:24:53.779814 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:24:53.781913 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m15:24:53.784621 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:24:53.784752 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:24:53.784873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:24:53.794708 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m15:24:53.794862 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:24:53.794997 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:24:53.800594 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.005 seconds
[0m15:24:53.801124 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:24:53.801584 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:24:53.801805 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m15:24:53.803316 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:24:53.803474 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:24:53.803597 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:24:53.812322 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m15:24:53.812452 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:24:53.812586 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:24:53.815212 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m15:24:53.815746 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:24:53.816080 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:24:53.818266 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:53.818414 [debug] [MainThread]: On master: BEGIN
[0m15:24:53.818539 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:24:53.824647 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m15:24:53.824784 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:53.824936 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:24:53.828292 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m15:24:53.828774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3919f034-e84b-45ee-9c97-814c4100d904', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d5ea90>]}
[0m15:24:53.828978 [debug] [MainThread]: On master: ROLLBACK
[0m15:24:53.829313 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:53.829437 [debug] [MainThread]: On master: BEGIN
[0m15:24:53.829902 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:24:53.830043 [debug] [MainThread]: On master: COMMIT
[0m15:24:53.830172 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:53.830296 [debug] [MainThread]: On master: COMMIT
[0m15:24:53.830578 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:24:53.830708 [debug] [MainThread]: On master: Close
[0m15:24:53.832782 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m15:24:53.833042 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.employee_extended ................ [RUN]
[0m15:24:53.833264 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.employee_extended)
[0m15:24:53.833423 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m15:24:53.837434 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m15:24:53.837905 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m15:24:53.855186 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m15:24:53.855625 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:24:53.855785 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m15:24:53.855933 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:24:53.864534 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:24:53.864681 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:24:53.864820 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN (id::varchar) IN (
            SELECT DISTINCT (manager_id::varchar) 
            FROM "lucca_db"."public_base"."lucca_raw_data"
            WHERE manager_id IS NOT NULL
        ) 
        THEN TRUE 
        ELSE FALSE 
    END AS is_manager

    
from "lucca_db"."public_base"."employee"
  );
  
[0m15:24:53.866046 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "id" does not exist
LINE 17:         WHEN (id::varchar) IN (
                       ^

[0m15:24:53.866187 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: ROLLBACK
[0m15:24:53.866657 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m15:24:53.878094 [debug] [Thread-1  ]: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  column "id" does not exist
  LINE 17:         WHEN (id::varchar) IN (
                         ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:24:53.879057 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3919f034-e84b-45ee-9c97-814c4100d904', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a325ac0>]}
[0m15:24:53.879352 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_transform.employee_extended ....... [[31mERROR[0m in 0.05s]
[0m15:24:53.879613 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m15:24:53.879841 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.employee_extended' to be skipped because of status 'error'.  Reason: Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  column "id" does not exist
  LINE 17:         WHEN (id::varchar) IN (
                         ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql.
[0m15:24:53.880289 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:53.880429 [debug] [MainThread]: On master: BEGIN
[0m15:24:53.880537 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:24:53.888033 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:24:53.888207 [debug] [MainThread]: On master: COMMIT
[0m15:24:53.888479 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:53.888607 [debug] [MainThread]: On master: COMMIT
[0m15:24:53.888965 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:24:53.889090 [debug] [MainThread]: On master: Close
[0m15:24:53.889272 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:24:53.889378 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m15:24:53.889498 [info ] [MainThread]: 
[0m15:24:53.889639 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m15:24:53.889929 [debug] [MainThread]: Command end result
[0m15:24:53.900305 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:24:53.901114 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:24:53.904220 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:24:53.904409 [info ] [MainThread]: 
[0m15:24:53.904612 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:24:53.904758 [info ] [MainThread]: 
[0m15:24:53.904925 [error] [MainThread]: [31mFailure in model employee_extended (models/models/transform/employee_extended.sql)[0m
[0m15:24:53.905087 [error] [MainThread]:   Database Error in model employee_extended (models/models/transform/employee_extended.sql)
  column "id" does not exist
  LINE 17:         WHEN (id::varchar) IN (
                         ^
  compiled code at target/run/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:24:53.905214 [info ] [MainThread]: 
[0m15:24:53.905364 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/employee_extended.sql
[0m15:24:53.905491 [info ] [MainThread]: 
[0m15:24:53.905632 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:24:53.907220 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6632898, "process_in_blocks": "0", "process_kernel_time": 0.172946, "process_mem_max_rss": "129695744", "process_out_blocks": "0", "process_user_time": 1.010868}
[0m15:24:53.907389 [debug] [MainThread]: Command `dbt run` failed at 15:24:53.907353 after 0.66 seconds
[0m15:24:53.907559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c9ae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053297c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e48640>]}
[0m15:24:53.907718 [debug] [MainThread]: Flushing usage events
[0m15:24:54.331492 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:25:31.784743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dfedf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae74f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae74490>]}


============================== 15:25:31.787070 | e36f0a67-b36e-483b-8e1d-753b8c0feefb ==============================
[0m15:25:31.787070 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:25:31.787327 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/marccao/repo/dbt/logs', 'no_print': 'None', 'indirect_selection': 'eager', 'partial_parse': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'printer_width': '80', 'version_check': 'True', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'warn_error': 'None', 'use_colors': 'True', 'invocation_command': 'dbt run --select employee_extended.sql', 'empty': 'False'}
[0m15:25:31.880298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e36f0a67-b36e-483b-8e1d-753b8c0feefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088efd00>]}
[0m15:25:31.906803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e36f0a67-b36e-483b-8e1d-753b8c0feefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b35cf10>]}
[0m15:25:31.907372 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:25:31.959865 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:25:32.027207 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:25:32.027530 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m15:25:32.135420 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m15:25:32.142350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e36f0a67-b36e-483b-8e1d-753b8c0feefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c080130>]}
[0m15:25:32.201003 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:25:32.202158 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:25:32.210990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e36f0a67-b36e-483b-8e1d-753b8c0feefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be95550>]}
[0m15:25:32.211218 [info ] [MainThread]: Found 5 models, 1 source, 447 macros
[0m15:25:32.211375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e36f0a67-b36e-483b-8e1d-753b8c0feefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae4ed00>]}
[0m15:25:32.211963 [info ] [MainThread]: 
[0m15:25:32.212117 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:25:32.212243 [info ] [MainThread]: 
[0m15:25:32.212463 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:25:32.212817 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:25:32.240517 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:25:32.240717 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:25:32.240846 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:25:32.276453 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.036 seconds
[0m15:25:32.277057 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:25:32.279229 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m15:25:32.281951 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:25:32.282105 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:25:32.282227 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:25:32.287785 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m15:25:32.287970 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:25:32.288115 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:25:32.289578 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.001 seconds
[0m15:25:32.290161 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:25:32.290461 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:25:32.290710 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m15:25:32.292341 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:25:32.292479 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:25:32.292598 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:25:32.297116 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m15:25:32.297277 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:25:32.297407 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:25:32.299721 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m15:25:32.300302 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:25:32.300690 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:25:32.302991 [debug] [MainThread]: Using postgres connection "master"
[0m15:25:32.303159 [debug] [MainThread]: On master: BEGIN
[0m15:25:32.303273 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:25:32.307835 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m15:25:32.307976 [debug] [MainThread]: Using postgres connection "master"
[0m15:25:32.308139 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:25:32.309426 [debug] [MainThread]: SQL status: SELECT 0 in 0.001 seconds
[0m15:25:32.309920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e36f0a67-b36e-483b-8e1d-753b8c0feefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088b8520>]}
[0m15:25:32.310120 [debug] [MainThread]: On master: ROLLBACK
[0m15:25:32.310403 [debug] [MainThread]: Using postgres connection "master"
[0m15:25:32.310529 [debug] [MainThread]: On master: BEGIN
[0m15:25:32.310977 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:25:32.311107 [debug] [MainThread]: On master: COMMIT
[0m15:25:32.311234 [debug] [MainThread]: Using postgres connection "master"
[0m15:25:32.311357 [debug] [MainThread]: On master: COMMIT
[0m15:25:32.311642 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:25:32.311761 [debug] [MainThread]: On master: Close
[0m15:25:32.313005 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m15:25:32.313250 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.employee_extended ................ [RUN]
[0m15:25:32.313455 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.employee_extended)
[0m15:25:32.313602 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m15:25:32.317662 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m15:25:32.317977 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m15:25:32.349241 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m15:25:32.350149 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:25:32.350346 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m15:25:32.350497 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:25:32.359866 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:25:32.360174 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:25:32.360355 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN employee_id IN (
            SELECT DISTINCT manager_id::varchar 
            FROM "lucca_db"."public_base"."employee"
            WHERE manager_id IS NOT NULL
        )
        THEN TRUE
        ELSE FALSE
    END AS is_manager

    
from "lucca_db"."public_base"."employee"
  );
  
[0m15:25:32.367398 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m15:25:32.371882 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:25:32.372054 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m15:25:32.373135 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:25:32.379279 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m15:25:32.379445 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:25:32.379588 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m15:25:32.381437 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:25:32.384625 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m15:25:32.386607 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:25:32.386763 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m15:25:32.387397 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m15:25:32.388408 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m15:25:32.389514 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e36f0a67-b36e-483b-8e1d-753b8c0feefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c373f70>]}
[0m15:25:32.389781 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.08s]
[0m15:25:32.390032 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m15:25:32.390500 [debug] [MainThread]: Using postgres connection "master"
[0m15:25:32.390641 [debug] [MainThread]: On master: BEGIN
[0m15:25:32.390767 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:25:32.397728 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:25:32.397863 [debug] [MainThread]: On master: COMMIT
[0m15:25:32.397984 [debug] [MainThread]: Using postgres connection "master"
[0m15:25:32.398094 [debug] [MainThread]: On master: COMMIT
[0m15:25:32.398524 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:25:32.398659 [debug] [MainThread]: On master: Close
[0m15:25:32.398815 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:25:32.398919 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m15:25:32.399037 [info ] [MainThread]: 
[0m15:25:32.399181 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m15:25:32.399472 [debug] [MainThread]: Command end result
[0m15:25:32.409535 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:25:32.410488 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:25:32.413773 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:25:32.413926 [info ] [MainThread]: 
[0m15:25:32.414100 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:25:32.414232 [info ] [MainThread]: 
[0m15:25:32.414374 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:25:32.415754 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6678309, "process_in_blocks": "0", "process_kernel_time": 0.147719, "process_mem_max_rss": "129630208", "process_out_blocks": "0", "process_user_time": 1.026274}
[0m15:25:32.415933 [debug] [MainThread]: Command `dbt run` succeeded at 15:25:32.415895 after 0.67 seconds
[0m15:25:32.416113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dfedf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b269880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088ef610>]}
[0m15:25:32.416290 [debug] [MainThread]: Flushing usage events
[0m15:25:32.862024 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:26:12.282240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2a9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d320fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3204c0>]}


============================== 15:26:12.284577 | d1c7314b-e8a9-42cb-8644-66618060a1df ==============================
[0m15:26:12.284577 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:26:12.284857 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/marccao/repo/dbt', 'partial_parse': 'True', 'use_colors': 'True', 'no_print': 'None', 'introspect': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'log_path': '/Users/marccao/repo/dbt/logs', 'empty': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'static_parser': 'True', 'write_json': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'quiet': 'False'}
[0m15:26:12.377560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d30be80>]}
[0m15:26:12.403369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0b1cd0>]}
[0m15:26:12.403943 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:26:12.456064 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:26:12.522440 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:26:12.522634 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:26:12.525539 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m15:26:12.541901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e336130>]}
[0m15:26:12.581794 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:26:12.583092 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:26:12.592404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e192be0>]}
[0m15:26:12.592643 [info ] [MainThread]: Found 5 models, 1 source, 447 macros
[0m15:26:12.592801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e34da00>]}
[0m15:26:12.593463 [info ] [MainThread]: 
[0m15:26:12.593618 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:26:12.593742 [info ] [MainThread]: 
[0m15:26:12.593969 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:26:12.595965 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:26:12.642275 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:26:12.642489 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:26:12.642612 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:26:12.679369 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.037 seconds
[0m15:26:12.679955 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:26:12.681156 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:26:12.681302 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:26:12.681413 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:26:12.691243 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m15:26:12.691672 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:26:12.692231 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m15:26:12.694833 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:26:12.694987 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:26:12.695104 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:26:12.703066 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:26:12.703199 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:26:12.703333 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:26:12.707722 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.004 seconds
[0m15:26:12.708261 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:26:12.708654 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:26:12.708918 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m15:26:12.710582 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:26:12.710732 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:26:12.710858 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:26:12.717069 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m15:26:12.717222 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:26:12.717357 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:26:12.719325 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m15:26:12.719858 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:26:12.720175 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:26:12.722515 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:12.722692 [debug] [MainThread]: On master: BEGIN
[0m15:26:12.722820 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:26:12.727431 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m15:26:12.727571 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:12.727729 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:26:12.730315 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m15:26:12.730810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d816820>]}
[0m15:26:12.731014 [debug] [MainThread]: On master: ROLLBACK
[0m15:26:12.731328 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:12.731458 [debug] [MainThread]: On master: BEGIN
[0m15:26:12.731916 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:26:12.732040 [debug] [MainThread]: On master: COMMIT
[0m15:26:12.732159 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:12.732273 [debug] [MainThread]: On master: COMMIT
[0m15:26:12.732537 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:26:12.732670 [debug] [MainThread]: On master: Close
[0m15:26:12.734999 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m15:26:12.735233 [info ] [Thread-1  ]: 1 of 5 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m15:26:12.735441 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m15:26:12.735589 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m15:26:12.739665 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.740217 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m15:26:12.757074 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.757462 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.757603 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m15:26:12.757734 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:12.766525 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:26:12.766685 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.766884 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m15:26:12.773289 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m15:26:12.777607 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.777765 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m15:26:12.778225 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:12.780059 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.780210 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m15:26:12.780616 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:12.787451 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:26:12.787617 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.787765 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:26:12.789464 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:26:12.791976 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m15:26:12.793862 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:12.794004 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m15:26:12.797982 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:26:12.798976 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m15:26:12.799952 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e802df0>]}
[0m15:26:12.800254 [info ] [Thread-1  ]: 1 of 5 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m15:26:12.800504 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m15:26:12.800847 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m15:26:12.801070 [info ] [Thread-1  ]: 2 of 5 START sql table model public_base.contract .............................. [RUN]
[0m15:26:12.801251 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m15:26:12.801384 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m15:26:12.802684 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m15:26:12.803085 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m15:26:12.804909 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m15:26:12.805236 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:12.805393 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m15:26:12.805535 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:12.813599 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:26:12.813840 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:12.814003 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,
modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:26:12.816384 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.002 seconds
[0m15:26:12.818255 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:12.818414 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m15:26:12.818881 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:12.820205 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:12.820344 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m15:26:12.820718 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:12.821430 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:26:12.821580 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:12.821711 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:26:12.822431 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:26:12.824109 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m15:26:12.824407 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:12.824545 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m15:26:12.826567 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:26:12.827069 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m15:26:12.827313 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8c6f70>]}
[0m15:26:12.827574 [info ] [Thread-1  ]: 2 of 5 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m15:26:12.827811 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m15:26:12.827978 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m15:26:12.828195 [info ] [Thread-1  ]: 3 of 5 START sql table model public_transform.contract_extended ................ [RUN]
[0m15:26:12.828378 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m15:26:12.828527 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m15:26:12.830057 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m15:26:12.830373 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m15:26:12.832035 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m15:26:12.832302 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:12.832447 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m15:26:12.832592 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:12.839572 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:26:12.839745 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:12.839936 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:26:12.843418 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m15:26:12.845301 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:12.845482 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m15:26:12.845976 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:12.847249 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:12.847388 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m15:26:12.848200 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:26:12.848828 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m15:26:12.848981 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:12.849110 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m15:26:12.850274 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:26:12.851546 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m15:26:12.851879 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:12.852022 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m15:26:12.854373 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:26:12.854885 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m15:26:12.855156 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8c6f70>]}
[0m15:26:12.855426 [info ] [Thread-1  ]: 3 of 5 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m15:26:12.855660 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m15:26:12.855842 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m15:26:12.856073 [info ] [Thread-1  ]: 4 of 5 START sql table model public_base.employee .............................. [RUN]
[0m15:26:12.856278 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.employee)
[0m15:26:12.856433 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m15:26:12.857977 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m15:26:12.858280 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m15:26:12.860522 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m15:26:12.860800 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:12.860943 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m15:26:12.861068 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:12.867821 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:26:12.867980 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:12.868141 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    CASE 
        WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_db"."public_base"."lucca_raw_data") 
        THEN TRUE 
        ELSE FALSE 
    END AS is_manager,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:26:12.869338 [debug] [Thread-1  ]: Postgres adapter: Postgres error: operator does not exist: character varying = integer
LINE 28:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                         ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[0m15:26:12.869658 [debug] [Thread-1  ]: On model.lucca_dbt.employee: ROLLBACK
[0m15:26:12.870231 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m15:26:12.881588 [debug] [Thread-1  ]: Database Error in model employee (models/models/base/employee.sql)
  operator does not exist: character varying = integer
  LINE 28:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                           ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/lucca_dbt/models/models/base/employee.sql
[0m15:26:12.881855 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1c7314b-e8a9-42cb-8644-66618060a1df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8d6c10>]}
[0m15:26:12.882132 [error] [Thread-1  ]: 4 of 5 ERROR creating sql table model public_base.employee ..................... [[31mERROR[0m in 0.03s]
[0m15:26:12.882379 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m15:26:12.882604 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.employee' to be skipped because of status 'error'.  Reason: Database Error in model employee (models/models/base/employee.sql)
  operator does not exist: character varying = integer
  LINE 28:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                           ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/lucca_dbt/models/models/base/employee.sql.
[0m15:26:12.882895 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m15:26:12.883090 [info ] [Thread-1  ]: 5 of 5 SKIP relation public_transform.employee_extended ........................ [[33mSKIP[0m]
[0m15:26:12.883277 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m15:26:12.883748 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:12.883884 [debug] [MainThread]: On master: BEGIN
[0m15:26:12.883991 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:26:12.891653 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:26:12.891822 [debug] [MainThread]: On master: COMMIT
[0m15:26:12.891951 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:12.892073 [debug] [MainThread]: On master: COMMIT
[0m15:26:12.892428 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:26:12.892541 [debug] [MainThread]: On master: Close
[0m15:26:12.892694 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:26:12.892797 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m15:26:12.892959 [info ] [MainThread]: 
[0m15:26:12.893098 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m15:26:12.893534 [debug] [MainThread]: Command end result
[0m15:26:12.904257 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:26:12.905085 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:26:12.908189 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:26:12.908334 [info ] [MainThread]: 
[0m15:26:12.908537 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:26:12.908736 [info ] [MainThread]: 
[0m15:26:12.908986 [error] [MainThread]: [31mFailure in model employee (models/models/base/employee.sql)[0m
[0m15:26:12.909186 [error] [MainThread]:   Database Error in model employee (models/models/base/employee.sql)
  operator does not exist: character varying = integer
  LINE 28:         WHEN id IN (SELECT DISTINCT manager_id FROM "lucca_d...
                           ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/lucca_dbt/models/models/base/employee.sql
[0m15:26:12.909328 [info ] [MainThread]: 
[0m15:26:12.909482 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/base/employee.sql
[0m15:26:12.909613 [info ] [MainThread]: 
[0m15:26:12.909762 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=5
[0m15:26:12.911127 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.665823, "process_in_blocks": "0", "process_kernel_time": 0.154584, "process_mem_max_rss": "127287296", "process_out_blocks": "0", "process_user_time": 0.985367}
[0m15:26:12.911301 [debug] [MainThread]: Command `dbt run` failed at 15:26:12.911267 after 0.67 seconds
[0m15:26:12.911462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2a9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1929d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0b1cd0>]}
[0m15:26:12.911629 [debug] [MainThread]: Flushing usage events
[0m15:26:13.271052 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:26:31.240253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c58ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d603ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d603430>]}


============================== 15:26:31.242650 | 75d412ab-8ef9-4ec1-a4d5-e48ab14328cf ==============================
[0m15:26:31.242650 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:26:31.242913 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'static_parser': 'True', 'introspect': 'True', 'printer_width': '80', 'partial_parse': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'use_colors': 'True', 'no_print': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'log_format': 'default'}
[0m15:26:31.334034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af35e20>]}
[0m15:26:31.360120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c02c460>]}
[0m15:26:31.360752 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:26:31.430104 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:26:31.494113 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:26:31.494457 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/employee.sql
[0m15:26:31.604274 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m15:26:31.611231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e80f130>]}
[0m15:26:31.669826 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:26:31.670827 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:26:31.678609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b060760>]}
[0m15:26:31.678823 [info ] [MainThread]: Found 5 models, 1 source, 447 macros
[0m15:26:31.678972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e625220>]}
[0m15:26:31.679575 [info ] [MainThread]: 
[0m15:26:31.679724 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:26:31.679848 [info ] [MainThread]: 
[0m15:26:31.680064 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:26:31.681979 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:26:31.709062 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:26:31.709267 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:26:31.709387 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:26:31.744977 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.036 seconds
[0m15:26:31.745600 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:26:31.746990 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:26:31.747178 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:26:31.747311 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:26:31.755680 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m15:26:31.756279 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:26:31.756909 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m15:26:31.760049 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:26:31.760191 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:26:31.760303 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:26:31.768791 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:26:31.768915 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:26:31.769036 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:26:31.772786 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m15:26:31.773331 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:26:31.773706 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:26:31.773940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m15:26:31.775100 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:26:31.775236 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:26:31.775356 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:26:31.782300 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:26:31.782567 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:26:31.782730 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:26:31.785267 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m15:26:31.785825 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:26:31.786165 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:26:31.788617 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:31.788797 [debug] [MainThread]: On master: BEGIN
[0m15:26:31.788916 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:26:31.794170 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m15:26:31.794324 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:31.794466 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:26:31.796074 [debug] [MainThread]: SQL status: SELECT 0 in 0.001 seconds
[0m15:26:31.796528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e64bd00>]}
[0m15:26:31.796732 [debug] [MainThread]: On master: ROLLBACK
[0m15:26:31.797039 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:31.797172 [debug] [MainThread]: On master: BEGIN
[0m15:26:31.797587 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:26:31.797731 [debug] [MainThread]: On master: COMMIT
[0m15:26:31.797850 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:31.797958 [debug] [MainThread]: On master: COMMIT
[0m15:26:31.798189 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:26:31.798309 [debug] [MainThread]: On master: Close
[0m15:26:31.800002 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m15:26:31.800243 [info ] [Thread-1  ]: 1 of 5 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m15:26:31.800478 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m15:26:31.800692 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m15:26:31.804696 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.805037 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m15:26:31.823746 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.824185 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.824329 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m15:26:31.824461 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:31.834722 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m15:26:31.834924 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.835099 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m15:26:31.841668 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m15:26:31.846608 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.846766 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m15:26:31.847260 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:31.848509 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.848652 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m15:26:31.849030 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:31.855907 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:26:31.856072 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.856215 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:26:31.858139 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:26:31.860775 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m15:26:31.862594 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:26:31.862761 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m15:26:31.865751 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:26:31.866813 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m15:26:31.867762 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaf0ca0>]}
[0m15:26:31.868059 [info ] [Thread-1  ]: 1 of 5 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m15:26:31.868328 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m15:26:31.868664 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m15:26:31.868868 [info ] [Thread-1  ]: 2 of 5 START sql table model public_base.contract .............................. [RUN]
[0m15:26:31.869060 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m15:26:31.869201 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m15:26:31.870499 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m15:26:31.870788 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m15:26:31.872418 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m15:26:31.872656 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:31.872797 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m15:26:31.872941 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:31.879952 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:26:31.880149 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:31.880301 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,
modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:26:31.884598 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m15:26:31.886117 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:31.886262 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m15:26:31.886924 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:26:31.888657 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:31.888804 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m15:26:31.889995 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:26:31.890576 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:26:31.890711 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:31.890851 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m15:26:31.891752 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:26:31.892785 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m15:26:31.893085 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m15:26:31.893229 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m15:26:31.895730 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:26:31.896183 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m15:26:31.896424 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec8da00>]}
[0m15:26:31.896677 [info ] [Thread-1  ]: 2 of 5 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m15:26:31.896921 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m15:26:31.897072 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m15:26:31.897280 [info ] [Thread-1  ]: 3 of 5 START sql table model public_transform.contract_extended ................ [RUN]
[0m15:26:31.897478 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m15:26:31.897621 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m15:26:31.898999 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m15:26:31.899290 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m15:26:31.900957 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m15:26:31.901254 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:31.901403 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m15:26:31.901533 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:31.908625 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:26:31.908842 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:31.909011 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:26:31.915014 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m15:26:31.916551 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:31.916695 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m15:26:31.917636 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:26:31.918847 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:31.918990 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m15:26:31.919599 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:31.920190 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m15:26:31.920322 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:31.920455 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m15:26:31.921412 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:26:31.922415 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m15:26:31.922708 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m15:26:31.922850 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m15:26:31.924979 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:26:31.925473 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m15:26:31.925728 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ecc07c0>]}
[0m15:26:31.925999 [info ] [Thread-1  ]: 3 of 5 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m15:26:31.926238 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m15:26:31.926403 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m15:26:31.926631 [info ] [Thread-1  ]: 4 of 5 START sql table model public_base.employee .............................. [RUN]
[0m15:26:31.926834 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.employee)
[0m15:26:31.926983 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m15:26:31.929060 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m15:26:31.929366 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m15:26:31.930978 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m15:26:31.931212 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:31.931346 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m15:26:31.931474 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:31.939412 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:26:31.939622 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:31.939766 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:26:31.945075 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m15:26:31.946629 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:31.946784 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m15:26:31.947958 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:26:31.949222 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:31.949367 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m15:26:31.950019 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:26:31.950651 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:26:31.950794 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:31.950925 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m15:26:31.952510 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:26:31.953566 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m15:26:31.953870 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m15:26:31.954010 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m15:26:31.957014 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:26:31.957500 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m15:26:31.957752 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ecc07c0>]}
[0m15:26:31.958040 [info ] [Thread-1  ]: 4 of 5 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m15:26:31.958279 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m15:26:31.958603 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m15:26:31.958842 [info ] [Thread-1  ]: 5 of 5 START sql table model public_transform.employee_extended ................ [RUN]
[0m15:26:31.959039 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m15:26:31.959188 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m15:26:31.960770 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m15:26:31.961107 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m15:26:31.963419 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m15:26:31.963680 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:26:31.963823 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m15:26:31.963961 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:26:31.970097 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m15:26:31.970337 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:26:31.970506 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN employee_id IN (
            SELECT DISTINCT manager_id::varchar 
            FROM "lucca_db"."public_base"."employee"
            WHERE manager_id IS NOT NULL
        )
        THEN TRUE
        ELSE FALSE
    END AS is_manager

    
from "lucca_db"."public_base"."employee"
  );
  
[0m15:26:31.973548 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m15:26:31.975298 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:26:31.975473 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m15:26:31.975893 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:31.977207 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:26:31.977363 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m15:26:31.977706 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:26:31.978456 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m15:26:31.978627 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:26:31.978776 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m15:26:31.979297 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m15:26:31.980455 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m15:26:31.980780 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m15:26:31.980927 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m15:26:31.981964 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m15:26:31.982483 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m15:26:31.982754 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d412ab-8ef9-4ec1-a4d5-e48ab14328cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd09730>]}
[0m15:26:31.983040 [info ] [Thread-1  ]: 5 of 5 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.02s]
[0m15:26:31.983283 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m15:26:31.983802 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:31.983943 [debug] [MainThread]: On master: BEGIN
[0m15:26:31.984070 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:26:31.989011 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m15:26:31.989216 [debug] [MainThread]: On master: COMMIT
[0m15:26:31.989362 [debug] [MainThread]: Using postgres connection "master"
[0m15:26:31.989489 [debug] [MainThread]: On master: COMMIT
[0m15:26:31.989751 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:26:31.989894 [debug] [MainThread]: On master: Close
[0m15:26:31.990088 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:26:31.990212 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m15:26:31.990384 [info ] [MainThread]: 
[0m15:26:31.990528 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m15:26:31.991046 [debug] [MainThread]: Command end result
[0m15:26:32.001363 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:26:32.002470 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:26:32.005457 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:26:32.005595 [info ] [MainThread]: 
[0m15:26:32.005762 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:26:32.005895 [info ] [MainThread]: 
[0m15:26:32.006038 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m15:26:32.007349 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.80334723, "process_in_blocks": "0", "process_kernel_time": 0.161777, "process_mem_max_rss": "130990080", "process_out_blocks": "0", "process_user_time": 1.094261}
[0m15:26:32.007509 [debug] [MainThread]: Command `dbt run` succeeded at 15:26:32.007474 after 0.80 seconds
[0m15:26:32.007680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c58ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b08d4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dad25b0>]}
[0m15:26:32.007846 [debug] [MainThread]: Flushing usage events
[0m15:26:35.579790 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:48:33.534912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3bedf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d435f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d435490>]}


============================== 15:48:33.537375 | 85ba9a91-b5f2-47af-ad55-7df92946bb3c ==============================
[0m15:48:33.537375 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:48:33.537646 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'printer_width': '80', 'log_format': 'default', 'use_experimental_parser': 'False', 'version_check': 'True', 'debug': 'False', 'empty': 'False', 'introspect': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'quiet': 'False', 'static_parser': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'warn_error': 'None', 'write_json': 'True', 'no_print': 'None', 'invocation_command': 'dbt run --select department.sql', 'log_path': '/Users/marccao/repo/dbt/logs', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False'}
[0m15:48:33.629051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85ba9a91-b5f2-47af-ad55-7df92946bb3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3ec220>]}
[0m15:48:33.655401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85ba9a91-b5f2-47af-ad55-7df92946bb3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4140a0>]}
[0m15:48:33.656085 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:48:33.707473 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:48:33.776954 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:48:33.777258 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/base/department.sql
[0m15:48:33.887006 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m15:48:33.893908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85ba9a91-b5f2-47af-ad55-7df92946bb3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e643130>]}
[0m15:48:33.953944 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:48:33.955475 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:48:33.965690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85ba9a91-b5f2-47af-ad55-7df92946bb3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e46a280>]}
[0m15:48:33.965921 [info ] [MainThread]: Found 6 models, 1 source, 447 macros
[0m15:48:33.966076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85ba9a91-b5f2-47af-ad55-7df92946bb3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db3b130>]}
[0m15:48:33.966668 [info ] [MainThread]: 
[0m15:48:33.966819 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:48:33.966946 [info ] [MainThread]: 
[0m15:48:33.967159 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:48:33.967514 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:48:33.996386 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:48:33.996603 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:48:33.996726 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:48:34.031445 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.035 seconds
[0m15:48:34.032215 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:48:34.034534 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m15:48:34.037538 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:48:34.037695 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:48:34.037811 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:48:34.045920 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:48:34.046104 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:48:34.046231 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:48:34.050990 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.005 seconds
[0m15:48:34.051512 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:48:34.051941 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:48:34.052175 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m15:48:34.053719 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:48:34.053860 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:48:34.053971 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:48:34.061592 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:48:34.061742 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:48:34.061878 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:48:34.065345 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m15:48:34.065879 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:48:34.066329 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:48:34.068392 [debug] [MainThread]: Using postgres connection "master"
[0m15:48:34.068525 [debug] [MainThread]: On master: BEGIN
[0m15:48:34.068649 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:48:34.077477 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m15:48:34.077638 [debug] [MainThread]: Using postgres connection "master"
[0m15:48:34.077797 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:48:34.082440 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m15:48:34.082922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85ba9a91-b5f2-47af-ad55-7df92946bb3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ccada30>]}
[0m15:48:34.083123 [debug] [MainThread]: On master: ROLLBACK
[0m15:48:34.083512 [debug] [MainThread]: Using postgres connection "master"
[0m15:48:34.083635 [debug] [MainThread]: On master: BEGIN
[0m15:48:34.084311 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m15:48:34.084438 [debug] [MainThread]: On master: COMMIT
[0m15:48:34.084565 [debug] [MainThread]: Using postgres connection "master"
[0m15:48:34.084683 [debug] [MainThread]: On master: COMMIT
[0m15:48:34.085124 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:48:34.085248 [debug] [MainThread]: On master: Close
[0m15:48:34.087103 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m15:48:34.087345 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.department ............................ [RUN]
[0m15:48:34.087557 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.department)
[0m15:48:34.087710 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m15:48:34.091456 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m15:48:34.091998 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m15:48:34.109113 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m15:48:34.110144 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m15:48:34.110302 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m15:48:34.110433 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:48:34.121232 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m15:48:34.121417 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m15:48:34.121584 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
department_id,
department_name,
legalEntity_id as company_id,
legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:48:34.122510 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "department_id" does not exist
LINE 16: department_id,
         ^

[0m15:48:34.122673 [debug] [Thread-1  ]: On model.lucca_dbt.department: ROLLBACK
[0m15:48:34.123161 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m15:48:34.134018 [debug] [Thread-1  ]: Database Error in model department (models/models/base/department.sql)
  column "department_id" does not exist
  LINE 16: department_id,
           ^
  compiled code at target/run/lucca_dbt/models/models/base/department.sql
[0m15:48:34.135050 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85ba9a91-b5f2-47af-ad55-7df92946bb3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c63a880>]}
[0m15:48:34.135334 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_base.department ................... [[31mERROR[0m in 0.05s]
[0m15:48:34.135603 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m15:48:34.135837 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.department' to be skipped because of status 'error'.  Reason: Database Error in model department (models/models/base/department.sql)
  column "department_id" does not exist
  LINE 16: department_id,
           ^
  compiled code at target/run/lucca_dbt/models/models/base/department.sql.
[0m15:48:34.136291 [debug] [MainThread]: Using postgres connection "master"
[0m15:48:34.136430 [debug] [MainThread]: On master: BEGIN
[0m15:48:34.136554 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:48:34.144712 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:48:34.144928 [debug] [MainThread]: On master: COMMIT
[0m15:48:34.145368 [debug] [MainThread]: Using postgres connection "master"
[0m15:48:34.145717 [debug] [MainThread]: On master: COMMIT
[0m15:48:34.146247 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:48:34.146375 [debug] [MainThread]: On master: Close
[0m15:48:34.146552 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:48:34.146661 [debug] [MainThread]: Connection 'model.lucca_dbt.department' was properly closed.
[0m15:48:34.146785 [info ] [MainThread]: 
[0m15:48:34.146925 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m15:48:34.147222 [debug] [MainThread]: Command end result
[0m15:48:34.158213 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:48:34.159212 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:48:34.162602 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:48:34.162742 [info ] [MainThread]: 
[0m15:48:34.162913 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:48:34.163056 [info ] [MainThread]: 
[0m15:48:34.163222 [error] [MainThread]: [31mFailure in model department (models/models/base/department.sql)[0m
[0m15:48:34.163382 [error] [MainThread]:   Database Error in model department (models/models/base/department.sql)
  column "department_id" does not exist
  LINE 16: department_id,
           ^
  compiled code at target/run/lucca_dbt/models/models/base/department.sql
[0m15:48:34.163507 [info ] [MainThread]: 
[0m15:48:34.163653 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/base/department.sql
[0m15:48:34.163777 [info ] [MainThread]: 
[0m15:48:34.163919 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m15:48:34.165458 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6685862, "process_in_blocks": "0", "process_kernel_time": 0.13923, "process_mem_max_rss": "129597440", "process_out_blocks": "0", "process_user_time": 1.007063}
[0m15:48:34.165615 [debug] [MainThread]: Command `dbt run` failed at 15:48:34.165583 after 0.67 seconds
[0m15:48:34.165772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3bedf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c694580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3fc070>]}
[0m15:48:34.165933 [debug] [MainThread]: Flushing usage events
[0m15:48:34.529007 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:50:12.893859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7cde50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d844070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d844610>]}


============================== 15:50:12.896405 | 96f8fb89-cecb-453b-8622-d4eaba6641fe ==============================
[0m15:50:12.896405 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:50:12.896663 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'no_print': 'None', 'partial_parse': 'True', 'quiet': 'False', 'invocation_command': 'dbt run --select lucca_raw_data.sql', 'log_format': 'default', 'empty': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'target_path': 'None', 'static_parser': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'log_cache_events': 'False', 'debug': 'False', 'version_check': 'True'}
[0m15:50:12.987980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '96f8fb89-cecb-453b-8622-d4eaba6641fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df4a040>]}
[0m15:50:13.014617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '96f8fb89-cecb-453b-8622-d4eaba6641fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d285c70>]}
[0m15:50:13.015298 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:50:13.067629 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:50:13.136379 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:50:13.136683 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m15:50:13.242141 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m15:50:13.249039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '96f8fb89-cecb-453b-8622-d4eaba6641fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea32130>]}
[0m15:50:13.314259 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:50:13.315365 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:50:13.324942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '96f8fb89-cecb-453b-8622-d4eaba6641fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e86f340>]}
[0m15:50:13.325181 [info ] [MainThread]: Found 6 models, 1 source, 447 macros
[0m15:50:13.325335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96f8fb89-cecb-453b-8622-d4eaba6641fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dfca340>]}
[0m15:50:13.325926 [info ] [MainThread]: 
[0m15:50:13.326078 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:50:13.326205 [info ] [MainThread]: 
[0m15:50:13.326426 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:50:13.326813 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:50:13.356715 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:50:13.356924 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:50:13.357046 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:50:13.454610 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.097 seconds
[0m15:50:13.455421 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:50:13.458209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m15:50:13.461667 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:50:13.461857 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:50:13.462006 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:50:13.474823 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m15:50:13.475054 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:50:13.475218 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:50:13.481400 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m15:50:13.482106 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:50:13.482588 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:50:13.482948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m15:50:13.484857 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:50:13.485067 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:50:13.485228 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:50:13.491268 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m15:50:13.491539 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:50:13.491718 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:50:13.493560 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m15:50:13.494250 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:50:13.494600 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:50:13.497566 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:13.497749 [debug] [MainThread]: On master: BEGIN
[0m15:50:13.497888 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:50:13.505087 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:50:13.505293 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:13.505501 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:50:13.508667 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m15:50:13.509283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96f8fb89-cecb-453b-8622-d4eaba6641fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2c5040>]}
[0m15:50:13.509534 [debug] [MainThread]: On master: ROLLBACK
[0m15:50:13.509898 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:13.510077 [debug] [MainThread]: On master: BEGIN
[0m15:50:13.510553 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:50:13.510719 [debug] [MainThread]: On master: COMMIT
[0m15:50:13.510876 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:13.511021 [debug] [MainThread]: On master: COMMIT
[0m15:50:13.511332 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:50:13.511491 [debug] [MainThread]: On master: Close
[0m15:50:13.513008 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m15:50:13.513306 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m15:50:13.513546 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m15:50:13.513723 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m15:50:13.518317 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.518762 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m15:50:13.538534 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.539026 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.539213 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m15:50:13.539366 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:50:13.547272 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:50:13.547500 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.547701 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    (raw_payload->'department'->>'id')::int AS department_id,
    raw_payload->'department'->>'name' AS department_name,
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m15:50:13.558414 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.010 seconds
[0m15:50:13.563745 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.563946 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m15:50:13.565274 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:50:13.566690 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.566852 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m15:50:13.567559 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:50:13.575846 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:50:13.576078 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.576293 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m15:50:13.577719 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:50:13.580777 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m15:50:13.582703 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m15:50:13.582875 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m15:50:13.586987 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:50:13.588325 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m15:50:13.589496 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96f8fb89-cecb-453b-8622-d4eaba6641fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed295b0>]}
[0m15:50:13.589832 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.08s]
[0m15:50:13.590146 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m15:50:13.590687 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:13.590835 [debug] [MainThread]: On master: BEGIN
[0m15:50:13.590964 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:50:13.599659 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m15:50:13.599865 [debug] [MainThread]: On master: COMMIT
[0m15:50:13.599998 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:13.600124 [debug] [MainThread]: On master: COMMIT
[0m15:50:13.600572 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:50:13.600704 [debug] [MainThread]: On master: Close
[0m15:50:13.600888 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:50:13.601009 [debug] [MainThread]: Connection 'model.lucca_dbt.lucca_raw_data' was properly closed.
[0m15:50:13.601145 [info ] [MainThread]: 
[0m15:50:13.601285 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m15:50:13.601622 [debug] [MainThread]: Command end result
[0m15:50:13.612996 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:50:13.613912 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:50:13.617102 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:50:13.617256 [info ] [MainThread]: 
[0m15:50:13.617443 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:50:13.617576 [info ] [MainThread]: 
[0m15:50:13.617719 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:50:13.619462 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7643282, "process_in_blocks": "0", "process_kernel_time": 0.176745, "process_mem_max_rss": "129974272", "process_out_blocks": "0", "process_user_time": 1.031751}
[0m15:50:13.619656 [debug] [MainThread]: Command `dbt run` succeeded at 15:50:13.619619 after 0.76 seconds
[0m15:50:13.619818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7cde50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca88cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee7d850>]}
[0m15:50:13.619972 [debug] [MainThread]: Flushing usage events
[0m15:50:13.996711 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:50:16.490765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bcddeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd55f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd55490>]}


============================== 15:50:16.492528 | b15315e3-17eb-4f34-95a9-c00cfbc03e44 ==============================
[0m15:50:16.492528 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:50:16.492795 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'write_json': 'True', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select department.sql', 'use_colors': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'no_print': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'introspect': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'empty': 'False', 'printer_width': '80', 'partial_parse': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None'}
[0m15:50:16.565786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b15315e3-17eb-4f34-95a9-c00cfbc03e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6857f0>]}
[0m15:50:16.592110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b15315e3-17eb-4f34-95a9-c00cfbc03e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd0f2e0>]}
[0m15:50:16.592573 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m15:50:16.639892 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:50:16.695880 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:50:16.696078 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:50:16.698950 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m15:50:16.715416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b15315e3-17eb-4f34-95a9-c00cfbc03e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd93eb0>]}
[0m15:50:16.755280 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:50:16.756122 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:50:16.761378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b15315e3-17eb-4f34-95a9-c00cfbc03e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd93d90>]}
[0m15:50:16.761614 [info ] [MainThread]: Found 6 models, 1 source, 447 macros
[0m15:50:16.761770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b15315e3-17eb-4f34-95a9-c00cfbc03e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dcd6f70>]}
[0m15:50:16.762320 [info ] [MainThread]: 
[0m15:50:16.762480 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:50:16.762606 [info ] [MainThread]: 
[0m15:50:16.762828 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:50:16.763179 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m15:50:16.804632 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m15:50:16.804874 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m15:50:16.805004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:50:16.824066 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.019 seconds
[0m15:50:16.824660 [debug] [ThreadPool]: On list_lucca_db: Close
[0m15:50:16.826840 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m15:50:16.829472 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:50:16.829618 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m15:50:16.829737 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:50:16.839892 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m15:50:16.840113 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m15:50:16.840250 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m15:50:16.844733 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.004 seconds
[0m15:50:16.845328 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m15:50:16.845966 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m15:50:16.846223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m15:50:16.847553 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:50:16.847714 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m15:50:16.847856 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:50:16.855333 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:50:16.855560 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m15:50:16.855700 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m15:50:16.857867 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m15:50:16.858443 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m15:50:16.858776 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m15:50:16.861203 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:16.861367 [debug] [MainThread]: On master: BEGIN
[0m15:50:16.861485 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:50:16.866794 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m15:50:16.866980 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:16.867148 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m15:50:16.868599 [debug] [MainThread]: SQL status: SELECT 0 in 0.001 seconds
[0m15:50:16.869596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b15315e3-17eb-4f34-95a9-c00cfbc03e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a596340>]}
[0m15:50:16.869800 [debug] [MainThread]: On master: ROLLBACK
[0m15:50:16.870124 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:16.870259 [debug] [MainThread]: On master: BEGIN
[0m15:50:16.870708 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:50:16.870832 [debug] [MainThread]: On master: COMMIT
[0m15:50:16.870947 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:16.871057 [debug] [MainThread]: On master: COMMIT
[0m15:50:16.871317 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:50:16.871442 [debug] [MainThread]: On master: Close
[0m15:50:16.872366 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m15:50:16.872636 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.department ............................ [RUN]
[0m15:50:16.872865 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.department)
[0m15:50:16.873023 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m15:50:16.876913 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m15:50:16.877385 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m15:50:16.894554 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m15:50:16.894991 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m15:50:16.895138 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m15:50:16.895281 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:50:16.904376 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:50:16.904520 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m15:50:16.904657 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
department_id,
department_name,
legalEntity_id as company_id,
legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m15:50:16.909162 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.004 seconds
[0m15:50:16.913383 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m15:50:16.913542 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m15:50:16.913958 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:50:16.919886 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m15:50:16.920036 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m15:50:16.920176 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m15:50:16.921393 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:50:16.923848 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m15:50:16.926068 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m15:50:16.926218 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m15:50:16.926809 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m15:50:16.927810 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m15:50:16.928550 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b15315e3-17eb-4f34-95a9-c00cfbc03e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6666d0>]}
[0m15:50:16.928824 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.department ....................... [[32mSELECT 5[0m in 0.06s]
[0m15:50:16.929069 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m15:50:16.929513 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:16.929666 [debug] [MainThread]: On master: BEGIN
[0m15:50:16.929786 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:50:16.936718 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:50:16.936851 [debug] [MainThread]: On master: COMMIT
[0m15:50:16.936966 [debug] [MainThread]: Using postgres connection "master"
[0m15:50:16.937074 [debug] [MainThread]: On master: COMMIT
[0m15:50:16.937467 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:50:16.937579 [debug] [MainThread]: On master: Close
[0m15:50:16.937734 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:50:16.937846 [debug] [MainThread]: Connection 'model.lucca_dbt.department' was properly closed.
[0m15:50:16.937974 [info ] [MainThread]: 
[0m15:50:16.938168 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m15:50:16.938553 [debug] [MainThread]: Command end result
[0m15:50:16.948340 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m15:50:16.949143 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m15:50:16.952153 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m15:50:16.952295 [info ] [MainThread]: 
[0m15:50:16.952476 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:50:16.952613 [info ] [MainThread]: 
[0m15:50:16.952760 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m15:50:16.954178 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.49561366, "process_in_blocks": "0", "process_kernel_time": 0.118272, "process_mem_max_rss": "126042112", "process_out_blocks": "0", "process_user_time": 0.915092}
[0m15:50:16.954403 [debug] [MainThread]: Command `dbt run` succeeded at 15:50:16.954359 after 0.50 seconds
[0m15:50:16.954585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bcddeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6857f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd0f2e0>]}
[0m15:50:16.954770 [debug] [MainThread]: Flushing usage events
[0m15:50:17.391935 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:57:01.458516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f4ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afb4e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afb43a0>]}


============================== 17:57:01.460905 | bff7e495-2ead-4bd3-b753-9941d1eb29b8 ==============================
[0m17:57:01.460905 [info ] [MainThread]: Running with dbt=1.10.17
[0m17:57:01.461194 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'write_json': 'True', 'debug': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'quiet': 'False', 'use_colors': 'True', 'introspect': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_format': 'default', 'log_cache_events': 'False', 'empty': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'warn_error': 'None', 'use_experimental_parser': 'False', 'fail_fast': 'False'}
[0m17:57:01.551944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b007880>]}
[0m17:57:01.577924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4c8c40>]}
[0m17:57:01.578425 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m17:57:01.629800 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m17:57:01.694528 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m17:57:01.694857 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m17:57:01.695020 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/contract.sql
[0m17:57:01.695196 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/department.sql
[0m17:57:01.805016 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m17:57:01.811993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c164130>]}
[0m17:57:01.868456 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m17:57:01.869534 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m17:57:01.878871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bff3dc0>]}
[0m17:57:01.879099 [info ] [MainThread]: Found 6 models, 1 source, 447 macros
[0m17:57:01.879254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b698610>]}
[0m17:57:01.879887 [info ] [MainThread]: 
[0m17:57:01.880046 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:57:01.880174 [info ] [MainThread]: 
[0m17:57:01.880394 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:57:01.882291 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m17:57:01.911283 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m17:57:01.911487 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m17:57:01.911620 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:57:01.943972 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.032 seconds
[0m17:57:01.944551 [debug] [ThreadPool]: On list_lucca_db: Close
[0m17:57:01.945794 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m17:57:01.945943 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m17:57:01.946055 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:01.954738 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m17:57:01.955203 [debug] [ThreadPool]: On list_lucca_db: Close
[0m17:57:01.955785 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m17:57:01.958698 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m17:57:01.958850 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m17:57:01.958969 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:01.967441 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m17:57:01.967566 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m17:57:01.967690 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m17:57:01.972157 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m17:57:01.972691 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m17:57:01.973139 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m17:57:01.973371 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m17:57:01.974450 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m17:57:01.974575 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m17:57:01.974686 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:01.982530 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m17:57:01.982655 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m17:57:01.982778 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m17:57:01.986090 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m17:57:01.986564 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m17:57:01.986964 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m17:57:01.989202 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:01.989348 [debug] [MainThread]: On master: BEGIN
[0m17:57:01.989464 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:57:01.997036 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m17:57:01.997160 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:01.997311 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m17:57:02.001568 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m17:57:02.002040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094ad3a0>]}
[0m17:57:02.002249 [debug] [MainThread]: On master: ROLLBACK
[0m17:57:02.002629 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:02.002756 [debug] [MainThread]: On master: BEGIN
[0m17:57:02.003360 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m17:57:02.003498 [debug] [MainThread]: On master: COMMIT
[0m17:57:02.003631 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:02.003746 [debug] [MainThread]: On master: COMMIT
[0m17:57:02.004125 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:57:02.004250 [debug] [MainThread]: On master: Close
[0m17:57:02.005957 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m17:57:02.006186 [info ] [Thread-1  ]: 1 of 6 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m17:57:02.006448 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m17:57:02.006599 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m17:57:02.010504 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.010810 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m17:57:02.027561 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.027988 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.028136 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m17:57:02.028271 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:57:02.037595 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m17:57:02.037757 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.037931 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m17:57:02.047490 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.009 seconds
[0m17:57:02.052490 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.052661 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m17:57:02.053587 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:57:02.054911 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.055062 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m17:57:02.055647 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:57:02.062615 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m17:57:02.062770 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.062904 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m17:57:02.064902 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m17:57:02.067372 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m17:57:02.069140 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m17:57:02.069291 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m17:57:02.072917 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:57:02.074000 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m17:57:02.075104 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8ddaf0>]}
[0m17:57:02.075392 [info ] [Thread-1  ]: 1 of 6 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m17:57:02.075649 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m17:57:02.076030 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m17:57:02.076295 [info ] [Thread-1  ]: 2 of 6 START sql table model public_base.contract .............................. [RUN]
[0m17:57:02.076525 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m17:57:02.076682 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m17:57:02.077995 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m17:57:02.078517 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m17:57:02.080172 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m17:57:02.080434 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m17:57:02.080566 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m17:57:02.080692 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:57:02.090254 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m17:57:02.090502 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m17:57:02.090670 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m17:57:02.095102 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m17:57:02.096889 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m17:57:02.097035 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m17:57:02.097835 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:57:02.099612 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m17:57:02.099748 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m17:57:02.100550 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:57:02.101148 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m17:57:02.101282 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m17:57:02.101408 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m17:57:02.102532 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:57:02.103525 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m17:57:02.103842 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m17:57:02.103973 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m17:57:02.106630 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:57:02.107123 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m17:57:02.107377 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c676a00>]}
[0m17:57:02.107647 [info ] [Thread-1  ]: 2 of 6 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m17:57:02.107892 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m17:57:02.108057 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m17:57:02.108296 [info ] [Thread-1  ]: 3 of 6 START sql table model public_transform.contract_extended ................ [RUN]
[0m17:57:02.108509 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m17:57:02.108662 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m17:57:02.110186 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m17:57:02.110510 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m17:57:02.112121 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m17:57:02.112412 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m17:57:02.112545 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m17:57:02.112671 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:57:02.120799 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m17:57:02.120993 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m17:57:02.121178 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m17:57:02.126873 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m17:57:02.128587 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m17:57:02.128781 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m17:57:02.129554 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:57:02.130983 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m17:57:02.131133 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m17:57:02.131744 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:57:02.132391 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m17:57:02.132537 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m17:57:02.132673 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m17:57:02.133907 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:57:02.135595 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m17:57:02.135910 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m17:57:02.136053 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m17:57:02.138782 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:57:02.139288 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m17:57:02.139545 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6cb610>]}
[0m17:57:02.139818 [info ] [Thread-1  ]: 3 of 6 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m17:57:02.140063 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m17:57:02.140226 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m17:57:02.140465 [info ] [Thread-1  ]: 4 of 6 START sql table model public_base.department ............................ [RUN]
[0m17:57:02.140678 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m17:57:02.140831 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m17:57:02.142257 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m17:57:02.142623 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m17:57:02.144274 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m17:57:02.144524 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m17:57:02.144658 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m17:57:02.144785 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:57:02.152663 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m17:57:02.152822 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m17:57:02.152957 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m17:57:02.156949 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m17:57:02.158547 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m17:57:02.158689 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m17:57:02.159381 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:57:02.160548 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m17:57:02.160682 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m17:57:02.161288 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:57:02.161904 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m17:57:02.162062 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m17:57:02.162209 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m17:57:02.163047 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:57:02.164089 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m17:57:02.164380 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m17:57:02.164508 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m17:57:02.166739 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m17:57:02.167213 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m17:57:02.167451 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1e8460>]}
[0m17:57:02.167704 [info ] [Thread-1  ]: 4 of 6 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m17:57:02.167951 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m17:57:02.168103 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m17:57:02.168326 [info ] [Thread-1  ]: 5 of 6 START sql table model public_base.employee .............................. [RUN]
[0m17:57:02.168559 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m17:57:02.168744 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m17:57:02.170105 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m17:57:02.170517 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m17:57:02.172848 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m17:57:02.173119 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m17:57:02.173254 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m17:57:02.173382 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:57:02.181507 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m17:57:02.181757 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m17:57:02.181926 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m17:57:02.186409 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m17:57:02.188179 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m17:57:02.188331 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m17:57:02.189129 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:57:02.190370 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m17:57:02.190509 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m17:57:02.191263 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:57:02.191863 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m17:57:02.191997 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m17:57:02.192123 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m17:57:02.193834 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m17:57:02.194880 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m17:57:02.195190 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m17:57:02.195400 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m17:57:02.198245 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:57:02.198812 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m17:57:02.199084 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c648a60>]}
[0m17:57:02.199366 [info ] [Thread-1  ]: 5 of 6 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m17:57:02.199610 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m17:57:02.199924 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m17:57:02.200148 [info ] [Thread-1  ]: 6 of 6 START sql table model public_transform.employee_extended ................ [RUN]
[0m17:57:02.200342 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m17:57:02.200487 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m17:57:02.202025 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m17:57:02.202493 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m17:57:02.204134 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m17:57:02.204406 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m17:57:02.204543 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m17:57:02.204671 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:57:02.212231 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m17:57:02.212388 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m17:57:02.212575 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN employee_id IN (
            SELECT DISTINCT manager_id::varchar 
            FROM "lucca_db"."public_base"."employee"
            WHERE manager_id IS NOT NULL
        )
        THEN TRUE
        ELSE FALSE
    END AS is_manager

    
from "lucca_db"."public_base"."employee"
  );
  
[0m17:57:02.216330 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m17:57:02.217967 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m17:57:02.218122 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m17:57:02.218639 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:57:02.220710 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m17:57:02.220912 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m17:57:02.221314 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:57:02.221978 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m17:57:02.222119 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m17:57:02.222246 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m17:57:02.223457 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:57:02.224555 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m17:57:02.224875 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m17:57:02.225023 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m17:57:02.227796 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:57:02.228373 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m17:57:02.228787 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bff7e495-2ead-4bd3-b753-9941d1eb29b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6ffaf0>]}
[0m17:57:02.229129 [info ] [Thread-1  ]: 6 of 6 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m17:57:02.229384 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m17:57:02.229929 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:02.230059 [debug] [MainThread]: On master: BEGIN
[0m17:57:02.230174 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:57:02.234872 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m17:57:02.235038 [debug] [MainThread]: On master: COMMIT
[0m17:57:02.235166 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:02.235278 [debug] [MainThread]: On master: COMMIT
[0m17:57:02.235518 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:57:02.235660 [debug] [MainThread]: On master: Close
[0m17:57:02.235849 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:57:02.235969 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m17:57:02.236136 [info ] [MainThread]: 
[0m17:57:02.236279 [info ] [MainThread]: Finished running 6 table models in 0 hours 0 minutes and 0.36 seconds (0.36s).
[0m17:57:02.236874 [debug] [MainThread]: Command end result
[0m17:57:02.247402 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m17:57:02.248309 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m17:57:02.251401 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m17:57:02.251550 [info ] [MainThread]: 
[0m17:57:02.251720 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:57:02.251854 [info ] [MainThread]: 
[0m17:57:02.251997 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m17:57:02.253733 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8338815, "process_in_blocks": "0", "process_kernel_time": 0.148235, "process_mem_max_rss": "131137536", "process_out_blocks": "0", "process_user_time": 1.098448}
[0m17:57:02.253925 [debug] [MainThread]: Command `dbt run` succeeded at 17:57:02.253885 after 0.83 seconds
[0m17:57:02.254167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f4ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bff3820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a211e20>]}
[0m17:57:02.254349 [debug] [MainThread]: Flushing usage events
[0m17:57:02.721109 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:41:50.463826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c479e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4f1f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4f1460>]}


============================== 12:41:50.466559 | 4def05cf-96ce-4b48-a366-07d7d63b768d ==============================
[0m12:41:50.466559 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:41:50.466826 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'indirect_selection': 'eager', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'fail_fast': 'False', 'empty': 'False', 'partial_parse': 'True', 'debug': 'False', 'version_check': 'True', 'write_json': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'use_colors': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'warn_error': 'None', 'invocation_command': 'dbt run --select department_extended.sql'}
[0m12:41:50.554600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4def05cf-96ce-4b48-a366-07d7d63b768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4c1970>]}
[0m12:41:50.579940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4def05cf-96ce-4b48-a366-07d7d63b768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd69ac0>]}
[0m12:41:50.580499 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:41:50.631178 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:41:50.694870 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:41:50.695176 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/transform/department_extended.sql
[0m12:41:50.798480 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m12:41:50.804967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4def05cf-96ce-4b48-a366-07d7d63b768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e673130>]}
[0m12:41:50.866778 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:41:50.867933 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:41:50.877467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4def05cf-96ce-4b48-a366-07d7d63b768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4f70a0>]}
[0m12:41:50.877692 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:41:50.877849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4def05cf-96ce-4b48-a366-07d7d63b768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc76f70>]}
[0m12:41:50.878466 [info ] [MainThread]: 
[0m12:41:50.878623 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:41:50.878750 [info ] [MainThread]: 
[0m12:41:50.878971 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:41:50.879333 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:41:50.906816 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:41:50.907025 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:41:50.907149 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:41:50.939713 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.033 seconds
[0m12:41:50.940371 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:41:50.942606 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m12:41:50.945295 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:41:50.945432 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:41:50.945548 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:41:50.951467 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m12:41:50.951609 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:41:50.951735 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:41:50.955116 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m12:41:50.955697 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:41:50.956003 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:41:50.956248 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m12:41:50.957787 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:41:50.957927 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:41:50.958046 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:41:50.962177 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:41:50.962325 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:41:50.962466 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:41:50.963705 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.001 seconds
[0m12:41:50.964300 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:41:50.964578 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:41:50.966891 [debug] [MainThread]: Using postgres connection "master"
[0m12:41:50.967040 [debug] [MainThread]: On master: BEGIN
[0m12:41:50.967150 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:41:50.971478 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m12:41:50.971614 [debug] [MainThread]: Using postgres connection "master"
[0m12:41:50.971758 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:41:50.974030 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m12:41:50.974467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4def05cf-96ce-4b48-a366-07d7d63b768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e514a90>]}
[0m12:41:50.974661 [debug] [MainThread]: On master: ROLLBACK
[0m12:41:50.974973 [debug] [MainThread]: Using postgres connection "master"
[0m12:41:50.975103 [debug] [MainThread]: On master: BEGIN
[0m12:41:50.975561 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:41:50.975682 [debug] [MainThread]: On master: COMMIT
[0m12:41:50.975792 [debug] [MainThread]: Using postgres connection "master"
[0m12:41:50.975900 [debug] [MainThread]: On master: COMMIT
[0m12:41:50.976179 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:41:50.976314 [debug] [MainThread]: On master: Close
[0m12:41:50.977540 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m12:41:50.977756 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.department_extended .............. [RUN]
[0m12:41:50.977955 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.department_extended)
[0m12:41:50.978111 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m12:41:50.981730 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m12:41:50.982051 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m12:41:50.997918 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m12:41:50.998275 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:41:50.998413 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m12:41:50.998542 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:41:51.005967 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:41:51.006182 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:41:51.006326 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    


select *,
    count(employee_id) OVER (PARTITION BY department_id) AS employee_count,
    count(manager_id) OVER (PARTITION BY department_id) AS manager_count

from "lucca_db"."public_base"."department"
  );
  
[0m12:41:51.007159 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "employee_id" does not exist
LINE 16:     count(employee_id) OVER (PARTITION BY department_id) AS ...
                   ^

[0m12:41:51.007305 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: ROLLBACK
[0m12:41:51.007779 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m12:41:51.019358 [debug] [Thread-1  ]: Database Error in model department_extended (models/models/transform/department_extended.sql)
  column "employee_id" does not exist
  LINE 16:     count(employee_id) OVER (PARTITION BY department_id) AS ...
                     ^
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql
[0m12:41:51.020412 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4def05cf-96ce-4b48-a366-07d7d63b768d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaad880>]}
[0m12:41:51.020705 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_transform.department_extended ..... [[31mERROR[0m in 0.04s]
[0m12:41:51.020961 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m12:41:51.021201 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.department_extended' to be skipped because of status 'error'.  Reason: Database Error in model department_extended (models/models/transform/department_extended.sql)
  column "employee_id" does not exist
  LINE 16:     count(employee_id) OVER (PARTITION BY department_id) AS ...
                     ^
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql.
[0m12:41:51.021696 [debug] [MainThread]: Using postgres connection "master"
[0m12:41:51.021833 [debug] [MainThread]: On master: BEGIN
[0m12:41:51.021942 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:41:51.030177 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:41:51.030302 [debug] [MainThread]: On master: COMMIT
[0m12:41:51.030416 [debug] [MainThread]: Using postgres connection "master"
[0m12:41:51.030541 [debug] [MainThread]: On master: COMMIT
[0m12:41:51.030912 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:41:51.031029 [debug] [MainThread]: On master: Close
[0m12:41:51.031197 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:41:51.031317 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m12:41:51.031450 [info ] [MainThread]: 
[0m12:41:51.031589 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.15 seconds (0.15s).
[0m12:41:51.031881 [debug] [MainThread]: Command end result
[0m12:41:51.042276 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:41:51.043086 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:41:51.046084 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:41:51.046233 [info ] [MainThread]: 
[0m12:41:51.046404 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:41:51.046548 [info ] [MainThread]: 
[0m12:41:51.046714 [error] [MainThread]: [31mFailure in model department_extended (models/models/transform/department_extended.sql)[0m
[0m12:41:51.046873 [error] [MainThread]:   Database Error in model department_extended (models/models/transform/department_extended.sql)
  column "employee_id" does not exist
  LINE 16:     count(employee_id) OVER (PARTITION BY department_id) AS ...
                     ^
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql
[0m12:41:51.047004 [info ] [MainThread]: 
[0m12:41:51.047154 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/department_extended.sql
[0m12:41:51.047334 [info ] [MainThread]: 
[0m12:41:51.047490 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m12:41:51.049833 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.62375915, "process_in_blocks": "0", "process_kernel_time": 0.146166, "process_mem_max_rss": "129859584", "process_out_blocks": "0", "process_user_time": 0.979565}
[0m12:41:51.050072 [debug] [MainThread]: Command `dbt run` failed at 12:41:51.050033 after 0.62 seconds
[0m12:41:51.050260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c479e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4a0ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd69ac0>]}
[0m12:41:51.050442 [debug] [MainThread]: Flushing usage events
[0m12:41:52.456343 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:46:56.326954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0a1e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d119070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d119610>]}


============================== 12:46:56.329493 | d34b076d-70cf-4275-bde8-5976a410805b ==============================
[0m12:46:56.329493 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:46:56.329768 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run --select department_extended.sql', 'use_colors': 'True', 'printer_width': '80', 'write_json': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'introspect': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'quiet': 'False', 'no_print': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'log_cache_events': 'False', 'partial_parse': 'True', 'debug': 'False', 'target_path': 'None', 'cache_selected_only': 'False'}
[0m12:46:56.423091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd34b076d-70cf-4275-bde8-5976a410805b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d81e040>]}
[0m12:46:56.448614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd34b076d-70cf-4275-bde8-5976a410805b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb59c70>]}
[0m12:46:56.449231 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:46:56.500842 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:46:56.566105 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:46:56.566411 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/department_extended.sql
[0m12:46:56.669300 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.base
- models.lucca_dbt.transform
[0m12:46:56.675710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd34b076d-70cf-4275-bde8-5976a410805b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e29b130>]}
[0m12:46:56.734119 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:46:56.735259 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:46:56.744577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd34b076d-70cf-4275-bde8-5976a410805b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e139490>]}
[0m12:46:56.744792 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:46:56.744942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd34b076d-70cf-4275-bde8-5976a410805b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8713d0>]}
[0m12:46:56.745528 [info ] [MainThread]: 
[0m12:46:56.745680 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:46:56.745806 [info ] [MainThread]: 
[0m12:46:56.746018 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:46:56.746386 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:46:56.774794 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:46:56.775028 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:46:56.775166 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:46:56.806850 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.032 seconds
[0m12:46:56.807498 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:46:56.809665 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m12:46:56.812319 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:46:56.812452 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:46:56.812566 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:46:56.820330 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m12:46:56.820454 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:46:56.820573 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:46:56.823853 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m12:46:56.824345 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:46:56.824757 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:46:56.824950 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m12:46:56.826304 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:46:56.826432 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:46:56.826540 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:46:56.834038 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m12:46:56.834177 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:46:56.834323 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:46:56.837733 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m12:46:56.838220 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:46:56.838668 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:46:56.840736 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.840927 [debug] [MainThread]: On master: BEGIN
[0m12:46:56.841068 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:46:56.848507 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:46:56.848634 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.848783 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:46:56.852192 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m12:46:56.852620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd34b076d-70cf-4275-bde8-5976a410805b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e128190>]}
[0m12:46:56.852813 [debug] [MainThread]: On master: ROLLBACK
[0m12:46:56.853227 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.853347 [debug] [MainThread]: On master: BEGIN
[0m12:46:56.853972 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:46:56.854094 [debug] [MainThread]: On master: COMMIT
[0m12:46:56.854213 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.854326 [debug] [MainThread]: On master: COMMIT
[0m12:46:56.854699 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:46:56.854820 [debug] [MainThread]: On master: Close
[0m12:46:56.856080 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m12:46:56.856297 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.department_extended .............. [RUN]
[0m12:46:56.856488 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.department_extended)
[0m12:46:56.856643 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m12:46:56.860643 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m12:46:56.861070 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m12:46:56.878148 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m12:46:56.878525 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:46:56.878669 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m12:46:56.878800 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:46:56.887444 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m12:46:56.887618 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:46:56.887800 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.*,
    count(e.employee_id) over (partition by d.department_id) as employee_count,
    count(e.manager_id)  over (partition by d.department_id) as manager_count

from "lucca_db"."public_base"."department" d
inner join "lucca_db"."public_base"."employee" e
    on d.department_id = e.department_id
  );
  
[0m12:46:56.888619 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column e.department_id does not exist
LINE 21:     on d.department_id = e.department_id
                                  ^
HINT:  Perhaps you meant to reference the column "d.department_id".

[0m12:46:56.888782 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: ROLLBACK
[0m12:46:56.889234 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m12:46:56.900141 [debug] [Thread-1  ]: Database Error in model department_extended (models/models/transform/department_extended.sql)
  column e.department_id does not exist
  LINE 21:     on d.department_id = e.department_id
                                    ^
  HINT:  Perhaps you meant to reference the column "d.department_id".
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql
[0m12:46:56.901180 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd34b076d-70cf-4275-bde8-5976a410805b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb3f8b0>]}
[0m12:46:56.901527 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_transform.department_extended ..... [[31mERROR[0m in 0.04s]
[0m12:46:56.901798 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m12:46:56.902039 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.department_extended' to be skipped because of status 'error'.  Reason: Database Error in model department_extended (models/models/transform/department_extended.sql)
  column e.department_id does not exist
  LINE 21:     on d.department_id = e.department_id
                                    ^
  HINT:  Perhaps you meant to reference the column "d.department_id".
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql.
[0m12:46:56.902518 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.902662 [debug] [MainThread]: On master: BEGIN
[0m12:46:56.902774 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:46:56.911013 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:46:56.911190 [debug] [MainThread]: On master: COMMIT
[0m12:46:56.911313 [debug] [MainThread]: Using postgres connection "master"
[0m12:46:56.911425 [debug] [MainThread]: On master: COMMIT
[0m12:46:56.911900 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:46:56.912026 [debug] [MainThread]: On master: Close
[0m12:46:56.912181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:46:56.912288 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m12:46:56.912405 [info ] [MainThread]: 
[0m12:46:56.912544 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m12:46:56.912835 [debug] [MainThread]: Command end result
[0m12:46:56.922788 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:46:56.923512 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:46:56.926976 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:46:56.927149 [info ] [MainThread]: 
[0m12:46:56.927331 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:46:56.927473 [info ] [MainThread]: 
[0m12:46:56.927643 [error] [MainThread]: [31mFailure in model department_extended (models/models/transform/department_extended.sql)[0m
[0m12:46:56.927807 [error] [MainThread]:   Database Error in model department_extended (models/models/transform/department_extended.sql)
  column e.department_id does not exist
  LINE 21:     on d.department_id = e.department_id
                                    ^
  HINT:  Perhaps you meant to reference the column "d.department_id".
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql
[0m12:46:56.927938 [info ] [MainThread]: 
[0m12:46:56.928088 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/department_extended.sql
[0m12:46:56.928217 [info ] [MainThread]: 
[0m12:46:56.928361 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m12:46:56.929696 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6375577, "process_in_blocks": "0", "process_kernel_time": 0.149494, "process_mem_max_rss": "129679360", "process_out_blocks": "0", "process_user_time": 0.985394}
[0m12:46:56.929878 [debug] [MainThread]: Command `dbt run` failed at 12:46:56.929841 after 0.64 seconds
[0m12:46:56.930047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0a1e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d621d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e139d60>]}
[0m12:46:56.930202 [debug] [MainThread]: Flushing usage events
[0m12:46:57.828235 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:47:58.389940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c816e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d88c070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d88c610>]}


============================== 12:47:58.392177 | fc96def9-3096-4f2d-b52d-a8e191cf2373 ==============================
[0m12:47:58.392177 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:47:58.392437 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --select department_extended.sql', 'debug': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'static_parser': 'True', 'use_colors': 'True', 'empty': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_path': '/Users/marccao/repo/dbt/logs', 'write_json': 'True', 'log_format': 'default'}
[0m12:47:58.479989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc96def9-3096-4f2d-b52d-a8e191cf2373', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df92040>]}
[0m12:47:58.505820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc96def9-3096-4f2d-b52d-a8e191cf2373', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2cdc70>]}
[0m12:47:58.506584 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:47:58.560962 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:47:58.624994 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:47:58.625230 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:47:58.628035 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m12:47:58.662649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc96def9-3096-4f2d-b52d-a8e191cf2373', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8c9130>]}
[0m12:47:58.701756 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:47:58.702933 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:47:58.711980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc96def9-3096-4f2d-b52d-a8e191cf2373', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8efaf0>]}
[0m12:47:58.712225 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:47:58.712379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc96def9-3096-4f2d-b52d-a8e191cf2373', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8b8130>]}
[0m12:47:58.712984 [info ] [MainThread]: 
[0m12:47:58.713146 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:47:58.713272 [info ] [MainThread]: 
[0m12:47:58.713498 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:47:58.713892 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:47:58.763924 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:47:58.764165 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:47:58.764315 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:47:58.797800 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.033 seconds
[0m12:47:58.798600 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:47:58.800944 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m12:47:58.803833 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:47:58.803979 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:47:58.804095 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:47:58.813333 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m12:47:58.813523 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:47:58.813664 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:47:58.817735 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m12:47:58.818386 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:47:58.818821 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:47:58.819078 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m12:47:58.820827 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:47:58.820970 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:47:58.821083 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:47:58.828996 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m12:47:58.829125 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:47:58.829250 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:47:58.832400 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m12:47:58.832965 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:47:58.833402 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:47:58.836088 [debug] [MainThread]: Using postgres connection "master"
[0m12:47:58.836344 [debug] [MainThread]: On master: BEGIN
[0m12:47:58.836544 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:47:58.844874 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:47:58.845034 [debug] [MainThread]: Using postgres connection "master"
[0m12:47:58.845198 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:47:58.848827 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m12:47:58.849340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc96def9-3096-4f2d-b52d-a8e191cf2373', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0d1ac0>]}
[0m12:47:58.849547 [debug] [MainThread]: On master: ROLLBACK
[0m12:47:58.850099 [debug] [MainThread]: Using postgres connection "master"
[0m12:47:58.850223 [debug] [MainThread]: On master: BEGIN
[0m12:47:58.851017 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:47:58.851148 [debug] [MainThread]: On master: COMMIT
[0m12:47:58.851278 [debug] [MainThread]: Using postgres connection "master"
[0m12:47:58.851389 [debug] [MainThread]: On master: COMMIT
[0m12:47:58.851787 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:47:58.851919 [debug] [MainThread]: On master: Close
[0m12:47:58.853845 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m12:47:58.854095 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.department_extended .............. [RUN]
[0m12:47:58.854318 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.department_extended)
[0m12:47:58.854473 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m12:47:58.858412 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m12:47:58.858726 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m12:47:58.875502 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m12:47:58.875960 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:47:58.876125 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m12:47:58.876293 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:47:58.885211 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m12:47:58.885534 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:47:58.885702 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.*,
    count(e.employee_id) over (partition by d.department_id) as employee_count,
    count(e.manager_id)  over (partition by d.department_id) as manager_count

from "lucca_db"."public_base"."department" d
inner join "lucca_db"."public_base"."employee" e
    on d.department_id = e.department_id
  );
  
[0m12:47:58.886564 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column e.department_id does not exist
LINE 21:     on d.department_id = e.department_id
                                  ^
HINT:  Perhaps you meant to reference the column "d.department_id".

[0m12:47:58.886717 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: ROLLBACK
[0m12:47:58.887227 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m12:47:58.898664 [debug] [Thread-1  ]: Database Error in model department_extended (models/models/transform/department_extended.sql)
  column e.department_id does not exist
  LINE 21:     on d.department_id = e.department_id
                                    ^
  HINT:  Perhaps you meant to reference the column "d.department_id".
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql
[0m12:47:58.899595 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc96def9-3096-4f2d-b52d-a8e191cf2373', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed9f7f0>]}
[0m12:47:58.899873 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model public_transform.department_extended ..... [[31mERROR[0m in 0.04s]
[0m12:47:58.900120 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m12:47:58.900367 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.department_extended' to be skipped because of status 'error'.  Reason: Database Error in model department_extended (models/models/transform/department_extended.sql)
  column e.department_id does not exist
  LINE 21:     on d.department_id = e.department_id
                                    ^
  HINT:  Perhaps you meant to reference the column "d.department_id".
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql.
[0m12:47:58.900960 [debug] [MainThread]: Using postgres connection "master"
[0m12:47:58.901128 [debug] [MainThread]: On master: BEGIN
[0m12:47:58.901262 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:47:58.910723 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m12:47:58.910861 [debug] [MainThread]: On master: COMMIT
[0m12:47:58.910980 [debug] [MainThread]: Using postgres connection "master"
[0m12:47:58.911091 [debug] [MainThread]: On master: COMMIT
[0m12:47:58.911517 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:47:58.911642 [debug] [MainThread]: On master: Close
[0m12:47:58.911801 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:47:58.911911 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m12:47:58.912033 [info ] [MainThread]: 
[0m12:47:58.912172 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m12:47:58.912474 [debug] [MainThread]: Command end result
[0m12:47:58.922843 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:47:58.923889 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:47:58.927392 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:47:58.927546 [info ] [MainThread]: 
[0m12:47:58.927714 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:47:58.927855 [info ] [MainThread]: 
[0m12:47:58.928019 [error] [MainThread]: [31mFailure in model department_extended (models/models/transform/department_extended.sql)[0m
[0m12:47:58.928180 [error] [MainThread]:   Database Error in model department_extended (models/models/transform/department_extended.sql)
  column e.department_id does not exist
  LINE 21:     on d.department_id = e.department_id
                                    ^
  HINT:  Perhaps you meant to reference the column "d.department_id".
  compiled code at target/run/lucca_dbt/models/models/transform/department_extended.sql
[0m12:47:58.928311 [info ] [MainThread]: 
[0m12:47:58.928459 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/department_extended.sql
[0m12:47:58.928582 [info ] [MainThread]: 
[0m12:47:58.928723 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m12:47:58.930198 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.57436055, "process_in_blocks": "0", "process_kernel_time": 0.152894, "process_mem_max_rss": "125992960", "process_out_blocks": "0", "process_user_time": 0.939988}
[0m12:47:58.930417 [debug] [MainThread]: Command `dbt run` failed at 12:47:58.930375 after 0.57 seconds
[0m12:47:58.930587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c816e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dfd9910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7ef9d0>]}
[0m12:47:58.930750 [debug] [MainThread]: Flushing usage events
[0m12:47:59.345977 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:48:29.821269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c40eeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d485f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d485490>]}


============================== 12:48:29.823605 | f6b7e899-cf84-40c2-a0db-c8894490bd25 ==============================
[0m12:48:29.823605 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:48:29.823861 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'invocation_command': 'dbt run --select department_extended.sql', 'printer_width': '80', 'static_parser': 'True', 'partial_parse': 'True', 'debug': 'False', 'no_print': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'empty': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'log_format': 'default', 'version_check': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'write_json': 'True'}
[0m12:48:29.910362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f6b7e899-cf84-40c2-a0db-c8894490bd25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adb57f0>]}
[0m12:48:29.934890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f6b7e899-cf84-40c2-a0db-c8894490bd25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d470e20>]}
[0m12:48:29.935489 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:48:29.984562 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:48:30.046979 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:48:30.047284 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/department_extended.sql
[0m12:48:30.149790 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m12:48:30.156432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6b7e899-cf84-40c2-a0db-c8894490bd25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6229d0>]}
[0m12:48:30.213854 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:48:30.214995 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:48:30.225075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6b7e899-cf84-40c2-a0db-c8894490bd25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d45b280>]}
[0m12:48:30.225292 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:48:30.225445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6b7e899-cf84-40c2-a0db-c8894490bd25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac1e0d0>]}
[0m12:48:30.226054 [info ] [MainThread]: 
[0m12:48:30.226208 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:48:30.226336 [info ] [MainThread]: 
[0m12:48:30.226551 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:48:30.226935 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:48:30.254760 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:48:30.254983 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:48:30.255114 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:48:30.287039 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.032 seconds
[0m12:48:30.287647 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:48:30.289932 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m12:48:30.292622 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:48:30.292760 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:48:30.292880 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:48:30.297361 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:48:30.297538 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:48:30.297679 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:48:30.299383 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.002 seconds
[0m12:48:30.300272 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:48:30.300688 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:48:30.300985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m12:48:30.302602 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:48:30.302730 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:48:30.302839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:48:30.306956 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:48:30.307128 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:48:30.307278 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:48:30.309074 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m12:48:30.309640 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:48:30.309934 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:48:30.312267 [debug] [MainThread]: Using postgres connection "master"
[0m12:48:30.312436 [debug] [MainThread]: On master: BEGIN
[0m12:48:30.312562 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:48:30.316771 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m12:48:30.316936 [debug] [MainThread]: Using postgres connection "master"
[0m12:48:30.317081 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:48:30.318676 [debug] [MainThread]: SQL status: SELECT 0 in 0.001 seconds
[0m12:48:30.319153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6b7e899-cf84-40c2-a0db-c8894490bd25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4bb460>]}
[0m12:48:30.319353 [debug] [MainThread]: On master: ROLLBACK
[0m12:48:30.319669 [debug] [MainThread]: Using postgres connection "master"
[0m12:48:30.319784 [debug] [MainThread]: On master: BEGIN
[0m12:48:30.320223 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:48:30.320341 [debug] [MainThread]: On master: COMMIT
[0m12:48:30.320453 [debug] [MainThread]: Using postgres connection "master"
[0m12:48:30.320557 [debug] [MainThread]: On master: COMMIT
[0m12:48:30.320817 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:48:30.320943 [debug] [MainThread]: On master: Close
[0m12:48:30.322269 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m12:48:30.322498 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.department_extended .............. [RUN]
[0m12:48:30.322706 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.department_extended)
[0m12:48:30.322850 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m12:48:30.326482 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m12:48:30.326787 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m12:48:30.343403 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m12:48:30.343808 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:48:30.343959 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m12:48:30.344089 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:48:30.348457 [debug] [Thread-1  ]: SQL status: BEGIN in 0.004 seconds
[0m12:48:30.348627 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:48:30.348767 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.*,
    count(e.employee_id) over (partition by d.department_id) as employee_count,
    count(e.manager_id)  over (partition by d.department_id) as manager_count

from "lucca_db"."public_base"."department" d
inner join "lucca_db"."public_base"."employee" e
    on d.company_id = e.company_id
  );
  
[0m12:48:30.353576 [debug] [Thread-1  ]: SQL status: SELECT 960 in 0.005 seconds
[0m12:48:30.357806 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:48:30.357966 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m12:48:30.358343 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:48:30.364121 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:48:30.364271 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:48:30.364407 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:48:30.365209 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:48:30.368421 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m12:48:30.370173 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:48:30.370317 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m12:48:30.370701 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m12:48:30.371812 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m12:48:30.373081 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6b7e899-cf84-40c2-a0db-c8894490bd25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad966d0>]}
[0m12:48:30.373390 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_transform.department_extended ......... [[32mSELECT 960[0m in 0.05s]
[0m12:48:30.373644 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m12:48:30.374116 [debug] [MainThread]: Using postgres connection "master"
[0m12:48:30.374263 [debug] [MainThread]: On master: BEGIN
[0m12:48:30.374380 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:48:30.378761 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m12:48:30.378966 [debug] [MainThread]: On master: COMMIT
[0m12:48:30.379117 [debug] [MainThread]: Using postgres connection "master"
[0m12:48:30.379240 [debug] [MainThread]: On master: COMMIT
[0m12:48:30.379501 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:48:30.379620 [debug] [MainThread]: On master: Close
[0m12:48:30.379786 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:48:30.379913 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m12:48:30.380034 [info ] [MainThread]: 
[0m12:48:30.380188 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.15 seconds (0.15s).
[0m12:48:30.380468 [debug] [MainThread]: Command end result
[0m12:48:30.390083 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:48:30.390855 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:48:30.394438 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:48:30.394601 [info ] [MainThread]: 
[0m12:48:30.394782 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:48:30.394918 [info ] [MainThread]: 
[0m12:48:30.395063 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:48:30.396428 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6079354, "process_in_blocks": "0", "process_kernel_time": 0.144297, "process_mem_max_rss": "130023424", "process_out_blocks": "0", "process_user_time": 0.987543}
[0m12:48:30.396594 [debug] [MainThread]: Command `dbt run` succeeded at 12:48:30.396560 after 0.61 seconds
[0m12:48:30.396756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c40eeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aee0580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aee06d0>]}
[0m12:48:30.396928 [debug] [MainThread]: Flushing usage events
[0m12:48:31.439583 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:49:05.261342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084dae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109551dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109551310>]}


============================== 12:49:05.263659 | dce6064c-d80a-4287-937e-549ec0018557 ==============================
[0m12:49:05.263659 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:49:05.263911 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run --select department_extended.sql', 'warn_error': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'printer_width': '80', 'quiet': 'False', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'debug': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'version_check': 'True', 'use_colors': 'True', 'no_print': 'None', 'target_path': 'None', 'fail_fast': 'False', 'log_format': 'default', 'write_json': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'log_path': '/Users/marccao/repo/dbt/logs'}
[0m12:49:05.353793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dce6064c-d80a-4287-937e-549ec0018557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e81190>]}
[0m12:49:05.378816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dce6064c-d80a-4287-937e-549ec0018557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092e1c10>]}
[0m12:49:05.379430 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:49:05.429790 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:49:05.497030 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:49:05.497348 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/department_extended.sql
[0m12:49:05.601123 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m12:49:05.607793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dce6064c-d80a-4287-937e-549ec0018557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6f1130>]}
[0m12:49:05.664398 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:49:05.665657 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:49:05.675087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dce6064c-d80a-4287-937e-549ec0018557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5909a0>]}
[0m12:49:05.675302 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:49:05.675455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dce6064c-d80a-4287-937e-549ec0018557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cf03d0>]}
[0m12:49:05.676053 [info ] [MainThread]: 
[0m12:49:05.676208 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:49:05.676337 [info ] [MainThread]: 
[0m12:49:05.676554 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:49:05.676910 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:49:05.705423 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:49:05.705632 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:49:05.705752 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:49:05.738146 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.032 seconds
[0m12:49:05.738781 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:49:05.741005 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m12:49:05.743616 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:49:05.743754 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:49:05.743867 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:49:05.752312 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m12:49:05.752435 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:49:05.752560 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:49:05.756821 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m12:49:05.757307 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:49:05.757734 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:49:05.757938 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m12:49:05.759296 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:49:05.759430 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:49:05.759542 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:49:05.766115 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m12:49:05.766230 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:49:05.766349 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:49:05.769383 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m12:49:05.769839 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:49:05.770228 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:49:05.772379 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:05.772515 [debug] [MainThread]: On master: BEGIN
[0m12:49:05.772628 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:49:05.778876 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m12:49:05.778999 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:05.779151 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:49:05.782587 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m12:49:05.782994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dce6064c-d80a-4287-937e-549ec0018557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107292160>]}
[0m12:49:05.783188 [debug] [MainThread]: On master: ROLLBACK
[0m12:49:05.783590 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:05.783708 [debug] [MainThread]: On master: BEGIN
[0m12:49:05.784351 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:49:05.784479 [debug] [MainThread]: On master: COMMIT
[0m12:49:05.784598 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:05.784712 [debug] [MainThread]: On master: COMMIT
[0m12:49:05.785078 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:49:05.785202 [debug] [MainThread]: On master: Close
[0m12:49:05.787923 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m12:49:05.788160 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.department_extended .............. [RUN]
[0m12:49:05.788376 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.department_extended)
[0m12:49:05.788531 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m12:49:05.792354 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m12:49:05.792807 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m12:49:05.809104 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m12:49:05.809752 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:49:05.809912 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m12:49:05.810046 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:05.819411 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m12:49:05.819576 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:49:05.819721 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select distinct
    d.*,
    count(e.employee_id) over (partition by d.department_id) as employee_count,
    count(e.manager_id)  over (partition by d.department_id) as manager_count

from "lucca_db"."public_base"."department" d
inner join "lucca_db"."public_base"."employee" e
    on d.company_id = e.company_id
  );
  
[0m12:49:05.825228 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m12:49:05.829287 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:49:05.829436 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m12:49:05.830070 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:05.831278 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:49:05.831420 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m12:49:05.831952 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:05.839030 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:49:05.839195 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:49:05.839331 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:49:05.840419 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:49:05.842826 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m12:49:05.844576 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:49:05.844734 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m12:49:05.847671 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m12:49:05.848676 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m12:49:05.849674 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dce6064c-d80a-4287-937e-549ec0018557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa55580>]}
[0m12:49:05.849945 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.06s]
[0m12:49:05.850186 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m12:49:05.850647 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:05.850780 [debug] [MainThread]: On master: BEGIN
[0m12:49:05.850892 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:49:05.857203 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m12:49:05.857337 [debug] [MainThread]: On master: COMMIT
[0m12:49:05.857453 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:05.857561 [debug] [MainThread]: On master: COMMIT
[0m12:49:05.857911 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:49:05.858041 [debug] [MainThread]: On master: Close
[0m12:49:05.858199 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:49:05.858305 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m12:49:05.858434 [info ] [MainThread]: 
[0m12:49:05.858569 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m12:49:05.858829 [debug] [MainThread]: Command end result
[0m12:49:05.869126 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:49:05.869920 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:49:05.873137 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:49:05.873290 [info ] [MainThread]: 
[0m12:49:05.873472 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:49:05.873670 [info ] [MainThread]: 
[0m12:49:05.873873 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:49:05.875380 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6483774, "process_in_blocks": "0", "process_kernel_time": 0.144208, "process_mem_max_rss": "130007040", "process_out_blocks": "0", "process_user_time": 0.994949}
[0m12:49:05.875544 [debug] [MainThread]: Command `dbt run` succeeded at 12:49:05.875511 after 0.65 seconds
[0m12:49:05.875700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084dae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092e1c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5909a0>]}
[0m12:49:05.875856 [debug] [MainThread]: Flushing usage events
[0m12:49:07.076669 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:51:52.090060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6f2e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b768070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b768610>]}


============================== 12:51:52.092440 | cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1 ==============================
[0m12:51:52.092440 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:51:52.092749 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'no_print': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'target_path': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'write_json': 'True', 'debug': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error': 'None', 'use_colors': 'True', 'invocation_command': 'dbt run --select employee.sql', 'fail_fast': 'False', 'static_parser': 'True', 'version_check': 'True', 'quiet': 'False'}
[0m12:51:52.186419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be6e040>]}
[0m12:51:52.212441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1a9c70>]}
[0m12:51:52.213118 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:51:52.264566 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:51:52.330136 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m12:51:52.330441 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/department_extended.sql
[0m12:51:52.330610 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/employee.sql
[0m12:51:52.435159 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m12:51:52.442407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c93bfd0>]}
[0m12:51:52.500065 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:51:52.501175 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:51:52.510730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc71b50>]}
[0m12:51:52.510946 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:51:52.511092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8b2be0>]}
[0m12:51:52.511686 [info ] [MainThread]: 
[0m12:51:52.511838 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:51:52.511963 [info ] [MainThread]: 
[0m12:51:52.512182 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:51:52.512541 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:51:52.540551 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:51:52.540758 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:51:52.540881 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:51:52.575808 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.035 seconds
[0m12:51:52.576423 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:51:52.578649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m12:51:52.581476 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:51:52.581609 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:51:52.581722 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:51:52.591228 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m12:51:52.591384 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:51:52.591520 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:51:52.595067 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m12:51:52.595577 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:51:52.595985 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:51:52.596203 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m12:51:52.597334 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:51:52.597454 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:51:52.597560 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:51:52.605591 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m12:51:52.605717 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:51:52.605847 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:51:52.609094 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m12:51:52.609588 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:51:52.609958 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:51:52.612132 [debug] [MainThread]: Using postgres connection "master"
[0m12:51:52.612278 [debug] [MainThread]: On master: BEGIN
[0m12:51:52.612396 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:51:52.619903 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:51:52.620033 [debug] [MainThread]: Using postgres connection "master"
[0m12:51:52.620184 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:51:52.624452 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m12:51:52.624900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c85da60>]}
[0m12:51:52.625097 [debug] [MainThread]: On master: ROLLBACK
[0m12:51:52.625493 [debug] [MainThread]: Using postgres connection "master"
[0m12:51:52.625625 [debug] [MainThread]: On master: BEGIN
[0m12:51:52.626194 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:51:52.626326 [debug] [MainThread]: On master: COMMIT
[0m12:51:52.626448 [debug] [MainThread]: Using postgres connection "master"
[0m12:51:52.626565 [debug] [MainThread]: On master: COMMIT
[0m12:51:52.626945 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:51:52.627073 [debug] [MainThread]: On master: Close
[0m12:51:52.628179 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m12:51:52.628396 [info ] [Thread-1  ]: 1 of 1 START sql table model public_base.employee .............................. [RUN]
[0m12:51:52.628595 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.employee)
[0m12:51:52.628748 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m12:51:52.632506 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m12:51:52.632973 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m12:51:52.649724 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m12:51:52.650101 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:51:52.650246 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m12:51:52.650375 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:51:52.659079 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m12:51:52.659329 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:51:52.659502 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m12:51:52.664537 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m12:51:52.669380 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:51:52.669590 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m12:51:52.670642 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:51:52.671950 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:51:52.672099 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m12:51:52.672688 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:51:52.679474 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m12:51:52.679624 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:51:52.679754 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m12:51:52.681709 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:51:52.684112 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m12:51:52.685849 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:51:52.685987 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m12:51:52.689946 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m12:51:52.690947 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m12:51:52.691962 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4b8f1e-b15e-4f28-9df0-14e55d77c5c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ccb5850>]}
[0m12:51:52.692289 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.06s]
[0m12:51:52.692544 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m12:51:52.692980 [debug] [MainThread]: Using postgres connection "master"
[0m12:51:52.693101 [debug] [MainThread]: On master: BEGIN
[0m12:51:52.693209 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:51:52.701068 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:51:52.701258 [debug] [MainThread]: On master: COMMIT
[0m12:51:52.701382 [debug] [MainThread]: Using postgres connection "master"
[0m12:51:52.701495 [debug] [MainThread]: On master: COMMIT
[0m12:51:52.702011 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:51:52.702139 [debug] [MainThread]: On master: Close
[0m12:51:52.702304 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:51:52.702415 [debug] [MainThread]: Connection 'model.lucca_dbt.employee' was properly closed.
[0m12:51:52.702536 [info ] [MainThread]: 
[0m12:51:52.702677 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m12:51:52.702943 [debug] [MainThread]: Command end result
[0m12:51:52.713494 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:51:52.714272 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:51:52.717302 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:51:52.717431 [info ] [MainThread]: 
[0m12:51:52.717606 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:51:52.717739 [info ] [MainThread]: 
[0m12:51:52.717884 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:51:52.719181 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6628162, "process_in_blocks": "0", "process_kernel_time": 0.144932, "process_mem_max_rss": "129630208", "process_out_blocks": "0", "process_user_time": 1.003173}
[0m12:51:52.719342 [debug] [MainThread]: Command `dbt run` succeeded at 12:51:52.719310 after 0.66 seconds
[0m12:51:52.719500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6f2e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c879ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8e5e80>]}
[0m12:51:52.719651 [debug] [MainThread]: Flushing usage events
[0m12:51:54.752861 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:57:56.869000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108426d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10949cd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10949c250>]}


============================== 12:57:56.871201 | 3cde75e5-0434-45b4-baf3-a7ffdf964b90 ==============================
[0m12:57:56.871201 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:57:56.871466 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'use_colors': 'True', 'version_check': 'True', 'partial_parse': 'True', 'target_path': 'None', 'empty': 'False', 'static_parser': 'True', 'printer_width': '80', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'log_format': 'default', 'quiet': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'warn_error': 'None', 'invocation_command': 'dbt run --select department_extended.sql'}
[0m12:57:56.948233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3cde75e5-0434-45b4-baf3-a7ffdf964b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10999d820>]}
[0m12:57:56.973899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3cde75e5-0434-45b4-baf3-a7ffdf964b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ba36d0>]}
[0m12:57:56.974364 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:57:57.022167 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:57:57.083562 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:57:57.083784 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:57:57.086691 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m12:57:57.102619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3cde75e5-0434-45b4-baf3-a7ffdf964b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4b9130>]}
[0m12:57:57.141136 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:57:57.141997 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:57:57.151037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3cde75e5-0434-45b4-baf3-a7ffdf964b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2e7310>]}
[0m12:57:57.151257 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:57:57.151413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3cde75e5-0434-45b4-baf3-a7ffdf964b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4a1820>]}
[0m12:57:57.151999 [info ] [MainThread]: 
[0m12:57:57.152152 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:57:57.152285 [info ] [MainThread]: 
[0m12:57:57.152510 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:57:57.152909 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:57:57.199839 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:57:57.200054 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:57:57.200181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:57:57.220036 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.020 seconds
[0m12:57:57.220705 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:57:57.223034 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m12:57:57.226239 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:57:57.226426 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:57:57.226555 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:57:57.234529 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m12:57:57.234713 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:57:57.234841 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:57:57.237772 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m12:57:57.238323 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:57:57.238829 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:57:57.239075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m12:57:57.240677 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:57:57.240799 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:57:57.240907 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:57:57.247923 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m12:57:57.248068 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:57:57.248189 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:57:57.251522 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m12:57:57.252047 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:57:57.252438 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:57:57.254658 [debug] [MainThread]: Using postgres connection "master"
[0m12:57:57.254800 [debug] [MainThread]: On master: BEGIN
[0m12:57:57.254914 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:57:57.262214 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:57:57.262360 [debug] [MainThread]: Using postgres connection "master"
[0m12:57:57.262513 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:57:57.265167 [debug] [MainThread]: SQL status: SELECT 0 in 0.002 seconds
[0m12:57:57.265687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3cde75e5-0434-45b4-baf3-a7ffdf964b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2e7730>]}
[0m12:57:57.265895 [debug] [MainThread]: On master: ROLLBACK
[0m12:57:57.266249 [debug] [MainThread]: Using postgres connection "master"
[0m12:57:57.266382 [debug] [MainThread]: On master: BEGIN
[0m12:57:57.266882 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:57:57.267029 [debug] [MainThread]: On master: COMMIT
[0m12:57:57.267162 [debug] [MainThread]: Using postgres connection "master"
[0m12:57:57.267284 [debug] [MainThread]: On master: COMMIT
[0m12:57:57.267591 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:57:57.267764 [debug] [MainThread]: On master: Close
[0m12:57:57.269065 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m12:57:57.269310 [info ] [Thread-1  ]: 1 of 1 START sql table model public_transform.department_extended .............. [RUN]
[0m12:57:57.269527 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.department_extended)
[0m12:57:57.269680 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m12:57:57.273441 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m12:57:57.273739 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m12:57:57.290420 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m12:57:57.291046 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:57:57.291205 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m12:57:57.291341 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:57:57.298344 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:57:57.298548 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:57:57.298707 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select distinct
    d.*,
    count(e.employee_id) over (partition by d.department_id) as employee_count,
    count(e.manager_id)  over (partition by d.department_id) as manager_count

from "lucca_db"."public_base"."department" d
inner join "lucca_db"."public_base"."employee" e
    on d.department_id = e.department_id
  );
  
[0m12:57:57.301741 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.003 seconds
[0m12:57:57.305908 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:57:57.306066 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m12:57:57.306490 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:57:57.307818 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:57:57.307964 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m12:57:57.308334 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:57:57.315582 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:57:57.315746 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:57:57.315881 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:57:57.317677 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:57:57.320142 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m12:57:57.321887 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:57:57.322035 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m12:57:57.323986 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m12:57:57.324985 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m12:57:57.325881 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3cde75e5-0434-45b4-baf3-a7ffdf964b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a85d8e0>]}
[0m12:57:57.326146 [info ] [Thread-1  ]: 1 of 1 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.06s]
[0m12:57:57.326402 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m12:57:57.326814 [debug] [MainThread]: Using postgres connection "master"
[0m12:57:57.326936 [debug] [MainThread]: On master: BEGIN
[0m12:57:57.327047 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:57:57.332990 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m12:57:57.333162 [debug] [MainThread]: On master: COMMIT
[0m12:57:57.333290 [debug] [MainThread]: Using postgres connection "master"
[0m12:57:57.333405 [debug] [MainThread]: On master: COMMIT
[0m12:57:57.333711 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:57:57.333850 [debug] [MainThread]: On master: Close
[0m12:57:57.334108 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:57:57.334253 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m12:57:57.334382 [info ] [MainThread]: 
[0m12:57:57.334544 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m12:57:57.334829 [debug] [MainThread]: Command end result
[0m12:57:57.344458 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:57:57.345185 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:57:57.348135 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:57:57.348282 [info ] [MainThread]: 
[0m12:57:57.348459 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:57:57.348591 [info ] [MainThread]: 
[0m12:57:57.348737 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:57:57.350496 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5154204, "process_in_blocks": "0", "process_kernel_time": 0.122026, "process_mem_max_rss": "126025728", "process_out_blocks": "0", "process_user_time": 0.902571}
[0m12:57:57.350714 [debug] [MainThread]: Command `dbt run` succeeded at 12:57:57.350672 after 0.52 seconds
[0m12:57:57.350892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108426d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086edb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a89e640>]}
[0m12:57:57.351056 [debug] [MainThread]: Flushing usage events
[0m12:57:58.355040 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:59:05.695124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d2ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ada3130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ada3520>]}


============================== 12:59:05.697407 | b6f12d4e-abb2-49dd-9640-e7303e246ef8 ==============================
[0m12:59:05.697407 [info ] [MainThread]: Running with dbt=1.10.17
[0m12:59:05.697651 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'use_colors': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'version_check': 'True', 'printer_width': '80', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'introspect': 'True', 'static_parser': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'quiet': 'False', 'debug': 'False', 'empty': 'False', 'partial_parse': 'True', 'no_print': 'None', 'target_path': 'None'}
[0m12:59:05.783113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2acc40>]}
[0m12:59:05.807858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a66b670>]}
[0m12:59:05.808470 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:59:05.857012 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m12:59:05.920888 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:59:05.921119 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:59:05.923944 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m12:59:05.940427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bde0130>]}
[0m12:59:05.979229 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:59:05.980954 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:59:05.989772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bda2bb0>]}
[0m12:59:05.989991 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m12:59:05.990148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdfe130>]}
[0m12:59:05.990830 [info ] [MainThread]: 
[0m12:59:05.990987 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:59:05.991113 [info ] [MainThread]: 
[0m12:59:05.991345 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:59:05.993293 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m12:59:06.039695 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:59:06.039906 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:59:06.040027 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:59:06.069456 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.029 seconds
[0m12:59:06.070045 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:59:06.071218 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m12:59:06.071366 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m12:59:06.071478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:06.078993 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.007 seconds
[0m12:59:06.079485 [debug] [ThreadPool]: On list_lucca_db: Close
[0m12:59:06.080082 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m12:59:06.082950 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:59:06.083083 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m12:59:06.083196 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:06.091195 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m12:59:06.091317 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m12:59:06.091439 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m12:59:06.094904 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m12:59:06.095396 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m12:59:06.095801 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m12:59:06.096012 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m12:59:06.096943 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:59:06.097320 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m12:59:06.097435 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:06.103908 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m12:59:06.104036 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m12:59:06.104164 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m12:59:06.107132 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m12:59:06.107677 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m12:59:06.108105 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m12:59:06.110261 [debug] [MainThread]: Using postgres connection "master"
[0m12:59:06.110399 [debug] [MainThread]: On master: BEGIN
[0m12:59:06.110514 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:59:06.116714 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m12:59:06.116873 [debug] [MainThread]: Using postgres connection "master"
[0m12:59:06.117037 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:59:06.120718 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m12:59:06.121222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085e9a60>]}
[0m12:59:06.121435 [debug] [MainThread]: On master: ROLLBACK
[0m12:59:06.121890 [debug] [MainThread]: Using postgres connection "master"
[0m12:59:06.122025 [debug] [MainThread]: On master: BEGIN
[0m12:59:06.122702 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:59:06.122831 [debug] [MainThread]: On master: COMMIT
[0m12:59:06.122955 [debug] [MainThread]: Using postgres connection "master"
[0m12:59:06.123077 [debug] [MainThread]: On master: COMMIT
[0m12:59:06.123452 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:59:06.123577 [debug] [MainThread]: On master: Close
[0m12:59:06.125325 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m12:59:06.125542 [info ] [Thread-1  ]: 1 of 7 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m12:59:06.125740 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m12:59:06.125887 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m12:59:06.129692 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.130157 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m12:59:06.146623 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.147035 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.147198 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m12:59:06.147330 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:59:06.156373 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m12:59:06.156532 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.156704 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m12:59:06.164476 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m12:59:06.169566 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.169749 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m12:59:06.170429 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.171788 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.171940 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m12:59:06.172575 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:59:06.179288 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m12:59:06.179444 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.179577 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m12:59:06.181072 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:59:06.183697 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m12:59:06.185403 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m12:59:06.185548 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m12:59:06.188974 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m12:59:06.189972 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m12:59:06.190860 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2b1160>]}
[0m12:59:06.191115 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m12:59:06.191359 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m12:59:06.191692 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m12:59:06.191901 [info ] [Thread-1  ]: 2 of 7 START sql table model public_base.contract .............................. [RUN]
[0m12:59:06.192085 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m12:59:06.192234 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m12:59:06.193514 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m12:59:06.193893 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m12:59:06.195500 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m12:59:06.195731 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m12:59:06.195861 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m12:59:06.195984 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:59:06.203654 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:59:06.203811 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m12:59:06.203949 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m12:59:06.207771 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m12:59:06.209163 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m12:59:06.209307 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m12:59:06.209831 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:59:06.211631 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m12:59:06.211769 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m12:59:06.212285 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:59:06.212869 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m12:59:06.213007 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m12:59:06.213133 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m12:59:06.214088 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:59:06.215109 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m12:59:06.215421 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m12:59:06.215558 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m12:59:06.217099 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m12:59:06.217597 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m12:59:06.217838 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c37af10>]}
[0m12:59:06.218095 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m12:59:06.218341 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m12:59:06.218494 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m12:59:06.218733 [info ] [Thread-1  ]: 3 of 7 START sql table model public_transform.contract_extended ................ [RUN]
[0m12:59:06.218959 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m12:59:06.219118 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m12:59:06.220552 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m12:59:06.220865 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m12:59:06.222425 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m12:59:06.222687 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m12:59:06.222834 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m12:59:06.222961 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:59:06.230373 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:59:06.230512 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m12:59:06.230672 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m12:59:06.235154 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m12:59:06.236652 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m12:59:06.236797 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m12:59:06.237454 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.238645 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m12:59:06.238781 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m12:59:06.239275 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:59:06.239875 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m12:59:06.240012 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m12:59:06.240136 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m12:59:06.241032 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:59:06.242627 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m12:59:06.242918 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m12:59:06.243052 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m12:59:06.245177 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m12:59:06.245651 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m12:59:06.245888 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3d2940>]}
[0m12:59:06.246138 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m12:59:06.246381 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m12:59:06.246531 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m12:59:06.246743 [info ] [Thread-1  ]: 4 of 7 START sql table model public_base.department ............................ [RUN]
[0m12:59:06.246945 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m12:59:06.247088 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m12:59:06.248523 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m12:59:06.248967 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m12:59:06.250611 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m12:59:06.250876 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m12:59:06.251007 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m12:59:06.251132 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:59:06.258412 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:59:06.258602 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m12:59:06.258762 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m12:59:06.265515 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.007 seconds
[0m12:59:06.267284 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m12:59:06.267471 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m12:59:06.268295 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.269560 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m12:59:06.269696 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m12:59:06.270222 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:59:06.270875 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m12:59:06.271019 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m12:59:06.271155 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m12:59:06.272138 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:59:06.273237 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m12:59:06.273541 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m12:59:06.273680 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m12:59:06.275837 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m12:59:06.276339 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m12:59:06.276601 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3d2940>]}
[0m12:59:06.276891 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m12:59:06.277139 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m12:59:06.277306 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m12:59:06.277547 [info ] [Thread-1  ]: 5 of 7 START sql table model public_base.employee .............................. [RUN]
[0m12:59:06.277768 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m12:59:06.277922 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m12:59:06.279357 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m12:59:06.279823 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m12:59:06.282264 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m12:59:06.282543 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:59:06.282687 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m12:59:06.282846 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:59:06.290181 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:59:06.290343 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:59:06.290492 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m12:59:06.295100 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m12:59:06.296635 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:59:06.296787 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m12:59:06.297431 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.298847 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:59:06.299020 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m12:59:06.299582 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:59:06.300527 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m12:59:06.300711 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:59:06.300855 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m12:59:06.302205 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:59:06.303357 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m12:59:06.303675 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m12:59:06.303816 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m12:59:06.305904 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m12:59:06.306465 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m12:59:06.306724 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097cb100>]}
[0m12:59:06.307000 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m12:59:06.307239 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m12:59:06.307566 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m12:59:06.307808 [info ] [Thread-1  ]: 6 of 7 START sql table model public_transform.department_extended .............. [RUN]
[0m12:59:06.308037 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.department_extended)
[0m12:59:06.308202 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m12:59:06.309777 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m12:59:06.310120 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m12:59:06.311821 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m12:59:06.312106 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:59:06.312250 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m12:59:06.312387 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:59:06.319579 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:59:06.319763 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:59:06.319901 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select distinct
    d.*,
    count(e.employee_id) over (partition by d.department_id) as employee_count,
    count(e.manager_id)  over (partition by d.department_id) as manager_count

from "lucca_db"."public_base"."department" d
inner join "lucca_db"."public_base"."employee" e
    on d.department_id = e.department_id
  );
  
[0m12:59:06.325174 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m12:59:06.326811 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:59:06.326967 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m12:59:06.328038 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.329979 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:59:06.330129 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m12:59:06.330912 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.331685 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:59:06.331893 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:59:06.332196 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m12:59:06.333250 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:59:06.334430 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m12:59:06.334750 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m12:59:06.334900 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m12:59:06.336685 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m12:59:06.337220 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m12:59:06.337480 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c395550>]}
[0m12:59:06.337764 [info ] [Thread-1  ]: 6 of 7 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m12:59:06.338006 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m12:59:06.338170 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m12:59:06.338396 [info ] [Thread-1  ]: 7 of 7 START sql table model public_transform.employee_extended ................ [RUN]
[0m12:59:06.338597 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department_extended, now model.lucca_dbt.employee_extended)
[0m12:59:06.338748 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m12:59:06.340296 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m12:59:06.340782 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m12:59:06.342435 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m12:59:06.342675 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m12:59:06.342805 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m12:59:06.342931 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:59:06.350000 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:59:06.350178 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m12:59:06.350315 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    CASE 
        WHEN employee_id IN (
            SELECT DISTINCT manager_id::varchar 
            FROM "lucca_db"."public_base"."employee"
            WHERE manager_id IS NOT NULL
        )
        THEN TRUE
        ELSE FALSE
    END AS is_manager

    
from "lucca_db"."public_base"."employee"
  );
  
[0m12:59:06.355133 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m12:59:06.356740 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m12:59:06.356887 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m12:59:06.357695 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.358995 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m12:59:06.359138 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m12:59:06.359848 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:59:06.360478 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m12:59:06.360623 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m12:59:06.360757 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m12:59:06.361934 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:59:06.363510 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m12:59:06.363809 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m12:59:06.363950 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m12:59:06.365850 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m12:59:06.366349 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m12:59:06.366599 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6f12d4e-abb2-49dd-9640-e7303e246ef8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3d1c10>]}
[0m12:59:06.366865 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m12:59:06.367106 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m12:59:06.367577 [debug] [MainThread]: Using postgres connection "master"
[0m12:59:06.367724 [debug] [MainThread]: On master: BEGIN
[0m12:59:06.367847 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:59:06.375454 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:59:06.375596 [debug] [MainThread]: On master: COMMIT
[0m12:59:06.375720 [debug] [MainThread]: Using postgres connection "master"
[0m12:59:06.375836 [debug] [MainThread]: On master: COMMIT
[0m12:59:06.376195 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:59:06.376321 [debug] [MainThread]: On master: Close
[0m12:59:06.376484 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:59:06.376598 [debug] [MainThread]: Connection 'model.lucca_dbt.employee_extended' was properly closed.
[0m12:59:06.376759 [info ] [MainThread]: 
[0m12:59:06.376904 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.39 seconds (0.39s).
[0m12:59:06.377512 [debug] [MainThread]: Command end result
[0m12:59:06.387923 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m12:59:06.388749 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m12:59:06.391761 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m12:59:06.391911 [info ] [MainThread]: 
[0m12:59:06.392077 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:59:06.392214 [info ] [MainThread]: 
[0m12:59:06.392356 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m12:59:06.393683 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7310702, "process_in_blocks": "0", "process_kernel_time": 0.149015, "process_mem_max_rss": "127434752", "process_out_blocks": "0", "process_user_time": 1.005815}
[0m12:59:06.393862 [debug] [MainThread]: Command `dbt run` succeeded at 12:59:06.393828 after 0.73 seconds
[0m12:59:06.394030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d2ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4a2670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bda2bb0>]}
[0m12:59:06.394180 [debug] [MainThread]: Flushing usage events
[0m12:59:07.368676 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:09:43.090293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081b2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109227190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109227520>]}


============================== 13:09:43.092977 | 19ebe06c-647f-4fc2-b512-fdfc7d1f2be6 ==============================
[0m13:09:43.092977 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:09:43.093257 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'no_print': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'warn_error': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'version_check': 'True', 'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'use_experimental_parser': 'False', 'empty': 'False'}
[0m13:09:43.185184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b597f0>]}
[0m13:09:43.210391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a965b0>]}
[0m13:09:43.211091 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:09:43.261806 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:09:43.328592 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m13:09:43.328897 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m13:09:43.329067 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/department_extended.sql
[0m13:09:43.432547 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m13:09:43.439405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a43aee0>]}
[0m13:09:43.496586 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:09:43.497779 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:09:43.507626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a24f910>]}
[0m13:09:43.507847 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m13:09:43.508002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109730d00>]}
[0m13:09:43.508666 [info ] [MainThread]: 
[0m13:09:43.508820 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:09:43.508947 [info ] [MainThread]: 
[0m13:09:43.509161 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:09:43.511184 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:09:43.539024 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:09:43.539227 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:09:43.539347 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:09:43.568946 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.030 seconds
[0m13:09:43.569541 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:09:43.570889 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:09:43.571044 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:09:43.571158 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:09:43.578913 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m13:09:43.579413 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:09:43.580010 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m13:09:43.582538 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:09:43.582687 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:09:43.582799 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:09:43.590815 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:09:43.590940 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:09:43.591066 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:09:43.594372 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m13:09:43.594839 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:09:43.595275 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:09:43.595481 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m13:09:43.596649 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:09:43.596775 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:09:43.596887 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:09:43.604604 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:09:43.604733 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:09:43.604861 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:09:43.607898 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m13:09:43.608432 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:09:43.608884 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:09:43.610976 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.611107 [debug] [MainThread]: On master: BEGIN
[0m13:09:43.611221 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:09:43.617519 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:09:43.617646 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.617799 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:09:43.621037 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m13:09:43.621463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a6a340>]}
[0m13:09:43.621659 [debug] [MainThread]: On master: ROLLBACK
[0m13:09:43.622061 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.622184 [debug] [MainThread]: On master: BEGIN
[0m13:09:43.622743 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:09:43.622866 [debug] [MainThread]: On master: COMMIT
[0m13:09:43.622987 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.623103 [debug] [MainThread]: On master: COMMIT
[0m13:09:43.623423 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:09:43.623547 [debug] [MainThread]: On master: Close
[0m13:09:43.625589 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:09:43.625809 [info ] [Thread-1  ]: 1 of 7 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:09:43.626007 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m13:09:43.626158 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:09:43.630101 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.630553 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:09:43.647696 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.648088 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.648228 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:09:43.648362 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:43.656973 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:09:43.657130 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.657300 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:09:43.665083 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m13:09:43.669259 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.669422 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:09:43.670223 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:09:43.671493 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.671640 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:09:43.672199 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.679163 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:09:43.679342 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.679485 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:09:43.681121 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:09:43.683610 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:09:43.685325 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:09:43.685471 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:09:43.689286 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m13:09:43.690361 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:09:43.691414 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a754190>]}
[0m13:09:43.691699 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:09:43.691950 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:09:43.692313 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m13:09:43.692540 [info ] [Thread-1  ]: 2 of 7 START sql table model public_base.contract .............................. [RUN]
[0m13:09:43.692733 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m13:09:43.692881 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m13:09:43.694133 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m13:09:43.694510 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m13:09:43.696072 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m13:09:43.696304 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:09:43.696436 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m13:09:43.696560 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:43.704792 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:09:43.705000 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:09:43.705137 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:09:43.709607 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:09:43.711850 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:09:43.712003 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m13:09:43.712641 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:09:43.713815 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:09:43.713952 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m13:09:43.714490 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.715075 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:09:43.715209 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:09:43.715335 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:09:43.716236 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:09:43.717201 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m13:09:43.717482 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:09:43.717615 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m13:09:43.719576 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:09:43.720020 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m13:09:43.720255 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8e8eb0>]}
[0m13:09:43.720520 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:09:43.720761 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m13:09:43.720927 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m13:09:43.721159 [info ] [Thread-1  ]: 3 of 7 START sql table model public_transform.contract_extended ................ [RUN]
[0m13:09:43.721367 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m13:09:43.721519 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m13:09:43.722927 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m13:09:43.723220 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m13:09:43.724772 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m13:09:43.725006 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:09:43.725141 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m13:09:43.725268 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:43.732088 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:09:43.732302 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:09:43.732468 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:09:43.735504 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m13:09:43.737141 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:09:43.737286 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m13:09:43.737707 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.738915 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:09:43.739051 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m13:09:43.739394 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.740010 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:09:43.740146 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:09:43.740269 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:09:43.740965 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:09:43.742518 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m13:09:43.742803 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:09:43.742933 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m13:09:43.743826 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:09:43.744398 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m13:09:43.744671 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8e8eb0>]}
[0m13:09:43.744967 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.02s]
[0m13:09:43.745216 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m13:09:43.745386 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m13:09:43.745615 [info ] [Thread-1  ]: 4 of 7 START sql table model public_base.department ............................ [RUN]
[0m13:09:43.745803 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m13:09:43.745955 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m13:09:43.747328 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m13:09:43.747777 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m13:09:43.749390 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m13:09:43.749643 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:09:43.749793 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m13:09:43.749939 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:43.755812 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:09:43.756032 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:09:43.756185 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:09:43.758572 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.002 seconds
[0m13:09:43.760272 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:09:43.760435 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m13:09:43.760984 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.762362 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:09:43.762502 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m13:09:43.762857 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.763478 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:09:43.763612 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:09:43.763739 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:09:43.764929 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:09:43.765926 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m13:09:43.766216 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:09:43.766348 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m13:09:43.768246 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:09:43.768707 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m13:09:43.768959 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8cab80>]}
[0m13:09:43.769226 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.02s]
[0m13:09:43.769473 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m13:09:43.769625 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m13:09:43.769851 [info ] [Thread-1  ]: 5 of 7 START sql table model public_base.employee .............................. [RUN]
[0m13:09:43.770063 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m13:09:43.770210 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m13:09:43.771574 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m13:09:43.771899 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m13:09:43.774039 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m13:09:43.774279 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:09:43.774409 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m13:09:43.774535 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:43.780922 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:09:43.781147 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:09:43.781324 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:09:43.785380 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:09:43.786898 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:09:43.787047 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m13:09:43.788164 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:09:43.789402 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:09:43.789539 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m13:09:43.790099 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.790707 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:09:43.790842 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:09:43.790969 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:09:43.792385 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:09:43.793574 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m13:09:43.793881 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:09:43.794016 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m13:09:43.796098 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:09:43.796581 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m13:09:43.796816 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a93fd90>]}
[0m13:09:43.797067 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:09:43.797298 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m13:09:43.797602 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m13:09:43.797815 [info ] [Thread-1  ]: 6 of 7 START sql table model public_transform.employee_extended ................ [RUN]
[0m13:09:43.798011 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m13:09:43.798154 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m13:09:43.799557 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m13:09:43.799839 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m13:09:43.801366 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m13:09:43.801592 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:09:43.801724 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m13:09:43.801848 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:43.809171 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:09:43.809335 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:09:43.809485 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    case 
        when employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager
from "lucca_db"."public_base"."employee"
  );
  
[0m13:09:43.813338 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:09:43.815303 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:09:43.815440 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m13:09:43.815891 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.817083 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:09:43.817230 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m13:09:43.817729 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.818318 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:09:43.818453 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:09:43.818580 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:09:43.819698 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:09:43.820683 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m13:09:43.820965 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:09:43.821096 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m13:09:43.823495 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:09:43.823963 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m13:09:43.824209 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9410a0>]}
[0m13:09:43.824478 [info ] [Thread-1  ]: 6 of 7 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:09:43.824719 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m13:09:43.825034 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m13:09:43.825241 [info ] [Thread-1  ]: 7 of 7 START sql table model public_transform.department_extended .............. [RUN]
[0m13:09:43.825468 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.department_extended)
[0m13:09:43.825639 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m13:09:43.827292 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m13:09:43.827744 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m13:09:43.829297 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m13:09:43.829686 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:09:43.829827 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m13:09:43.829954 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:09:43.837161 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:09:43.837322 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:09:43.837474 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m13:09:43.840117 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.002 seconds
[0m13:09:43.841679 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:09:43.841843 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m13:09:43.842212 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.843599 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:09:43.843783 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m13:09:43.844165 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:09:43.844819 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:09:43.844972 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:09:43.845115 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:09:43.845964 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:09:43.847499 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m13:09:43.847785 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:09:43.847919 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m13:09:43.849389 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:09:43.849858 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m13:09:43.850094 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19ebe06c-647f-4fc2-b512-fdfc7d1f2be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9410a0>]}
[0m13:09:43.850349 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.02s]
[0m13:09:43.850586 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m13:09:43.851038 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.851162 [debug] [MainThread]: On master: BEGIN
[0m13:09:43.851271 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:09:43.857418 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:09:43.857561 [debug] [MainThread]: On master: COMMIT
[0m13:09:43.857685 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.857802 [debug] [MainThread]: On master: COMMIT
[0m13:09:43.858099 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:09:43.858231 [debug] [MainThread]: On master: Close
[0m13:09:43.858398 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:09:43.858520 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m13:09:43.858685 [info ] [MainThread]: 
[0m13:09:43.858826 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.35 seconds (0.35s).
[0m13:09:43.859476 [debug] [MainThread]: Command end result
[0m13:09:43.869734 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:09:43.870595 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:09:43.873734 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:09:43.873871 [info ] [MainThread]: 
[0m13:09:43.874037 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:09:43.874173 [info ] [MainThread]: 
[0m13:09:43.874319 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m13:09:43.875814 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8200153, "process_in_blocks": "0", "process_kernel_time": 0.175278, "process_mem_max_rss": "130564096", "process_out_blocks": "0", "process_user_time": 1.090629}
[0m13:09:43.875973 [debug] [MainThread]: Command `dbt run` succeeded at 13:09:43.875940 after 0.82 seconds
[0m13:09:43.876127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081b2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a965b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fda4c0>]}
[0m13:09:43.876291 [debug] [MainThread]: Flushing usage events
[0m13:09:44.397598 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:15:34.274570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a76ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7e3d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7e3250>]}


============================== 13:15:34.276854 | a199e407-7832-4426-b098-d781b9a847ed ==============================
[0m13:15:34.276854 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:15:34.277105 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None', 'target_path': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'version_check': 'True', 'static_parser': 'True', 'introspect': 'True', 'empty': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'fail_fast': 'False'}
[0m13:15:34.365377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109115a60>]}
[0m13:15:34.390363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aaae250>]}
[0m13:15:34.390923 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:15:34.440891 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:15:34.506317 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:15:34.506590 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/department_extended.sql
[0m13:15:34.610076 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m13:15:34.616609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9f2130>]}
[0m13:15:34.673255 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:15:34.674387 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:15:34.683849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c80bc10>]}
[0m13:15:34.684058 [info ] [MainThread]: Found 7 models, 1 source, 447 macros
[0m13:15:34.684207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c61c430>]}
[0m13:15:34.684851 [info ] [MainThread]: 
[0m13:15:34.685000 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:15:34.685125 [info ] [MainThread]: 
[0m13:15:34.685339 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:15:34.687241 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:15:34.715035 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:15:34.715228 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:15:34.715344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:15:34.744784 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.029 seconds
[0m13:15:34.745374 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:15:34.746586 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:15:34.746730 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:15:34.746838 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:15:34.754687 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m13:15:34.755170 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:15:34.755778 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m13:15:34.758532 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:15:34.758656 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:15:34.758764 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:15:34.765638 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:15:34.765763 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:15:34.765884 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:15:34.769811 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m13:15:34.770350 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:15:34.770782 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:15:34.771002 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m13:15:34.771937 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:15:34.772069 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:15:34.772446 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:15:34.778950 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:15:34.779079 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:15:34.779209 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:15:34.782106 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m13:15:34.782617 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:15:34.783042 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:15:34.785173 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:34.785306 [debug] [MainThread]: On master: BEGIN
[0m13:15:34.785421 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:15:34.792217 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:15:34.792342 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:34.792494 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:15:34.796220 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:15:34.796670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109029f70>]}
[0m13:15:34.796866 [debug] [MainThread]: On master: ROLLBACK
[0m13:15:34.797300 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:34.797424 [debug] [MainThread]: On master: BEGIN
[0m13:15:34.798090 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:15:34.798221 [debug] [MainThread]: On master: COMMIT
[0m13:15:34.798340 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:34.798458 [debug] [MainThread]: On master: COMMIT
[0m13:15:34.798824 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:15:34.798951 [debug] [MainThread]: On master: Close
[0m13:15:34.800978 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:15:34.801188 [info ] [Thread-1  ]: 1 of 7 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:15:34.801383 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m13:15:34.801532 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:15:34.805380 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.805806 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:15:34.822327 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.822694 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.822843 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:15:34.822974 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:34.832549 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m13:15:34.832693 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.832866 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:15:34.841456 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m13:15:34.846310 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.846500 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:15:34.847187 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:34.848544 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.848702 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:15:34.849226 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:15:34.856140 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:15:34.856288 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.856419 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:15:34.857410 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:34.859852 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:15:34.861544 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:15:34.861686 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:15:34.864767 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:15:34.865786 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:15:34.866793 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ccba160>]}
[0m13:15:34.867055 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:15:34.867308 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:15:34.867634 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m13:15:34.867833 [info ] [Thread-1  ]: 2 of 7 START sql table model public_base.contract .............................. [RUN]
[0m13:15:34.868024 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.contract)
[0m13:15:34.868162 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m13:15:34.869412 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m13:15:34.869762 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m13:15:34.871292 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m13:15:34.871515 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:15:34.871644 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m13:15:34.871766 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:34.879547 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:15:34.879740 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:15:34.879878 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:15:34.884685 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:15:34.886201 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:15:34.886342 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m13:15:34.886982 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:34.888787 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:15:34.888923 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m13:15:34.889769 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:34.890367 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:15:34.890503 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:15:34.890627 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:15:34.891683 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:34.892684 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m13:15:34.892979 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:15:34.893120 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m13:15:34.895339 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:15:34.895835 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m13:15:34.896087 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce9e9a0>]}
[0m13:15:34.896359 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:15:34.896610 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m13:15:34.896776 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m13:15:34.897007 [info ] [Thread-1  ]: 3 of 7 START sql table model public_transform.contract_extended ................ [RUN]
[0m13:15:34.897209 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m13:15:34.897361 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m13:15:34.898940 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m13:15:34.899279 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m13:15:34.900921 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m13:15:34.901185 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:15:34.901334 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m13:15:34.901459 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:34.909096 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:15:34.909302 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:15:34.909470 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:15:34.914320 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:15:34.915835 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:15:34.915982 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m13:15:34.916563 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:15:34.917832 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:15:34.917978 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m13:15:34.918541 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:15:34.919187 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:15:34.919330 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:15:34.919464 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:15:34.920519 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:34.921570 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m13:15:34.921874 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:15:34.922014 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m13:15:34.924958 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:15:34.925442 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m13:15:34.925695 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c856b50>]}
[0m13:15:34.925961 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:15:34.926203 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m13:15:34.926368 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m13:15:34.926623 [info ] [Thread-1  ]: 4 of 7 START sql table model public_base.department ............................ [RUN]
[0m13:15:34.926862 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m13:15:34.927032 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m13:15:34.929177 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m13:15:34.929734 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m13:15:34.931372 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m13:15:34.931608 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:15:34.931737 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m13:15:34.931860 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:34.939000 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:15:34.939221 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:15:34.939378 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:15:34.943441 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m13:15:34.945050 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:15:34.945251 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m13:15:34.945873 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:15:34.947320 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:15:34.947470 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m13:15:34.948015 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:15:34.948685 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:15:34.948831 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:15:34.948967 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:15:34.949961 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:34.951029 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m13:15:34.951342 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:15:34.951482 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m13:15:34.953031 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:15:34.953536 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m13:15:34.953791 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c856b50>]}
[0m13:15:34.954065 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m13:15:34.954308 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m13:15:34.954477 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m13:15:34.954711 [info ] [Thread-1  ]: 5 of 7 START sql table model public_base.employee .............................. [RUN]
[0m13:15:34.954909 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m13:15:34.955055 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m13:15:34.956444 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m13:15:34.956753 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m13:15:34.959015 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m13:15:34.959280 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:15:34.959423 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m13:15:34.959559 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:34.968164 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:15:34.968352 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:15:34.968508 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:15:34.973547 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:15:34.975090 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:15:34.975239 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m13:15:34.976001 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:34.977290 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:15:34.977431 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m13:15:34.977962 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:15:34.978637 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:15:34.978800 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:15:34.978948 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:15:34.979672 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:34.980749 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m13:15:34.981060 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:15:34.981199 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m13:15:34.983375 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:15:34.983878 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m13:15:34.984128 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c856b50>]}
[0m13:15:34.984398 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:15:34.984636 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m13:15:34.984946 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m13:15:34.985140 [info ] [Thread-1  ]: 6 of 7 START sql table model public_transform.employee_extended ................ [RUN]
[0m13:15:34.985366 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m13:15:34.985526 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m13:15:34.986994 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m13:15:34.987279 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m13:15:34.988911 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m13:15:34.989153 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:15:34.989292 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m13:15:34.989426 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:34.997303 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:15:34.997496 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:15:34.997652 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    case 
        when employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager
from "lucca_db"."public_base"."employee"
  );
  
[0m13:15:35.002989 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:15:35.004579 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:15:35.004733 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m13:15:35.006138 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:35.008126 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:15:35.008279 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m13:15:35.009083 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:35.009735 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:15:35.009886 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:15:35.010027 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:15:35.011209 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:35.012370 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m13:15:35.012687 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:15:35.012832 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m13:15:35.015075 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:15:35.015606 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m13:15:35.015854 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cee5bb0>]}
[0m13:15:35.016119 [info ] [Thread-1  ]: 6 of 7 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:15:35.016355 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m13:15:35.016654 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m13:15:35.016881 [info ] [Thread-1  ]: 7 of 7 START sql table model public_transform.department_extended .............. [RUN]
[0m13:15:35.017085 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.department_extended)
[0m13:15:35.017239 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m13:15:35.018810 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m13:15:35.019328 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m13:15:35.021025 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m13:15:35.021286 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:15:35.021433 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m13:15:35.021573 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:15:35.029355 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:15:35.029521 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:15:35.029677 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m13:15:35.034437 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m13:15:35.035967 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:15:35.036120 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m13:15:35.036964 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:35.038244 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:15:35.038395 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m13:15:35.039600 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:15:35.040237 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:15:35.040385 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:15:35.040522 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:15:35.041623 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:15:35.042688 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m13:15:35.042999 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:15:35.043150 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m13:15:35.045264 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:15:35.045847 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m13:15:35.046118 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a199e407-7832-4426-b098-d781b9a847ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7e38b0>]}
[0m13:15:35.046406 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m13:15:35.046651 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m13:15:35.047098 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:35.047232 [debug] [MainThread]: On master: BEGIN
[0m13:15:35.047351 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:15:35.054281 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:15:35.054420 [debug] [MainThread]: On master: COMMIT
[0m13:15:35.054549 [debug] [MainThread]: Using postgres connection "master"
[0m13:15:35.054670 [debug] [MainThread]: On master: COMMIT
[0m13:15:35.055119 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:15:35.055250 [debug] [MainThread]: On master: Close
[0m13:15:35.055416 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:15:35.055534 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m13:15:35.055697 [info ] [MainThread]: 
[0m13:15:35.055839 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 0.37 seconds (0.37s).
[0m13:15:35.056451 [debug] [MainThread]: Command end result
[0m13:15:35.067853 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:15:35.068688 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:15:35.071999 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:15:35.072142 [info ] [MainThread]: 
[0m13:15:35.072311 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:15:35.072448 [info ] [MainThread]: 
[0m13:15:35.072597 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m13:15:35.073986 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8316403, "process_in_blocks": "0", "process_kernel_time": 0.152599, "process_mem_max_rss": "131088384", "process_out_blocks": "0", "process_user_time": 1.099057}
[0m13:15:35.074172 [debug] [MainThread]: Command `dbt run` succeeded at 13:15:35.074133 after 0.83 seconds
[0m13:15:35.074342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a76ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aaae250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10924ab20>]}
[0m13:15:35.074505 [debug] [MainThread]: Flushing usage events
[0m13:15:36.477167 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:42:06.093445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a67adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6efdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6ef310>]}


============================== 13:42:06.095870 | 6c0063d6-0d1b-4e57-a13f-8ad547cd0de3 ==============================
[0m13:42:06.095870 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:42:06.096132 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'log_format': 'default', 'target_path': 'None', 'version_check': 'True', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/Users/marccao/repo/dbt', 'log_cache_events': 'False', 'empty': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'cache_selected_only': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'no_print': 'None'}
[0m13:42:06.187877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbefd30>]}
[0m13:42:06.213982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbc6790>]}
[0m13:42:06.214639 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:42:06.264721 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:42:06.331975 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m13:42:06.332232 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/transform/company_extended.sql
[0m13:42:06.332373 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/base/company.sql
[0m13:42:06.437891 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m13:42:06.444772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c88d130>]}
[0m13:42:06.503415 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:42:06.504794 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:42:06.514994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c721c10>]}
[0m13:42:06.515214 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m13:42:06.515368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6ce790>]}
[0m13:42:06.516062 [info ] [MainThread]: 
[0m13:42:06.516217 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:42:06.516348 [info ] [MainThread]: 
[0m13:42:06.516563 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:42:06.518567 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:42:06.546116 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:42:06.546304 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:42:06.546418 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:42:06.577407 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.031 seconds
[0m13:42:06.578039 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:42:06.579452 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:42:06.579608 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:42:06.579721 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:42:06.587433 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m13:42:06.587867 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:42:06.588531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m13:42:06.591019 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:42:06.591146 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:42:06.591253 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:42:06.598140 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:42:06.598277 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:42:06.598406 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:42:06.601852 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m13:42:06.602404 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:42:06.602854 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:42:06.603085 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m13:42:06.604031 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:42:06.604418 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:42:06.604542 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:42:06.611336 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:42:06.611463 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:42:06.611590 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:42:06.614646 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m13:42:06.615177 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:42:06.615605 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:42:06.617789 [debug] [MainThread]: Using postgres connection "master"
[0m13:42:06.617919 [debug] [MainThread]: On master: BEGIN
[0m13:42:06.618030 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:42:06.624589 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:42:06.624716 [debug] [MainThread]: Using postgres connection "master"
[0m13:42:06.624866 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:42:06.628629 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:42:06.629067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5266a0>]}
[0m13:42:06.629267 [debug] [MainThread]: On master: ROLLBACK
[0m13:42:06.629702 [debug] [MainThread]: Using postgres connection "master"
[0m13:42:06.629828 [debug] [MainThread]: On master: BEGIN
[0m13:42:06.630504 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:42:06.630635 [debug] [MainThread]: On master: COMMIT
[0m13:42:06.630757 [debug] [MainThread]: Using postgres connection "master"
[0m13:42:06.630871 [debug] [MainThread]: On master: COMMIT
[0m13:42:06.631237 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:42:06.631365 [debug] [MainThread]: On master: Close
[0m13:42:06.633418 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:42:06.633642 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:42:06.633840 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m13:42:06.633992 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:42:06.637871 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.638309 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:42:06.655650 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.656064 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.656231 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:42:06.656366 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.666303 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m13:42:06.666474 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.666646 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:42:06.676070 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.009 seconds
[0m13:42:06.680434 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.680604 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:42:06.681527 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.682828 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.682980 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:42:06.683779 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.690714 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:42:06.690864 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.690993 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:42:06.692757 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m13:42:06.695561 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:42:06.697284 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:42:06.697424 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:42:06.700895 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:42:06.701964 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:42:06.703041 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc18e50>]}
[0m13:42:06.703333 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m13:42:06.703593 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:42:06.704002 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m13:42:06.704260 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m13:42:06.704461 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m13:42:06.704615 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m13:42:06.705885 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m13:42:06.706308 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m13:42:06.707861 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m13:42:06.708100 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:42:06.708228 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m13:42:06.708356 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.716470 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:42:06.716659 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:42:06.716792 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:42:06.721294 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.004 seconds
[0m13:42:06.723415 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:42:06.723558 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m13:42:06.724725 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.725273 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:42:06.725406 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:42:06.725531 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:42:06.726523 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.727562 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m13:42:06.727917 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:42:06.728087 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m13:42:06.728618 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:42:06.729152 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m13:42:06.729409 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cdb5ac0>]}
[0m13:42:06.729685 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.02s]
[0m13:42:06.729932 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m13:42:06.730102 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m13:42:06.730348 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m13:42:06.730574 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m13:42:06.730734 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m13:42:06.732222 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m13:42:06.732659 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m13:42:06.734253 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m13:42:06.734505 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:42:06.734640 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m13:42:06.734765 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.742951 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:42:06.743120 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:42:06.743267 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:42:06.746838 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m13:42:06.748509 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:42:06.748656 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m13:42:06.749483 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.750682 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:42:06.750820 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m13:42:06.751486 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.752122 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:42:06.752279 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:42:06.752405 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:42:06.753742 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.754764 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m13:42:06.755051 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:42:06.755184 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m13:42:06.758509 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:42:06.759006 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m13:42:06.759271 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cdbba60>]}
[0m13:42:06.759578 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:42:06.759827 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m13:42:06.759999 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m13:42:06.760239 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m13:42:06.760445 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m13:42:06.760600 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m13:42:06.762966 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m13:42:06.763298 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m13:42:06.764943 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m13:42:06.765205 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:42:06.765341 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m13:42:06.765530 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.773471 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:42:06.773650 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:42:06.773827 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:42:06.778459 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:42:06.780483 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:42:06.780676 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m13:42:06.781583 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.782934 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:42:06.783087 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m13:42:06.783935 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.784601 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:42:06.784748 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:42:06.784886 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:42:06.785726 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.786810 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m13:42:06.787118 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:42:06.787258 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m13:42:06.790503 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:42:06.791014 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m13:42:06.791289 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cdbba60>]}
[0m13:42:06.791566 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:42:06.791817 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m13:42:06.791986 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m13:42:06.792217 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m13:42:06.792422 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m13:42:06.792574 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m13:42:06.793998 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m13:42:06.794577 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m13:42:06.796980 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m13:42:06.797303 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:42:06.797556 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m13:42:06.797748 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.807423 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m13:42:06.807619 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:42:06.807764 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:42:06.812200 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m13:42:06.813885 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:42:06.814088 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m13:42:06.814688 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:42:06.815941 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:42:06.816087 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m13:42:06.816626 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:42:06.817272 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:42:06.817415 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:42:06.817550 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:42:06.818360 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.819422 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m13:42:06.819727 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:42:06.819867 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m13:42:06.822538 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:42:06.823018 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m13:42:06.823266 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cdbba60>]}
[0m13:42:06.823536 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m13:42:06.823782 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m13:42:06.823948 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m13:42:06.824177 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m13:42:06.824372 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m13:42:06.824524 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m13:42:06.825949 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m13:42:06.826273 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m13:42:06.828049 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m13:42:06.828350 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:42:06.828493 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m13:42:06.828627 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.835855 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:42:06.836007 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:42:06.836156 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:42:06.840692 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:42:06.842188 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:42:06.842332 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m13:42:06.842958 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:42:06.844854 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:42:06.845173 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m13:42:06.845704 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:42:06.846391 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:42:06.846539 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:42:06.846677 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:42:06.847771 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.848869 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m13:42:06.849180 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:42:06.849323 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m13:42:06.851185 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:42:06.851698 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m13:42:06.851954 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce1e5b0>]}
[0m13:42:06.852230 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:42:06.852479 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m13:42:06.852788 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m13:42:06.853012 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m13:42:06.853211 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m13:42:06.853360 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m13:42:06.854935 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m13:42:06.855243 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m13:42:06.856865 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m13:42:06.857115 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:42:06.857259 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m13:42:06.857395 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.865385 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:42:06.865569 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:42:06.865716 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

select 
    *,
    case 
        when employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager
from "lucca_db"."public_base"."employee"
  );
  
[0m13:42:06.871185 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:42:06.872805 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:42:06.872995 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m13:42:06.874030 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.875299 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:42:06.875448 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m13:42:06.875968 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:42:06.876612 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:42:06.876762 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:42:06.876900 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:42:06.877772 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.878948 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m13:42:06.879269 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:42:06.879414 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m13:42:06.881683 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:42:06.882219 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m13:42:06.882476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb70670>]}
[0m13:42:06.882751 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:42:06.882994 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m13:42:06.883331 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m13:42:06.883553 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m13:42:06.883745 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m13:42:06.883898 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m13:42:06.886148 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m13:42:06.886633 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m13:42:06.888357 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m13:42:06.888658 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:42:06.888845 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m13:42:06.888991 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.896548 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:42:06.896716 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:42:06.896869 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    c.company_id,
    c.company_name,

    -- total d'employés historiques (y compris ceux qui ont quitté)
    count(e.employee_id) as total_employee,

    -- total d'employés actifs
    count(case when e.active = true then 1 end) as total_employee_active,

    -- total managers historiques
    sum(case when e.is_manager then 1 else 0 end) as total_manager,

    -- total managers actifs
    sum(case when e.is_manager and e.active = true then 1 else 0 end) as total_manager_active

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m13:42:06.898071 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column e.active does not exist
LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                             ^

[0m13:42:06.898225 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: ROLLBACK
[0m13:42:06.898675 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m13:42:06.910653 [debug] [Thread-1  ]: Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                               ^
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql
[0m13:42:06.910946 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce52820>]}
[0m13:42:06.911276 [error] [Thread-1  ]: 8 of 9 ERROR creating sql table model public_transform.company_extended ........ [[31mERROR[0m in 0.03s]
[0m13:42:06.911537 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m13:42:06.911719 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m13:42:06.911931 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.company_extended' to be skipped because of status 'error'.  Reason: Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                               ^
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql.
[0m13:42:06.912143 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m13:42:06.912391 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m13:42:06.912549 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m13:42:06.914149 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m13:42:06.914542 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m13:42:06.916180 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m13:42:06.916421 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:42:06.916555 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m13:42:06.916682 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:42:06.927001 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m13:42:06.927174 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:42:06.927329 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m13:42:06.932888 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m13:42:06.934486 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:42:06.934633 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m13:42:06.935461 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.936748 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:42:06.936893 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m13:42:06.937654 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:42:06.938289 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:42:06.938436 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:42:06.938570 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:42:06.939608 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.941222 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m13:42:06.941527 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:42:06.941667 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m13:42:06.944090 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:42:06.944709 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m13:42:06.944970 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0063d6-0d1b-4e57-a13f-8ad547cd0de3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cee4250>]}
[0m13:42:06.945244 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m13:42:06.945488 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m13:42:06.945958 [debug] [MainThread]: Using postgres connection "master"
[0m13:42:06.946084 [debug] [MainThread]: On master: BEGIN
[0m13:42:06.946198 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:42:06.954054 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m13:42:06.954191 [debug] [MainThread]: On master: COMMIT
[0m13:42:06.954329 [debug] [MainThread]: Using postgres connection "master"
[0m13:42:06.954447 [debug] [MainThread]: On master: COMMIT
[0m13:42:06.955215 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m13:42:06.955347 [debug] [MainThread]: On master: Close
[0m13:42:06.955509 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:42:06.955624 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m13:42:06.955789 [info ] [MainThread]: 
[0m13:42:06.955935 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m13:42:06.956646 [debug] [MainThread]: Command end result
[0m13:42:06.967151 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:42:06.967962 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:42:06.971188 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:42:06.971315 [info ] [MainThread]: 
[0m13:42:06.971469 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:42:06.971612 [info ] [MainThread]: 
[0m13:42:06.971782 [error] [MainThread]: [31mFailure in model company_extended (models/models/transform/company_extended.sql)[0m
[0m13:42:06.971946 [error] [MainThread]:   Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                               ^
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql
[0m13:42:06.972075 [info ] [MainThread]: 
[0m13:42:06.972224 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/company_extended.sql
[0m13:42:06.972355 [info ] [MainThread]: 
[0m13:42:06.972496 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=9
[0m13:42:06.973902 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.91568273, "process_in_blocks": "0", "process_kernel_time": 0.191392, "process_mem_max_rss": "132022272", "process_out_blocks": "0", "process_user_time": 1.273116}
[0m13:42:06.974064 [debug] [MainThread]: Command `dbt run` failed at 13:42:06.974030 after 0.92 seconds
[0m13:42:06.974223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a67adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c721100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a93bee0>]}
[0m13:42:06.974377 [debug] [MainThread]: Flushing usage events
[0m13:42:07.507034 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:51:44.394769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c8edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad03dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad03310>]}


============================== 13:51:44.397172 | c7cd5134-6707-4d28-b3e4-a6ea8c8c0069 ==============================
[0m13:51:44.397172 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:51:44.397428 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'use_colors': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'empty': 'False', 'use_experimental_parser': 'False', 'write_json': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/marccao/repo/dbt', 'cache_selected_only': 'False', 'quiet': 'False', 'debug': 'False', 'version_check': 'True', 'no_print': 'None'}
[0m13:51:44.486082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b203d30>]}
[0m13:51:44.510537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1da790>]}
[0m13:51:44.511096 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:51:44.563630 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:51:44.630998 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:51:44.631301 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m13:51:44.733894 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.base
- models.lucca_dbt.analytics
[0m13:51:44.740386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be9f130>]}
[0m13:51:44.797038 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:51:44.798408 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:51:44.807986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd2b9d0>]}
[0m13:51:44.808204 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m13:51:44.808361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b432a90>]}
[0m13:51:44.808999 [info ] [MainThread]: 
[0m13:51:44.809147 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:51:44.809272 [info ] [MainThread]: 
[0m13:51:44.809487 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:51:44.811456 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:51:44.839003 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:51:44.839211 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:51:44.839334 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:51:44.871683 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.032 seconds
[0m13:51:44.872320 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:51:44.873533 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:51:44.873687 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:51:44.873804 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:51:44.881989 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m13:51:44.882472 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:51:44.883129 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m13:51:44.885955 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:51:44.886091 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:51:44.886202 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:51:44.893614 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:51:44.893747 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:51:44.893870 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:51:44.897494 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m13:51:44.898001 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:51:44.898418 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:51:44.898636 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m13:51:44.899768 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:51:44.899904 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:51:44.900008 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:51:44.907288 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:51:44.907417 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:51:44.907547 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:51:44.911438 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.004 seconds
[0m13:51:44.911957 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:51:44.912406 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:51:44.914700 [debug] [MainThread]: Using postgres connection "master"
[0m13:51:44.914850 [debug] [MainThread]: On master: BEGIN
[0m13:51:44.914972 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:51:44.922187 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:51:44.922328 [debug] [MainThread]: Using postgres connection "master"
[0m13:51:44.922486 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:51:44.926309 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:51:44.926786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd2e4c0>]}
[0m13:51:44.926989 [debug] [MainThread]: On master: ROLLBACK
[0m13:51:44.927384 [debug] [MainThread]: Using postgres connection "master"
[0m13:51:44.927511 [debug] [MainThread]: On master: BEGIN
[0m13:51:44.928111 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:51:44.928238 [debug] [MainThread]: On master: COMMIT
[0m13:51:44.928363 [debug] [MainThread]: Using postgres connection "master"
[0m13:51:44.928480 [debug] [MainThread]: On master: COMMIT
[0m13:51:44.928819 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:51:44.928956 [debug] [MainThread]: On master: Close
[0m13:51:44.931087 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:51:44.931344 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:51:44.931563 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m13:51:44.931722 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:51:44.935623 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.936183 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:51:44.952439 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.952837 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.952981 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:51:44.953112 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:44.961800 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:51:44.961984 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.962175 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:51:44.969403 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m13:51:44.974155 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.974314 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:51:44.975547 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:51:44.976740 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.976880 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:51:44.977538 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:51:44.984020 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:51:44.984167 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.984295 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:51:44.986105 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m13:51:44.988499 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:51:44.990176 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:51:44.990312 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:51:44.993851 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:51:44.994828 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:51:44.995851 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c250e50>]}
[0m13:51:44.996112 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:51:44.996373 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:51:44.996777 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m13:51:44.997036 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m13:51:44.997249 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m13:51:44.997411 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m13:51:44.998717 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m13:51:44.999131 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m13:51:45.000727 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m13:51:45.000960 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:51:45.001094 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m13:51:45.001220 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.014089 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m13:51:45.014257 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:51:45.014406 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:51:45.018031 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.003 seconds
[0m13:51:45.019534 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:51:45.019675 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m13:51:45.020116 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.021940 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:51:45.022081 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m13:51:45.022456 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.023059 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:51:45.023196 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:51:45.023321 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:51:45.023904 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m13:51:45.024896 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m13:51:45.025211 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:51:45.025343 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m13:51:45.028072 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:51:45.028583 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m13:51:45.028843 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c370820>]}
[0m13:51:45.029114 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.03s]
[0m13:51:45.029360 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m13:51:45.029530 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m13:51:45.029767 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m13:51:45.029956 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m13:51:45.030114 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m13:51:45.031595 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m13:51:45.032085 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m13:51:45.033812 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m13:51:45.034088 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:51:45.034229 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m13:51:45.034360 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.041491 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:51:45.041650 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:51:45.041799 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:51:45.043541 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.002 seconds
[0m13:51:45.045021 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:51:45.045171 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m13:51:45.045823 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.047328 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:51:45.047500 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m13:51:45.047963 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.048674 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:51:45.048819 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:51:45.048946 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:51:45.049812 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:51:45.051364 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m13:51:45.051655 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:51:45.051789 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m13:51:45.053621 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:51:45.054095 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m13:51:45.054338 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd7d640>]}
[0m13:51:45.054596 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.02s]
[0m13:51:45.054844 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m13:51:45.054999 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m13:51:45.055210 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m13:51:45.055404 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m13:51:45.055549 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m13:51:45.056986 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m13:51:45.057301 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m13:51:45.058821 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m13:51:45.059059 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:51:45.059191 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m13:51:45.059315 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.065870 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:51:45.066042 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:51:45.066211 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:51:45.069982 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:51:45.071493 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:51:45.071651 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m13:51:45.072068 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.073476 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:51:45.073641 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m13:51:45.073988 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.074643 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:51:45.074791 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:51:45.074927 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:51:45.076174 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:51:45.077231 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m13:51:45.077547 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:51:45.077691 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m13:51:45.079752 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:51:45.080309 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m13:51:45.080608 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c41b7c0>]}
[0m13:51:45.080900 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:51:45.081155 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m13:51:45.081330 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m13:51:45.081556 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m13:51:45.081753 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m13:51:45.081903 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m13:51:45.083311 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m13:51:45.083857 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m13:51:45.086222 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m13:51:45.086471 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:51:45.086605 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m13:51:45.086731 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.093047 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:51:45.093194 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:51:45.093328 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:51:45.096446 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.003 seconds
[0m13:51:45.098081 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:51:45.098263 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m13:51:45.098729 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.100081 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:51:45.100228 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m13:51:45.100585 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.101234 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:51:45.101386 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:51:45.101530 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:51:45.102209 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:51:45.103272 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m13:51:45.103579 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:51:45.103721 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m13:51:45.104445 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:51:45.104942 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m13:51:45.105212 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c395f40>]}
[0m13:51:45.105500 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.02s]
[0m13:51:45.105745 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m13:51:45.105916 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m13:51:45.106146 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m13:51:45.106335 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m13:51:45.106494 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m13:51:45.107904 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m13:51:45.108212 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m13:51:45.109778 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m13:51:45.110021 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:51:45.110151 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m13:51:45.110276 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.117087 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:51:45.117283 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:51:45.117434 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:51:45.121117 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:51:45.122725 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:51:45.122878 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m13:51:45.123927 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:51:45.125798 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:51:45.125946 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m13:51:45.126548 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.127177 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:51:45.127323 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:51:45.127457 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:51:45.128479 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:51:45.129511 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m13:51:45.129867 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:51:45.130061 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m13:51:45.131934 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:51:45.132483 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m13:51:45.132743 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c44b9a0>]}
[0m13:51:45.133016 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:51:45.133265 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m13:51:45.133600 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m13:51:45.133804 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m13:51:45.133996 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m13:51:45.134145 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m13:51:45.135745 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m13:51:45.136060 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m13:51:45.137704 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m13:51:45.137958 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:51:45.138103 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m13:51:45.138241 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.145576 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:51:45.145797 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:51:45.145965 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

with today as (
    select current_date as today
)

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active basé sur le contrat
    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m13:51:45.150340 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:51:45.151969 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:51:45.152131 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m13:51:45.152628 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.154052 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:51:45.154216 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m13:51:45.155056 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:51:45.155727 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:51:45.155883 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:51:45.156023 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:51:45.157420 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:51:45.159078 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m13:51:45.159387 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:51:45.159528 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m13:51:45.161541 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:51:45.162026 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m13:51:45.162312 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c493460>]}
[0m13:51:45.162667 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:51:45.162963 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m13:51:45.163341 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m13:51:45.163543 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m13:51:45.163764 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m13:51:45.163913 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m13:51:45.165501 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m13:51:45.165839 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m13:51:45.167522 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m13:51:45.167770 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:51:45.167903 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m13:51:45.168031 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.173985 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:51:45.174153 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:51:45.174356 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    c.company_id,
    c.company_name,

    -- total d'employés historiques (y compris ceux qui ont quitté)
    count(e.employee_id) as total_employee,

    -- total d'employés actifs
    count(case when e.active = true then 1 end) as total_employee_active,

    -- total managers historiques
    sum(case when e.is_manager then 1 else 0 end) as total_manager,

    -- total managers actifs
    sum(case when e.is_manager and e.active = true then 1 else 0 end) as total_manager_active

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m13:51:45.174900 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column e.active does not exist
LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                             ^
HINT:  Perhaps you meant to reference the column "e.is_active".

[0m13:51:45.175070 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: ROLLBACK
[0m13:51:45.175423 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m13:51:45.187053 [debug] [Thread-1  ]: Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                               ^
  HINT:  Perhaps you meant to reference the column "e.is_active".
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql
[0m13:51:45.187314 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c440910>]}
[0m13:51:45.187587 [error] [Thread-1  ]: 8 of 9 ERROR creating sql table model public_transform.company_extended ........ [[31mERROR[0m in 0.02s]
[0m13:51:45.187835 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m13:51:45.187997 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m13:51:45.188186 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.company_extended' to be skipped because of status 'error'.  Reason: Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                               ^
  HINT:  Perhaps you meant to reference the column "e.is_active".
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql.
[0m13:51:45.188410 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m13:51:45.188679 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m13:51:45.188825 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m13:51:45.190430 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m13:51:45.190721 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m13:51:45.192271 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m13:51:45.192526 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:51:45.192661 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m13:51:45.192787 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:51:45.200289 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:51:45.200508 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:51:45.200647 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m13:51:45.205411 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m13:51:45.206917 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:51:45.207058 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m13:51:45.208330 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:51:45.209528 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:51:45.209663 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m13:51:45.210268 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:51:45.210936 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:51:45.211076 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:51:45.211203 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:51:45.212122 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:51:45.213844 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m13:51:45.214151 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:51:45.214288 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m13:51:45.216110 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:51:45.216603 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m13:51:45.216861 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7cd5134-6707-4d28-b3e4-a6ea8c8c0069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c517fa0>]}
[0m13:51:45.217119 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m13:51:45.217362 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m13:51:45.217815 [debug] [MainThread]: Using postgres connection "master"
[0m13:51:45.217963 [debug] [MainThread]: On master: BEGIN
[0m13:51:45.218083 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:51:45.224016 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:51:45.224175 [debug] [MainThread]: On master: COMMIT
[0m13:51:45.224311 [debug] [MainThread]: Using postgres connection "master"
[0m13:51:45.224433 [debug] [MainThread]: On master: COMMIT
[0m13:51:45.224699 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:51:45.224827 [debug] [MainThread]: On master: Close
[0m13:51:45.225005 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:51:45.225126 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m13:51:45.225301 [info ] [MainThread]: 
[0m13:51:45.225449 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m13:51:45.226142 [debug] [MainThread]: Command end result
[0m13:51:45.236469 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:51:45.237255 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:51:45.240533 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:51:45.240671 [info ] [MainThread]: 
[0m13:51:45.240831 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:51:45.240978 [info ] [MainThread]: 
[0m13:51:45.241149 [error] [MainThread]: [31mFailure in model company_extended (models/models/transform/company_extended.sql)[0m
[0m13:51:45.241315 [error] [MainThread]:   Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 22:     count(case when e.active = true then 1 end) as total_emp...
                               ^
  HINT:  Perhaps you meant to reference the column "e.is_active".
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql
[0m13:51:45.241449 [info ] [MainThread]: 
[0m13:51:45.241602 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/company_extended.sql
[0m13:51:45.241732 [info ] [MainThread]: 
[0m13:51:45.241874 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=9
[0m13:51:45.243475 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.88485175, "process_in_blocks": "0", "process_kernel_time": 0.170607, "process_mem_max_rss": "132022272", "process_out_blocks": "0", "process_user_time": 1.112294}
[0m13:51:45.243642 [debug] [MainThread]: Command `dbt run` failed at 13:51:45.243608 after 0.89 seconds
[0m13:51:45.243800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c8edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd2bc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f55ee0>]}
[0m13:51:45.243954 [debug] [MainThread]: Flushing usage events
[0m13:51:47.757275 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:52:05.751275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1a2d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b215160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b215c10>]}


============================== 13:52:05.752932 | 8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77 ==============================
[0m13:52:05.752932 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:52:05.753190 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'target_path': 'None', 'printer_width': '80', 'use_colors': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'fail_fast': 'False', 'quiet': 'False', 'version_check': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'empty': 'False', 'no_print': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'debug': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'write_json': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:52:05.823432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b25f6a0>]}
[0m13:52:05.848784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b90bfd0>]}
[0m13:52:05.849408 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:52:05.896904 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:52:05.958405 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:52:05.958704 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/company_extended.sql
[0m13:52:06.058954 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m13:52:06.065618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c420130>]}
[0m13:52:06.123413 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:52:06.124438 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:52:06.135815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c296e80>]}
[0m13:52:06.136115 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m13:52:06.136280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b90bb80>]}
[0m13:52:06.137043 [info ] [MainThread]: 
[0m13:52:06.137204 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:52:06.137334 [info ] [MainThread]: 
[0m13:52:06.137638 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:52:06.139906 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:52:06.165079 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:52:06.165286 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:52:06.165411 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:52:06.185264 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.020 seconds
[0m13:52:06.185848 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:52:06.187058 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:52:06.187206 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:52:06.187321 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:06.196227 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m13:52:06.196670 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:52:06.197320 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m13:52:06.200135 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:52:06.200287 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:52:06.200405 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:06.207499 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:52:06.207626 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:52:06.207746 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:52:06.210961 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m13:52:06.211454 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:52:06.211840 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:52:06.212056 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m13:52:06.213003 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:52:06.213138 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:52:06.213571 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:06.220227 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:52:06.220352 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:52:06.220481 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:52:06.223620 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m13:52:06.224126 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:52:06.224524 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:52:06.226760 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:06.226896 [debug] [MainThread]: On master: BEGIN
[0m13:52:06.227015 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:52:06.233389 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:52:06.233517 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:06.233673 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:52:06.237256 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m13:52:06.237696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108912df0>]}
[0m13:52:06.237892 [debug] [MainThread]: On master: ROLLBACK
[0m13:52:06.238342 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:06.238469 [debug] [MainThread]: On master: BEGIN
[0m13:52:06.239225 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:52:06.239356 [debug] [MainThread]: On master: COMMIT
[0m13:52:06.239480 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:06.239603 [debug] [MainThread]: On master: COMMIT
[0m13:52:06.239988 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:52:06.240123 [debug] [MainThread]: On master: Close
[0m13:52:06.241280 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:52:06.241503 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:52:06.241700 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m13:52:06.241858 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:52:06.245832 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.246146 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:52:06.262789 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.263193 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.263337 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:52:06.263470 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.272639 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:52:06.272793 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.272979 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:52:06.280216 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m13:52:06.285148 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.285320 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:52:06.286142 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.287459 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.287609 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:52:06.288722 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.295604 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:52:06.295777 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.295916 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:52:06.297402 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:06.299842 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:52:06.301545 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:06.301688 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:52:06.304810 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:52:06.305874 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:52:06.306810 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c75ffa0>]}
[0m13:52:06.307096 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:52:06.307351 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:52:06.307720 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m13:52:06.307963 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m13:52:06.308162 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m13:52:06.308304 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m13:52:06.309561 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m13:52:06.309806 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m13:52:06.311445 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m13:52:06.311683 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:06.311815 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m13:52:06.311942 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.320782 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:52:06.321013 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:06.321157 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:06.326803 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.005 seconds
[0m13:52:06.328618 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:06.328793 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m13:52:06.329625 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.331575 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:06.331723 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m13:52:06.332261 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.332912 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:52:06.333059 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:06.333196 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:52:06.334182 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:06.335257 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m13:52:06.335569 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:06.335717 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m13:52:06.338045 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:52:06.338543 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m13:52:06.338802 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8dbac0>]}
[0m13:52:06.339078 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.03s]
[0m13:52:06.339325 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m13:52:06.339494 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m13:52:06.339745 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m13:52:06.339982 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m13:52:06.340150 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m13:52:06.341597 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m13:52:06.341932 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m13:52:06.343660 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m13:52:06.343912 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:06.344049 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m13:52:06.344203 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.350625 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:52:06.350867 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:06.351033 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:06.356225 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:52:06.357788 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:06.357933 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m13:52:06.358926 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.360242 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:06.360388 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m13:52:06.360938 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.361704 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:52:06.361855 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:06.361990 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:52:06.363024 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:06.364704 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m13:52:06.365026 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:06.365170 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m13:52:06.367026 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:52:06.367523 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m13:52:06.367779 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9316d0>]}
[0m13:52:06.368052 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:52:06.368294 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m13:52:06.368462 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m13:52:06.368716 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m13:52:06.368948 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m13:52:06.369116 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m13:52:06.370652 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m13:52:06.370980 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m13:52:06.372586 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m13:52:06.372829 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:06.372966 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m13:52:06.373094 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.380473 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:06.380661 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:06.380835 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:06.385756 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:52:06.387345 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:06.387497 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m13:52:06.388587 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.389879 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:06.390027 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m13:52:06.390604 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.391254 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:52:06.391401 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:06.391539 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:52:06.392466 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:06.393535 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m13:52:06.393847 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:06.393991 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m13:52:06.395517 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:52:06.396063 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m13:52:06.396326 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a48a130>]}
[0m13:52:06.396599 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:52:06.396852 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m13:52:06.397021 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m13:52:06.397269 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m13:52:06.397495 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m13:52:06.397649 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m13:52:06.399071 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m13:52:06.399379 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m13:52:06.401718 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m13:52:06.401981 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:06.402123 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m13:52:06.402255 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.410278 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:52:06.410454 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:06.410615 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:06.414604 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m13:52:06.416237 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:06.416400 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m13:52:06.416957 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.418346 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:06.418496 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m13:52:06.419110 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.419764 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:52:06.419910 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:06.420046 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:52:06.421006 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:06.422107 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m13:52:06.422416 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:06.422561 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m13:52:06.425302 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:52:06.425820 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m13:52:06.426074 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a48a130>]}
[0m13:52:06.426346 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m13:52:06.426587 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m13:52:06.426754 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m13:52:06.426990 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m13:52:06.427192 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m13:52:06.427342 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m13:52:06.428882 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m13:52:06.429206 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m13:52:06.430895 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m13:52:06.431159 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:06.431306 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m13:52:06.431441 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.439859 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:52:06.440056 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:06.440210 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:06.444836 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:52:06.446451 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:06.446604 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m13:52:06.447315 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.449190 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:06.449336 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m13:52:06.449898 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.450539 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:52:06.450683 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:06.450818 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:52:06.451732 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:06.452791 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m13:52:06.453104 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:06.453248 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m13:52:06.455795 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:52:06.456289 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m13:52:06.456543 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c96c040>]}
[0m13:52:06.456816 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:52:06.457061 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m13:52:06.457382 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m13:52:06.457618 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m13:52:06.457817 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m13:52:06.457972 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m13:52:06.459615 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m13:52:06.459903 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m13:52:06.461662 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m13:52:06.461953 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:06.462103 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m13:52:06.462240 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.469644 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:06.469801 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:06.469964 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

with today as (
    select current_date as today
)

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active basé sur le contrat
    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m13:52:06.476100 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m13:52:06.477627 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:06.477784 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m13:52:06.478386 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.479742 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:06.479893 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m13:52:06.480499 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:06.481157 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:52:06.481311 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:06.481450 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:52:06.482338 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:06.484016 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m13:52:06.484342 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:06.484492 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m13:52:06.486561 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:52:06.487051 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m13:52:06.487309 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9a6370>]}
[0m13:52:06.487585 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:52:06.487827 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m13:52:06.488142 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m13:52:06.488367 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m13:52:06.488559 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m13:52:06.488708 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m13:52:06.490261 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m13:52:06.490555 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m13:52:06.492205 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m13:52:06.492456 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:52:06.492601 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m13:52:06.492743 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.499404 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:06.499595 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:52:06.499754 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    c.company_id,
    c.company_name,

    -- total d'employés historiques (y compris ceux qui ont quitté)
    count(e.employee_id) as total_employee,

    -- total d'employés actifs
    count(case when e.is_active = true then 1 end) as total_employee_active,

    -- total managers historiques
    sum(case when e.is_manager then 1 else 0 end) as total_manager,

    -- total managers actifs
    sum(case when e.is_manager and e.active = true then 1 else 0 end) as total_manager_active

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m13:52:06.501023 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column e.active does not exist
LINE 28:     sum(case when e.is_manager and e.active = true then 1 el...
                                            ^
HINT:  Perhaps you meant to reference the column "e.is_active".

[0m13:52:06.501174 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: ROLLBACK
[0m13:52:06.501651 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m13:52:06.513167 [debug] [Thread-1  ]: Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 28:     sum(case when e.is_manager and e.active = true then 1 el...
                                              ^
  HINT:  Perhaps you meant to reference the column "e.is_active".
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql
[0m13:52:06.513426 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3c57c0>]}
[0m13:52:06.513725 [error] [Thread-1  ]: 8 of 9 ERROR creating sql table model public_transform.company_extended ........ [[31mERROR[0m in 0.02s]
[0m13:52:06.513985 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m13:52:06.514163 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m13:52:06.514384 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.company_extended' to be skipped because of status 'error'.  Reason: Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 28:     sum(case when e.is_manager and e.active = true then 1 el...
                                              ^
  HINT:  Perhaps you meant to reference the column "e.is_active".
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql.
[0m13:52:06.514598 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m13:52:06.514850 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m13:52:06.515007 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m13:52:06.516553 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m13:52:06.516823 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m13:52:06.518396 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m13:52:06.518624 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:06.518759 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m13:52:06.518884 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:06.528057 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m13:52:06.528293 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:06.528471 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m13:52:06.534070 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m13:52:06.535687 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:06.535840 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m13:52:06.536937 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.538227 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:06.538373 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m13:52:06.539503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:06.540266 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:52:06.540442 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:06.540602 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:52:06.541185 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m13:52:06.542896 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m13:52:06.543219 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:06.543368 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m13:52:06.544308 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:52:06.544859 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m13:52:06.545137 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ef9a784-f9e7-4bf3-ba62-1c7b8ccc1a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca2beb0>]}
[0m13:52:06.545423 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m13:52:06.545667 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m13:52:06.546164 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:06.546314 [debug] [MainThread]: On master: BEGIN
[0m13:52:06.546438 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:52:06.551022 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:52:06.551217 [debug] [MainThread]: On master: COMMIT
[0m13:52:06.551362 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:06.551488 [debug] [MainThread]: On master: COMMIT
[0m13:52:06.551771 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:52:06.551917 [debug] [MainThread]: On master: Close
[0m13:52:06.552103 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:52:06.552230 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m13:52:06.552403 [info ] [MainThread]: 
[0m13:52:06.552552 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.41 seconds (0.41s).
[0m13:52:06.553276 [debug] [MainThread]: Command end result
[0m13:52:06.563455 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:52:06.564281 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:52:06.567188 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:52:06.567323 [info ] [MainThread]: 
[0m13:52:06.567483 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:52:06.567624 [info ] [MainThread]: 
[0m13:52:06.567793 [error] [MainThread]: [31mFailure in model company_extended (models/models/transform/company_extended.sql)[0m
[0m13:52:06.567958 [error] [MainThread]:   Database Error in model company_extended (models/models/transform/company_extended.sql)
  column e.active does not exist
  LINE 28:     sum(case when e.is_manager and e.active = true then 1 el...
                                              ^
  HINT:  Perhaps you meant to reference the column "e.is_active".
  compiled code at target/run/lucca_dbt/models/models/transform/company_extended.sql
[0m13:52:06.568088 [info ] [MainThread]: 
[0m13:52:06.568235 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/company_extended.sql
[0m13:52:06.568375 [info ] [MainThread]: 
[0m13:52:06.568515 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=9
[0m13:52:06.569862 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.84869814, "process_in_blocks": "0", "process_kernel_time": 0.120657, "process_mem_max_rss": "132300800", "process_out_blocks": "0", "process_user_time": 1.11626}
[0m13:52:06.570020 [debug] [MainThread]: Command `dbt run` failed at 13:52:06.569987 after 0.85 seconds
[0m13:52:06.570173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1a2d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b25f640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1e7fd0>]}
[0m13:52:06.570319 [debug] [MainThread]: Flushing usage events
[0m13:52:07.498512 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:52:17.976966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107986e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089fbd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089fb250>]}


============================== 13:52:17.979143 | 00f5f9f7-3391-4272-b378-6ed0111c2429 ==============================
[0m13:52:17.979143 [info ] [MainThread]: Running with dbt=1.10.17
[0m13:52:17.979405 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/marccao/repo/dbt', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'target_path': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'introspect': 'True', 'no_print': 'None', 'version_check': 'True', 'static_parser': 'True', 'debug': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'quiet': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'warn_error': 'None'}
[0m13:52:18.065262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632da60>]}
[0m13:52:18.090060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cc6250>]}
[0m13:52:18.090659 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:52:18.141229 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m13:52:18.203862 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:52:18.204167 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/company_extended.sql
[0m13:52:18.307376 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
[0m13:52:18.314757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b75130>]}
[0m13:52:18.372310 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:52:18.373479 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:52:18.382486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089cb6a0>]}
[0m13:52:18.382708 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m13:52:18.382861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a9b4c0>]}
[0m13:52:18.383518 [info ] [MainThread]: 
[0m13:52:18.383671 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:52:18.383799 [info ] [MainThread]: 
[0m13:52:18.384019 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:52:18.386096 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m13:52:18.413341 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:52:18.413556 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:52:18.413690 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:52:18.443180 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.029 seconds
[0m13:52:18.443805 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:52:18.445046 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m13:52:18.445215 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m13:52:18.445388 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:18.454297 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m13:52:18.454805 [debug] [ThreadPool]: On list_lucca_db: Close
[0m13:52:18.455477 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m13:52:18.458293 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:52:18.458430 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m13:52:18.458544 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:18.466295 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:52:18.466433 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m13:52:18.466561 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m13:52:18.470634 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.004 seconds
[0m13:52:18.471176 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m13:52:18.471729 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m13:52:18.471970 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m13:52:18.473114 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:52:18.473246 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m13:52:18.473362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:52:18.480779 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.480912 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m13:52:18.481040 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m13:52:18.484255 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m13:52:18.484796 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m13:52:18.485221 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m13:52:18.487580 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:18.487729 [debug] [MainThread]: On master: BEGIN
[0m13:52:18.487856 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:52:18.494763 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.494904 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:18.495059 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:52:18.498830 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m13:52:18.499300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109812490>]}
[0m13:52:18.499501 [debug] [MainThread]: On master: ROLLBACK
[0m13:52:18.499891 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:18.500020 [debug] [MainThread]: On master: BEGIN
[0m13:52:18.500650 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:52:18.500778 [debug] [MainThread]: On master: COMMIT
[0m13:52:18.500900 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:18.501021 [debug] [MainThread]: On master: COMMIT
[0m13:52:18.501394 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:52:18.501518 [debug] [MainThread]: On master: Close
[0m13:52:18.503355 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m13:52:18.503596 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m13:52:18.503796 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m13:52:18.503965 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m13:52:18.507936 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.508234 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m13:52:18.524749 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.525152 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.525296 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m13:52:18.525424 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.533854 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m13:52:18.534009 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.534183 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m13:52:18.542889 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m13:52:18.547971 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.548164 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m13:52:18.548790 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.550224 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.550378 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m13:52:18.550819 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.557863 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:52:18.558015 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.558148 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m13:52:18.558857 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.561734 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m13:52:18.563589 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m13:52:18.563742 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m13:52:18.564593 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:52:18.565656 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m13:52:18.566660 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f29df0>]}
[0m13:52:18.566954 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m13:52:18.567204 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m13:52:18.567544 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m13:52:18.567781 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m13:52:18.568010 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m13:52:18.568170 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m13:52:18.569468 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m13:52:18.569742 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m13:52:18.571426 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m13:52:18.571670 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:18.571818 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m13:52:18.571944 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.578057 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m13:52:18.578265 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:18.578404 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:18.580867 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.002 seconds
[0m13:52:18.582541 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:18.582690 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m13:52:18.583079 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.584843 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:18.584977 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m13:52:18.585292 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.585938 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:52:18.586073 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:18.586196 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m13:52:18.586772 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m13:52:18.587773 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m13:52:18.588059 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m13:52:18.588210 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m13:52:18.588983 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:52:18.589523 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m13:52:18.589801 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0a0c70>]}
[0m13:52:18.590081 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.02s]
[0m13:52:18.590326 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m13:52:18.590499 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m13:52:18.590734 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m13:52:18.590919 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m13:52:18.591071 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m13:52:18.592463 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m13:52:18.592761 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m13:52:18.594504 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m13:52:18.594809 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:18.594954 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m13:52:18.595083 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.599681 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m13:52:18.599858 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:18.599995 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:18.601974 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.002 seconds
[0m13:52:18.603595 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:18.603762 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m13:52:18.604679 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:18.605962 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:18.606102 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m13:52:18.606599 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.607190 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:52:18.607328 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:18.607453 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m13:52:18.608282 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.609828 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m13:52:18.610123 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m13:52:18.610256 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m13:52:18.611426 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:52:18.611985 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m13:52:18.612246 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a047760>]}
[0m13:52:18.612529 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.02s]
[0m13:52:18.612938 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m13:52:18.613124 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m13:52:18.613378 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m13:52:18.613610 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m13:52:18.613752 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m13:52:18.615230 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m13:52:18.615562 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m13:52:18.617157 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m13:52:18.617406 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:18.617541 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m13:52:18.617670 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.625027 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.625179 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:18.625347 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:18.629156 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:52:18.630709 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:18.630852 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m13:52:18.631357 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.632518 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:18.632653 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m13:52:18.633060 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.633630 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:52:18.633762 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:18.633887 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m13:52:18.634633 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.635601 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m13:52:18.635880 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m13:52:18.636013 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m13:52:18.638542 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:52:18.638989 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m13:52:18.639237 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0f3880>]}
[0m13:52:18.639489 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:52:18.639736 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m13:52:18.639885 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m13:52:18.640102 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m13:52:18.640323 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m13:52:18.640472 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m13:52:18.641803 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m13:52:18.642111 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m13:52:18.644453 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m13:52:18.644729 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:18.644863 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m13:52:18.644992 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.652171 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.652349 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:18.652497 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:18.657140 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m13:52:18.658575 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:18.658717 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m13:52:18.659354 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.660702 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:18.660868 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m13:52:18.661353 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.662058 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:52:18.662203 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:18.662335 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m13:52:18.663232 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.664277 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m13:52:18.664571 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m13:52:18.664710 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m13:52:18.666301 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:52:18.666769 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m13:52:18.667006 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f03df0>]}
[0m13:52:18.667261 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m13:52:18.667506 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m13:52:18.667658 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m13:52:18.667862 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m13:52:18.668046 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m13:52:18.668184 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m13:52:18.669477 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m13:52:18.669746 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m13:52:18.671278 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m13:52:18.671502 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:18.671630 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m13:52:18.671752 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.678613 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.678772 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:18.678912 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m13:52:18.682835 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m13:52:18.684275 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:18.684415 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m13:52:18.684941 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.686801 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:18.686940 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m13:52:18.687852 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:18.688449 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:52:18.688589 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:18.688715 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m13:52:18.689911 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.690929 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m13:52:18.691219 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m13:52:18.691372 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m13:52:18.693129 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m13:52:18.693622 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m13:52:18.693893 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a125820>]}
[0m13:52:18.694239 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m13:52:18.694496 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m13:52:18.694854 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m13:52:18.695081 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m13:52:18.695294 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m13:52:18.695449 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m13:52:18.697121 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m13:52:18.697463 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m13:52:18.699087 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m13:52:18.699333 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:18.699468 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m13:52:18.699594 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.707083 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.707266 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:18.707435 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

with today as (
    select current_date as today
)

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active basé sur le contrat
    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m13:52:18.712450 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m13:52:18.714207 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:18.714369 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m13:52:18.714966 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.716244 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:18.716392 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m13:52:18.716887 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.717516 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:52:18.717662 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:18.717799 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m13:52:18.718883 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.720479 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m13:52:18.720789 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m13:52:18.720941 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m13:52:18.723791 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m13:52:18.724267 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m13:52:18.724521 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a162460>]}
[0m13:52:18.724786 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m13:52:18.725027 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m13:52:18.725361 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m13:52:18.725598 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m13:52:18.725797 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m13:52:18.725947 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m13:52:18.727552 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m13:52:18.727881 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m13:52:18.729546 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m13:52:18.729805 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:52:18.729953 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m13:52:18.730092 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.737547 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.737714 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:52:18.737877 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    c.company_id,
    c.company_name,

    -- total d'employés historiques (y compris ceux qui ont quitté)
    count(e.employee_id) as total_employee,

    -- total d'employés actifs
    count(case when e.is_active = true then 1 end) as total_employee_active,

    -- total managers historiques
    sum(case when e.is_manager then 1 else 0 end) as total_manager,

    -- total managers actifs
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m13:52:18.742926 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.005 seconds
[0m13:52:18.744432 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:52:18.744642 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m13:52:18.745092 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:52:18.745660 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m13:52:18.745806 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:52:18.745941 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m13:52:18.746818 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.747872 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m13:52:18.748173 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m13:52:18.748318 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m13:52:18.748724 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m13:52:18.749198 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m13:52:18.749441 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091b4eb0>]}
[0m13:52:18.749706 [info ] [Thread-1  ]: 8 of 9 OK created sql table model public_transform.company_extended ............ [[32mSELECT 5[0m in 0.02s]
[0m13:52:18.749942 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m13:52:18.750106 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m13:52:18.750337 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m13:52:18.750545 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m13:52:18.750700 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m13:52:18.752265 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m13:52:18.752577 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m13:52:18.754240 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m13:52:18.754504 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:18.754647 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m13:52:18.754782 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:18.761972 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.762166 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:18.762321 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m13:52:18.767399 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m13:52:18.769631 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:18.769783 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m13:52:18.770554 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:18.771817 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:18.771968 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m13:52:18.773236 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:52:18.773862 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:52:18.774006 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:18.774143 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m13:52:18.775209 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:52:18.776271 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m13:52:18.776579 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m13:52:18.776723 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m13:52:18.777971 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m13:52:18.778476 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m13:52:18.778736 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00f5f9f7-3391-4272-b378-6ed0111c2429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091b4eb0>]}
[0m13:52:18.779011 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m13:52:18.779259 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m13:52:18.779750 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:18.779898 [debug] [MainThread]: On master: BEGIN
[0m13:52:18.780023 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:52:18.787125 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:52:18.787261 [debug] [MainThread]: On master: COMMIT
[0m13:52:18.787400 [debug] [MainThread]: Using postgres connection "master"
[0m13:52:18.787525 [debug] [MainThread]: On master: COMMIT
[0m13:52:18.787945 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:52:18.788076 [debug] [MainThread]: On master: Close
[0m13:52:18.788243 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:52:18.788359 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m13:52:18.788524 [info ] [MainThread]: 
[0m13:52:18.788671 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.40 seconds (0.40s).
[0m13:52:18.789369 [debug] [MainThread]: Command end result
[0m13:52:18.800288 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m13:52:18.801097 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m13:52:18.804075 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m13:52:18.804206 [info ] [MainThread]: 
[0m13:52:18.804370 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:52:18.804515 [info ] [MainThread]: 
[0m13:52:18.804671 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m13:52:18.806044 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.86140907, "process_in_blocks": "0", "process_kernel_time": 0.146014, "process_mem_max_rss": "131825664", "process_out_blocks": "0", "process_user_time": 1.11836}
[0m13:52:18.806212 [debug] [MainThread]: Command `dbt run` succeeded at 13:52:18.806177 after 0.86 seconds
[0m13:52:18.806367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107986e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a0fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632da60>]}
[0m13:52:18.806518 [debug] [MainThread]: Flushing usage events
[0m13:52:19.827109 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:17:34.023601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109afde50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab73ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab73430>]}


============================== 14:17:34.025954 | 5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9 ==============================
[0m14:17:34.025954 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:17:34.026226 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'empty': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/marccao/repo/dbt', 'quiet': 'False', 'target_path': 'None', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'printer_width': '80', 'partial_parse': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'warn_error': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'log_cache_events': 'False', 'version_check': 'True'}
[0m14:17:34.113894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084a5e20>]}
[0m14:17:34.139016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10959b460>]}
[0m14:17:34.139625 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:17:34.190073 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:17:34.256282 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:17:34.256566 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/company_extended.sql
[0m14:17:34.359002 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m14:17:34.365561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd0c130>]}
[0m14:17:34.424002 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:17:34.425144 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:17:34.434985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e3c190>]}
[0m14:17:34.435201 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m14:17:34.435356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085d1d60>]}
[0m14:17:34.436016 [info ] [MainThread]: 
[0m14:17:34.436168 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:17:34.436292 [info ] [MainThread]: 
[0m14:17:34.436510 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:17:34.438494 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:17:34.466384 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:17:34.466588 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:17:34.466713 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:34.497762 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.031 seconds
[0m14:17:34.498349 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:17:34.499544 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:17:34.499693 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:17:34.499803 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:34.508004 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m14:17:34.508441 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:17:34.509084 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m14:17:34.511821 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:17:34.511947 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:17:34.512054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:34.518903 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:17:34.519054 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:17:34.519185 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:17:34.522547 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:17:34.523092 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:17:34.523535 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:17:34.523763 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m14:17:34.525006 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:17:34.525133 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:17:34.525242 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:34.531765 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:17:34.531900 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:17:34.532031 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:17:34.534900 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m14:17:34.535445 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:17:34.535840 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:17:34.538105 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:34.538248 [debug] [MainThread]: On master: BEGIN
[0m14:17:34.538365 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:17:34.544727 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:17:34.544855 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:34.545007 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:17:34.548524 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m14:17:34.548974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab4d460>]}
[0m14:17:34.549187 [debug] [MainThread]: On master: ROLLBACK
[0m14:17:34.549611 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:34.549736 [debug] [MainThread]: On master: BEGIN
[0m14:17:34.550329 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:17:34.550459 [debug] [MainThread]: On master: COMMIT
[0m14:17:34.550580 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:34.550700 [debug] [MainThread]: On master: COMMIT
[0m14:17:34.551054 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:17:34.551184 [debug] [MainThread]: On master: Close
[0m14:17:34.552911 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:17:34.553129 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:17:34.553331 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m14:17:34.553484 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:17:34.557408 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.557835 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:17:34.574789 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.575202 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.575350 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:17:34.575482 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.584765 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:17:34.584936 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.585103 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:17:34.593742 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m14:17:34.598754 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.598927 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:17:34.599900 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:17:34.601212 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.601362 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:17:34.601921 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.608912 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:17:34.609073 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.609203 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:17:34.610643 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.613213 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:17:34.614892 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:17:34.615031 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:17:34.617450 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.618444 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:17:34.619439 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0c5eb0>]}
[0m14:17:34.619705 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m14:17:34.619957 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:17:34.620301 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m14:17:34.620505 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m14:17:34.620713 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m14:17:34.620854 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m14:17:34.622077 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m14:17:34.622332 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m14:17:34.623934 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m14:17:34.624215 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:17:34.624351 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m14:17:34.624478 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.633175 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:17:34.633377 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:17:34.633511 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:17:34.638419 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.005 seconds
[0m14:17:34.639998 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:17:34.640150 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m14:17:34.640799 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.642832 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:17:34.642973 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m14:17:34.643536 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.644141 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:17:34.644277 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:17:34.644402 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:17:34.645348 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.646346 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m14:17:34.646630 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:17:34.646762 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m14:17:34.649370 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.649861 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m14:17:34.650111 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c238df0>]}
[0m14:17:34.650380 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.03s]
[0m14:17:34.650619 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m14:17:34.650784 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m14:17:34.651019 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m14:17:34.651229 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m14:17:34.651383 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m14:17:34.652803 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m14:17:34.653248 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m14:17:34.654869 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m14:17:34.655094 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:17:34.655222 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m14:17:34.655346 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.663471 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:17:34.663684 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:17:34.663826 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    


select 

id as employee_id,
employee_number,
last_name,
first_name,
contract_start_date,
contract_end_date,
legalEntity_id as company_id,
legalEntity_name as company_name,

roleprincipal_id as jobtitle_id,
roleprincipal_name as jobtitle_name,


modified_at,
refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:17:34.668889 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:17:34.670540 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:17:34.670691 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m14:17:34.671640 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:17:34.672961 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:17:34.673108 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m14:17:34.673672 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.674458 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:17:34.674615 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:17:34.674750 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:17:34.675636 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.677277 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m14:17:34.677589 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:17:34.677731 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m14:17:34.680022 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.680539 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m14:17:34.680795 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c28aa00>]}
[0m14:17:34.681064 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:17:34.681301 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m14:17:34.681467 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m14:17:34.681697 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m14:17:34.681897 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m14:17:34.682047 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m14:17:34.683539 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m14:17:34.683846 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m14:17:34.685562 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m14:17:34.685819 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:17:34.685965 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m14:17:34.686106 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.693182 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:17:34.693359 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:17:34.693531 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:17:34.698520 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:17:34.700059 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:17:34.700207 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m14:17:34.701170 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:17:34.702453 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:17:34.702598 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m14:17:34.703145 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.703775 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:17:34.703920 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:17:34.704054 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:17:34.705155 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.706230 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m14:17:34.706533 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:17:34.706675 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m14:17:34.708371 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.708888 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m14:17:34.709147 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10959b8b0>]}
[0m14:17:34.709418 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:17:34.709657 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m14:17:34.709819 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m14:17:34.710058 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m14:17:34.710298 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m14:17:34.710468 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m14:17:34.711938 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m14:17:34.712489 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m14:17:34.714741 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m14:17:34.714999 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:17:34.715143 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m14:17:34.715279 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.723246 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:17:34.723433 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:17:34.723595 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    


select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:17:34.727484 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m14:17:34.729015 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:17:34.729168 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m14:17:34.729697 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.731001 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:17:34.731149 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m14:17:34.731634 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.732258 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:17:34.732402 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:17:34.732538 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:17:34.733575 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.734634 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m14:17:34.734942 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:17:34.735089 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m14:17:34.737600 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.738084 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m14:17:34.738331 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b230ca0>]}
[0m14:17:34.738595 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m14:17:34.738834 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m14:17:34.738996 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:17:34.739226 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m14:17:34.739444 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m14:17:34.739598 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:17:34.741115 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:17:34.741421 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:17:34.743089 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:17:34.743333 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:17:34.743469 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:17:34.743599 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.750695 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:17:34.750875 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:17:34.751038 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:17:34.755281 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:17:34.756802 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:17:34.756959 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m14:17:34.757516 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.759719 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:17:34.759876 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m14:17:34.760456 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.761117 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:17:34.761265 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:17:34.761400 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:17:34.762704 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.763773 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m14:17:34.764081 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:17:34.764226 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m14:17:34.766382 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.766870 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:17:34.767122 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2729a0>]}
[0m14:17:34.767389 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:17:34.767627 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:17:34.767958 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m14:17:34.768221 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m14:17:34.768434 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m14:17:34.768592 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m14:17:34.770248 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m14:17:34.770583 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m14:17:34.772269 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m14:17:34.772546 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:17:34.772699 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m14:17:34.772841 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.779464 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:17:34.779656 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:17:34.779825 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

with today as (
    select current_date as today
)

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active basé sur le contrat
    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m14:17:34.785941 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m14:17:34.787589 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:17:34.787756 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m14:17:34.788488 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:17:34.789843 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:17:34.789997 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m14:17:34.790605 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.791304 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:17:34.791458 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:17:34.791597 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:17:34.792522 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.794213 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m14:17:34.794524 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:17:34.794666 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m14:17:34.796722 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.797234 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m14:17:34.797487 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2729a0>]}
[0m14:17:34.797750 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:17:34.797987 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m14:17:34.798303 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m14:17:34.798515 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m14:17:34.798740 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m14:17:34.798907 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m14:17:34.800500 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m14:17:34.800799 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m14:17:34.802506 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m14:17:34.802776 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:17:34.802922 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m14:17:34.803060 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.811261 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:17:34.811436 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:17:34.811592 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    c.company_id,
    c.company_name,

    -- total d'employés historiques (y compris ceux qui ont quitté)
    count(e.employee_id) as total_employee,

    -- total d'employés actifs
    count(case when e.is_active = true then 1 end) as total_employee_active,

    -- total managers historiques
    sum(case when e.is_manager then 1 else 0 end) as total_manager,

    -- total managers actifs
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active,

    count(distinct e.department_id) as total_department

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m14:17:34.817290 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.006 seconds
[0m14:17:34.818888 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:17:34.819042 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended" rename to "company_extended__dbt_backup"
[0m14:17:34.820575 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:17:34.821879 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:17:34.822031 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m14:17:34.822557 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.823201 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:17:34.823351 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:17:34.823492 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:17:34.824580 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.825717 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m14:17:34.826040 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:17:34.826190 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m14:17:34.828144 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.828658 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m14:17:34.828916 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbb7370>]}
[0m14:17:34.829191 [info ] [Thread-1  ]: 8 of 9 OK created sql table model public_transform.company_extended ............ [[32mSELECT 5[0m in 0.03s]
[0m14:17:34.829426 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m14:17:34.829593 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m14:17:34.829819 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m14:17:34.830024 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m14:17:34.830188 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m14:17:34.831794 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m14:17:34.832251 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m14:17:34.834807 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m14:17:34.835285 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:17:34.835446 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m14:17:34.835592 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:17:34.843364 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:17:34.843547 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:17:34.843711 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m14:17:34.848593 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.005 seconds
[0m14:17:34.850276 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:17:34.850445 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m14:17:34.851532 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:17:34.852952 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:17:34.853115 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m14:17:34.853700 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:17:34.854404 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:17:34.854566 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:17:34.854713 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:17:34.855865 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:17:34.857045 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m14:17:34.857410 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:17:34.857588 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m14:17:34.859521 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:17:34.860083 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m14:17:34.860363 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c82e7d8-5143-4fb3-bc4e-550cd9e55eb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b338f70>]}
[0m14:17:34.860660 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m14:17:34.860917 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m14:17:34.861397 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:34.861541 [debug] [MainThread]: On master: BEGIN
[0m14:17:34.861668 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:17:34.869229 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:17:34.869376 [debug] [MainThread]: On master: COMMIT
[0m14:17:34.869508 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:34.869638 [debug] [MainThread]: On master: COMMIT
[0m14:17:34.870059 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:17:34.870194 [debug] [MainThread]: On master: Close
[0m14:17:34.870367 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:17:34.870489 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m14:17:34.870666 [info ] [MainThread]: 
[0m14:17:34.870816 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.43 seconds (0.43s).
[0m14:17:34.871568 [debug] [MainThread]: Command end result
[0m14:17:34.882973 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:17:34.883771 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:17:34.887117 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:17:34.887257 [info ] [MainThread]: 
[0m14:17:34.887422 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:17:34.887560 [info ] [MainThread]: 
[0m14:17:34.887707 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m14:17:34.889118 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8980864, "process_in_blocks": "0", "process_kernel_time": 0.156379, "process_mem_max_rss": "131661824", "process_out_blocks": "0", "process_user_time": 1.124692}
[0m14:17:34.889292 [debug] [MainThread]: Command `dbt run` succeeded at 14:17:34.889257 after 0.90 seconds
[0m14:17:34.889453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109afde50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0425b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e5a130>]}
[0m14:17:34.889616 [debug] [MainThread]: Flushing usage events
[0m14:17:35.439931 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:19:51.718784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a00adf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b07ff40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b07f490>]}


============================== 14:19:51.720900 | 9817ce9f-1e52-4af9-a5a1-d952ecc4348b ==============================
[0m14:19:51.720900 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:19:51.721149 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'version_check': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'warn_error': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'use_colors': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/Users/marccao/repo/dbt', 'target_path': 'None', 'write_json': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'debug': 'False', 'invocation_command': 'dbt run', 'log_format': 'default', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'introspect': 'True'}
[0m14:19:51.797165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9817ce9f-1e52-4af9-a5a1-d952ecc4348b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b059970>]}
[0m14:19:51.822543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9817ce9f-1e52-4af9-a5a1-d952ecc4348b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9332e0>]}
[0m14:19:51.823178 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:19:51.870542 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:19:51.932793 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m14:19:51.933085 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/contract.sql
[0m14:19:51.933253 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/company.sql
[0m14:19:51.933407 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/department.sql
[0m14:19:52.011694 [error] [MainThread]: Encountered an error:
Compilation Error in model contract (models/models/base/contract.sql)
  expected token ',', got ':'
    line 4
      --description: "Table pour regrouper les informations sur les contrats "
[0m14:19:52.013068 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.32574043, "process_in_blocks": "0", "process_kernel_time": 0.111037, "process_mem_max_rss": "112836608", "process_out_blocks": "0", "process_user_time": 0.801484}
[0m14:19:52.013276 [debug] [MainThread]: Command `dbt run` failed at 14:19:52.013236 after 0.33 seconds
[0m14:19:52.013446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a00adf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1fe3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1fe6d0>]}
[0m14:19:52.013609 [debug] [MainThread]: Flushing usage events
[0m14:19:53.904478 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:23:15.883106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bee6e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf5cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf5c430>]}


============================== 14:23:15.885581 | 1b620ec1-5fbd-429b-820e-36526c15211c ==============================
[0m14:23:15.885581 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:23:15.885847 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'use_colors': 'True', 'printer_width': '80', 'warn_error': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'partial_parse': 'True', 'version_check': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'static_parser': 'True', 'target_path': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'profiles_dir': '/Users/marccao/repo/dbt', 'write_json': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'empty': 'False'}
[0m14:23:15.978779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a88de20>]}
[0m14:23:16.004229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b983460>]}
[0m14:23:16.004866 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:23:16.074157 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:23:16.139664 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m14:23:16.139933 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/company.sql
[0m14:23:16.140100 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/department.sql
[0m14:23:16.140251 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/contract.sql
[0m14:23:16.246834 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m14:23:16.253679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0de130>]}
[0m14:23:16.310915 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:23:16.312335 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:23:16.321947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e081a90>]}
[0m14:23:16.322171 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m14:23:16.322323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd729d0>]}
[0m14:23:16.323007 [info ] [MainThread]: 
[0m14:23:16.323160 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:23:16.323288 [info ] [MainThread]: 
[0m14:23:16.323504 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:23:16.325522 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:23:16.353548 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:23:16.353754 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:23:16.353876 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:23:16.390052 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.036 seconds
[0m14:23:16.390676 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:23:16.392128 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:23:16.392283 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:23:16.392395 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:23:16.401130 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m14:23:16.401627 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:23:16.402336 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:23:16.404920 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:23:16.405073 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:23:16.405188 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:23:16.412025 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:23:16.412154 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:23:16.412276 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:23:16.415677 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m14:23:16.416178 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:23:16.416592 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:23:16.416816 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:23:16.418002 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:23:16.418142 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:23:16.418261 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:23:16.425162 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:23:16.425289 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:23:16.425415 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:23:16.428594 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:23:16.429127 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:23:16.429518 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:23:16.431871 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:16.432018 [debug] [MainThread]: On master: BEGIN
[0m14:23:16.432138 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:23:16.439104 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:23:16.439253 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:16.439420 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:23:16.443185 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m14:23:16.443663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c242b80>]}
[0m14:23:16.443882 [debug] [MainThread]: On master: ROLLBACK
[0m14:23:16.444268 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:16.444398 [debug] [MainThread]: On master: BEGIN
[0m14:23:16.445056 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:23:16.445187 [debug] [MainThread]: On master: COMMIT
[0m14:23:16.445311 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:16.445430 [debug] [MainThread]: On master: COMMIT
[0m14:23:16.445799 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:16.445932 [debug] [MainThread]: On master: Close
[0m14:23:16.447722 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:23:16.447959 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:23:16.448153 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:23:16.448303 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:23:16.452181 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.452604 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:23:16.469946 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.470366 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.470517 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:23:16.470653 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.480705 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m14:23:16.480866 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.481044 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    

select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,

    -- Habilited roles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,

    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,

    -- User work cycles (tableau)
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,

    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:23:16.488672 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m14:23:16.493069 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.493235 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:23:16.494041 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:23:16.495333 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.495482 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:23:16.496043 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.503064 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:23:16.503225 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.503370 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:23:16.504633 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.507136 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:23:16.508840 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:23:16.508981 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:23:16.511946 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:23:16.513019 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:23:16.514077 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e465190>]}
[0m14:23:16.514357 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m14:23:16.514611 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:23:16.514987 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m14:23:16.515212 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m14:23:16.515411 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m14:23:16.515570 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m14:23:16.516880 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m14:23:16.517261 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m14:23:16.518926 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m14:23:16.519163 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:23:16.519296 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m14:23:16.519421 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.526934 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:23:16.527144 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:23:16.527284 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    
    --description: "Table pour regrouper les informations sur les entreprises "
select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:23:16.532400 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.005 seconds
[0m14:23:16.534586 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:23:16.534738 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m14:23:16.535464 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:23:16.536704 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:23:16.536841 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m14:23:16.537489 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:23:16.538087 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:23:16.538220 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:23:16.538349 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:23:16.539295 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.540277 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m14:23:16.540564 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:23:16.540695 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m14:23:16.542647 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:23:16.543132 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m14:23:16.543385 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e602f70>]}
[0m14:23:16.543655 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.03s]
[0m14:23:16.543893 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m14:23:16.544058 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m14:23:16.544289 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m14:23:16.544485 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m14:23:16.544626 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m14:23:16.545938 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m14:23:16.546360 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m14:23:16.547953 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m14:23:16.548193 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:23:16.548326 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m14:23:16.548454 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.555530 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:23:16.555755 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:23:16.555908 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    
    --description: "Table pour regrouper les informations sur les contrats "
select 
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id as company_id,
    legalEntity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:23:16.560672 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:23:16.562283 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:23:16.562435 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m14:23:16.563672 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:23:16.564982 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:23:16.565126 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m14:23:16.565635 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.566257 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:23:16.566399 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:23:16.566530 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:23:16.567642 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.569443 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m14:23:16.569761 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:23:16.569908 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m14:23:16.572120 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:23:16.572652 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m14:23:16.572910 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e602f70>]}
[0m14:23:16.573182 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:23:16.573424 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m14:23:16.573592 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m14:23:16.573823 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m14:23:16.574020 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m14:23:16.574172 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m14:23:16.575621 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m14:23:16.575924 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m14:23:16.577602 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m14:23:16.577838 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:23:16.577972 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m14:23:16.578102 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.585588 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:23:16.585750 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:23:16.585933 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:23:16.590084 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:23:16.591645 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:23:16.591805 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m14:23:16.592363 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.593673 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:23:16.593821 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m14:23:16.594607 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:23:16.595244 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:23:16.595390 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:23:16.595528 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:23:16.596881 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.597938 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m14:23:16.598246 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:23:16.598390 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m14:23:16.601053 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:23:16.601575 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m14:23:16.601931 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e602f70>]}
[0m14:23:16.602209 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:23:16.602448 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m14:23:16.602617 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m14:23:16.602857 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m14:23:16.603070 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m14:23:16.603225 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m14:23:16.604623 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m14:23:16.604926 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m14:23:16.607297 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m14:23:16.607564 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:23:16.607708 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m14:23:16.607844 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.615416 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:23:16.615566 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:23:16.615721 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    
    --description: "Table pour regrouper les informations sur les départements "

select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:23:16.619743 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m14:23:16.621216 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:23:16.621362 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m14:23:16.621969 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.623198 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:23:16.623341 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m14:23:16.623819 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.624434 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:23:16.624579 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:23:16.624711 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:23:16.625521 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.626550 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m14:23:16.626849 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:23:16.626988 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m14:23:16.629193 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:23:16.629666 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m14:23:16.629906 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e602f70>]}
[0m14:23:16.630163 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m14:23:16.630398 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m14:23:16.630560 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:23:16.630803 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m14:23:16.631027 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m14:23:16.631190 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:23:16.632597 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:23:16.632915 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:23:16.634614 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:23:16.634889 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:23:16.635043 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:23:16.635235 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.643333 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:23:16.643490 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:23:16.643642 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    

select

    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:23:16.648761 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:23:16.650882 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:23:16.651037 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m14:23:16.651665 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.653083 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:23:16.653233 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m14:23:16.653834 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.654487 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:23:16.654639 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:23:16.654777 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:23:16.655641 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.656702 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m14:23:16.657018 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:23:16.657162 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m14:23:16.659242 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:23:16.659730 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:23:16.659983 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e602f70>]}
[0m14:23:16.660255 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:23:16.660501 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:23:16.660815 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m14:23:16.661046 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m14:23:16.661265 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m14:23:16.661425 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m14:23:16.663091 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m14:23:16.663397 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m14:23:16.665070 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m14:23:16.665325 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:23:16.665468 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m14:23:16.665602 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.673085 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:23:16.673248 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:23:16.673411 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

with today as (
    select current_date as today
)

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active basé sur le contrat
    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m14:23:16.679701 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m14:23:16.681221 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:23:16.681384 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m14:23:16.682177 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:23:16.683482 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:23:16.683633 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m14:23:16.684119 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.684777 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:23:16.684951 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:23:16.685097 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:23:16.686483 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.688221 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m14:23:16.688542 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:23:16.688689 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m14:23:16.690958 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:23:16.691466 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m14:23:16.691711 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e48a1c0>]}
[0m14:23:16.691976 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:23:16.692206 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m14:23:16.692538 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m14:23:16.692741 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m14:23:16.692928 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m14:23:16.693081 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m14:23:16.694647 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m14:23:16.694958 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m14:23:16.696677 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m14:23:16.696930 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:23:16.697076 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m14:23:16.697216 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.702625 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:23:16.702925 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:23:16.703097 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    c.company_id,
    c.company_name,

    -- total d'employés historiques (y compris ceux qui ont quitté)
    count(e.employee_id) as total_employee,

    -- total d'employés actifs
    count(case when e.is_active = true then 1 end) as total_employee_active,

    -- total managers historiques
    sum(case when e.is_manager then 1 else 0 end) as total_manager,

    -- total managers actifs
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active,

    count(distinct e.department_id) as total_department

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m14:23:16.705123 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.002 seconds
[0m14:23:16.706756 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:23:16.706914 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended" rename to "company_extended__dbt_backup"
[0m14:23:16.707304 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.708701 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:23:16.708861 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m14:23:16.709220 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.709883 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:23:16.710035 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:23:16.710176 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:23:16.710565 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:23:16.711654 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m14:23:16.711977 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:23:16.712126 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m14:23:16.712798 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:23:16.713315 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m14:23:16.713586 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e60be20>]}
[0m14:23:16.713872 [info ] [Thread-1  ]: 8 of 9 OK created sql table model public_transform.company_extended ............ [[32mSELECT 5[0m in 0.02s]
[0m14:23:16.714115 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m14:23:16.714288 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m14:23:16.714516 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m14:23:16.714704 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m14:23:16.714859 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m14:23:16.716467 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m14:23:16.716937 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m14:23:16.719669 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m14:23:16.720216 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:23:16.720378 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m14:23:16.720525 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:23:16.725134 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:23:16.725307 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:23:16.725470 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m14:23:16.727425 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.002 seconds
[0m14:23:16.729036 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:23:16.729200 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m14:23:16.729576 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.730891 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:23:16.731050 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m14:23:16.731409 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:23:16.732072 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:23:16.732227 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:23:16.732369 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:23:16.733028 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:23:16.734138 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m14:23:16.734451 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:23:16.734596 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m14:23:16.735343 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:23:16.736064 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m14:23:16.736381 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b620ec1-5fbd-429b-820e-36526c15211c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e422eb0>]}
[0m14:23:16.736695 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.02s]
[0m14:23:16.736951 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m14:23:16.737442 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:16.737581 [debug] [MainThread]: On master: BEGIN
[0m14:23:16.737706 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:23:16.742180 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:23:16.742342 [debug] [MainThread]: On master: COMMIT
[0m14:23:16.742480 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:16.742607 [debug] [MainThread]: On master: COMMIT
[0m14:23:16.742882 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:16.743054 [debug] [MainThread]: On master: Close
[0m14:23:16.743241 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:23:16.743365 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m14:23:16.743543 [info ] [MainThread]: 
[0m14:23:16.743687 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m14:23:16.744397 [debug] [MainThread]: Command end result
[0m14:23:16.755019 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:23:16.755767 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:23:16.758726 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:23:16.758852 [info ] [MainThread]: 
[0m14:23:16.759014 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:23:16.759152 [info ] [MainThread]: 
[0m14:23:16.759297 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m14:23:16.760837 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.91389304, "process_in_blocks": "0", "process_kernel_time": 0.184964, "process_mem_max_rss": "131743744", "process_out_blocks": "0", "process_user_time": 1.122783}
[0m14:23:16.761022 [debug] [MainThread]: Command `dbt run` succeeded at 14:23:16.760986 after 0.91 seconds
[0m14:23:16.761199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bee6e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b983460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0b0190>]}
[0m14:23:16.761348 [debug] [MainThread]: Flushing usage events
[0m14:23:17.906343 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:26:14.327876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8f1e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b968d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b968250>]}


============================== 14:26:14.330336 | 42ea22d7-e654-473c-956c-7c7e8e8f2864 ==============================
[0m14:26:14.330336 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:26:14.330608 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'warn_error': 'None', 'log_path': '/Users/marccao/repo/dbt/logs', 'profiles_dir': '/Users/marccao/repo/dbt', 'debug': 'False', 'no_print': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'printer_width': '80', 'write_json': 'True', 'log_format': 'default', 'partial_parse': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'quiet': 'False', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'log_cache_events': 'False'}
[0m14:26:14.425865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109299a60>]}
[0m14:26:14.453029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac30250>]}
[0m14:26:14.453676 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:26:14.505484 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:26:14.573629 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 5 files changed.
[0m14:26:14.573917 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/department.sql
[0m14:26:14.574078 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/employee.sql
[0m14:26:14.574231 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/company.sql
[0m14:26:14.574377 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m14:26:14.574524 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/contract.sql
[0m14:26:14.682792 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m14:26:14.712629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8a1940>]}
[0m14:26:14.749665 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:26:14.750731 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:26:14.760055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be70bb0>]}
[0m14:26:14.760263 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m14:26:14.760414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c94f6a0>]}
[0m14:26:14.761057 [info ] [MainThread]: 
[0m14:26:14.761206 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:26:14.761332 [info ] [MainThread]: 
[0m14:26:14.761552 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:26:14.763598 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:26:14.805401 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:26:14.805608 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:26:14.805729 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:26:14.840684 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.035 seconds
[0m14:26:14.841315 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:26:14.842860 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:26:14.843050 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:26:14.843181 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:26:14.851381 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m14:26:14.851834 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:26:14.852511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:26:14.855058 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:26:14.855191 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:26:14.855309 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:26:14.860168 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m14:26:14.860373 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:26:14.860526 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:26:14.861792 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.001 seconds
[0m14:26:14.862397 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:26:14.862683 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:26:14.862935 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:26:14.864261 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:26:14.864382 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:26:14.864497 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:26:14.868930 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m14:26:14.869077 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:26:14.869212 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:26:14.870314 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.001 seconds
[0m14:26:14.870914 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:26:14.871224 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:26:14.873718 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:14.873863 [debug] [MainThread]: On master: BEGIN
[0m14:26:14.873972 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:26:14.878292 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:26:14.878438 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:14.878586 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:26:14.880133 [debug] [MainThread]: SQL status: SELECT 0 in 0.001 seconds
[0m14:26:14.880611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c91e0a0>]}
[0m14:26:14.880804 [debug] [MainThread]: On master: ROLLBACK
[0m14:26:14.881123 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:14.881247 [debug] [MainThread]: On master: BEGIN
[0m14:26:14.881683 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:26:14.881816 [debug] [MainThread]: On master: COMMIT
[0m14:26:14.881934 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:14.882053 [debug] [MainThread]: On master: COMMIT
[0m14:26:14.882321 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:14.882478 [debug] [MainThread]: On master: Close
[0m14:26:14.883756 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:26:14.884002 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:26:14.884217 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:26:14.884367 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:26:14.888150 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.889347 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:26:14.906870 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.907289 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.907445 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:26:14.907642 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:14.915687 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:26:14.915840 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.916021 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table brut de l'extraction de l'API de Lucca suite au script python main.py
select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    -- extract du payload an json
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,
    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:26:14.922697 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.006 seconds
[0m14:26:14.926947 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.927099 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:26:14.927816 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:14.929040 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.929183 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:26:14.929690 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:14.936393 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:26:14.936558 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.936693 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:26:14.938118 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:14.940541 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:26:14.942210 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:26:14.942396 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:26:14.944823 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:26:14.945854 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:26:14.946836 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce67cd0>]}
[0m14:26:14.947130 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m14:26:14.947394 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:26:14.947767 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m14:26:14.947952 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m14:26:14.948139 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m14:26:14.948275 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m14:26:14.949607 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m14:26:14.950046 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m14:26:14.952165 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m14:26:14.952400 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:26:14.952535 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m14:26:14.952659 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:14.959160 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:26:14.959376 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:26:14.959530 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les entreprises 
select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:26:14.963004 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.003 seconds
[0m14:26:14.964517 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:26:14.964659 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m14:26:14.965238 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:14.966660 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:26:14.966826 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m14:26:14.967353 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:14.967993 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:26:14.968138 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:26:14.968269 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:26:14.969249 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:14.970268 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m14:26:14.970560 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:26:14.970694 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m14:26:14.972126 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:26:14.972596 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m14:26:14.972843 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112034bb0>]}
[0m14:26:14.973104 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.02s]
[0m14:26:14.973352 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m14:26:14.973504 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m14:26:14.973719 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m14:26:14.973916 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m14:26:14.974058 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m14:26:14.975382 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m14:26:14.975910 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m14:26:14.977496 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m14:26:14.977730 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:26:14.977864 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m14:26:14.977987 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:14.984575 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:26:14.984791 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:26:14.984942 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les contrats 
select 
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id as company_id,
    legalEntity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:26:14.989862 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:26:14.991413 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:26:14.991565 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m14:26:14.992174 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:14.994077 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:26:14.994221 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m14:26:14.994813 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:14.995409 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:26:14.995550 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:26:14.995676 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:26:14.996577 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:14.997592 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m14:26:14.997906 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:26:14.998054 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m14:26:14.999708 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:26:15.000231 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m14:26:15.000494 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112034bb0>]}
[0m14:26:15.000772 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:26:15.001030 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m14:26:15.001202 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m14:26:15.001434 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m14:26:15.001653 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m14:26:15.001806 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m14:26:15.003229 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m14:26:15.003549 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m14:26:15.005098 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m14:26:15.005338 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:26:15.005473 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m14:26:15.005601 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:15.013776 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:26:15.013928 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:26:15.014100 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    

-- =====================================================
-- Modèle : contract_extended
-- Description : Enrichissement des informations de contrat
-- =====================================================

select 

    id AS employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id AS company_id,
    legalEntity_name AS company_name,

    -- Indique si la personne n'a pas encore commencé
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS will_start,

    -- Statut du contrat
    CASE
        WHEN contract_start_date > CURRENT_DATE THEN 'not_started'
        WHEN contract_end_date IS NULL OR contract_end_date >= CURRENT_DATE THEN 'active'
        ELSE 'inactive'
    END AS contract_status,

    -- Contrat terminé / suspension
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date < CURRENT_DATE THEN TRUE
        ELSE FALSE
    END AS is_suspended,

    -- Nombre de jours travaillés (ancienneté en jours)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            COALESCE(contract_end_date, CURRENT_DATE) - contract_start_date
        ELSE NULL
    END AS days_worked,

    -- Ancienneté en années (pratique pour reporting RH)
    CASE
        WHEN contract_start_date IS NOT NULL THEN
            EXTRACT(YEAR FROM AGE(COALESCE(contract_end_date, CURRENT_DATE), contract_start_date))
        ELSE NULL
    END AS seniority_years,

    -- Nombre de jours restants sur le contrat (si fin future)
    CASE
        WHEN contract_end_date IS NOT NULL AND contract_end_date >= CURRENT_DATE THEN
            contract_end_date - CURRENT_DATE
        ELSE NULL
    END AS remaining_days,

    -- Dates de modification et refresh
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:26:15.018758 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:26:15.020242 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:26:15.020392 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m14:26:15.021027 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:15.022233 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:26:15.022375 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m14:26:15.022926 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:15.023519 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:26:15.023655 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:26:15.023782 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:26:15.024794 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:15.025784 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m14:26:15.026074 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:26:15.026206 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m14:26:15.028420 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:26:15.028891 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m14:26:15.029136 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112034bb0>]}
[0m14:26:15.029396 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:26:15.029642 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m14:26:15.029796 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m14:26:15.030009 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m14:26:15.030201 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m14:26:15.030341 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m14:26:15.032362 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m14:26:15.032844 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m14:26:15.034453 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m14:26:15.034749 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:26:15.034890 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m14:26:15.035020 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:15.042938 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:26:15.043089 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:26:15.043230 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les départements 

select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:26:15.047178 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m14:26:15.048686 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:26:15.048848 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m14:26:15.049519 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:15.050884 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:26:15.051034 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m14:26:15.051629 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:15.052263 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:26:15.052411 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:26:15.052548 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:26:15.053503 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:15.054546 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m14:26:15.054848 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:26:15.054993 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m14:26:15.056943 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:26:15.057424 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m14:26:15.057675 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce3d730>]}
[0m14:26:15.057945 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m14:26:15.058188 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m14:26:15.058355 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:26:15.058596 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m14:26:15.058817 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m14:26:15.058976 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:26:15.060407 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:26:15.060771 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:26:15.063118 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:26:15.063410 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:26:15.063563 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:26:15.063704 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:15.070449 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:26:15.070615 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:26:15.070756 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les employés 

select
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:26:15.074763 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:26:15.076275 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:26:15.076426 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m14:26:15.077432 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:15.078686 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:26:15.078834 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m14:26:15.079398 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:15.080029 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:26:15.080176 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:26:15.080310 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:26:15.081285 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:15.082405 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m14:26:15.082806 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:26:15.082976 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m14:26:15.085221 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:26:15.085775 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:26:15.086039 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cfdbb80>]}
[0m14:26:15.086320 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:26:15.086560 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:26:15.086884 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m14:26:15.087116 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m14:26:15.087315 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m14:26:15.087472 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m14:26:15.089128 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m14:26:15.089461 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m14:26:15.091148 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m14:26:15.091447 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:26:15.091598 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m14:26:15.091740 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:15.099758 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:26:15.099939 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:26:15.100103 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    

with today as (
    select current_date as today
)

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active basé sur le contrat
    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m14:26:15.105548 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:26:15.107110 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:26:15.107266 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m14:26:15.108198 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:15.110127 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:26:15.110278 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m14:26:15.111291 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:15.111929 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:26:15.112083 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:26:15.112222 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:26:15.113503 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:15.114570 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m14:26:15.114882 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:26:15.115032 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m14:26:15.116569 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:26:15.117077 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m14:26:15.117334 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120abf40>]}
[0m14:26:15.117610 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:26:15.117855 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m14:26:15.118171 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m14:26:15.118390 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m14:26:15.118596 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m14:26:15.118751 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m14:26:15.120334 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m14:26:15.120658 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m14:26:15.122344 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m14:26:15.122624 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:26:15.122772 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m14:26:15.122914 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:15.130541 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:26:15.130697 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:26:15.130859 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    c.company_id,
    c.company_name,

    -- total d'employés historiques (y compris ceux qui ont quitté)
    count(e.employee_id) as total_employee,

    -- total d'employés actifs
    count(case when e.is_active = true then 1 end) as total_employee_active,

    -- total managers historiques
    sum(case when e.is_manager then 1 else 0 end) as total_manager,

    -- total managers actifs
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active,

    count(distinct e.department_id) as total_department

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m14:26:15.135177 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.004 seconds
[0m14:26:15.136658 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:26:15.136811 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended" rename to "company_extended__dbt_backup"
[0m14:26:15.137401 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:15.138667 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:26:15.138819 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m14:26:15.139303 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:15.139932 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:26:15.140079 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:26:15.140219 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:26:15.141235 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:15.142301 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m14:26:15.142617 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:26:15.142764 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m14:26:15.145595 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:26:15.146083 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m14:26:15.146333 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112055160>]}
[0m14:26:15.146607 [info ] [Thread-1  ]: 8 of 9 OK created sql table model public_transform.company_extended ............ [[32mSELECT 5[0m in 0.03s]
[0m14:26:15.146846 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m14:26:15.147013 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m14:26:15.147228 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m14:26:15.147419 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m14:26:15.147575 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m14:26:15.149938 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m14:26:15.150441 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m14:26:15.152181 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m14:26:15.152602 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:26:15.152755 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m14:26:15.152901 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:26:15.161160 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:26:15.161317 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:26:15.161468 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    

select
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m14:26:15.165691 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m14:26:15.167239 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:26:15.167395 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m14:26:15.168254 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:15.169528 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:26:15.169680 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m14:26:15.170173 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:26:15.170809 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:26:15.170961 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:26:15.171102 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:26:15.172152 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:26:15.173217 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m14:26:15.173533 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:26:15.173683 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m14:26:15.176034 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:26:15.176530 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m14:26:15.176788 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42ea22d7-e654-473c-956c-7c7e8e8f2864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112055160>]}
[0m14:26:15.177064 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m14:26:15.177310 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m14:26:15.177746 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.177877 [debug] [MainThread]: On master: BEGIN
[0m14:26:15.177997 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:26:15.185748 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:26:15.189574 [debug] [MainThread]: On master: COMMIT
[0m14:26:15.189746 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.189876 [debug] [MainThread]: On master: COMMIT
[0m14:26:15.190338 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:15.190472 [debug] [MainThread]: On master: Close
[0m14:26:15.190645 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:26:15.190767 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m14:26:15.190941 [info ] [MainThread]: 
[0m14:26:15.191089 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.43 seconds (0.43s).
[0m14:26:15.191823 [debug] [MainThread]: Command end result
[0m14:26:15.205271 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:26:15.206096 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:26:15.209425 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:26:15.209567 [info ] [MainThread]: 
[0m14:26:15.209736 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:26:15.209875 [info ] [MainThread]: 
[0m14:26:15.210022 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m14:26:15.211410 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.91780174, "process_in_blocks": "0", "process_kernel_time": 0.174376, "process_mem_max_rss": "131284992", "process_out_blocks": "0", "process_user_time": 1.13703}
[0m14:26:15.211586 [debug] [MainThread]: Command `dbt run` succeeded at 14:26:15.211552 after 0.92 seconds
[0m14:26:15.211747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8f1e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b952e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be709a0>]}
[0m14:26:15.211907 [debug] [MainThread]: Flushing usage events
[0m14:26:16.085215 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:37:05.927787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081add90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109219e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092193a0>]}


============================== 14:37:05.930021 | 636e9eba-0354-426b-b7a0-391c582a316c ==============================
[0m14:37:05.930021 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:37:05.930294 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'debug': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'write_json': 'True', 'printer_width': '80', 'warn_error': 'None', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'version_check': 'True', 'no_print': 'None', 'empty': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'quiet': 'False', 'target_path': 'None'}
[0m14:37:06.023564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10926c880>]}
[0m14:37:06.049964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10972cc40>]}
[0m14:37:06.050589 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:37:06.102742 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:37:06.170411 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 4 files changed.
[0m14:37:06.170673 [debug] [MainThread]: Partial parsing: added file: lucca_dbt://models/models/transform/TEST.sql
[0m14:37:06.170839 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/department_extended.sql
[0m14:37:06.170993 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m14:37:06.171165 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/contract_extended.sql
[0m14:37:06.171333 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/company_extended.sql
[0m14:37:06.279874 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.transform
- models.lucca_dbt.analytics
- models.lucca_dbt.base
[0m14:37:06.307735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a7ad60>]}
[0m14:37:06.344484 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:37:06.345933 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:37:06.355298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109923130>]}
[0m14:37:06.355500 [info ] [MainThread]: Found 10 models, 1 source, 447 macros
[0m14:37:06.355651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a231d90>]}
[0m14:37:06.356319 [info ] [MainThread]: 
[0m14:37:06.356468 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:37:06.356595 [info ] [MainThread]: 
[0m14:37:06.356809 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:37:06.358944 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:37:06.387215 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:37:06.387429 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:37:06.387552 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:37:06.424555 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.037 seconds
[0m14:37:06.425168 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:37:06.426498 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:37:06.426648 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:37:06.426762 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:06.434893 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m14:37:06.435383 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:37:06.436080 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:37:06.438650 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:37:06.438810 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:37:06.438930 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:06.446622 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.446752 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:37:06.446878 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:37:06.450833 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m14:37:06.451367 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:37:06.451804 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:37:06.452033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:37:06.453253 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:37:06.453391 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:37:06.453512 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:06.461542 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.461668 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:37:06.461801 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:37:06.465324 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:37:06.465828 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:37:06.466190 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:37:06.468490 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:06.468622 [debug] [MainThread]: On master: BEGIN
[0m14:37:06.468734 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:37:06.476556 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.476679 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:06.476830 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:37:06.480869 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m14:37:06.481315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a20d730>]}
[0m14:37:06.481508 [debug] [MainThread]: On master: ROLLBACK
[0m14:37:06.481895 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:06.482021 [debug] [MainThread]: On master: BEGIN
[0m14:37:06.482695 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:37:06.482819 [debug] [MainThread]: On master: COMMIT
[0m14:37:06.482938 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:06.483052 [debug] [MainThread]: On master: COMMIT
[0m14:37:06.483423 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:37:06.483547 [debug] [MainThread]: On master: Close
[0m14:37:06.485281 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:37:06.485515 [info ] [Thread-1  ]: 1 of 10 START sql table model public_base.lucca_raw_data ....................... [RUN]
[0m14:37:06.485721 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:37:06.485880 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:37:06.489860 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.490309 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:37:06.507809 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.508207 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.508348 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:37:06.508477 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.518229 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m14:37:06.518383 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.518557 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table brut de l'extraction de l'API de Lucca suite au script python main.py
select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    -- extract du payload an json
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,
    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:37:06.526429 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.008 seconds
[0m14:37:06.531222 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.531596 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:37:06.532426 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:06.533817 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.533969 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:37:06.534523 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.541597 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:37:06.541767 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.541904 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:37:06.543362 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:06.545906 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:37:06.547605 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:06.547749 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:37:06.550838 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:37:06.551956 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:37:06.553032 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7e6e50>]}
[0m14:37:06.553330 [info ] [Thread-1  ]: 1 of 10 OK created sql table model public_base.lucca_raw_data .................. [[32mSELECT 115[0m in 0.07s]
[0m14:37:06.553599 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:37:06.553991 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m14:37:06.554211 [info ] [Thread-1  ]: 2 of 10 START sql table model public_base.company .............................. [RUN]
[0m14:37:06.554424 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m14:37:06.554602 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m14:37:06.555908 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m14:37:06.556202 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m14:37:06.558287 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m14:37:06.558523 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:06.558654 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m14:37:06.558777 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.566336 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.566500 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:06.566637 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les entreprises 
select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:06.570937 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.004 seconds
[0m14:37:06.572512 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:06.572663 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m14:37:06.573258 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.574576 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:06.574713 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m14:37:06.575295 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.575914 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:37:06.576047 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:06.576171 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:37:06.577056 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:06.578035 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m14:37:06.578314 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:06.578444 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m14:37:06.580498 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:06.580958 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m14:37:06.581196 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8ccf70>]}
[0m14:37:06.581448 [info ] [Thread-1  ]: 2 of 10 OK created sql table model public_base.company ......................... [[32mSELECT 5[0m in 0.03s]
[0m14:37:06.581693 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m14:37:06.581842 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m14:37:06.582058 [info ] [Thread-1  ]: 3 of 10 START sql table model public_base.contract ............................. [RUN]
[0m14:37:06.582262 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m14:37:06.582406 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m14:37:06.583762 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m14:37:06.584188 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m14:37:06.585720 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m14:37:06.585946 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:06.586072 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m14:37:06.586193 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.593204 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:06.593361 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:06.593499 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les contrats 
select 
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id as company_id,
    legalEntity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:06.597509 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:37:06.598940 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:06.599079 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m14:37:06.599899 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:06.601622 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:06.601753 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m14:37:06.602205 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.602780 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:37:06.602908 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:06.603029 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:37:06.603910 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:06.604914 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m14:37:06.605269 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:06.605418 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m14:37:06.607016 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:37:06.607566 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m14:37:06.607812 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8ccf70>]}
[0m14:37:06.608063 [info ] [Thread-1  ]: 3 of 10 OK created sql table model public_base.contract ........................ [[32mSELECT 115[0m in 0.03s]
[0m14:37:06.608304 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m14:37:06.608453 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m14:37:06.608671 [info ] [Thread-1  ]: 4 of 10 START sql table model public_transform.contract_extended ............... [RUN]
[0m14:37:06.608877 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m14:37:06.609022 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m14:37:06.610474 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m14:37:06.610797 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m14:37:06.612377 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m14:37:06.612660 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:06.612813 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m14:37:06.612941 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.620799 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.620990 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:06.621185 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour regrouper les informations sur les contrats étendus avec des indicateurs sur les employés
select 
    *,
    case
        when contract_start_date > current_date then true
        else false
    end as will_start,

    case
        when contract_start_date > current_date then 'not_started'
        when contract_end_date is null or contract_end_date >= current_date then 'active'
        else 'inactive'
    end as contract_status,

    case
        when contract_end_date is not null and contract_end_date < current_date then true
        else false
    end as is_suspended,    

    case
        when contract_start_date is not null then
            coalesce(contract_end_date, current_date) - contract_start_date
        else null
    end as days_worked,

    case
        when contract_start_date is not null then
                extract(year from age(coalesce(contract_end_date, current_date), contract_start_date))
            else null
    end as seniority_years,

    case
        when contract_end_date is not null and contract_end_date >= current_date then
            contract_end_date - current_date
        else null
    end as remaining_days,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:06.622619 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "modified_at" specified more than once

[0m14:37:06.622779 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: ROLLBACK
[0m14:37:06.623328 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m14:37:06.634192 [debug] [Thread-1  ]: Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  column "modified_at" specified more than once
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql
[0m14:37:06.634438 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8e5c40>]}
[0m14:37:06.634725 [error] [Thread-1  ]: 4 of 10 ERROR creating sql table model public_transform.contract_extended ...... [[31mERROR[0m in 0.03s]
[0m14:37:06.634980 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m14:37:06.635155 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m14:37:06.635369 [debug] [Thread-4  ]: Marking all children of 'model.lucca_dbt.contract_extended' to be skipped because of status 'error'.  Reason: Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  column "modified_at" specified more than once
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql.
[0m14:37:06.635567 [info ] [Thread-1  ]: 5 of 10 START sql table model public_base.department ........................... [RUN]
[0m14:37:06.635820 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m14:37:06.635980 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m14:37:06.637409 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m14:37:06.637812 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m14:37:06.639504 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m14:37:06.639762 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:06.639890 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m14:37:06.640011 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.647736 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.647918 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:06.648072 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les départements 

select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:06.652041 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m14:37:06.653485 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:06.653637 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m14:37:06.654137 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.656378 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:06.656545 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m14:37:06.657106 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.657772 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:37:06.657912 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:06.658040 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:37:06.659106 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:06.660125 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m14:37:06.660420 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:06.660555 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m14:37:06.662211 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:06.662685 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m14:37:06.662927 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8ccf70>]}
[0m14:37:06.663189 [info ] [Thread-1  ]: 5 of 10 OK created sql table model public_base.department ...................... [[32mSELECT 32[0m in 0.03s]
[0m14:37:06.663433 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m14:37:06.663582 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:37:06.663796 [info ] [Thread-1  ]: 6 of 10 START sql table model public_base.employee ............................. [RUN]
[0m14:37:06.663987 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m14:37:06.664126 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:37:06.665470 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:37:06.665760 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:37:06.667308 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:37:06.667535 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:06.667666 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:37:06.667791 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.675506 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.675707 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:06.675854 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les employés 

select
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:06.680273 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:37:06.681794 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:06.681946 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m14:37:06.683055 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:06.684334 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:06.684475 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m14:37:06.685065 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.685690 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:37:06.685834 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:06.685968 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:37:06.686996 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:06.688842 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m14:37:06.689188 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:06.689340 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m14:37:06.691499 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:06.692038 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:37:06.692294 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8ccf70>]}
[0m14:37:06.692568 [info ] [Thread-1  ]: 6 of 10 OK created sql table model public_base.employee ........................ [[32mSELECT 115[0m in 0.03s]
[0m14:37:06.692816 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:37:06.693139 [debug] [Thread-1  ]: Began running node model.lucca_dbt.TEST
[0m14:37:06.693371 [info ] [Thread-1  ]: 7 of 10 START sql table model public_transform.TEST ............................ [RUN]
[0m14:37:06.693570 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.TEST)
[0m14:37:06.693718 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.TEST
[0m14:37:06.695384 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.TEST"
[0m14:37:06.695969 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.TEST
[0m14:37:06.697572 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.TEST"
[0m14:37:06.697818 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:06.697951 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: BEGIN
[0m14:37:06.698078 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.705356 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:06.705534 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:06.705702 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.TEST"} */

  
    

  create  table "lucca_db"."public_transform"."TEST__dbt_tmp"
  
  
    as
  
  (
    
-- Table pour regrouper les informations étendues sur les employés, incluant le statut d'activité et de management

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active
    case
        when c.contract_start_date <= current_date
         and (c.contract_end_date is null or c.contract_end_date > current_date)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e
left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id
  );
  
[0m14:37:06.710215 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:37:06.711739 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:06.711894 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.TEST"} */
alter table "lucca_db"."public_transform"."TEST__dbt_tmp" rename to "TEST"
[0m14:37:06.712318 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.712953 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: COMMIT
[0m14:37:06.713106 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:06.713246 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: COMMIT
[0m14:37:06.713777 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:37:06.714861 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."TEST__dbt_backup"
[0m14:37:06.715174 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:06.715315 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.TEST"} */
drop table if exists "lucca_db"."public_transform"."TEST__dbt_backup" cascade
[0m14:37:06.715698 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m14:37:06.716220 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: Close
[0m14:37:06.716487 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7f6d90>]}
[0m14:37:06.716773 [info ] [Thread-1  ]: 7 of 10 OK created sql table model public_transform.TEST ....................... [[32mSELECT 115[0m in 0.02s]
[0m14:37:06.717012 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.TEST
[0m14:37:06.717182 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m14:37:06.717402 [info ] [Thread-1  ]: 8 of 10 START sql table model public_transform.employee_extended ............... [RUN]
[0m14:37:06.717587 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.TEST, now model.lucca_dbt.employee_extended)
[0m14:37:06.717740 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m14:37:06.719407 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m14:37:06.719702 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m14:37:06.721425 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m14:37:06.721716 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:06.721861 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m14:37:06.721998 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.728370 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:37:06.728542 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:06.728717 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour regrouper les informations étendues sur les employés, incluant le statut d'activité et de management

with today as (
    select current_date as today
)

select 
    e.*,
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m14:37:06.731554 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m14:37:06.733901 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:06.734055 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m14:37:06.734420 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.735681 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:06.735836 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m14:37:06.736185 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.736838 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:37:06.736987 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:06.737126 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:37:06.737599 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:37:06.738784 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m14:37:06.739117 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:06.739266 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m14:37:06.740125 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:37:06.740658 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m14:37:06.740940 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8947f0>]}
[0m14:37:06.741232 [info ] [Thread-1  ]: 8 of 10 OK created sql table model public_transform.employee_extended .......... [[32mSELECT 115[0m in 0.02s]
[0m14:37:06.741481 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m14:37:06.741866 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m14:37:06.742109 [info ] [Thread-1  ]: 9 of 10 START sql table model public_transform.company_extended ................ [RUN]
[0m14:37:06.742306 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m14:37:06.742464 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m14:37:06.744099 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m14:37:06.744421 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m14:37:06.746088 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m14:37:06.746343 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:06.746492 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m14:37:06.746632 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.753417 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:06.753617 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:06.753827 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour les informations sur les entreprises avec des métriques agrégées sur les employés et départements
select
    c.company_id,
    c.company_name,
    count(e.employee_id) as total_employee,
    count(case when e.is_active = true then 1 else 0 end) as total_employee_active,
    sum(case when e.is_manager then 1 else 0 end) as total_manager,
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active,
    count(distinct e.department_id) as total_nb_departments

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m14:37:06.757620 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.004 seconds
[0m14:37:06.759257 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:06.759415 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended" rename to "company_extended__dbt_backup"
[0m14:37:06.759832 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.761150 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:06.761302 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m14:37:06.761939 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.763182 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:37:06.763329 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:06.763465 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:37:06.764410 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:06.765450 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m14:37:06.765800 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:06.765944 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m14:37:06.768175 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:06.768653 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m14:37:06.768903 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099a3df0>]}
[0m14:37:06.769176 [info ] [Thread-1  ]: 9 of 10 OK created sql table model public_transform.company_extended ........... [[32mSELECT 5[0m in 0.03s]
[0m14:37:06.769421 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m14:37:06.769585 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m14:37:06.769826 [info ] [Thread-1  ]: 10 of 10 START sql table model public_transform.department_extended ............ [RUN]
[0m14:37:06.770050 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m14:37:06.770216 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m14:37:06.771851 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m14:37:06.772326 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m14:37:06.773985 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m14:37:06.774375 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:06.774525 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m14:37:06.774660 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:06.781564 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:06.781738 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:06.781905 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    
-- description: Table pour regrouper les informations étendues sur les départements, incluant le nombre d'employés et de managers
select
    d.*,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m14:37:06.786120 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m14:37:06.787627 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:06.787797 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m14:37:06.788267 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.789717 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:06.789872 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m14:37:06.790427 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:06.791095 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:37:06.791238 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:06.791371 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:37:06.792329 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:06.793378 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m14:37:06.793683 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:06.793828 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m14:37:06.795307 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:37:06.795804 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m14:37:06.796044 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '636e9eba-0354-426b-b7a0-391c582a316c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2ade20>]}
[0m14:37:06.796310 [info ] [Thread-1  ]: 10 of 10 OK created sql table model public_transform.department_extended ....... [[32mSELECT 32[0m in 0.03s]
[0m14:37:06.796549 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m14:37:06.797006 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:06.797136 [debug] [MainThread]: On master: BEGIN
[0m14:37:06.797251 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:37:06.804801 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:37:06.804948 [debug] [MainThread]: On master: COMMIT
[0m14:37:06.805080 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:06.805271 [debug] [MainThread]: On master: COMMIT
[0m14:37:06.805619 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:37:06.805753 [debug] [MainThread]: On master: Close
[0m14:37:06.805932 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:37:06.806046 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m14:37:06.806213 [info ] [MainThread]: 
[0m14:37:06.806357 [info ] [MainThread]: Finished running 10 table models in 0 hours 0 minutes and 0.45 seconds (0.45s).
[0m14:37:06.807108 [debug] [MainThread]: Command end result
[0m14:37:06.817926 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:37:06.818615 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:37:06.821622 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:37:06.821775 [info ] [MainThread]: 
[0m14:37:06.822022 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:37:06.822182 [info ] [MainThread]: 
[0m14:37:06.822360 [error] [MainThread]: [31mFailure in model contract_extended (models/models/transform/contract_extended.sql)[0m
[0m14:37:06.822522 [error] [MainThread]:   Database Error in model contract_extended (models/models/transform/contract_extended.sql)
  column "modified_at" specified more than once
  compiled code at target/run/lucca_dbt/models/models/transform/contract_extended.sql
[0m14:37:06.822651 [info ] [MainThread]: 
[0m14:37:06.822807 [info ] [MainThread]:   compiled code at target/compiled/lucca_dbt/models/models/transform/contract_extended.sql
[0m14:37:06.822940 [info ] [MainThread]: 
[0m14:37:06.823084 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=10
[0m14:37:06.824508 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9300299, "process_in_blocks": "0", "process_kernel_time": 0.165063, "process_mem_max_rss": "132317184", "process_out_blocks": "0", "process_user_time": 1.152372}
[0m14:37:06.824694 [debug] [MainThread]: Command `dbt run` failed at 14:37:06.824657 after 0.93 seconds
[0m14:37:06.824864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081add90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c890a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a37ec40>]}
[0m14:37:06.825020 [debug] [MainThread]: Flushing usage events
[0m14:37:07.320584 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:37:31.703989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0c2e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d137fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1374c0>]}


============================== 14:37:31.705730 | 3659aaae-3c94-4739-a77c-8d64ee4669c4 ==============================
[0m14:37:31.705730 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:37:31.705995 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'log_path': '/Users/marccao/repo/dbt/logs', 'target_path': 'None', 'use_experimental_parser': 'False', 'introspect': 'True', 'fail_fast': 'False', 'profiles_dir': '/Users/marccao/repo/dbt', 'no_print': 'None', 'partial_parse': 'True', 'version_check': 'True', 'printer_width': '80', 'write_json': 'True', 'log_format': 'default', 'quiet': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'static_parser': 'True', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run'}
[0m14:37:31.779002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d123e80>]}
[0m14:37:31.804324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cec9cd0>]}
[0m14:37:31.804767 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:37:31.849743 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:37:31.904668 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:37:31.904944 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/contract_extended.sql
[0m14:37:32.007492 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.base
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
[0m14:37:32.014437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e31afa0>]}
[0m14:37:32.071117 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:37:32.072059 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:37:32.078138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6005b0>]}
[0m14:37:32.078401 [info ] [MainThread]: Found 10 models, 1 source, 447 macros
[0m14:37:32.078556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0ff850>]}
[0m14:37:32.079259 [info ] [MainThread]: 
[0m14:37:32.079414 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:37:32.079541 [info ] [MainThread]: 
[0m14:37:32.079760 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:37:32.081853 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:37:32.103341 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:37:32.103553 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:37:32.103677 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:37:32.123122 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.019 seconds
[0m14:37:32.123705 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:37:32.125061 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:37:32.125220 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:37:32.125353 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:32.133090 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m14:37:32.133531 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:37:32.134222 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_base)
[0m14:37:32.136769 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:37:32.136896 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:37:32.137006 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:32.143964 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.144089 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:37:32.144218 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:37:32.147361 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:37:32.147880 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:37:32.148325 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:37:32.148548 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now list_lucca_db_public_transform)
[0m14:37:32.149777 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:37:32.149906 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:37:32.150021 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:32.156724 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.156853 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:37:32.156987 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:37:32.159890 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:37:32.160427 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:37:32.160870 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:37:32.163275 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:32.163420 [debug] [MainThread]: On master: BEGIN
[0m14:37:32.163539 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:37:32.170392 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.170526 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:32.170695 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:37:32.174451 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m14:37:32.174880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9103a0>]}
[0m14:37:32.175075 [debug] [MainThread]: On master: ROLLBACK
[0m14:37:32.175484 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:32.175608 [debug] [MainThread]: On master: BEGIN
[0m14:37:32.176293 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:37:32.176419 [debug] [MainThread]: On master: COMMIT
[0m14:37:32.176539 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:32.176654 [debug] [MainThread]: On master: COMMIT
[0m14:37:32.177028 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:37:32.177156 [debug] [MainThread]: On master: Close
[0m14:37:32.178005 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:37:32.178245 [info ] [Thread-1  ]: 1 of 10 START sql table model public_base.lucca_raw_data ....................... [RUN]
[0m14:37:32.178449 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now model.lucca_dbt.lucca_raw_data)
[0m14:37:32.178606 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:37:32.182548 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.182880 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:37:32.200186 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.200579 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.200725 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:37:32.200855 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.205816 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:37:32.206003 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.206202 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table brut de l'extraction de l'API de Lucca suite au script python main.py
select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    -- extract du payload an json
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,
    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:37:32.209535 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m14:37:32.213957 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.214117 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:37:32.214523 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.215859 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.216010 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:37:32.216354 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.223278 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:37:32.223436 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.223567 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:37:32.224738 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:32.227157 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:37:32.228835 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:37:32.228973 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:37:32.231115 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:32.232113 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:37:32.232848 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e639e20>]}
[0m14:37:32.233105 [info ] [Thread-1  ]: 1 of 10 OK created sql table model public_base.lucca_raw_data .................. [[32mSELECT 115[0m in 0.05s]
[0m14:37:32.233351 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:37:32.233684 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m14:37:32.233895 [info ] [Thread-1  ]: 2 of 10 START sql table model public_base.company .............................. [RUN]
[0m14:37:32.234101 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m14:37:32.234244 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m14:37:32.235488 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m14:37:32.235767 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m14:37:32.237469 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m14:37:32.237769 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:32.237921 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m14:37:32.238050 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.245029 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.245244 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:32.245402 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les entreprises 
select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:32.250345 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.005 seconds
[0m14:37:32.252424 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:32.252564 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m14:37:32.253346 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:32.254830 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:32.254981 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m14:37:32.255549 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.256176 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:37:32.256313 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:32.256437 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:37:32.257580 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:32.258586 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m14:37:32.258879 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:37:32.259010 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m14:37:32.260561 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:37:32.261029 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m14:37:32.261263 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7e7be0>]}
[0m14:37:32.261518 [info ] [Thread-1  ]: 2 of 10 OK created sql table model public_base.company ......................... [[32mSELECT 5[0m in 0.03s]
[0m14:37:32.261764 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m14:37:32.261929 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m14:37:32.262141 [info ] [Thread-1  ]: 3 of 10 START sql table model public_base.contract ............................. [RUN]
[0m14:37:32.262342 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m14:37:32.262483 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m14:37:32.263808 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m14:37:32.264100 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m14:37:32.265689 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m14:37:32.265932 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:32.266079 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m14:37:32.266213 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.273131 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.273356 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:32.273528 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les contrats 
select 
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id as company_id,
    legalEntity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:32.276446 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m14:37:32.278036 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:32.278178 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m14:37:32.278787 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.280089 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:32.280224 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m14:37:32.281010 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:32.281604 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:37:32.281739 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:32.281864 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:37:32.283152 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:32.284765 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m14:37:32.285052 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:37:32.285183 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m14:37:32.287064 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:32.287615 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m14:37:32.287937 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7e7be0>]}
[0m14:37:32.288234 [info ] [Thread-1  ]: 3 of 10 OK created sql table model public_base.contract ........................ [[32mSELECT 115[0m in 0.03s]
[0m14:37:32.288536 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m14:37:32.288853 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m14:37:32.289124 [info ] [Thread-1  ]: 4 of 10 START sql table model public_transform.contract_extended ............... [RUN]
[0m14:37:32.289340 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m14:37:32.289482 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m14:37:32.290875 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m14:37:32.291168 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m14:37:32.292752 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m14:37:32.292988 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:32.293121 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m14:37:32.293250 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.301004 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:37:32.301163 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:32.301332 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour regrouper les informations sur les contrats étendus avec des indicateurs sur les employés
select 
    *,
    case
        when contract_start_date > current_date then true
        else false
    end as will_start,

    case
        when contract_start_date > current_date then 'not_started'
        when contract_end_date is null or contract_end_date >= current_date then 'active'
        else 'inactive'
    end as contract_status,

    case
        when contract_end_date is not null and contract_end_date < current_date then true
        else false
    end as is_suspended,    

    case
        when contract_start_date is not null then
            coalesce(contract_end_date, current_date) - contract_start_date
        else null
    end as days_worked,

    case
        when contract_start_date is not null then
                extract(year from age(coalesce(contract_end_date, current_date), contract_start_date))
            else null
    end as seniority_years,

    case
        when contract_end_date is not null and contract_end_date >= current_date then
            contract_end_date - current_date
        else null
    end as remaining_days

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:32.305611 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:37:32.307289 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:32.307441 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m14:37:32.308042 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.309256 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:32.309391 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m14:37:32.309902 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.310505 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:37:32.310641 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:32.310765 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:37:32.311786 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:32.312826 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m14:37:32.313113 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:37:32.313247 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m14:37:32.315547 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:32.316092 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m14:37:32.316350 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11384e7f0>]}
[0m14:37:32.316612 [info ] [Thread-1  ]: 4 of 10 OK created sql table model public_transform.contract_extended .......... [[32mSELECT 115[0m in 0.03s]
[0m14:37:32.316855 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m14:37:32.317029 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m14:37:32.317245 [info ] [Thread-1  ]: 5 of 10 START sql table model public_base.department ........................... [RUN]
[0m14:37:32.317425 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m14:37:32.317565 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m14:37:32.318958 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m14:37:32.319286 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m14:37:32.321803 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m14:37:32.322141 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:32.322288 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m14:37:32.322419 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.327590 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:37:32.327762 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:32.327898 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les départements 

select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:32.331427 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.003 seconds
[0m14:37:32.332964 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:32.333124 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m14:37:32.333535 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.334769 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:32.334905 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m14:37:32.335224 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.335827 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:37:32.335964 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:32.336087 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:37:32.336506 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:37:32.337615 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m14:37:32.337966 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:37:32.338186 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m14:37:32.339240 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:37:32.339807 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m14:37:32.340084 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11384e7f0>]}
[0m14:37:32.340360 [info ] [Thread-1  ]: 5 of 10 OK created sql table model public_base.department ...................... [[32mSELECT 32[0m in 0.02s]
[0m14:37:32.340606 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m14:37:32.340777 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:37:32.341008 [info ] [Thread-1  ]: 6 of 10 START sql table model public_base.employee ............................. [RUN]
[0m14:37:32.341192 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m14:37:32.341334 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:37:32.342750 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:37:32.343054 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:37:32.344625 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:37:32.344867 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:32.344995 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:37:32.345118 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.351108 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:37:32.351273 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:32.351416 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les employés 

select
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:37:32.353403 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.002 seconds
[0m14:37:32.355828 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:32.356009 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m14:37:32.357292 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:32.358551 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:32.358692 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m14:37:32.359325 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:37:32.359921 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:37:32.360055 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:32.360179 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:37:32.360989 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:32.361971 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m14:37:32.362268 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:37:32.362399 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m14:37:32.364194 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:32.364657 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:37:32.364900 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11384e7f0>]}
[0m14:37:32.365158 [info ] [Thread-1  ]: 6 of 10 OK created sql table model public_base.employee ........................ [[32mSELECT 115[0m in 0.02s]
[0m14:37:32.365397 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:37:32.365702 [debug] [Thread-1  ]: Began running node model.lucca_dbt.TEST
[0m14:37:32.365919 [info ] [Thread-1  ]: 7 of 10 START sql table model public_transform.TEST ............................ [RUN]
[0m14:37:32.366142 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.TEST)
[0m14:37:32.366292 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.TEST
[0m14:37:32.367858 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.TEST"
[0m14:37:32.368157 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.TEST
[0m14:37:32.369757 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.TEST"
[0m14:37:32.369996 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:32.370129 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: BEGIN
[0m14:37:32.370255 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.377601 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.377753 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:32.377901 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.TEST"} */

  
    

  create  table "lucca_db"."public_transform"."TEST__dbt_tmp"
  
  
    as
  
  (
    
-- Table pour regrouper les informations étendues sur les employés, incluant le statut d'activité et de management

select 
    e.*,

    -- is_manager
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    -- is_active
    case
        when c.contract_start_date <= current_date
         and (c.contract_end_date is null or c.contract_end_date > current_date)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e
left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id
  );
  
[0m14:37:32.382413 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:37:32.383883 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:32.384027 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.TEST"} */
alter table "lucca_db"."public_transform"."TEST" rename to "TEST__dbt_backup"
[0m14:37:32.384448 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.385761 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:32.385898 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.TEST"} */
alter table "lucca_db"."public_transform"."TEST__dbt_tmp" rename to "TEST"
[0m14:37:32.386233 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.386909 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: COMMIT
[0m14:37:32.387074 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:32.387217 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: COMMIT
[0m14:37:32.388141 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:32.389944 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."TEST__dbt_backup"
[0m14:37:32.390245 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.TEST"
[0m14:37:32.390377 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.TEST"} */
drop table if exists "lucca_db"."public_transform"."TEST__dbt_backup" cascade
[0m14:37:32.392547 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:32.393053 [debug] [Thread-1  ]: On model.lucca_dbt.TEST: Close
[0m14:37:32.393289 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113885610>]}
[0m14:37:32.393544 [info ] [Thread-1  ]: 7 of 10 OK created sql table model public_transform.TEST ....................... [[32mSELECT 115[0m in 0.03s]
[0m14:37:32.393782 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.TEST
[0m14:37:32.393929 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m14:37:32.394134 [info ] [Thread-1  ]: 8 of 10 START sql table model public_transform.employee_extended ............... [RUN]
[0m14:37:32.394325 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.TEST, now model.lucca_dbt.employee_extended)
[0m14:37:32.394464 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m14:37:32.396046 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m14:37:32.396349 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m14:37:32.397960 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m14:37:32.398204 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:32.398341 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m14:37:32.398470 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.405137 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.405404 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:32.405644 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour regrouper les informations étendues sur les employés, incluant le statut d'activité et de management

with today as (
    select current_date as today
)

select 
    e.*,
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    case
        when c.contract_start_date <= t.today
         and (c.contract_end_date is null or c.contract_end_date > t.today)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e

left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id

cross join today t
  );
  
[0m14:37:32.410923 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:37:32.412451 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:32.412594 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m14:37:32.413023 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.414250 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:32.414390 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m14:37:32.414750 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.415387 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:37:32.415523 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:32.415647 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:37:32.416217 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:37:32.417267 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m14:37:32.417561 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:37:32.417696 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m14:37:32.419896 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:37:32.420374 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m14:37:32.420634 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1138c45e0>]}
[0m14:37:32.420966 [info ] [Thread-1  ]: 8 of 10 OK created sql table model public_transform.employee_extended .......... [[32mSELECT 115[0m in 0.03s]
[0m14:37:32.421273 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m14:37:32.421600 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m14:37:32.421824 [info ] [Thread-1  ]: 9 of 10 START sql table model public_transform.company_extended ................ [RUN]
[0m14:37:32.422015 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m14:37:32.422167 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m14:37:32.423621 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m14:37:32.423908 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m14:37:32.426030 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m14:37:32.426259 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:32.426391 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m14:37:32.426516 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.433634 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:37:32.433791 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:32.433946 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour les informations sur les entreprises avec des métriques agrégées sur les employés et départements
select
    c.company_id,
    c.company_name,
    count(e.employee_id) as total_employee,
    count(case when e.is_active = true then 1 else 0 end) as total_employee_active,
    sum(case when e.is_manager then 1 else 0 end) as total_manager,
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active,
    count(distinct e.department_id) as total_nb_departments

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m14:37:32.437942 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.004 seconds
[0m14:37:32.439709 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:32.439874 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended" rename to "company_extended__dbt_backup"
[0m14:37:32.440332 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.441604 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:32.441747 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m14:37:32.442083 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.442705 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:37:32.442848 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:32.442982 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:37:32.443440 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:37:32.444604 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m14:37:32.444923 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:37:32.445080 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m14:37:32.445943 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:37:32.446479 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m14:37:32.446745 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113845160>]}
[0m14:37:32.447035 [info ] [Thread-1  ]: 9 of 10 OK created sql table model public_transform.company_extended ........... [[32mSELECT 5[0m in 0.02s]
[0m14:37:32.447280 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m14:37:32.447455 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m14:37:32.447680 [info ] [Thread-1  ]: 10 of 10 START sql table model public_transform.department_extended ............ [RUN]
[0m14:37:32.447868 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m14:37:32.448023 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m14:37:32.449636 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m14:37:32.449964 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m14:37:32.451584 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m14:37:32.451831 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:32.451968 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m14:37:32.452104 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:37:32.456862 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:37:32.457076 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:32.457241 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    
-- description: Table pour regrouper les informations étendues sur les départements, incluant le nombre d'employés et de managers
select
    d.*,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m14:37:32.459960 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.003 seconds
[0m14:37:32.462140 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:32.462283 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m14:37:32.462646 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.463866 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:32.464003 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m14:37:32.464380 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:37:32.464993 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:37:32.465151 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:32.465294 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:37:32.465944 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:37:32.466969 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m14:37:32.467257 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:37:32.467411 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m14:37:32.468067 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:37:32.468539 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m14:37:32.468796 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3659aaae-3c94-4739-a77c-8d64ee4669c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7c26a0>]}
[0m14:37:32.469089 [info ] [Thread-1  ]: 10 of 10 OK created sql table model public_transform.department_extended ....... [[32mSELECT 32[0m in 0.02s]
[0m14:37:32.469334 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m14:37:32.469827 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:32.469974 [debug] [MainThread]: On master: BEGIN
[0m14:37:32.470098 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:37:32.474581 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:37:32.474754 [debug] [MainThread]: On master: COMMIT
[0m14:37:32.474891 [debug] [MainThread]: Using postgres connection "master"
[0m14:37:32.475046 [debug] [MainThread]: On master: COMMIT
[0m14:37:32.475319 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:37:32.475448 [debug] [MainThread]: On master: Close
[0m14:37:32.475631 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:37:32.475738 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m14:37:32.475898 [info ] [MainThread]: 
[0m14:37:32.476039 [info ] [MainThread]: Finished running 10 table models in 0 hours 0 minutes and 0.40 seconds (0.40s).
[0m14:37:32.476763 [debug] [MainThread]: Command end result
[0m14:37:32.486922 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:37:32.487704 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:37:32.494988 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:37:32.495767 [info ] [MainThread]: 
[0m14:37:32.496192 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:37:32.496583 [info ] [MainThread]: 
[0m14:37:32.497163 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=10
[0m14:37:32.500227 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.82851386, "process_in_blocks": "0", "process_kernel_time": 0.127272, "process_mem_max_rss": "131514368", "process_out_blocks": "0", "process_user_time": 1.138256}
[0m14:37:32.500772 [debug] [MainThread]: Command `dbt run` succeeded at 14:37:32.500685 after 0.83 seconds
[0m14:37:32.501172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0c2e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf7ea30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e130bb0>]}
[0m14:37:32.501673 [debug] [MainThread]: Flushing usage events
[0m14:37:34.256910 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:39:00.643187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108456e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094cbd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094cb250>]}


============================== 14:39:00.645676 | ac2e1544-1e3e-473f-a179-25c08dfe99cd ==============================
[0m14:39:00.645676 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:39:00.645929 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'introspect': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'log_format': 'default', 'quiet': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'printer_width': '80', 'no_print': 'None', 'use_colors': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'version_check': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:39:00.735274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dfda60>]}
[0m14:39:00.760610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108796250>]}
[0m14:39:00.761250 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:39:00.811923 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:39:00.875532 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 1 files changed.
[0m14:39:00.875820 [debug] [MainThread]: Partial parsing: deleted file: lucca_dbt://models/models/transform/TEST.sql
[0m14:39:00.876024 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/transform/employee_extended.sql
[0m14:39:00.979241 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.transform
- models.lucca_dbt.base
[0m14:39:00.985927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a660130>]}
[0m14:39:01.043310 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:39:01.044361 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:39:01.053544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cef7f0>]}
[0m14:39:01.053776 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m14:39:01.053932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a44aac0>]}
[0m14:39:01.054610 [info ] [MainThread]: 
[0m14:39:01.054768 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:39:01.054910 [info ] [MainThread]: 
[0m14:39:01.055133 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:39:01.057142 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:39:01.084167 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:39:01.084609 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:39:01.084733 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:39:01.117880 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.033 seconds
[0m14:39:01.118490 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:39:01.119760 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:39:01.119933 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:39:01.120064 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:01.128115 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.008 seconds
[0m14:39:01.128555 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:39:01.129191 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:39:01.131921 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:39:01.132051 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:39:01.132161 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:01.138564 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:39:01.138697 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:39:01.138820 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:39:01.141999 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:39:01.142505 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:39:01.142900 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:39:01.143127 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:39:01.144346 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:39:01.144472 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:39:01.144587 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:01.151639 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:39:01.151768 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:39:01.151895 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:39:01.155226 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:39:01.155755 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:39:01.156158 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:39:01.158464 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:01.158603 [debug] [MainThread]: On master: BEGIN
[0m14:39:01.158721 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:39:01.165273 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:39:01.165401 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:01.165550 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:39:01.169249 [debug] [MainThread]: SQL status: SELECT 0 in 0.004 seconds
[0m14:39:01.169687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a501280>]}
[0m14:39:01.169879 [debug] [MainThread]: On master: ROLLBACK
[0m14:39:01.170306 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:01.170427 [debug] [MainThread]: On master: BEGIN
[0m14:39:01.171074 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:39:01.171195 [debug] [MainThread]: On master: COMMIT
[0m14:39:01.171316 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:01.171429 [debug] [MainThread]: On master: COMMIT
[0m14:39:01.171796 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:39:01.171925 [debug] [MainThread]: On master: Close
[0m14:39:01.173651 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:39:01.173882 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:39:01.174089 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:39:01.174242 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:39:01.178116 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.178415 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:39:01.195153 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.195537 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.195682 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:39:01.195812 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.204947 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:39:01.205112 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.205286 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table brut de l'extraction de l'API de Lucca suite au script python main.py
select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    -- extract du payload an json
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date AS birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' AS manager_name,
    (raw_payload->'culture'->>'id')::int AS culture_id,
    raw_payload->'culture'->>'name' AS culture_name,
    (raw_payload->'calendar'->>'id')::int AS calendar_id,
    raw_payload->'calendar'->>'name' AS calendar_name,
    (raw_payload->'legalEntity'->>'id')::int AS legalEntity_id,
    raw_payload->'legalEntity'->>'name' AS legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int AS rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' AS rolePrincipal_name,
    ARRAY_TO_STRING(ARRAY(
        SELECT hr->>'name'
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ', ') AS habilitedRoles_names,
    ARRAY_TO_STRING(ARRAY(
        SELECT (hr->>'id')::int
        FROM jsonb_array_elements(raw_payload->'habilitedRoles') AS hr
    ), ',') AS habilitedRoles_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT (uwc->>'id')::int
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ids,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'ownerID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ownerIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'workCycleID'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_workCycleIDs,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'startsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_starts,
    ARRAY_TO_STRING(ARRAY(
        SELECT uwc->>'endsOn'
        FROM jsonb_array_elements(raw_payload->'userWorkCycles') AS uwc
    ), ',') AS workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:39:01.212915 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m14:39:01.217729 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.217886 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:39:01.218538 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:01.219837 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.219986 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:39:01.220496 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.227288 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:39:01.227443 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.227577 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:39:01.228493 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:01.230922 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:39:01.232768 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:01.232932 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:39:01.235092 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:39:01.236160 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:39:01.237090 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa1d190>]}
[0m14:39:01.237361 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.06s]
[0m14:39:01.237617 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:39:01.237967 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m14:39:01.238182 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m14:39:01.238375 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m14:39:01.238514 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m14:39:01.239736 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m14:39:01.239989 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m14:39:01.241538 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m14:39:01.241767 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:01.241898 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m14:39:01.242023 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.249938 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:39:01.250128 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:01.250279 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les entreprises 
select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:01.254844 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.004 seconds
[0m14:39:01.256352 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:01.256491 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m14:39:01.257056 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.258779 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:01.258916 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m14:39:01.259393 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.259969 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:39:01.260104 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:01.260227 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:39:01.261052 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:01.262023 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m14:39:01.262306 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:01.262437 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m14:39:01.264861 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:39:01.265319 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m14:39:01.265549 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab90fd0>]}
[0m14:39:01.265800 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.03s]
[0m14:39:01.266041 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m14:39:01.266189 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m14:39:01.266400 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m14:39:01.266597 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m14:39:01.266739 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m14:39:01.268055 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m14:39:01.268339 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m14:39:01.269943 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m14:39:01.270178 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:01.270311 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m14:39:01.270440 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.276817 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:39:01.276997 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:01.277136 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les contrats 
select 
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id as company_id,
    legalEntity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:01.281181 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:39:01.282654 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:01.282795 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m14:39:01.283426 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.284614 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:01.284747 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m14:39:01.285247 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.285913 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:39:01.286160 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:01.286356 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:39:01.287286 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:01.288860 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m14:39:01.289158 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:01.289293 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m14:39:01.291277 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:39:01.291773 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m14:39:01.292009 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abe5be0>]}
[0m14:39:01.292267 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:39:01.292508 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m14:39:01.292670 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m14:39:01.292900 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m14:39:01.293103 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m14:39:01.293255 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m14:39:01.294651 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m14:39:01.294931 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m14:39:01.296516 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m14:39:01.296754 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:01.296889 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m14:39:01.297018 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.304591 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:39:01.304798 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:01.304982 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour regrouper les informations sur les contrats étendus avec des indicateurs sur les employés
select 
    *,
    case
        when contract_start_date > current_date then true
        else false
    end as will_start,

    case
        when contract_start_date > current_date then 'not_started'
        when contract_end_date is null or contract_end_date >= current_date then 'active'
        else 'inactive'
    end as contract_status,

    case
        when contract_end_date is not null and contract_end_date < current_date then true
        else false
    end as is_suspended,    

    case
        when contract_start_date is not null then
            coalesce(contract_end_date, current_date) - contract_start_date
        else null
    end as days_worked,

    case
        when contract_start_date is not null then
                extract(year from age(coalesce(contract_end_date, current_date), contract_start_date))
            else null
    end as seniority_years,

    case
        when contract_end_date is not null and contract_end_date >= current_date then
            contract_end_date - current_date
        else null
    end as remaining_days

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:01.310308 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:39:01.311938 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:01.312095 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m14:39:01.313007 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:01.314310 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:01.314461 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m14:39:01.315595 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:01.316248 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:39:01.316395 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:01.316534 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:39:01.318182 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m14:39:01.319275 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m14:39:01.319651 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:01.319798 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m14:39:01.321936 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:39:01.322612 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m14:39:01.322916 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ef3100>]}
[0m14:39:01.323236 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:39:01.323495 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m14:39:01.323671 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m14:39:01.323914 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m14:39:01.324129 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m14:39:01.324296 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m14:39:01.325821 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m14:39:01.326156 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m14:39:01.328541 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m14:39:01.328816 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:01.328962 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m14:39:01.329109 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.334300 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:39:01.334487 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:01.334646 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les départements 

select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:01.336949 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.002 seconds
[0m14:39:01.338752 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:01.338924 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m14:39:01.339370 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.340693 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:01.340842 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m14:39:01.341178 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.341830 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:39:01.341990 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:01.342129 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:39:01.342551 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:39:01.343624 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m14:39:01.343931 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:01.344074 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m14:39:01.344957 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:01.345456 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m14:39:01.345730 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a577c40>]}
[0m14:39:01.346023 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.02s]
[0m14:39:01.346270 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m14:39:01.346446 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:39:01.346677 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m14:39:01.346877 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m14:39:01.347023 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:39:01.348529 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:39:01.348853 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:39:01.350548 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:39:01.350792 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:01.350927 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:39:01.351055 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.355627 [debug] [Thread-1  ]: SQL status: BEGIN in 0.005 seconds
[0m14:39:01.355836 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:01.355986 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les employés 

select
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:01.358064 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.002 seconds
[0m14:39:01.359644 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:01.359787 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m14:39:01.360154 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.361985 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:01.362122 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m14:39:01.362495 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.363101 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:39:01.363239 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:01.363363 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:39:01.363803 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:39:01.364801 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m14:39:01.365086 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:01.365220 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m14:39:01.365944 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:01.366471 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:39:01.366740 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab45dc0>]}
[0m14:39:01.367016 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.02s]
[0m14:39:01.367267 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:39:01.367567 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m14:39:01.367777 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m14:39:01.368014 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m14:39:01.368165 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m14:39:01.369926 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m14:39:01.370277 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m14:39:01.371907 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m14:39:01.372156 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:01.372290 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m14:39:01.372419 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.378608 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:39:01.378781 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:01.378933 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    
-- Table pour regrouper les informations étendues sur les employés, incluant le statut d'activité et de management

select 
    e.*,
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    case
        when c.contract_start_date <= current_date
         and (c.contract_end_date is null or c.contract_end_date > current_date)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e
left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id
  );
  
[0m14:39:01.381413 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.002 seconds
[0m14:39:01.382874 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:01.383031 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m14:39:01.383426 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.384703 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:01.384846 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m14:39:01.385184 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.385865 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:39:01.386024 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:01.386155 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:39:01.387043 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:01.388679 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m14:39:01.388975 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:01.389108 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m14:39:01.390946 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:39:01.391432 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m14:39:01.391670 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab9c0a0>]}
[0m14:39:01.391926 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.02s]
[0m14:39:01.392165 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m14:39:01.392506 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m14:39:01.392717 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m14:39:01.392913 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m14:39:01.393060 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m14:39:01.394498 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m14:39:01.394806 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m14:39:01.396379 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m14:39:01.396621 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:01.396754 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m14:39:01.396882 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.402787 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:39:01.402935 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:01.403096 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour les informations sur les entreprises avec des métriques agrégées sur les employés et départements
select
    c.company_id,
    c.company_name,
    count(e.employee_id) as total_employee,
    count(case when e.is_active = true then 1 else 0 end) as total_employee_active,
    sum(case when e.is_manager then 1 else 0 end) as total_manager,
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active,
    count(distinct e.department_id) as total_nb_departments

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m14:39:01.406518 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.003 seconds
[0m14:39:01.408042 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:01.408185 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended" rename to "company_extended__dbt_backup"
[0m14:39:01.408589 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.409806 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:01.409940 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m14:39:01.410272 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.410907 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:39:01.411053 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:01.411186 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:39:01.411775 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:39:01.412882 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m14:39:01.413191 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:01.413341 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m14:39:01.414014 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:01.414513 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m14:39:01.414775 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aba75b0>]}
[0m14:39:01.415052 [info ] [Thread-1  ]: 8 of 9 OK created sql table model public_transform.company_extended ............ [[32mSELECT 5[0m in 0.02s]
[0m14:39:01.415289 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m14:39:01.415459 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m14:39:01.415679 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m14:39:01.415860 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m14:39:01.416012 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m14:39:01.417588 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m14:39:01.417886 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m14:39:01.420203 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m14:39:01.420455 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:01.420584 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m14:39:01.420709 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:01.427499 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:39:01.427687 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:01.427848 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    
-- description: Table pour regrouper les informations étendues sur les départements, incluant le nombre d'employés et de managers
select
    d.*,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m14:39:01.430484 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.002 seconds
[0m14:39:01.432057 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:01.432215 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m14:39:01.432579 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:01.433897 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:01.434050 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m14:39:01.434704 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:01.435347 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:39:01.435497 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:01.435636 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:39:01.436550 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:01.437758 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m14:39:01.438054 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:01.438190 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m14:39:01.440721 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:39:01.441241 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m14:39:01.441503 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac2e1544-1e3e-473f-a179-25c08dfe99cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b88250>]}
[0m14:39:01.441782 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m14:39:01.442032 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m14:39:01.442507 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:01.442642 [debug] [MainThread]: On master: BEGIN
[0m14:39:01.442761 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:39:01.449653 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:39:01.449825 [debug] [MainThread]: On master: COMMIT
[0m14:39:01.449960 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:01.450082 [debug] [MainThread]: On master: COMMIT
[0m14:39:01.450353 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:39:01.450484 [debug] [MainThread]: On master: Close
[0m14:39:01.450662 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:39:01.450779 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m14:39:01.450948 [info ] [MainThread]: 
[0m14:39:01.451094 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.40 seconds (0.40s).
[0m14:39:01.451819 [debug] [MainThread]: Command end result
[0m14:39:01.462456 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:39:01.463268 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:39:01.466223 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:39:01.466357 [info ] [MainThread]: 
[0m14:39:01.466523 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:39:01.466664 [info ] [MainThread]: 
[0m14:39:01.466812 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m14:39:01.468114 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8572968, "process_in_blocks": "0", "process_kernel_time": 0.154233, "process_mem_max_rss": "131661824", "process_out_blocks": "0", "process_user_time": 1.120542}
[0m14:39:01.468276 [debug] [MainThread]: Command `dbt run` succeeded at 14:39:01.468244 after 0.86 seconds
[0m14:39:01.468426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108456e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108796250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5fa0d0>]}
[0m14:39:01.468573 [debug] [MainThread]: Flushing usage events
[0m14:39:03.452080 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:39:35.698030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a44e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108abcee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108abc430>]}


============================== 14:39:35.700387 | be8b1d01-d1db-4a73-ae71-cde867446e53 ==============================
[0m14:39:35.700387 [info ] [MainThread]: Running with dbt=1.10.17
[0m14:39:35.700651 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'log_format': 'default', 'use_colors': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'no_print': 'None', 'profiles_dir': '/Users/marccao/repo/dbt', 'version_check': 'True', 'log_path': '/Users/marccao/repo/dbt/logs', 'use_experimental_parser': 'False', 'printer_width': '80', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'write_json': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'introspect': 'True', 'quiet': 'False', 'debug': 'False', 'fail_fast': 'False'}
[0m14:39:35.789317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063ede20>]}
[0m14:39:35.814702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e4460>]}
[0m14:39:35.815131 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:39:35.869248 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m14:39:35.932177 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:39:35.932507 [debug] [MainThread]: Partial parsing: updated file: lucca_dbt://models/models/base/lucca_raw_data.sql
[0m14:39:36.042738 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.lucca_dbt.analytics
- models.lucca_dbt.base
- models.lucca_dbt.transform
[0m14:39:36.049613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c68130>]}
[0m14:39:36.107580 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:39:36.108648 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:39:36.117801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a302b0>]}
[0m14:39:36.118021 [info ] [MainThread]: Found 9 models, 1 source, 447 macros
[0m14:39:36.118174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d86190>]}
[0m14:39:36.118882 [info ] [MainThread]: 
[0m14:39:36.119047 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:39:36.119179 [info ] [MainThread]: 
[0m14:39:36.119400 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:39:36.121376 [debug] [ThreadPool]: Acquiring new postgres connection 'list_lucca_db'
[0m14:39:36.148970 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:39:36.149170 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:39:36.149291 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:39:36.185224 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.036 seconds
[0m14:39:36.185887 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:39:36.187113 [debug] [ThreadPool]: Using postgres connection "list_lucca_db"
[0m14:39:36.187265 [debug] [ThreadPool]: On list_lucca_db: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db"} */

    select distinct nspname from pg_namespace
  
[0m14:39:36.187379 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:36.195982 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m14:39:36.196423 [debug] [ThreadPool]: On list_lucca_db: Close
[0m14:39:36.197047 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db, now list_lucca_db_public_transform)
[0m14:39:36.199782 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:39:36.199920 [debug] [ThreadPool]: On list_lucca_db_public_transform: BEGIN
[0m14:39:36.200030 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:36.207041 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:39:36.207157 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_transform"
[0m14:39:36.207281 [debug] [ThreadPool]: On list_lucca_db_public_transform: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_transform"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_transform'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_transform'
  
[0m14:39:36.210536 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:39:36.211032 [debug] [ThreadPool]: On list_lucca_db_public_transform: ROLLBACK
[0m14:39:36.211434 [debug] [ThreadPool]: On list_lucca_db_public_transform: Close
[0m14:39:36.211652 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_lucca_db_public_transform, now list_lucca_db_public_base)
[0m14:39:36.212578 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:39:36.212713 [debug] [ThreadPool]: On list_lucca_db_public_base: BEGIN
[0m14:39:36.213136 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:36.220068 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:39:36.220227 [debug] [ThreadPool]: Using postgres connection "list_lucca_db_public_base"
[0m14:39:36.220365 [debug] [ThreadPool]: On list_lucca_db_public_base: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "list_lucca_db_public_base"} */
select
      'lucca_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_base'
    union all
    select
      'lucca_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_base'
  
[0m14:39:36.223692 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m14:39:36.224271 [debug] [ThreadPool]: On list_lucca_db_public_base: ROLLBACK
[0m14:39:36.224697 [debug] [ThreadPool]: On list_lucca_db_public_base: Close
[0m14:39:36.227080 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:36.227219 [debug] [MainThread]: On master: BEGIN
[0m14:39:36.227335 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:39:36.234137 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:39:36.234267 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:36.234418 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:39:36.237824 [debug] [MainThread]: SQL status: SELECT 0 in 0.003 seconds
[0m14:39:36.238252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a94130>]}
[0m14:39:36.238445 [debug] [MainThread]: On master: ROLLBACK
[0m14:39:36.238831 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:36.238956 [debug] [MainThread]: On master: BEGIN
[0m14:39:36.239616 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m14:39:36.239742 [debug] [MainThread]: On master: COMMIT
[0m14:39:36.239864 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:36.239983 [debug] [MainThread]: On master: COMMIT
[0m14:39:36.240351 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:39:36.240480 [debug] [MainThread]: On master: Close
[0m14:39:36.242220 [debug] [Thread-1  ]: Began running node model.lucca_dbt.lucca_raw_data
[0m14:39:36.242445 [info ] [Thread-1  ]: 1 of 9 START sql table model public_base.lucca_raw_data ........................ [RUN]
[0m14:39:36.242648 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_lucca_db_public_base, now model.lucca_dbt.lucca_raw_data)
[0m14:39:36.242799 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.lucca_raw_data
[0m14:39:36.246654 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.246953 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.lucca_raw_data
[0m14:39:36.263410 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.263786 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.263927 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: BEGIN
[0m14:39:36.264057 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.275625 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m14:39:36.275808 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.276008 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */

  
    

  create  table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table brut de l'extraction de l'API de Lucca suite au script python main.py
select
    id, 
    last_name,
    first_name,
    mail,
    employee_number,
    modified_at,
    refreshed_at,
    -- extract du payload an json
    (raw_payload->>'dtContractStart')::date as contract_start_date,
    (raw_payload->>'dtContractEnd')::date as contract_end_date,
    (raw_payload->>'birthDate')::date as birth_date,
    (raw_payload->'manager'->>'id')::int as manager_id,
    raw_payload->'manager'->>'name' as manager_name,
    (raw_payload->'culture'->>'id')::int as culture_id,
    raw_payload->'culture'->>'name' as culture_name,
    (raw_payload->'calendar'->>'id')::int as calendar_id,
    raw_payload->'calendar'->>'name' as calendar_name,
    (raw_payload->'legalEntity'->>'id')::int as legalEntity_id,
    raw_payload->'legalEntity'->>'name' as legalEntity_name,
    raw_payload->'department'->>'id'   as department_id,
    raw_payload->'department'->>'name' as department_name,  
    (raw_payload->'rolePrincipal'->>'id')::int as rolePrincipal_id,
    raw_payload->'rolePrincipal'->>'name' as rolePrincipal_name,
    array_to_string(array(
        select hr->>'name'
        from jsonb_array_elements(raw_payload->'habilitedRoles') as hr
    ), ', ') as habilitedRoles_names,
    array_to_string(array(
        select (hr->>'id')::int
        from jsonb_array_elements(raw_payload->'habilitedRoles') as hr
    ), ',') as habilitedRoles_ids,
    array_to_string(array(
        select (uwc->>'id')::int
        from jsonb_array_elements(raw_payload->'userWorkCycles') as uwc
    ), ',') as workCycle_ids,
    array_to_string(array(
        select uwc->>'ownerID'
        from jsonb_array_elements(raw_payload->'userWorkCycles') as uwc
    ), ',') as workCycle_ownerIDs,
    array_to_string(array(
        select uwc->>'workCycleID'
        from jsonb_array_elements(raw_payload->'userWorkCycles') as uwc
    ), ',') as workCycle_workCycleIDs,
    array_to_string(array(
        select uwc->>'startsOn'
        from jsonb_array_elements(raw_payload->'userWorkCycles') as uwc
    ), ',') as workCycle_starts,
    array_to_string(array(
        select uwc->>'endsOn'
        from jsonb_array_elements(raw_payload->'userWorkCycles') as uwc
    ), ',') as workCycle_ends

from "lucca_db"."public"."users"
  );
  
[0m14:39:36.283232 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.007 seconds
[0m14:39:36.291677 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.291916 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data" rename to "lucca_raw_data__dbt_backup"
[0m14:39:36.293139 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:36.294803 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.294961 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
alter table "lucca_db"."public_base"."lucca_raw_data__dbt_tmp" rename to "lucca_raw_data"
[0m14:39:36.296087 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:36.304108 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:39:36.304333 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.304471 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: COMMIT
[0m14:39:36.306201 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m14:39:36.308782 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."lucca_raw_data__dbt_backup"
[0m14:39:36.310500 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.lucca_raw_data"
[0m14:39:36.310647 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.lucca_raw_data"} */
drop table if exists "lucca_db"."public_base"."lucca_raw_data__dbt_backup" cascade
[0m14:39:36.313708 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:39:36.314787 [debug] [Thread-1  ]: On model.lucca_dbt.lucca_raw_data: Close
[0m14:39:36.315770 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f93160>]}
[0m14:39:36.316062 [info ] [Thread-1  ]: 1 of 9 OK created sql table model public_base.lucca_raw_data ................... [[32mSELECT 115[0m in 0.07s]
[0m14:39:36.316300 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.lucca_raw_data
[0m14:39:36.316669 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company
[0m14:39:36.316894 [info ] [Thread-1  ]: 2 of 9 START sql table model public_base.company ............................... [RUN]
[0m14:39:36.317162 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.lucca_raw_data, now model.lucca_dbt.company)
[0m14:39:36.317316 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company
[0m14:39:36.318875 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company"
[0m14:39:36.319260 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company
[0m14:39:36.320982 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company"
[0m14:39:36.321244 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:36.321394 [debug] [Thread-1  ]: On model.lucca_dbt.company: BEGIN
[0m14:39:36.321563 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.329869 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:39:36.330071 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:36.330207 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */

  
    

  create  table "lucca_db"."public_base"."company__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les entreprises 
select distinct 
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:36.333618 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.003 seconds
[0m14:39:36.335917 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:36.336195 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company" rename to "company__dbt_backup"
[0m14:39:36.337164 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:36.340046 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:36.340348 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
alter table "lucca_db"."public_base"."company__dbt_tmp" rename to "company"
[0m14:39:36.341118 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:36.341806 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:39:36.341950 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:36.342078 [debug] [Thread-1  ]: On model.lucca_dbt.company: COMMIT
[0m14:39:36.342584 [debug] [Thread-1  ]: SQL status: COMMIT in 0.000 seconds
[0m14:39:36.343784 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."company__dbt_backup"
[0m14:39:36.344123 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company"
[0m14:39:36.344335 [debug] [Thread-1  ]: On model.lucca_dbt.company: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company"} */
drop table if exists "lucca_db"."public_base"."company__dbt_backup" cascade
[0m14:39:36.345546 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:36.346258 [debug] [Thread-1  ]: On model.lucca_dbt.company: Close
[0m14:39:36.346576 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a17efa0>]}
[0m14:39:36.346897 [info ] [Thread-1  ]: 2 of 9 OK created sql table model public_base.company .......................... [[32mSELECT 5[0m in 0.03s]
[0m14:39:36.347152 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company
[0m14:39:36.347328 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract
[0m14:39:36.347598 [info ] [Thread-1  ]: 3 of 9 START sql table model public_base.contract .............................. [RUN]
[0m14:39:36.347793 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company, now model.lucca_dbt.contract)
[0m14:39:36.347950 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract
[0m14:39:36.349630 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract"
[0m14:39:36.350024 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract
[0m14:39:36.351821 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract"
[0m14:39:36.352220 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:36.352426 [debug] [Thread-1  ]: On model.lucca_dbt.contract: BEGIN
[0m14:39:36.352699 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.359858 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:39:36.360076 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:36.360221 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */

  
    

  create  table "lucca_db"."public_base"."contract__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les contrats 
select 
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    contract_start_date,
    contract_end_date,
    legalEntity_id as company_id,
    legalEntity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:36.363200 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m14:39:36.365057 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:36.365234 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract" rename to "contract__dbt_backup"
[0m14:39:36.365912 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:36.367231 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:36.367387 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
alter table "lucca_db"."public_base"."contract__dbt_tmp" rename to "contract"
[0m14:39:36.367886 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.368519 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:39:36.368684 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:36.368811 [debug] [Thread-1  ]: On model.lucca_dbt.contract: COMMIT
[0m14:39:36.369562 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:36.371512 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."contract__dbt_backup"
[0m14:39:36.371930 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract"
[0m14:39:36.372079 [debug] [Thread-1  ]: On model.lucca_dbt.contract: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract"} */
drop table if exists "lucca_db"."public_base"."contract__dbt_backup" cascade
[0m14:39:36.373684 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:36.374236 [debug] [Thread-1  ]: On model.lucca_dbt.contract: Close
[0m14:39:36.374490 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1d5970>]}
[0m14:39:36.374752 [info ] [Thread-1  ]: 3 of 9 OK created sql table model public_base.contract ......................... [[32mSELECT 115[0m in 0.03s]
[0m14:39:36.374998 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract
[0m14:39:36.375149 [debug] [Thread-1  ]: Began running node model.lucca_dbt.contract_extended
[0m14:39:36.375361 [info ] [Thread-1  ]: 4 of 9 START sql table model public_transform.contract_extended ................ [RUN]
[0m14:39:36.375558 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract, now model.lucca_dbt.contract_extended)
[0m14:39:36.375702 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.contract_extended
[0m14:39:36.377170 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.contract_extended"
[0m14:39:36.377493 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.contract_extended
[0m14:39:36.379231 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.contract_extended"
[0m14:39:36.379530 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:36.379687 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: BEGIN
[0m14:39:36.379828 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.386293 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:39:36.386536 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:36.386739 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */

  
    

  create  table "lucca_db"."public_transform"."contract_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour regrouper les informations sur les contrats étendus avec des indicateurs sur les employés
select 
    *,
    case
        when contract_start_date > current_date then true
        else false
    end as will_start,

    case
        when contract_start_date > current_date then 'not_started'
        when contract_end_date is null or contract_end_date >= current_date then 'active'
        else 'inactive'
    end as contract_status,

    case
        when contract_end_date is not null and contract_end_date < current_date then true
        else false
    end as is_suspended,    

    case
        when contract_start_date is not null then
            coalesce(contract_end_date, current_date) - contract_start_date
        else null
    end as days_worked,

    case
        when contract_start_date is not null then
                extract(year from age(coalesce(contract_end_date, current_date), contract_start_date))
            else null
    end as seniority_years,

    case
        when contract_end_date is not null and contract_end_date >= current_date then
            contract_end_date - current_date
        else null
    end as remaining_days

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:36.391673 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.005 seconds
[0m14:39:36.393305 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:36.393462 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended" rename to "contract_extended__dbt_backup"
[0m14:39:36.394074 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.395355 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:36.395506 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
alter table "lucca_db"."public_transform"."contract_extended__dbt_tmp" rename to "contract_extended"
[0m14:39:36.396316 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:39:36.396930 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:39:36.397070 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:36.397195 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: COMMIT
[0m14:39:36.398025 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:36.399047 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."contract_extended__dbt_backup"
[0m14:39:36.399361 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.contract_extended"
[0m14:39:36.399495 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.contract_extended"} */
drop table if exists "lucca_db"."public_transform"."contract_extended__dbt_backup" cascade
[0m14:39:36.400992 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:36.401494 [debug] [Thread-1  ]: On model.lucca_dbt.contract_extended: Close
[0m14:39:36.401747 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b51bb0>]}
[0m14:39:36.402070 [info ] [Thread-1  ]: 4 of 9 OK created sql table model public_transform.contract_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:39:36.402463 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.contract_extended
[0m14:39:36.402674 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department
[0m14:39:36.402880 [info ] [Thread-1  ]: 5 of 9 START sql table model public_base.department ............................ [RUN]
[0m14:39:36.403094 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.contract_extended, now model.lucca_dbt.department)
[0m14:39:36.403273 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department
[0m14:39:36.404662 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department"
[0m14:39:36.404977 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department
[0m14:39:36.407157 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department"
[0m14:39:36.407395 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:36.407526 [debug] [Thread-1  ]: On model.lucca_dbt.department: BEGIN
[0m14:39:36.407650 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.416137 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:39:36.416298 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:36.416438 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */

  
    

  create  table "lucca_db"."public_base"."department__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les départements 

select distinct 
    department_id,
    department_name,
    legalEntity_id as company_id,
    legalEntity_name as company_name

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:36.420086 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.003 seconds
[0m14:39:36.421609 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:36.421754 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department" rename to "department__dbt_backup"
[0m14:39:36.422276 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.423555 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:36.423721 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
alter table "lucca_db"."public_base"."department__dbt_tmp" rename to "department"
[0m14:39:36.424220 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.424853 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:39:36.424994 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:36.425123 [debug] [Thread-1  ]: On model.lucca_dbt.department: COMMIT
[0m14:39:36.425909 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:36.426918 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."department__dbt_backup"
[0m14:39:36.427208 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department"
[0m14:39:36.427341 [debug] [Thread-1  ]: On model.lucca_dbt.department: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department"} */
drop table if exists "lucca_db"."public_base"."department__dbt_backup" cascade
[0m14:39:36.428981 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:39:36.429445 [debug] [Thread-1  ]: On model.lucca_dbt.department: Close
[0m14:39:36.429682 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e48b0>]}
[0m14:39:36.429931 [info ] [Thread-1  ]: 5 of 9 OK created sql table model public_base.department ....................... [[32mSELECT 32[0m in 0.03s]
[0m14:39:36.430173 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department
[0m14:39:36.430321 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee
[0m14:39:36.430524 [info ] [Thread-1  ]: 6 of 9 START sql table model public_base.employee .............................. [RUN]
[0m14:39:36.430711 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.department, now model.lucca_dbt.employee)
[0m14:39:36.430849 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee
[0m14:39:36.432143 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee"
[0m14:39:36.432406 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee
[0m14:39:36.433913 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee"
[0m14:39:36.434133 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:36.434261 [debug] [Thread-1  ]: On model.lucca_dbt.employee: BEGIN
[0m14:39:36.434381 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.440653 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:39:36.440810 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:36.440949 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */

  
    

  create  table "lucca_db"."public_base"."employee__dbt_tmp"
  
  
    as
  
  (
    
    --description: Table pour regrouper les informations sur les employés 

select
    id as employee_id,
    employee_number,
    last_name,
    first_name,
    mail as employee_email,
    birth_date,
    culture_name as nationality,
    legalentity_id as company_id,
    legalentity_name as company_name,
    roleprincipal_id as jobtitle_id,
    roleprincipal_name as jobtitle_name,
    department_id,
    department_name,
    manager_id,
    manager_name,
    modified_at,
    refreshed_at

from "lucca_db"."public_base"."lucca_raw_data"
  );
  
[0m14:39:36.444551 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.003 seconds
[0m14:39:36.445952 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:36.446091 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee" rename to "employee__dbt_backup"
[0m14:39:36.446569 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.448324 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:36.448462 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
alter table "lucca_db"."public_base"."employee__dbt_tmp" rename to "employee"
[0m14:39:36.448925 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.449502 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:39:36.449640 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:36.449764 [debug] [Thread-1  ]: On model.lucca_dbt.employee: COMMIT
[0m14:39:36.450544 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:36.451519 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_base"."employee__dbt_backup"
[0m14:39:36.451823 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee"
[0m14:39:36.451994 [debug] [Thread-1  ]: On model.lucca_dbt.employee: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee"} */
drop table if exists "lucca_db"."public_base"."employee__dbt_backup" cascade
[0m14:39:36.453275 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:36.453892 [debug] [Thread-1  ]: On model.lucca_dbt.employee: Close
[0m14:39:36.454167 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1d5970>]}
[0m14:39:36.454422 [info ] [Thread-1  ]: 6 of 9 OK created sql table model public_base.employee ......................... [[32mSELECT 115[0m in 0.02s]
[0m14:39:36.454654 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee
[0m14:39:36.454956 [debug] [Thread-1  ]: Began running node model.lucca_dbt.employee_extended
[0m14:39:36.455161 [info ] [Thread-1  ]: 7 of 9 START sql table model public_transform.employee_extended ................ [RUN]
[0m14:39:36.455351 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee, now model.lucca_dbt.employee_extended)
[0m14:39:36.455488 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.employee_extended
[0m14:39:36.457007 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.employee_extended"
[0m14:39:36.457291 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.employee_extended
[0m14:39:36.458878 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.employee_extended"
[0m14:39:36.459143 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:36.459288 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: BEGIN
[0m14:39:36.459416 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.466101 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:39:36.466259 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:36.466420 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */

  
    

  create  table "lucca_db"."public_transform"."employee_extended__dbt_tmp"
  
  
    as
  
  (
    
-- Table pour regrouper les informations étendues sur les employés, incluant le statut d'activité et de management

select 
    e.*,
    case 
        when e.employee_id in (
            select distinct manager_id::varchar 
            from "lucca_db"."public_base"."employee"
            where manager_id is not null
        )
        then true
        else false
    end as is_manager,

    case
        when c.contract_start_date <= current_date
         and (c.contract_end_date is null or c.contract_end_date > current_date)
        then true
        else false
    end as is_active

from "lucca_db"."public_base"."employee" e
left join "lucca_db"."public_base"."contract" c
    on e.employee_id = c.employee_id
  );
  
[0m14:39:36.470620 [debug] [Thread-1  ]: SQL status: SELECT 115 in 0.004 seconds
[0m14:39:36.472095 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:36.472245 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended" rename to "employee_extended__dbt_backup"
[0m14:39:36.472895 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.474220 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:36.474372 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
alter table "lucca_db"."public_transform"."employee_extended__dbt_tmp" rename to "employee_extended"
[0m14:39:36.474861 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.475496 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:39:36.475640 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:36.475782 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: COMMIT
[0m14:39:36.476737 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:36.478387 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."employee_extended__dbt_backup"
[0m14:39:36.478704 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.employee_extended"
[0m14:39:36.478847 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.employee_extended"} */
drop table if exists "lucca_db"."public_transform"."employee_extended__dbt_backup" cascade
[0m14:39:36.480295 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:36.480776 [debug] [Thread-1  ]: On model.lucca_dbt.employee_extended: Close
[0m14:39:36.481029 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fe87f0>]}
[0m14:39:36.481300 [info ] [Thread-1  ]: 7 of 9 OK created sql table model public_transform.employee_extended ........... [[32mSELECT 115[0m in 0.03s]
[0m14:39:36.481542 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.employee_extended
[0m14:39:36.481825 [debug] [Thread-1  ]: Began running node model.lucca_dbt.company_extended
[0m14:39:36.482041 [info ] [Thread-1  ]: 8 of 9 START sql table model public_transform.company_extended ................. [RUN]
[0m14:39:36.482239 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.employee_extended, now model.lucca_dbt.company_extended)
[0m14:39:36.482383 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.company_extended
[0m14:39:36.483865 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.company_extended"
[0m14:39:36.484158 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.company_extended
[0m14:39:36.486017 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.company_extended"
[0m14:39:36.486373 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:36.486563 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: BEGIN
[0m14:39:36.486745 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.493059 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:39:36.493223 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:36.493379 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */

  
    

  create  table "lucca_db"."public_transform"."company_extended__dbt_tmp"
  
  
    as
  
  (
    
--description: Table pour les informations sur les entreprises avec des métriques agrégées sur les employés et départements
select
    c.company_id,
    c.company_name,
    count(e.employee_id) as total_employee,
    count(case when e.is_active = true then 1 else 0 end) as total_employee_active,
    sum(case when e.is_manager then 1 else 0 end) as total_manager,
    sum(case when e.is_manager and e.is_active = true then 1 else 0 end) as total_manager_active,
    count(distinct e.department_id) as total_nb_departments

from "lucca_db"."public_base"."company" c
left join "lucca_db"."public_transform"."employee_extended" e
    on c.company_id = e.company_id

group by
    c.company_id,
    c.company_name
  );
  
[0m14:39:36.496894 [debug] [Thread-1  ]: SQL status: SELECT 5 in 0.003 seconds
[0m14:39:36.498908 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:36.499102 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended" rename to "company_extended__dbt_backup"
[0m14:39:36.499552 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.500887 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:36.501045 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
alter table "lucca_db"."public_transform"."company_extended__dbt_tmp" rename to "company_extended"
[0m14:39:36.501420 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.502110 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:39:36.502277 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:36.502424 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: COMMIT
[0m14:39:36.503419 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:36.504528 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."company_extended__dbt_backup"
[0m14:39:36.504838 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.company_extended"
[0m14:39:36.504984 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.company_extended"} */
drop table if exists "lucca_db"."public_transform"."company_extended__dbt_backup" cascade
[0m14:39:36.506484 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:36.507011 [debug] [Thread-1  ]: On model.lucca_dbt.company_extended: Close
[0m14:39:36.507265 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fe87f0>]}
[0m14:39:36.507534 [info ] [Thread-1  ]: 8 of 9 OK created sql table model public_transform.company_extended ............ [[32mSELECT 5[0m in 0.02s]
[0m14:39:36.507778 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.company_extended
[0m14:39:36.507944 [debug] [Thread-1  ]: Began running node model.lucca_dbt.department_extended
[0m14:39:36.508173 [info ] [Thread-1  ]: 9 of 9 START sql table model public_transform.department_extended .............. [RUN]
[0m14:39:36.508376 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.lucca_dbt.company_extended, now model.lucca_dbt.department_extended)
[0m14:39:36.508529 [debug] [Thread-1  ]: Began compiling node model.lucca_dbt.department_extended
[0m14:39:36.510076 [debug] [Thread-1  ]: Writing injected SQL for node "model.lucca_dbt.department_extended"
[0m14:39:36.510394 [debug] [Thread-1  ]: Began executing node model.lucca_dbt.department_extended
[0m14:39:36.512734 [debug] [Thread-1  ]: Writing runtime sql for node "model.lucca_dbt.department_extended"
[0m14:39:36.512987 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:36.513129 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: BEGIN
[0m14:39:36.513268 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:39:36.519754 [debug] [Thread-1  ]: SQL status: BEGIN in 0.006 seconds
[0m14:39:36.519930 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:36.520090 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */

  
    

  create  table "lucca_db"."public_transform"."department_extended__dbt_tmp"
  
  
    as
  
  (
    
-- description: Table pour regrouper les informations étendues sur les départements, incluant le nombre d'employés et de managers
select
    d.*,
    count(e.employee_id) as employee_count,
    sum(case when e.is_manager then 1 else 0 end) as manager_count
from "lucca_db"."public_base"."department" d
left join "lucca_db"."public_transform"."employee_extended" e
    on d.department_id = e.department_id and d.company_id = e.company_id
group by
    d.department_id,
    d.department_name,
    d.company_id,
    d.company_name
  );
  
[0m14:39:36.524680 [debug] [Thread-1  ]: SQL status: SELECT 32 in 0.004 seconds
[0m14:39:36.526232 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:36.526386 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended" rename to "department_extended__dbt_backup"
[0m14:39:36.526968 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.528243 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:36.528394 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
alter table "lucca_db"."public_transform"."department_extended__dbt_tmp" rename to "department_extended"
[0m14:39:36.528905 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:39:36.529526 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:39:36.529670 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:36.529807 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: COMMIT
[0m14:39:36.530453 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:39:36.531506 [debug] [Thread-1  ]: Applying DROP to: "lucca_db"."public_transform"."department_extended__dbt_backup"
[0m14:39:36.531817 [debug] [Thread-1  ]: Using postgres connection "model.lucca_dbt.department_extended"
[0m14:39:36.531965 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "lucca", "target_name": "dev", "node_id": "model.lucca_dbt.department_extended"} */
drop table if exists "lucca_db"."public_transform"."department_extended__dbt_backup" cascade
[0m14:39:36.533378 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.001 seconds
[0m14:39:36.533858 [debug] [Thread-1  ]: On model.lucca_dbt.department_extended: Close
[0m14:39:36.534108 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8b1d01-d1db-4a73-ae71-cde867446e53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1cc1f0>]}
[0m14:39:36.534376 [info ] [Thread-1  ]: 9 of 9 OK created sql table model public_transform.department_extended ......... [[32mSELECT 32[0m in 0.03s]
[0m14:39:36.534621 [debug] [Thread-1  ]: Finished running node model.lucca_dbt.department_extended
[0m14:39:36.535078 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:36.535240 [debug] [MainThread]: On master: BEGIN
[0m14:39:36.535378 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:39:36.542146 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:39:36.542282 [debug] [MainThread]: On master: COMMIT
[0m14:39:36.542404 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:36.542520 [debug] [MainThread]: On master: COMMIT
[0m14:39:36.542822 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:39:36.542947 [debug] [MainThread]: On master: Close
[0m14:39:36.543112 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:39:36.543226 [debug] [MainThread]: Connection 'model.lucca_dbt.department_extended' was properly closed.
[0m14:39:36.543391 [info ] [MainThread]: 
[0m14:39:36.543535 [info ] [MainThread]: Finished running 9 table models in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m14:39:36.544226 [debug] [MainThread]: Command end result
[0m14:39:36.554910 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/marccao/repo/dbt/target/manifest.json
[0m14:39:36.555669 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/marccao/repo/dbt/target/semantic_manifest.json
[0m14:39:36.558557 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/marccao/repo/dbt/target/run_results.json
[0m14:39:36.558684 [info ] [MainThread]: 
[0m14:39:36.558846 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:39:36.558981 [info ] [MainThread]: 
[0m14:39:36.559131 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m14:39:36.560471 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.89571226, "process_in_blocks": "0", "process_kernel_time": 0.156215, "process_mem_max_rss": "131596288", "process_out_blocks": "0", "process_user_time": 1.139358}
[0m14:39:36.560632 [debug] [MainThread]: Command `dbt run` succeeded at 14:39:36.560600 after 0.90 seconds
[0m14:39:36.560783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a44e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e4460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099d7af0>]}
[0m14:39:36.560929 [debug] [MainThread]: Flushing usage events
[0m14:39:37.879108 [debug] [MainThread]: An error was encountered while trying to flush usage events
